<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.plgrim.ncp.biz.goods.erp"> 
	<resultMap id="erpGoodsResult" type="com.plgrim.ncp.biz.goods.result.GoodsErpResult">
		<result property="rowNumber" 									column="NO"/>
		<result property="totalRow" 									column="TOTALROW"/>		
		<result property="infGodItmEx.brndId" 							column="BRND_ID"/>		
		<result property="infGodItmEx.sesonCd" 							column="SESON_CD"/>		
		<result property="infGodItmEx.dsgnGrpNo" 						column="DSGN_GRP_NO"/>		
		<result property="infGodItmEx.erpGodNo" 						column="ERP_GOD_NO"/>		
		<result property="infGodItmEx.bcode" 							column="BCODE"/>		
		<result property="infGodItmEx.godNm" 							column="GOD_NM"/>		
		<result property="infGodItmEx.engGodNm"							column="ENG_GOD_NM"/>
		<result property="infGodItmEx.chiGodNm"							column="CHI_GOD_NM"/>		
		<result property="infGodItmEx.rtlPrc" 							column="RTL_PRC"/>		
		<result property="infGodItmEx.colorCd" 							column="COLOR_CD"/>		
		<result property="infGodItmEx.lndrCd" 							column="LNDR_CD"/>		
		<result property="infGodItmEx.optValCd" 						column="OPT_VAL_CD"/>		
		<result property="infGodItmEx.recomendSexCd" 					column="RECOMEND_SEX_CD"/>		
		<result property="infGodItmEx.prdlstCd" 						column="PRDLST_CD"/>		
		<result property="infGodItmEx.prdcSectCd" 						column="PRDC_SECT_CD"/>		
		<result property="infGodItmEx.godSectCd" 						column="GOD_SECT_CD"/>		
		<result property="infGodItmEx.orgPlNm" 							column="ORG_PL_NM"/>		
		<result property="infGodItmEx.mnfcturYm" 						column="MNFCTUR_YM"/>		
		<result property="infGodItmEx.kcCrtfcNo" 						column="KC_CRTFC_NO"/>		
		<result property="infGodItmEx.relatErpGodNo" 					column="RELAT_ERP_GOD_NO"/>		
		<result property="infGodItmEx.fitSectCd" 						column="FIT_SECT_CD"/>		
		<result property="infGodItmEx.fitDetailSectCd" 					column="FIT_DETAIL_SECT_CD"/>		
		<result property="infGodItmEx.imprcomNm" 						column="IMPRCOM_NM"/>		
		<result property="infGodItmEx.trtmntAtndMatterDscr" 			column="TRTMNT_ATND_MATTER_DSCR"/>		
		<result property="infGodItmEx.csmrPrcTpCd" 						column="CSMR_PRC_TP_CD"/>		
		<result property="infGodItmEx.regDt"				 			column="REG_DT"/>
	</resultMap>
	
	<sql id="goodsErpWhere">
		AND IGI.ERP_GOD_NO IS NOT NULL
        AND NOT EXISTS (SELECT 1
                         FROM GOD G
                        WHERE IGI.ERP_GOD_NO = G.ERP_GOD_NO)
        AND EXISTS (SELECT 1 FROM COM_GOD_OPT_VAL CGOV WHERE IGI.OPT_VAL_CD = CGOV.OPT_VAL_CD AND CGOV.COM_ID = #{comId, jdbcType=VARCHAR})                
		<choose>
			<when test="godNos != null and godNos != '' and godNos.length > 0">				
   				<if test="godNosGbn == 'erp_god_no'">
   					AND IGI.ERP_GOD_NO IN (<foreach collection="godNos" item="godNos" separator=",">#{godNos, jdbcType=VARCHAR}</foreach>)
   				</if>
   				<if test="godNosGbn == 'god_nm'">
   					AND IGI.GOD_NM IN (<foreach collection="godNos" item="godNos" separator=",">#{godNos, jdbcType=VARCHAR}</foreach>)
   				</if>
  				<if test="godNosGbn == 'prdlst_cd'">
  					AND IGI.PRDLST_CD IN (<foreach collection="godNos" item="godNos" separator=",">#{godNos, jdbcType=VARCHAR}</foreach>)
  				</if>   				
   				<if test="godNosGbn == 'seson_cd'">
   					AND IGI.SESON_CD IN (<foreach collection="godNos" item="godNos" separator=",">#{godNos, jdbcType=VARCHAR}</foreach>)
   				</if>   				
			</when>		
			<otherwise>
				<if test="!@com.plgrim.ncp.framework.commons.StringService@isEmpty(term)">
					<if test="@com.plgrim.ncp.framework.commons.StringService@equalsIgnoreCase(term,'regdt')">			 	
		 				AND IGI.REG_DT <![CDATA[>=]]> TO_DATE(#{startTermDt}||' 00:00:00', 'YYYY-MM-DD HH24:MI:SS') 
		 				AND IGI.REG_DT <![CDATA[<=]]> TO_DATE(#{endTermDt}||' 23:59:59', 'YYYY-MM-DD HH24:MI:SS') 
					</if>		
				</if>
				<if test="!@com.plgrim.ncp.framework.commons.StringService@isEmpty(erpGodNo)">
					AND IGI.ERP_GOD_NO = #{erpGodNo, jdbcType=VARCHAR}
				</if>
				<if test="(!@com.plgrim.ncp.framework.commons.StringService@isEmpty(brndIds) and brndIds.length > 0)">
					AND IGI.BRND_ID IN (<foreach collection="brndIds" item="brndIds" separator=",">#{brndIds, jdbcType=VARCHAR}</foreach>)
				</if>		
				<if test="!@com.plgrim.ncp.framework.commons.StringService@isEmpty(godNm)">
					AND UPPER(IGI.GOD_NM) LIKE UPPER('%'||#{godNm, jdbcType=VARCHAR}||'%')
				</if>		  				
				<if test="!@com.plgrim.ncp.framework.commons.StringService@isEmpty(prcMin)">
					AND IGI.RTL_PRC <![CDATA[>=]]> TO_NUMBER(#{prcMin, jdbcType=VARCHAR})
				</if>
				<if test="!@com.plgrim.ncp.framework.commons.StringService@isEmpty(prcMax)">
					AND IGI.RTL_PRC <![CDATA[<=]]> TO_NUMBER(#{prcMax, jdbcType=VARCHAR})
				</if>			
			</otherwise>
		</choose>
	</sql>
	
	<select id="selectErpGoodsList" parameterType="com.plgrim.ncp.biz.goods.data.GoodsSearchDTO" resultMap="erpGoodsResult">		
		<include refid="com.plgrim.ncp.base.beginPage"/>
	        SELECT /* [goods.erp.xml][selectErpGoodsList][ERP상품 목록][Neps] */
	               IGI.SEQ
	             , IGI.BRND_ID
	             , IGI.SESON_CD
	             , IGI.DSGN_GRP_NO
	             , IGI.ERP_GOD_NO
	             , IGI.BCODE
	             , IGI.GOD_NM
	             , IGI.ENG_GOD_NM
	             , IGI.CHI_GOD_NM
	             , IGI.RTL_PRC
	             , IGI.COLOR_CD
	             , IGI.LNDR_CD
	             , IGI.OPT_VAL_CD
	             , IGI.RECOMEND_SEX_CD
	             , IGI.PRDLST_CD
	             , IGI.PRDC_SECT_CD
	             , IGI.GOD_SECT_CD
	             , IGI.ORG_PL_NM
	             , IGI.MNFCTUR_YM
	             , IGI.KC_CRTFC_NO
	             , IGI.RELAT_ERP_GOD_NO
	             , IGI.FIT_SECT_CD
	             , IGI.FIT_DETAIL_SECT_CD
	             , IGI.IMPRCOM_NM
	             , IGI.TRTMNT_ATND_MATTER_DSCR
	             , IGI.CSMR_PRC_TP_CD
	             , IGI.REGTR_ID
	             , IGI.REG_DT
	             , IGI.UDTER_ID
	             , IGI.UDT_DT
	          FROM INF_GOD_ITM IGI
			 <if test="adminTpCd != 'SYS_OPRTR'">
			  JOIN SYS_ADMIN_BRND SAB ON (IGI.BRND_ID = SAB.BRND_ID AND SAB.ADMIN_ID = #{loginId,jdbcType=VARCHAR})
			 </if>	          
	         WHERE 1 = 1
	         <include refid="com.plgrim.ncp.biz.goods.erp.goodsErpWhere"/>
	         ORDER BY REG_DT DESC
		<include refid="com.plgrim.ncp.base.endPage"/> 
	</select>
 	
 	<select id="getErpGoodsListCount" parameterType="com.plgrim.ncp.biz.goods.data.GoodsSearchDTO" resultType="long">
 		SELECT /* [goods.erp.xml][getErpGoodsListCount][ERP상품 목록 수][Neps] */
 			COUNT(IGI.SEQ)
 		 FROM INF_GOD_ITM IGI
		<if test="adminTpCd != 'SYS_OPRTR'">
		 JOIN SYS_ADMIN_BRND SAB ON (IGI.BRND_ID = SAB.BRND_ID AND SAB.ADMIN_ID = #{loginId,jdbcType=VARCHAR})
		</if>
 		WHERE 1 = 1 
 		<include refid="com.plgrim.ncp.biz.goods.erp.goodsErpWhere"/>
 	</select>
 	
 	<select id="getErpGoods" parameterType="String" resultType="infGodItmExtend">
		SELECT /* [goods.erp.xml][getErpGoods][ERP상품 조회][Neps] */
		       T.*
		 FROM (        
		        SELECT 
		               IGI.SEQ
		             , IGI.BRND_ID
		             , IGI.SESON_CD
		             , IGI.DSGN_GRP_NO
		             , IGI.ERP_GOD_NO
		             , IGI.BCODE
		             , IGI.GOD_NM
		             , IGI.ENG_GOD_NM
		             , IGI.CHI_GOD_NM
		             , IGI.RTL_PRC
		             , IGI.COLOR_CD
		             , IGI.LNDR_CD
		             , IGI.RECOMEND_SEX_CD
		             , IGI.PRDLST_CD
		             , IGI.PRDC_SECT_CD
		             , IGI.GOD_SECT_CD
		             , IGI.ORG_PL_NM
		             , IGI.ENG_ORG_PL_NM
		             , IGI.CHI_ORG_PL_NM
		             , IGI.MNFCTUR_YM
		             , IGI.KC_CRTFC_NO
		             , IGI.RELAT_ERP_GOD_NO
		             , IGI.FIT_SECT_CD
		             , IGI.FIT_DETAIL_SECT_CD
		             , IGI.IMPRCOM_NM
		             , IGI.TRTMNT_ATND_MATTER_DSCR
		             , IGI.CSMR_PRC_TP_CD
		             , IGI.DSGN_GRP_SET_CONT
		             , (
		                SELECT DISTINCT LISTAGG(IGM.SECT_NM||':'||IGM.MATR_NM||' '||IGM.MIX_RT||'%', ', ') WITHIN GROUP (ORDER BY IGM.ERP_GOD_NO ) OVER (PARTITION BY IGM.ERP_GOD_NO)
		                 FROM INF_GOD_MATR IGM
		                WHERE IGM.ERP_GOD_NO = IGI.ERP_GOD_NO  
		                AND IGM.EXPSR_SEQ || '_' || IGM.REG_DT IN ( SELECT EXPSR_SEQ || '_' || MAX(REG_DT) OVER(PARTITION BY BRND_ID, SESON_CD, DSGN_GRP_NO, ERP_GOD_NO, COLOR_CD, EXPSR_SEQ) FROM INF_GOD_MATR WHERE ERP_GOD_NO = IGM.ERP_GOD_NO AND SECT_NM IS NOT NULL )                 
		               )  AS MATR_DSCR
                     , (
                        SELECT DISTINCT
                               CASE
                                WHEN IGM.ENG_SECT_NM IS NOT NULL THEN
                                    LISTAGG(IGM.ENG_SECT_NM||':'||IGM.ENG_MATR_NM||' '||IGM.MIX_RT||'%', ', ') WITHIN GROUP (ORDER BY IGM.ERP_GOD_NO ) OVER (PARTITION BY IGM.ERP_GOD_NO)
                                ELSE
                                    '' 
                               END                              
                         FROM INF_GOD_MATR IGM
                        WHERE IGM.ERP_GOD_NO = IGI.ERP_GOD_NO  
                          AND IGM.ENG_SECT_NM IS NOT NULL  
                          AND IGM.EXPSR_SEQ || '_' || IGM.REG_DT IN ( SELECT EXPSR_SEQ || '_' || MAX(REG_DT) OVER(PARTITION BY BRND_ID, SESON_CD, DSGN_GRP_NO, ERP_GOD_NO, COLOR_CD, EXPSR_SEQ) FROM INF_GOD_MATR WHERE ERP_GOD_NO = IGM.ERP_GOD_NO AND ENG_SECT_NM IS NOT NULL )               
                       )  AS ENG_MATR_DSCR
                     , (
                         SELECT DISTINCT
                               CASE
                                WHEN IGM.CHI_SECT_NM IS NOT NULL THEN
                                    LISTAGG(IGM.CHI_SECT_NM||':'||IGM.CHI_MATR_NM||' '||IGM.MIX_RT||'%', ', ') WITHIN GROUP (ORDER BY IGM.ERP_GOD_NO ) OVER (PARTITION BY IGM.ERP_GOD_NO)
                                ELSE
                                    '' 
                               END                              
                         FROM INF_GOD_MATR IGM
                        WHERE IGM.ERP_GOD_NO = IGI.ERP_GOD_NO     
                          AND IGM.CHI_SECT_NM IS NOT NULL 
                          AND IGM.EXPSR_SEQ || '_' || IGM.REG_DT IN ( SELECT EXPSR_SEQ || '_' || MAX(REG_DT) OVER(PARTITION BY BRND_ID, SESON_CD, DSGN_GRP_NO, ERP_GOD_NO, COLOR_CD, EXPSR_SEQ) FROM INF_GOD_MATR WHERE ERP_GOD_NO = IGM.ERP_GOD_NO AND CHI_SECT_NM IS NOT NULL )             
                       )  AS CHI_MATR_DSCR
		             , RANK() OVER (PARTITION BY IGI.ERP_GOD_NO ORDER BY IGI.SEQ DESC ) AS RNUM  
		          FROM INF_GOD_ITM IGI
		         WHERE 1 = 1
		           AND IGI.ERP_GOD_NO = #{erpGodNo, jdbcType=VARCHAR}
		        ) T
		WHERE T.RNUM = 1
 	</select>
 	
 	<select id="getErpGoodsItem" parameterType="com.plgrim.ncp.biz.goods.data.GoodsSearchDTO" resultType="godItmExtend">
	    SELECT * FROM (
		    SELECT /* [goods.erp.xml][getErpGoodsItem][ERP상품 단품 조회][Neps] */
		    	   A.*
		     FROM (
		     	SELECT
		     		   IGI.ERP_GOD_NO||IGI.OPT_VAL_CD AS SKU_NO
			         , CGOV.OPT_VAL_NM AS ITM_NM
			         , CGO.OPT_CD  AS OPT_CD_1
			         , CGO.OPT_NM  AS OPT_NM_1
			         , CGOV.OPT_VAL_CD AS OPT_VAL_CD_1
			         , CGOV.OPT_VAL_NM AS OPT_VAL_NM_1
			         , CGOV.SORT_SEQ
			     FROM INF_GOD_ITM IGI
			     JOIN COM_GOD_OPT_VAL CGOV ON (IGI.OPT_VAL_CD = CGOV.OPT_VAL_CD AND CGOV.COM_ID = #{comId, jdbcType=VARCHAR})
			     JOIN COM_GOD_OPT CGO ON (CGO.COM_ID = CGOV.COM_ID AND CGO.OPT_CD = CGOV.OPT_CD)
			    WHERE IGI.ERP_GOD_NO = #{erpGodNo, jdbcType=VARCHAR}
			      AND TRANSLATE(CGOV.OPT_VAL_CD, '0123456789', 'A') = CGOV.OPT_VAL_CD
			    ORDER BY CGOV.SORT_SEQ
		    ) A
		    UNION ALL
		    SELECT
		    	   B.*
		     FROM (
		     	SELECT
		     	   	   IGI.ERP_GOD_NO||IGI.OPT_VAL_CD AS SKU_NO
			         , CGOV.OPT_VAL_NM AS ITM_NM
			         , CGO.OPT_CD  AS OPT_CD_1
			         , CGO.OPT_NM  AS OPT_NM_1
			         , CGOV.OPT_VAL_CD AS OPT_VAL_CD_1
			         , CGOV.OPT_VAL_NM AS OPT_VAL_NM_1
			         , CGOV.SORT_SEQ
			     FROM INF_GOD_ITM IGI
			     JOIN COM_GOD_OPT_VAL CGOV ON (IGI.OPT_VAL_CD = CGOV.OPT_VAL_CD AND CGOV.COM_ID = #{comId, jdbcType=VARCHAR})
			     JOIN COM_GOD_OPT CGO ON (CGO.COM_ID = CGOV.COM_ID AND CGO.OPT_CD = CGOV.OPT_CD)
			    WHERE IGI.ERP_GOD_NO = #{erpGodNo, jdbcType=VARCHAR}
			      AND TRANSLATE(CGOV.OPT_VAL_CD, '0123456789' || CGOV.OPT_VAL_CD, '0123456789') = CGOV.OPT_VAL_CD
			    ORDER BY TO_NUMBER(CGOV.OPT_VAL_CD)
		    ) B
	        UNION
		    SELECT
		    	   C.*
		     FROM (
	            SELECT 
	                   IGI.ERP_GOD_NO||IGI.OPT_VAL_CD AS SKU_NO
	                 , CGOV.OPT_VAL_NM AS ITM_NM
	                 , CGO.OPT_CD  AS OPT_CD_1
	                 , CGO.OPT_NM  AS OPT_NM_1
	                 , CGOV.OPT_VAL_CD AS OPT_VAL_CD_1
	                 , CGOV.OPT_VAL_NM AS OPT_VAL_NM_1
	                 , CGOV.SORT_SEQ 
	             FROM INF_GOD_ITM IGI
	             JOIN COM_GOD_OPT_VAL CGOV ON (IGI.OPT_VAL_CD = CGOV.OPT_VAL_CD AND CGOV.COM_ID = #{comId, jdbcType=VARCHAR})
	             JOIN COM_GOD_OPT CGO ON (CGO.COM_ID = CGOV.COM_ID AND CGO.OPT_CD = CGOV.OPT_CD)
	            WHERE IGI.ERP_GOD_NO = #{erpGodNo, jdbcType=VARCHAR}
	            ORDER BY CGOV.SORT_SEQ
	        ) C
	    ) ORDER BY SORT_SEQ
 	</select>

	<select id="getGoodsLaundryDescriptionList" parameterType="String" resultType="godLndrDscr">
		SELECT /* [goods.erp.xml][getGoodsLaundryDescriptionList][세탁코드 설명 목록 조회][Neps] */
			   LNDR_CD
			 , LANG_CD
			 , LNDR_MTHD_DSCR
			 , REGTR_ID
			 , REG_DT
			 , UDTER_ID
			 , UDT_DT
		  FROM GOD_LNDR_DSCR
		 WHERE 1 = 1
	   	   AND LNDR_CD = #{lndrCd,jdbcType=VARCHAR}
	</select>

	<select id="getGoodsLaundryImageList" parameterType="com.plgrim.ncp.biz.goods.data.GoodsSearchDTO" resultType="godLndrImg">
		SELECT /* [goods.erp.xml][getGoodsLaundryImageList][세탁코드 이미지 조회][Neps] */
			   LNDR_CD  
			 , LANG_CD
			 , BRND_GRP_ID  
			 , LNDR_IMG_TURN			 
			 , LNDR_IMG_USE_YN
			 , LNDR_IMG_FILE_URL
			 , LNDR_IMG_ALTRTV_CONT
		  FROM GOD_LNDR_IMG
		 WHERE 1 = 1
	   	   AND LNDR_CD = #{lndrCd,jdbcType=VARCHAR}
	   	   AND BRND_GRP_ID = #{brndGrpId,jdbcType=VARCHAR}
	   	 <if test="!@com.plgrim.ncp.framework.commons.StringService@isEmpty(langCd)">
	   	   AND LANG_CD = #{langCd,jdbcType=VARCHAR}
	   	 </if>  	
	</select>
	
	<select id="getErpGoodsUploadExcelTemplate" parameterType="com.plgrim.ncp.biz.goods.data.GoodsSearchDTO" resultType="java.util.LinkedHashMap">
	    SELECT /* [goods.erp.xml][getErpGoodsUploadExcelTemplate][ERP상품 엑셀 업로드 템플릿 목록][Neps] */
                   T.GOD_TP_CD      AS 상품유형코드
                 , T.ERP_GOD_NO     AS ERP상품번호
                 , 'N'              AS 매장픽업여부
                 , T.GOD_NM         AS 상품명
                 , T.ENG_GOD_NM     AS 영문상품명
                 , T.CHI_GOD_NM		AS 중문상품명
                 , T.GOD_NM         AS 모바일상품명
                 , T.ENG_GOD_NM     AS 영문모바일상품명
                 , T.CHI_GOD_NM		AS 중문모바일상품명
                 , ''				AS EP상품명
                 , T.MALL_ID        AS 전시몰
                 , ''               AS 전시카테고리
                 , T.MNFCTUR_YM     AS 제조년월
                 , T.LNDR_CD        AS 세탁코드
                 , T.ORG_PL_NM      AS 제조국
                 , T.ENG_ORG_PL_NM	AS 영문제조국
                 , T.CHI_ORG_PL_NM	AS 중문제조국
                 , T.MATR_DSCR      AS 소재
                 , T.ENG_MATR_DSCR	AS 영문소재
                 , T.CHI_MATR_DSCR	AS 중문소재
                 , ''               AS 유사검색어
                 , ''               AS 상품상세설명_1
                 , ''               AS 영문상품상세설명_1
                 , ''               AS 중문상품상세설명_1
                 , ''               AS 상품상세설명_2
                 , ''               AS 영문상품상세설명_2
                 , ''               AS 중문상품상세설명_2
                 , ''               AS 조견표이미지
                 , ''               AS 사이즈조견표_국문
                 , ''               AS 사이즈조견표_영문
                 , ''               AS 사이즈조견표_중문
                 , ''               AS MB사이즈조견표_국문
                 , ''               AS MB사이즈조견표_영문
                 , ''               AS MB사이즈조견표_중문
         FROM (
                SELECT (CASE
                            WHEN IGI.SESON_CD = 'X' THEN
                                'PCHS_GFT'
                            ELSE
                                'GNRL_GOD'
                       END)                AS GOD_TP_CD
                     , IGI.ERP_GOD_NO
                     , IGI.GOD_NM
                     , IGI.ENG_GOD_NM
                     , IGI.CHI_GOD_NM
                     /* 몰ID MLB, SA 추가필요 - ds */
                     , (CASE
                        WHEN SB.UPPER_BRND_ID = 'DX' THEN
                            'DXM'
                        WHEN SB.UPPER_BRND_ID = 'ML' THEN
                        	'MBM'
                        WHEN SB.UPPER_BRND_ID = 'SA' THEN
                        	'SAM'
                        ELSE
                            ''
                        END) AS MALL_ID
                     , IGI.MNFCTUR_YM
                     , IGI.LNDR_CD
                     , IGI.ORG_PL_NM
                     , IGI.ENG_ORG_PL_NM
                     , IGI.CHI_ORG_PL_NM
                     , (SELECT DISTINCT LISTAGG(IGM.SECT_NM||':'||IGM.MATR_NM||' '||IGM.MIX_RT||'%', ', ') WITHIN GROUP (ORDER BY IGM.ERP_GOD_NO ) OVER (PARTITION BY IGM.ERP_GOD_NO)
                          FROM INF_GOD_MATR IGM
                         WHERE IGM.ERP_GOD_NO = IGI.ERP_GOD_NO
                         AND IGM.EXPSR_SEQ || '_' || IGM.REG_DT IN ( SELECT EXPSR_SEQ || '_' || MAX(REG_DT) OVER(PARTITION BY BRND_ID, SESON_CD, DSGN_GRP_NO, ERP_GOD_NO, COLOR_CD, EXPSR_SEQ) FROM INF_GOD_MATR WHERE ERP_GOD_NO = IGM.ERP_GOD_NO AND SECT_NM IS NOT NULL )
                       ) AS MATR_DSCR
                     , (
                        SELECT DISTINCT
                               CASE
                                WHEN IGM.ENG_SECT_NM IS NOT NULL THEN
                                    LISTAGG(IGM.ENG_SECT_NM||':'||IGM.ENG_MATR_NM||' '||IGM.MIX_RT||'%', ', ') WITHIN GROUP (ORDER BY IGM.ERP_GOD_NO ) OVER (PARTITION BY IGM.ERP_GOD_NO)
                                ELSE
                                    ''
                               END
                         FROM INF_GOD_MATR IGM
                        WHERE IGM.ERP_GOD_NO = IGI.ERP_GOD_NO
                        AND IGM.ENG_SECT_NM IS NOT NULL
                        AND IGM.EXPSR_SEQ || '_' || IGM.REG_DT IN ( SELECT EXPSR_SEQ || '_' || MAX(REG_DT) OVER(PARTITION BY BRND_ID, SESON_CD, DSGN_GRP_NO, ERP_GOD_NO, COLOR_CD, EXPSR_SEQ) FROM INF_GOD_MATR WHERE ERP_GOD_NO = IGM.ERP_GOD_NO AND ENG_SECT_NM IS NOT NULL )
                       )  AS ENG_MATR_DSCR
                     , (
                        SELECT DISTINCT
                               CASE
                                WHEN IGM.CHI_SECT_NM IS NOT NULL THEN
                                    LISTAGG(IGM.CHI_SECT_NM||':'||IGM.CHI_MATR_NM||' '||IGM.MIX_RT||'%', ', ') WITHIN GROUP (ORDER BY IGM.ERP_GOD_NO ) OVER (PARTITION BY IGM.ERP_GOD_NO)
                                ELSE
                                    ''
                               END
                         FROM INF_GOD_MATR IGM
                        WHERE IGM.ERP_GOD_NO = IGI.ERP_GOD_NO
                        AND IGM.CHI_SECT_NM IS NOT NULL
                        AND IGM.EXPSR_SEQ || '_' || IGM.REG_DT IN ( SELECT EXPSR_SEQ || '_' || MAX(REG_DT) OVER(PARTITION BY BRND_ID, SESON_CD, DSGN_GRP_NO, ERP_GOD_NO, COLOR_CD, EXPSR_SEQ) FROM INF_GOD_MATR WHERE ERP_GOD_NO = IGM.ERP_GOD_NO AND CHI_SECT_NM IS NOT NULL )
                       )  AS CHI_MATR_DSCR
                     , RANK() OVER (PARTITION BY IGI.ERP_GOD_NO ORDER BY IGI.SEQ DESC ) AS RNUM
                  FROM INF_GOD_ITM IGI
                  JOIN SYS_BRND SB ON (IGI.BRND_ID = SB.BRND_ID)
				 <if test="adminTpCd != 'SYS_OPRTR'">
				  JOIN SYS_ADMIN_BRND SAB ON (IGI.BRND_ID = SAB.BRND_ID AND SAB.ADMIN_ID = #{loginId,jdbcType=VARCHAR})
				 </if>
                 WHERE 1 = 1
	               <if test="erpGodNos != null and erpGodNos != '' and erpGodNos.length > 0">
	               AND IGI.ERP_GOD_NO IN (<foreach collection="erpGodNos" item="erpGodNos" separator=",">#{erpGodNos, jdbcType=VARCHAR}</foreach>)
	               </if>
	          ) T
	    WHERE T.RNUM = 1
	    ORDER BY GOD_TP_CD DESC
	</select>
	
	<select id="getErpGoodsSizeLktbPomList" parameterType="String" resultType="infGodSizeLktbPom">
	    SELECT /* [goods.erp.xml][getErpGoodsSizeLktbPomList][ERP 상품의 사이즈조견표 POM 정보 조회][Neps] */
	    	   IGSLP.SEQ
	         , IGSLP.BRND_ID
	         , IGSLP.POM_CD
	         , IGSLP.POM_NM
	         , IGSLP.ENG_POM_NM
	     FROM INF_GOD_SIZE_LKTB_POM IGSLP
	    WHERE EXISTS (SELECT 1 
	    			   FROM INF_GOD_SIZE_LKTB IGSL 
	    			  WHERE IGSLP.BRND_ID = IGSL.BRND_ID 
	    			    AND IGSLP.POM_CD = IGSL.POM_CD 
	    			    AND IGSL.DSGN_GRP_NO = #{dsgnGrpNo, jdbcType=VARCHAR})
		ORDER BY IGSLP.SEQ		
	</select>

	<select id="getErpGoodsSizeLktbPomExList" parameterType="com.plgrim.ncp.base.entities.datasource1.inf.InfGodSizeLktb" resultType="InfGodSizeLktbPomExtend">
	    SELECT /* [goods.erp.xml][getErpGoodsSizeLktbPomExList][ERP 상품의 사이즈조견표 POM 정보 조회][Neps] */
	    	   IGSLP.SEQ
	         , IGSLP.BRND_ID
	         , IGSLP.POM_CD
	         , IGSLP.POM_NM
	         , IGSLP.ENG_POM_NM
	         , IGSLP.CHI_POM_NM
             , SBPP.POM_CLFC_CD
             , SBPP.SORT_SEQ	         
	     FROM INF_GOD_SIZE_LKTB_POM IGSLP
	     JOIN SYS_BRND_PRDLST_POM SBPP ON (IGSLP.POM_CD = SBPP.POM_CD AND IGSLP.BRND_ID = SBPP.BRND_ID AND SBPP.USE_YN = 'Y')
	    WHERE IGSLP.BRND_ID = #{brndId, jdbcType=VARCHAR} 
	      AND EXISTS (SELECT 1 
	    			   FROM INF_GOD_SIZE_LKTB IGSL 
	    			  WHERE IGSLP.BRND_ID = IGSL.BRND_ID 
	    			    AND IGSLP.POM_CD = IGSL.POM_CD 
	    			    AND IGSL.DSGN_GRP_NO = #{dsgnGrpNo, jdbcType=VARCHAR})
          AND EXISTS (SELECT 1
                       FROM INF_GOD_ITM IGI
                      WHERE IGSLP.BRND_ID = IGI.BRND_ID
                        AND SBPP.PRDLST_CD = IGI.PRDLST_CD
                        AND IGI.DSGN_GRP_NO = #{dsgnGrpNo, jdbcType=VARCHAR})          
        ORDER BY SBPP.POM_CLFC_CD ASC, SBPP.SORT_SEQ ASC 		
	</select>

	<select id="getErpGoodsSizeLktbList" parameterType="com.plgrim.ncp.base.entities.datasource1.inf.InfGodSizeLktb" resultType="infGodSizeLktb">
		SELECT /* [goods.erp.xml][getErpGoodsSizeLktbList][ERP 상품의 사이즈조견표 정보 조회][Neps] */
			   IGSL.BRND_ID
			 , IGSL.DSGN_GRP_NO  
			 , IGSL.POM_CD  
			 , IGSL.OPT_VAL_CD  
			 , IGSL.SIZE_VAL  
		 FROM INF_GOD_SIZE_LKTB IGSL
		WHERE IGSL.DSGN_GRP_NO = #{dsgnGrpNo, jdbcType=VARCHAR}
		  AND IGSL.BRND_ID = #{brndId, jdbcType=VARCHAR}  
		ORDER BY IGSL.SEQ
	</select>
	
	<select id="getMlbGoodsSizeLktbExList" parameterType="Map" resultType="java.util.HashMap">
		SELECT /* [goods.erp.xml][getMlbGoodsSizeLktbExList][ERP MLB 상품의 사이즈조견표 정보 조회][ds] */
			LANG_CD
			, TO_CHAR(SIZE_LKTB_HTML) AS SIZE_LKTB_HTML
			, TO_CHAR(MOBILE_SIZE_LKTB_HTML) AS MOBILE_SIZE_LKTB_HTML
		 FROM INF_GOD_SIZE_LKTB_EXCP
		WHERE 1=1
		  AND BRND_ID = #{brndId,jdbcType=VARCHAR}
		  AND PRDLST_CD = #{prdlstCd,jdbcType=VARCHAR}
		  <if test="!@com.plgrim.ncp.framework.commons.StringService@isEmpty(fitDetailSectCd)">
	   	   AND FIT_SECT_CD = #{fitDetailSectCd,jdbcType=VARCHAR}
	   	  </if>
	   	  <if test="@com.plgrim.ncp.framework.commons.StringService@isEmpty(fitDetailSectCd)">
	   	   AND FIT_SECT_CD IS NULL
	   	  </if>
	</select>

	<select id="isExistFitGuideCheckSizePomCd" parameterType="Map" resultType="int">
	    SELECT /* [goods.erp.xml][isExistFitGuideCheckSizePomCd][ERP 핏 조견표 정보 조회시 필요한  사이즈 조견표 POM 코드 존재 여부 체크][Neps] */
	    	   COUNT(DISTINCT IGSL.POM_CD) AS CNT
	     FROM INF_GOD_SIZE_LKTB IGSL
	    WHERE IGSL.POM_CD = #{pomCd,jdbcType=VARCHAR}
	      AND EXISTS (SELECT 1 
	      			   FROM GOD G 
	      			  WHERE IGSL.DSGN_GRP_NO = G.DSGN_GRP_NO 
	      			  	AND IGSL.BRND_ID = G.BRND_ID 
	      			  	AND IGSL.SESON_CD = G.SESON_CD 
	      			  	AND G.GOD_NO = #{godNo,jdbcType=VARCHAR}) 	
	</select>

	<select id="getGoodsErpFitGuide" parameterType="com.plgrim.ncp.base.entities.datasource1.inf.InfGodFitLktbExtend" resultType="infGodFitLktbExtend">	
		SELECT /* [goods.erp.xml][getGoodsErpFitGuide][ERP 상품의 핏 조견표 정보 조회][Neps] */
			   R.FIT_LKTB_CNNC_NO
			 , R.LANG_CD  
			 , R.FIT_SECT_CD
		     , R.FIT_LKTB_HTML
		     , R.MOBILE_FIT_LKTB_HTML
		     , FMSC.CD_NM AS FIT_SECT_CD_NM
		 FROM (
		        SELECT IGFL.BRND_ID
		             , IGFL.PRDLST_CD
		             , IGFL.LANG_CD
		             , IGFL.FIT_SECT_CD
		             , IGFL.SESON_GRP_CD
		             , IGFL.RECOMEND_SEX_CD
		             , IGFL.POM_CD
		             , IGFL.FIT_LKTB_CNNC_NO
		             , IGFLC.FIT_LKTB_HTML
		             , IGFLC.MOBILE_FIT_LKTB_HTML      
		             , G.GOD_NO          
		             , ROW_NUMBER() OVER(PARTITION BY IGFL.BRND_ID
		                                            , IGFL.PRDLST_CD
		                                            , IGFL.LANG_CD
		                                            , IGFL.FIT_SECT_CD
		                                            , IGFL.SESON_GRP_CD
		                                            , IGFL.RECOMEND_SEX_CD
		                                            , IGFL.POM_CD ORDER BY IGFL.BRND_ID DESC) AS RNK
		         FROM GOD G
		         JOIN INF_GOD_ITM IGI ON (G.ERP_GOD_NO = IGI.ERP_GOD_NO)
		         JOIN INF_GOD_FIT_LKTB IGFL ON (G.BRND_ID = IGFL.BRND_ID AND G.PRDLST_CD = IGFL.PRDLST_CD AND G.SESON_GRP_CD = IGFL.SESON_GRP_CD AND G.RECOMEND_SEX_CD = IGFL.RECOMEND_SEX_CD AND IGI.FIT_DETAIL_SECT_CD = IGFL.FIT_SECT_CD)
		         JOIN INF_GOD_FIT_LKTB_CNNC IGFLC ON (IGFL.FIT_LKTB_CNNC_NO = IGFLC.FIT_LKTB_CNNC_NO)
		        WHERE G.GOD_NO = #{godNo,jdbcType=VARCHAR} 
		          AND IGFL.LANG_CD = #{langCd,jdbcType=VARCHAR}
		          <choose>
		          	<when test="!@com.plgrim.ncp.framework.commons.StringService@isEmpty(pomCd)">
		          		AND IGFL.POM_CD = #{pomCd,jdbcType=VARCHAR}
		          	</when>
		          	<otherwise>
		          		AND IGFL.POM_CD IS NULL
		          	</otherwise>
		          </choose>  
		    )R
		    JOIN MV_SYS_CD FMSC ON (R.FIT_SECT_CD = FMSC.CD AND R.LANG_CD = FMSC.LANG_CD AND FMSC.UPPER_CD = 'FIT_SECT')
		WHERE R.RNK = 1	
	</select>

</mapper>