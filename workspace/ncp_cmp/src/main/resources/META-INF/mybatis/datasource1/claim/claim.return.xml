<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.plgrim.ncp.biz.claim.return">


    <!-- 클레임 철회 기본정보조회 -->
    <select id="selectClaimCheckInfo" parameterType="com.plgrim.ncp.biz.claim.data.ClaimReturnSearchDTO" resultMap="selectCancelClaimInfoResult">
        SELECT /* [biz.claim.return.xml][selectClaimCheckInfo][클레임기본정보조회][khan] */
               clm_no                                                               AS clmNo                        /* 클레임번호 */
             , ord_no                                                               AS ordNo                        /* 주문번호 */
             , clm_tp_cd                                                            AS clmTpCd                      /* 클레임유형코드 */
             , clm_stat_cd                                                          AS clmStatCd                    /* 클레임상태코드 */
             , stdr_crncy_sum_amt                                                   AS stdrCrncySumAmt              /* 기준통화합계금액 */
             , (SELECT COUNT (1)
                  FROM lgs_rtrvl_drct_god
                 WHERE 1 = 1
<!--
                       AND restore_finish_yn = 'Y'                                  회수 완료 여부
                       AND restore_status_end_yn = 'N'                              회수상품처리완료여부
                       AND restore_status_cd IN ('58020', '58030');                 회수 상품 상태 코드 수선의뢰
 -->
                       AND rtrvl_stat_cd = 'WRHS_COMPT'                             /* 회수완료여부 */
                       AND rtrvl_god_stat_cd IN ('BADN_JDGMNT', 'REPAIR_REQEST')    /* 회수상품상태코드 수선의뢰 : REPAIR_REQEST, 불량판정 : BADN_JDGMNT */
        <if test='clmNo != null and clmNo != ""'>
                       AND clm_no = #{clmNo, jdbcType=VARCHAR}
        </if>
               )                                                                    AS chkCnt
             , (SELECT DECODE (COUNT (lrdg.rtrvl_drct_god_no), 0, 'Y', 'N')
                  FROM clm c
                       LEFT JOIN
                       clm_wrhs_god cwg ON (cwg.clm_no = c.clm_no)
                       LEFT JOIN lgs_rtrvl_drct_god lrdg ON (lrdg.clm_no = cwg.clm_no AND lrdg.clm_wrhs_god_turn = cwg.clm_wrhs_god_turn)
                 WHERE 1 = 1
                       AND c.clm_tp_cd = 'RTGOD'
                       AND c.clm_stat_cd NOT IN ('REQST', 'RCEPT', 'WTHDRAW') /* 반품신청, 반품접수, 철회 */
                       AND lrdg.rtrvl_stat_cd NOT IN ('RTRVL_DRCT', 'RTRVL_WTHDRAW') /* 회수지시, 회수철회 */
<!--
                       AND lrdg.rtrvl_stat_cd NOT IN ('', '')
                          AND c.return_st_cd <> '18206'                             철회가 아니고
                          AND c.return_st_cd NOT IN ('18201', '18202', '18203');    반품신청, 반품접수, 반품회수지시가 아니고
                          결과적으로 회수완료, 회수입고 인 경우
 -->
        <if test='clmNo != null and clmNo != ""'>
                       AND c.clm_no = #{clmNo, jdbcType=VARCHAR}
        </if>
               )                                                                    AS chkRtVal
             , (SELECT DECODE (COUNT (lddg.ord_no), 0, 'Y', 'N') AS excVal
                  FROM clm c
                       LEFT JOIN ord o ON (c.ord_no = o.ord_no)               /* 주문 */
                       LEFT JOIN ord_god og ON (og.ord_no = o.ord_no)         /* 주문상품 */
                       LEFT JOIN
                       lgs_dlivy_drct_god lddg
                          ON (    lddg.ord_no = og.ord_no
                              AND lddg.ord_god_turn = og.ord_god_turn
                              AND lddg.dlivy_drct_tp_cd IN ('EXCHG', 'DRT_EXCHG')   /* 교환출고지시, 교환포장중, 교환배송중, 교환배송완료 인 경우를 체크하고 있음. */
                              AND lddg.dlv_stat_cd IN ('DLIVY_DRCT', 'DLIVY_COMPT', 'DLV_COMPT')    /* 출고지시 : DLIVY_DRCT, 출고완료 : DLIVY_COMPT, 배송완료 : DLV_COMPT */
                             )
                 WHERE     1 = 1
                       AND c.clm_tp_cd IN ('GNRL_EXCHG', 'DRT_EXCHG')
        <if test='clmNo != null and clmNo != ""'>
                       AND c.clm_no = #{clmNo, jdbcType=VARCHAR}
        </if>
               )                                                                    AS chkExVal
          FROM clm
         WHERE 1 = 1
        <if test='clmNo != null and clmNo != ""'>
           AND clm_no = #{clmNo, jdbcType=VARCHAR}
        </if>
    </select>

    <!-- 클레임기본정보조회 -->
    <resultMap id="selectCancelClaimInfoResult" type="map">
        <result property="clmNo"            column="clmNo"              javaType="String"   />  <!-- 클레임번호                      -->
        <result property="ordNo"            column="ordNo"              javaType="String"   />  <!-- 주문번호                       -->
        <result property="clmTpCd"          column="clmTpCd"            javaType="String"   />  <!-- 클레임유형코드                -->
        <result property="clmStatCd"        column="clmStatCd"          javaType="String"   />  <!-- 클레임상태코드                -->
        <result property="stdrCrncySumAmt"  column="stdrCrncySumAmt"    javaType="String"   />  <!-- 기준통화합계금액               -->
        <result property="chkCnt"           column="chkCnt"             javaType="String"   />  <!-- 상품입고후수선실처리진행여부   -->
        <result property="chkRtVal"         column="chkRtVal"           javaType="String"   />  <!-- 반품상태체크                 -->
        <result property="chkExVal"         column="chkExVal"           javaType="String"   />  <!-- 교환/맞교환출고상태체크       -->
    </resultMap>

    <!-- 클레임 접수 가능 수량조회 -->
    <select id="selectCheckClmQty" parameterType="com.plgrim.ncp.biz.claim.data.ClaimBoDTO" resultMap="selectCheckClmQtyResult">
		SELECT /* [biz.claim.return.xml][selectClaimCheckInfo][클레임기본정보조회][khan] */
		       tmp.ord_no               AS ordNo
		     , tmp.ord_god_turn         AS ordGodTurn
		     , tmp.dlv_turn             AS dlvTurn
		     , tmp.dlv_pcupsp_turn      AS dlvPcupspTurn
		     , tmp.dlivy_drct_qty       AS dlivyDrctQty
		     , tmp.dlivy_drct_cncl_qty  AS dlivyDrctCnclQty
		     , tmp.rtrvl_drct_qty       AS rtrvlDrctQty
		  <choose>
		  	<when test='clmTpCd !=null and clmTpCd =="REPAIR"'>
		  	 , tmp.dlivy_drct_qty
		      -tmp.dlivy_drct_cncl_qty
		      -tmp.rtrvl_drct_qty
		      +tmp.rtrvl_drct_wthdraw_qty AS clmQty
		  	</when>
		  	<otherwise>
		  	 , tmp.dlivy_drct_qty
		      -tmp.dlivy_drct_cncl_qty
		      -tmp.rtrvl_drct_qty 		AS clmQty
		  	</otherwise>
		  </choose>
		  FROM (  SELECT lg.ord_no
		               , lg.ord_god_turn
		               , lg.dlv_turn
		               , lg.dlv_pcupsp_turn
		               , NVL(lg.dlivy_drct_cncl_qty, 0) AS dlivy_drct_cncl_qty
		               , NVL(lg.dlivy_drct_qty, 0) AS dlivy_drct_qty
		               , NVL(rg.rtrvl_drct_qty, 0) AS rtrvl_drct_qty
		              <if test='clmTpCd !=null and clmTpCd =="REPAIR"'>
		               , NVL(rg.rtrvl_drct_wthdraw_qty, 0) AS rtrvl_drct_wthdraw_qty
		              </if>
		            FROM lgs_dlivy_drct_god lg
		                 LEFT OUTER JOIN
		                 (  SELECT ord_no
		                         , dlivy_drct_god_no
		                         , SUM(rtrvl_drct_qty) AS rtrvl_drct_qty
		                        <if test='clmTpCd !=null and clmTpCd =="REPAIR"'>
		                         , SUM(rtrvl_drct_wthdraw_qty) AS rtrvl_drct_wthdraw_qty
		                        </if>
		                      FROM lgs_rtrvl_drct_god
		                     WHERE ord_no = #{ordNo,jdbcType=VARCHAR}
		                       AND rtrvl_stat_cd <![CDATA[<>]]> 'RTRVL_WTHDRAW'
		                  GROUP BY ord_no, dlivy_drct_god_no) rg
		                      ON lg.ord_no = rg.ord_no
		                     AND lg.dlivy_drct_god_no = rg.dlivy_drct_god_no
		           WHERE lg.ord_no = #{ordNo,jdbcType=VARCHAR}
            <if test='ordGodTurnStr != null and ordGodTurnStr != ""'>
                     AND lg.ord_god_turn IN
                <foreach collection="ordGodTurnArr" item="item" separator="," open="(" close=")" index="idx">
                       #{item}
                </foreach>
            </if>
		        GROUP BY lg.ord_no
		               , lg.ord_god_turn
		               , lg.dlv_pcupsp_turn
		               , lg.dlv_turn
		               , lg.dlivy_drct_cncl_qty
		               , lg.dlivy_drct_qty
		               , rg.rtrvl_drct_qty
		               <if test='clmTpCd !=null and clmTpCd =="REPAIR"'>
		               , rg.rtrvl_drct_wthdraw_qty
		               </if>) tmp
    </select>

    <!-- 클레임 접수 가능 수량조회 -->
    <resultMap id="selectCheckClmQtyResult" type="map">
        <result property="ordNo"            column="ordNo"              javaType="String"   />  <!-- 주문번호           -->
        <result property="ordGodTurn"       column="ordGodTurn"         javaType="String"   />  <!-- 주문상품순번       -->
        <result property="dlvTurn"          column="dlvTurn"            javaType="String"   />  <!-- 배송순번           -->
        <result property="dlvPcupspTurn"    column="dlvPcupspTurn"      javaType="String"   />  <!-- 배송지순번         -->
        <result property="dlivyDrctQty"  	column="dlivyDrctQty"    	javaType="String"   />  <!-- 출고수량           -->
        <result property="dlivyDrctCnclQty" column="dlivyDrctCnclQty"   javaType="String"   />  <!-- 출고취소수량   	-->
        <result property="rtrvlDrctQty"     column="rtrvlDrctQty"       javaType="String"   />  <!-- 회수수량           -->
        <result property="clmQty"         	column="clmQty"           	javaType="String"   />  <!-- 클레임접수가능수량 -->
    </resultMap>


    <!-- 고객서비스상담메모저장 -->
    <update id="updateCsoCnsltMemo" parameterType="com.plgrim.ncp.biz.claim.data.ClaimReturnDTO">
        MERGE INTO /* [biz.claim.return.xml][updateCsoCnsltMemo][고객서비스상담메모저장][khan] */
                   cso_cnslt_memo
             USING DUAL
                ON (clm_no = #{clmNo,jdbcType=VARCHAR})
        WHEN MATCHED
        THEN
           UPDATE SET memo_cont = #{memoCont,jdbcType=VARCHAR}
           			, memo_regtr_id = #{regtrId,jdbcType=VARCHAR}
                    , udter_id  = #{regtrId,jdbcType=VARCHAR}
                    , udt_dt    = SYSDATE
        WHEN NOT MATCHED
        THEN
           INSERT    ( memo_sn
                     , clm_no
                     , memo_cont
                     , memo_tp_cd
                     , expsr_yn
                     , memo_regtr_id
                     , regtr_id
                     , reg_dt
                     )
          VALUES     ( #{memoSn,jdbcType=NUMERIC}
                     , #{clmNo,jdbcType=VARCHAR}
                     , #{memoCont,jdbcType=VARCHAR}
                     , #{memoTpCd,jdbcType=VARCHAR}
                     , #{expsrYn,jdbcType=VARCHAR}
                     , #{regtrId,jdbcType=VARCHAR}
                     , #{regtrId,jdbcType=VARCHAR}
                     , SYSDATE
                     )
    </update>

    <!-- 클레임철회-클레임상태코드저장 -->
    <update id="updateClmStatCd" parameterType="com.plgrim.ncp.biz.claim.data.ClaimReturnDTO">
        UPDATE clm
           SET clm_stat_cd  = #{clmStatCd,jdbcType=VARCHAR}
             , udter_id     = #{udterId,jdbcType=VARCHAR}
             , udt_dt       = SYSDATE
         WHERE clm_no       = #{clmNo,jdbcType=VARCHAR}
    </update>


    <!-- 반품접수 클레임 등록 -->
    <insert id="insertClmForRtrvl" parameterType="com.plgrim.ncp.biz.claim.data.ClaimBoDTO">
        INSERT INTO clm( /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.insertClmForRtrvl][반품접수 클레임 등록][Khan] */
                        clm_no
                      , ord_no
                      , clm_stat_cd
                      , pkup_clm_yn
                      , pg_trnsmis_tgt_yn
                      , clm_tp_cd
                      , clm_resn_cd
                      , clm_resn_cont
                      , clm_dt
                      , rcept_admin_id
                      , rcept_dt
                      , compt_dt
                      , crncy_cd
                      , stdr_crncy_sum_amt
                      , pay_exchg_rt_crncy_sum_amt
                      , rtl_prc_sum_amt
                      , sale_sum_amt
                      , web_dc_sum_amt
                      , emp_dc_sum_amt
                      , svc_sum_amt
                      , dlv_cst_sum_amt
                      , all_dc_sum_amt
                      , god_dc_sum_amt
                      , bundle_dc_sum_amt
                      , crs_dc_sum_amt
                      , god_cpn_dc_sum_amt
                      , bsk_cpn_dc_sum_amt
                      , dlv_cst_cpn_dc_sum_amt
                      , unity_pnt_use_sum_amt
                      , evt_pnt_use_sum_amt
                      , webpnt_use_sum_amt
                      , unity_pnt_accml_sum_amt
                      , evt_pnt_accml_sum_amt
                      , webpnt_accml_sum_amt
                      , aff_com_ord_no
                      , aff_com_id
                      , aff_vrsc_com_id
                      , advt_aff_com_id
                      , god_sumry
                      , rcptfr_reqst_prcs_cd
                      , rcptfr_aprv_no
                      , virtl_rtgod_yn
                      , virtl_ord_no
                      , rfd_bnk_acct_no
                      , rfd_bnk_cd
                      , rfd_acnthldr_nm
                      , regtr_id
                      , reg_dt
                      , udter_id
                      , udt_dt
                      , exchg_rt_apl_beg_dt
                      , clm_rcept_mthd_cd
                      , UTID
                      )
                 SELECT #{clmExtend.clmNo,jdbcType=VARCHAR}             AS clm_no                       /* 클레임 번호                  */
                      , ord_no                                          AS ord_no                       /* 주문 번호                    */
                      , #{clmExtend.clmStatCd,jdbcType=VARCHAR}         AS clm_stat_cd                  /* 클레임 상태 코드             */
                      , #{clmExtend.pkupClmYn,jdbcType=VARCHAR}         AS pkup_clm_yn                  /* 픽업 클레임 여부             */
                      , #{clmExtend.pgTrnsmisTgtYn,jdbcType=VARCHAR}    AS pg_trnsmis_tgt_yn            /* PG전송대상여부               */
                      , #{clmExtend.clmTpCd,jdbcType=VARCHAR}           AS clm_tp_cd                    /* 클레임 유형 코드             */
                      , #{clmExtend.clmResnCd,jdbcType=VARCHAR}         AS clm_resn_cd                  /* 클레임 사유 코드             */
                      , #{clmExtend.clmResnCont,jdbcType=VARCHAR}       AS clm_resn_cont                /* 클레임 사유 내용             */
                      , SYSDATE                                         AS clm_dt                       /* 클레임 일시                  */
                     <choose>
                        <when test='role == "F"'>
                      , NULL                                            AS rcept_admin_id               /* 접수 관리자 ID               */
                      , NULL                                            AS rcept_dt                     /* 접수 일시                    */
                        </when>
                        <otherwise>
                      , #{clmExtend.rceptAdminId,jdbcType=VARCHAR}      AS rcept_admin_id               /* 접수 관리자 ID               */
                      		<choose>
                        	<when test='clmTpCd == "REPAIR"'>
                      , NULL                                            AS rcept_dt                        /* 접수 일시                    */
                      		</when>
                      		<otherwise>
                      , SYSDATE                                         AS rcept_dt                     /* 접수 일시                    */
                        </otherwise>
                     </choose>
                      	</otherwise>
                     </choose>
                      , NULL                                            AS compt_dt                     /* 완료 일시                    */
                      , crncy_cd                                        AS crncy_cd                     /* 통화 코드                    */
                      , NVL(stdr_crncy_sum_amt         ,0)              AS stdr_crncy_sum_amt           /* 기준 통화 합계 금액          */
                      , NVL(pay_exchg_rt_crncy_sum_amt ,0)              AS pay_exchg_rt_crncy_sum_amt   /* 결제 환율 통화 합계          */
                      , NVL(rtl_prc_sum_amt            ,0)              AS rtl_prc_sum_amt              /* 정소가 합계 금액             */
                      , NVL(sale_sum_amt               ,0)              AS sale_sum_amt                 /* 판매 합계 금액               */
                      , NVL(web_dc_sum_amt             ,0)              AS web_dc_sum_amt               /* 웹할인 합계 금액             */
                      , NVL(emp_dc_sum_amt             ,0)              AS emp_dc_sum_amt               /* 임직원 할인 합계 금액        */
                      , NVL(svc_sum_amt                ,0)              AS svc_sum_amt                  /* 서비스 합계 금액             */
                      , NVL(dlv_cst_sum_amt            ,0)              AS dlv_cst_sum_amt              /* 배송비 합계 금액             */
                      , NVL(all_dc_sum_amt             ,0)              AS all_dc_sum_amt               /* 전체 할인 합계 금액          */
                      , NVL(god_dc_sum_amt             ,0)              AS god_dc_sum_amt               /* 상품 할인 합계 금액          */
                      , NVL(bundle_dc_sum_amt          ,0)              AS bundle_dc_sum_amt            /* 묶음 할인 합계 금액          */
                      , NVL(crs_dc_sum_amt             ,0)              AS crs_dc_sum_amt               /* 교차 할인 합계 금액          */
                      , NVL(god_cpn_dc_sum_amt         ,0)              AS god_cpn_dc_sum_amt           /* 상품 쿠폰 할인 합계 금액     */
                      , NVL(bsk_cpn_dc_sum_amt         ,0)              AS bsk_cpn_dc_sum_amt           /* 장바구니 쿠폰 할인 합계 금액 */
                      , NVL(dlv_cst_cpn_dc_sum_amt     ,0)              AS dlv_cst_cpn_dc_sum_amt       /* 배송비 쿠폰 할인 합계 금액   */
                      , NVL(unity_pnt_use_sum_amt      ,0)              AS unity_pnt_use_sum_amt        /* 통합 포인트 사용 합계 금액   */
                      , NVL(evt_pnt_use_sum_amt        ,0)              AS evt_pnt_use_sum_amt          /* 이벤트 포인트 사용 합계 금액 */
                      , NVL(webpnt_use_sum_amt         ,0)              AS webpnt_use_sum_amt           /* 웹포인트 사용 합계 금액      */
                      , NVL(unity_pnt_accml_sum_amt    ,0)              AS unity_pnt_accml_sum_amt      /* 통합 포인트 적립 합계 금액   */
                      , NVL(evt_pnt_accml_sum_amt      ,0)              AS evt_pnt_accml_sum_amt        /* 이벤트 포인트 적립 합계 금액 */
                      , NVL(webpnt_accml_sum_amt       ,0)              AS webpnt_accml_sum_amt         /* 웹포인트 적립 합계 금액      */
                      , aff_com_ord_no                                  AS aff_com_ord_no               /* 제휴 업체 주문 번호          */
                      , aff_com_id                                      AS aff_com_id                   /* 제휴 업체 ID                 */
                      , aff_vrsc_com_id                                 AS aff_vrsc_com_id              /* 제휴 대행 업체 ID            */
                      , advt_aff_com_id                                 AS advt_aff_com_id              /* 광고 제휴 업체 ID            */
                      , god_sumry                                       AS god_sumry                    /* 상품 요약                    */
                      , rcptfr_reqst_cd                                 AS rcptfr_reqst_cd              /* 영수증 신청 처리 코드        */
                      , rcptfr_aprv_no                                  AS rcptfr_aprv_no               /* 영수증 승인 번호             */
                      , #{clmExtend.virtlRtgodYn,jdbcType=VARCHAR}      AS virtl_rtgod_yn               /* 가상 반품 여부               */
                      , #{clmExtend.virtlOrdNo,jdbcType=VARCHAR}        AS virtl_ord_no                 /* 가상 주문 번호               */
                      , PKG_CRYPTO.ENCRYPT(#{clmExtend.rfdBnkAcctNo,jdbcType=VARCHAR}, 'FNFBNT02-5200001')  AS rfd_bnk_acct_no              /* 환불 계좌 번호               */
                      , #{clmExtend.rfdBnkCd,jdbcType=VARCHAR}          AS rfd_bnk_cd                   /* 환불 은행 코드               */
                      , #{clmExtend.rfdAcnthldrNm,jdbcType=VARCHAR}     AS rfd_acnthldr_nm              /* 환불 예금주 명               */
                      , #{clmExtend.regtrId,jdbcType=VARCHAR}           AS regtr_id                     /* 등록자 ID                    */
                      , SYSDATE                                         AS reg_dt                       /* 등록 일시                    */
                      , #{clmExtend.regtrId,jdbcType=VARCHAR}           AS udter_id                     /* 수정자 ID                    */
                      , SYSDATE                                         AS udt_dt                       /* 수정 일시                    */
                      , exchg_rt_apl_beg_dt								AS exchg_rt_apl_beg_dt
                      , NVL(#{clmExtend.clmRceptMthdCd,jdbcType=VARCHAR},'ETC')    AS clm_rcept_mthd_cd            /* REPAIR 추가 : 클레임접수방법              */
                      , #{userTrackingId}		    AS UTID
                   FROM ord
                  WHERE 1=1
                    AND ord_no = #{ordNo,jdbcType=VARCHAR}
    </insert>


    <!-- 반품접수 클레임입고상품 등록 -->
    <insert id="insertClmWrhsGodForRtrvl" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
        INSERT INTO clm_wrhs_god( /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.insertClmWrhsGodForRtrvl][반품접수 클레임입고상품 등록][Khan] */
								  clm_no
								, clm_wrhs_god_turn
								, ord_no
								, dlv_pcupsp_turn
								, clm_resn_cd
								, clm_resn_cont
								, god_no
								, itm_no
								, god_hist_turn
								, itm_hist_turn
								, god_nm
								, mobile_god_nm
								, itm_nm
								, color_nm
								, color_cd
								, erp_god_no
								, sku_no
								, brnd_id
								, brnd_grp_id
								, god_vol
								, god_wt
								, god_tp_cd
								, partmal_sect_cd
								, lst_img_url
								, com_id
								, repair_yn
								, dmstc_dlv_cst_plc_sn
								, ovsea_dlv_dmstc_dlv_cst_plc_sn
								, ovsea_dlv_cst_plc_sn
								, sale_shop_cd
								, clm_qty
								, clm_wthdraw_sect_cd
								, clm_wthdraw_qty
								, crncy_cd
								, stdr_crncy_amt
								, pay_exchg_rt_crncy_amt
								, rtl_prc
								, sale_amt
								, web_dc_amt
								, emp_dc_amt
								, all_dc_amt
								, imdtl_dc_amt
								, god_dc_amt
								, bundle_dc_amt
								, crs_dc_amt
								, god_cpn_dc_amt
								, bsk_cpn_dc_amt
								, unity_pnt_use_amt
								, evt_pnt_use_amt
								, webpnt_use_amt
								, unity_pnt_accml_amt
								, evt_pnt_accml_amt
								, webpnt_accml_amt
								, regtr_id
 								, reg_dt
 		                        , udter_id
		                        , udt_dt
		                        , cncl_pnttm_dlv_stat_cd
                               )
                          SELECT
                                  #{clmNo,jdbcType=VARCHAR}                 AS clm_no                               /* 클레임 번호CL || YYYYMMDD || 7자리 Cycle Sequence */
                                , #{clmWrhsGodTurn,jdbcType=NUMERIC}        AS clm_wrhs_god_turn                    /* 클레임 입고 상품 순번 */
                                , og.ord_no                                 AS ord_no                               /* 주문 번호OD || YYYYMMDD || 7자리 Cycle Sequence */
                                , #{dlvPcupspTurn,jdbcType=NUMERIC}         AS dlv_pcupsp_turn                      /* 배송 수거지 순번 */
                                , #{clmResnCd,jdbcType=VARCHAR}             AS clm_resn_cd                          /* 클레임 사유 코드ㅁ. 클레임 사유 : CLM_RSN   >. 단순변심 : SIMPL_CHGMIND   >. 이중 주문 : DPLC_ORD   >. 결제 지연 : PAY_DELAY   >. 상품불량 : GOD_BADN   >. 상품정보상이 : GOD_INFO_GAP   >. 상품파손 : GOD_DMG   >. 결품 : LSSGS   >. 오배송 : WN_DLV   >. 배송지연 : DLV_DELAY */
                                , #{clmResnCont,jdbcType=VARCHAR}           AS clm_resn_cont                        /* 클레임 사유 내용 */
                                , og.god_no                                 AS god_no                               /* 상품 번호상품 유형 1자리 || 업체 코드 3자리 || YYYYMMDD || 6자리 Cycle Sequence */
                                , og.itm_no                                 AS itm_no                               /* 단품 번호IT || YYYYMMDD || 7자리 Cycle Sequence */
                                , og.god_hist_turn                          AS god_hist_turn                        /* 상품 이력 순번 */
                                , og.itm_hist_turn                          AS itm_hist_turn                        /* 단품 이력 순번 */
                                , og.god_nm                                 AS god_nm                               /* 상품 명 */
                                , og.mobile_god_nm                          AS mobile_god_nm                        /* 모바일 상품 명 */
                                , og.itm_nm                                 AS itm_nm                               /* 단품 명 */
                                , og.color_nm                               AS color_nm                             /* 색상 명 */
								, og.color_cd								AS color_cd
                                , og.erp_god_no                             AS erp_god_no                           /* ERP 상품 번호 */
                                , og.sku_no                                 AS sku_no                               /* SKU 번호 */
                                , og.brnd_id                                AS brnd_id                              /* 브랜드 ID */
                                , og.brnd_grp_id                            AS brnd_grp_id                          /* 브랜드 그룹 ID */
                                , og.god_vol                                AS god_vol                              /* 상품 부피ㅁ. SUM(상품.부피) */
                                , og.god_wt                                 AS god_wt                               /* 상품 무게ㅁ. SUM(상품.무게) */
                                , og.god_tp_cd                              AS god_tp_cd                            /* 상품 유형 코드ㅁ. 상품구분 : GOD_TP   >. 일반상품 : GNRL_GOD   >. 사은품 : GFT   >. 세트상품 : SET_GOD   >. 패키지 상품 : PCKAGE_GOD   >. 상품권 : GFCT */
                                , og.partmal_sect_cd                        AS partmal_sect_cd                      /* 입점 구분 코드ㅁ. 입점 구분 : PARTMAL_SECT   >. 자사 : MCOM   >. 입점 : PARTMAL */
                                , og.lst_img_url                            AS lst_img_url                          /* 리스트 이미지 URL */
                                , og.com_id                                 AS com_id                               /* 업체 ID */
                                , #{repairYn,jdbcType=VARCHAR}              AS repair_yn                            /* 수선 여부 */
                                , og.dmstc_dlv_cst_plc_sn                   AS dmstc_dlv_cst_plc_sn                 /* 국내 배송비 정책 일련번호 */
                                , og.ovsea_dlv_dmstc_dlv_cst_plc_sn         as ovsea_dlv_dmstc_dlv_cst_plc_sn
                                , og.ovsea_dlv_cst_plc_sn                   AS ovsea_dlv_cst_plc_sn                 /* 해외 배송비 정책 일련번호 */
                                , og.sale_shop_cd                           AS sale_shop_cd                         /* 판매 매장 코드ㅁ. ERP과 연동하는 판매 매장 코드ㅁ. 판매 매장 : SALE_SHOP   >. Online패션피아 : B04A   >. Online8s : B04B   >. Beaker자사 : B04C   >. Beaker위탁 : B04D   >. Online제휴몰 : B04E   >. Beaker제휴몰위탁 : B04F */
                                , #{clmQty,jdbcType=NUMERIC}                AS clm_qty                              /* 클레임 수량 */
                                , NVL(#{clmWthdrawSectCd,jdbcType=VARCHAR}, 'NRMLT') AS clm_wthdraw_sect_cd         /* 클레임 철회 구분 코드ㅁ. 클레임 철회 구분 : CLM_WTHDRAW_SECT   >. 정상 : NRMLT   >. 부분 철회 : PART_WTHDRAW   >. 전체 철회 : ALL_WTHDRAW */
                                , 0                                      	AS clm_wthdraw_qty                      /* 클레임 철회 수량 */
                                , og.crncy_cd                               AS crncy_cd                             /* 통화 코드ISO 4217을 준수사용 코드 : CRNCY    통화KRW    대한민국 원USD    미국 달러CNY     런민비 (위안)JPY    일본 엔 */
                                , og.stdr_crncy_amt                         AS stdr_crncy_amt                       /* 기준 통화 금액사이트의 기준 통화의 기준이 되는 금액 */
                                , og.pay_exchg_rt_crncy_amt                 AS pay_exchg_rt_crncy_amt               /* 결제 환율 통화 금액사이트의 기준 통화를 기준으로 기준 통화금액에 환율을 적용한 금액 */
                                , og.rtl_prc                                AS rtl_prc                              /* 정소가 */
                                , og.sale_amt                               AS sale_amt                             /* 판매금액 */
                                , og.web_dc_amt                             AS web_dc_amt                           /* 웹할인금액 */
                                , og.emp_dc_amt                             AS emp_dc_amt                           /* 임직원 할인 금액 */
                                , og.all_dc_amt
                                , og.imdtl_dc_amt
                                , og.god_dc_amt                             AS god_dc_amt                           /* 상품 할인 금액 */
                                , og.bundle_dc_amt
                                , og.crs_dc_amt
                                , og.god_cpn_dc_amt                         AS god_cpn_dc_amt                       /* 상품 쿠폰 할인 금액 */
                                , og.bsk_cpn_dc_amt                         AS bsk_cpn_dc_amt                       /* 장바구니 쿠폰 할인 금액 */
                                , og.unity_pnt_use_amt                      AS unity_pnt_use_amt                    /* 통합 포인트 사용 금액 */
                                , og.evt_pnt_accml_amt                      AS evt_pnt_accml_amt                    /* 이벤트 포인트 적립 금액 */
                                , og.webpnt_use_amt                         AS webpnt_use_amt                       /* 웹포인트 사용 금액 */
                                , og.unity_pnt_accml_amt                    AS unity_pnt_accml_amt                  /* 통합 포인트 적립 금액 */
                                , og.evt_pnt_use_amt                        AS evt_pnt_use_amt                      /* 이벤트 포인트 사용 금액 */
                                , og.webpnt_accml_amt                       AS webpnt_accml_amt                     /* 웹포인트 적립 금액적립은 되고 있으나 사용 할 수 없는부분 */
                                , #{regtrId,jdbcType=VARCHAR}               AS regtr_id                             /* 등록자 ID등록한 관리자 번호 */
                                , SYSDATE                                   AS reg_dt                               /* 등록 일시 */
                                , #{regtrId,jdbcType=VARCHAR}               AS udter_id                             /* 수정자 ID등록한 관리자 번호 */
                                , SYSDATE                                   AS udt_dt                               /* 수정 일시 */
                                , decode(ldd.dlv_stat_cd,'DLV_COMPT','','DLIVY_COMPT','',ldd.dlv_stat_cd)                           AS cncl_pnttm_dlv_stat_cd                          /* 배송상태 */
                            FROM ord_god og, (select ord_no,ord_god_turn,max(dlv_turn) dlv_turn,max(dlv_stat_cd) dlv_stat_cd from lgs_dlivy_drct_god
                                  where ord_no=#{ordNo,jdbcType=VARCHAR}
                                  and ord_god_turn=#{ordGodTurn,jdbcType=NUMERIC}
                                  group by ord_no,ord_god_turn
                                  ) ldd
                           WHERE 1=1
                             AND og.ord_no          = #{ordNo,jdbcType=VARCHAR}
                             AND og.ord_god_turn    = #{ordGodTurn,jdbcType=NUMERIC}
                             AND og.ord_no=ldd.ord_no
                             AND og.ord_god_turn=ldd.ord_god_turn
    </insert>


    <!-- 반품접수 주문클레임상품연결 등록 -->
    <insert id="insertOrdClmGodCnncForRtrvl" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
        INSERT INTO ord_clm_god_cnnc( /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.insertOrdClmGodCnncForRtrvl][반품접수 주문클레임상품연결 등록][Khan] */
                                     ord_no
                                   , ord_god_turn
                                   , clm_no
                                   , clm_wrhs_god_turn
                                   , god_cnnc_tp_cd
                                   , ord_clm_qty
                                   , ord_clm_wthdraw_qty
                                   , regtr_id
                                   , reg_dt
 		                           , udter_id
		                           , udt_dt
                                   )
                              SELECT #{ordNo,jdbcType=VARCHAR}          AS ord_no               /* 주문 번호OD || YYYYMMDD || 7자리 Cycle Sequence */
                                   , #{ordGodTurn,jdbcType=NUMERIC}     AS ord_god_turn         /* 주문 상품 순번 */
                                   , cwg.clm_no                         AS clm_no               /* 클레임 번호CL || YYYYMMDD || 7자리 Cycle Sequence */
                                   , cwg.clm_wrhs_god_turn              AS clm_wrhs_god_turn    /* 클레임 입고 상품 순번 */
                                   , #{godCnncTpCd,jdbcType=VARCHAR}    AS god_cnnc_tp_cd       /* 상품 연결 유형 코드ㅁ. 상품 연결 유형 : GOD_CNNC_TP   >. 출고 상품 연결 : DLIVY_GOD_CNNC   >. 입고 상품 연결 : WRHS_GOD_CNNCㅁ. 출고 상품 연결 : 교환시 입고 상품과 출고 상품을 연결   >. 교환 출고 상품과 연결 되기 때문에 연결된 상품이 다를 수있다.ㅁ. 입고 상품 연결 : 교환/반품시 주문 상품과 입고 상품을 연결   >. 주문 상품과 입고 상품을 연결 하기 때문에 연결된 상품은 무조건 같다. */
                                   , #{ordClmQty,jdbcType=NUMERIC}      AS ord_clm_qty          /* 주문 클레임 수량 */
                                   , cwg.clm_wthdraw_qty                AS clm_wthdraw_qty      /* 주문 클레임 철회 수량 */
                                   , #{regtrId,jdbcType=VARCHAR}        AS regtr_id             /* 등록자 ID등록한 관리자 번호 */
                                   , SYSDATE                            AS reg_dt               /* 등록 일시 */
                                   , #{regtrId,jdbcType=VARCHAR}        AS udter_id             /* 수정자 ID등록한 관리자 번호 */
                                   , SYSDATE                            AS udt_dt               /* 수정 일시 */
                                FROM clm_wrhs_god cwg
                               WHERE 1 = 1
                                 AND cwg.clm_no 			= #{clmNo,jdbcType=VARCHAR}
                                 AND cwg.clm_wrhs_god_turn	= #{clmWrhsGodTurn,jdbcType=NUMERIC}
    </insert>

    <select id="selectOrdClmGodCnnc" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="ordClmGodCnnc">
        SELECT /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.selectOrdClmGodCnnc][주문클레임상품연결 조회][Khan] */
		       ocgc.ord_no
		     , ocgc.ord_god_turn
		     , ocgc.clm_no
		     , ocgc.clm_wrhs_god_turn
		     , ocgc.god_cnnc_tp_cd
		     , ocgc.ord_clm_qty
		     , ocgc.ord_clm_wthdraw_qty
		     , ocgc.regtr_id
		     , ocgc.reg_dt
		     , ocgc.udter_id
		     , ocgc.udt_dt
		  FROM ord_clm_god_cnnc ocgc
		 WHERE 1 = 1
		   AND ocgc.ord_no 				= #{ordNo,jdbcType=VARCHAR}
		   AND ocgc.ord_god_turn 		= #{ordGodTurn,jdbcType=NUMERIC}
		   AND ocgc.clm_no 				= #{clmNo,jdbcType=VARCHAR}
		   AND ocgc.clm_wrhs_god_turn 	= #{clmWrhsGodTurn,jdbcType=NUMERIC}
		   AND ocgc.god_cnnc_tp_cd 		= #{godCnncTpCd,jdbcType=VARCHAR}
    </select>

    <update id="updateOrdClmGodCnnc" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
	    UPDATE ord_clm_god_cnnc ocgc
	       SET ocgc.ord_clm_qty = #{ordClmQty,jdbcType=NUMERIC}
	       , ocgc.udt_dt = SYSDATE
	     WHERE 1=1
		   AND ocgc.ord_no 				= #{ordNo,jdbcType=VARCHAR}
		   AND ocgc.ord_god_turn 		= #{ordGodTurn,jdbcType=NUMERIC}
		   AND ocgc.clm_no 				= #{clmNo,jdbcType=VARCHAR}
		   AND ocgc.clm_wrhs_god_turn 	= #{clmWrhsGodTurn,jdbcType=NUMERIC}
		   AND ocgc.god_cnnc_tp_cd 		= #{godCnncTpCd,jdbcType=VARCHAR}
    </update>

    <select id="selectClmWrhsGod" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="clmWrhsGod">
        SELECT /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.selectClmWrhsGod][클레임 입고상품 조회][Aether] */
                CLM_NO
               ,CLM_WRHS_GOD_TURN
               ,ORD_NO
               ,DLV_PCUPSP_TURN
               ,CLM_RESN_CD
               ,CLM_RESN_CONT
               ,GOD_NO
               ,ITM_NO
               ,GOD_HIST_TURN
               ,ITM_HIST_TURN
               ,GOD_NM
               ,MOBILE_GOD_NM
               ,ITM_NM
               ,COLOR_NM
               ,ERP_GOD_NO
               ,BRND_ID
               ,BRND_GRP_ID
               ,GOD_VOL
               ,GOD_WT
               ,GOD_TP_CD
               ,PARTMAL_SECT_CD
               ,LST_IMG_URL
               ,COM_ID
               ,REPAIR_YN
               ,DMSTC_DLV_CST_PLC_SN
               ,OVSEA_DLV_DMSTC_DLV_CST_PLC_SN
               ,OVSEA_DLV_CST_PLC_SN
               ,SALE_SHOP_CD
               ,CLM_QTY
               ,CLM_WTHDRAW_SECT_CD
               ,CLM_WTHDRAW_QTY
               ,CRNCY_CD
               ,STDR_CRNCY_AMT
               ,PAY_EXCHG_RT_CRNCY_AMT
               ,RTL_PRC
               ,SALE_AMT
               ,WEB_DC_AMT
               ,GOD_DC_AMT
               ,EMP_DC_AMT
               ,GOD_CPN_DC_AMT
               ,BSK_CPN_DC_AMT
               ,UNITY_PNT_USE_AMT
               ,EVT_PNT_USE_AMT
               ,WEBPNT_USE_AMT
               ,UNITY_PNT_ACCML_AMT
               ,EVT_PNT_ACCML_AMT
               ,WEBPNT_ACCML_AMT
               ,REGTR_ID
               ,REG_DT
               ,UDTER_ID
               ,UDT_DT
        FROM    CLM_WRHS_GOD cwg
        WHERE   1 = 1
		AND	cwg.clm_no = #{clmNo,jdbcType=VARCHAR}
		AND
			cwg.god_no = #{godNo,jdbcType=VARCHAR}
		AND
			cwg.itm_no = #{itmNo,jdbcType=NUMERIC}
		AND
			cwg.dlv_pcupsp_turn = #{dlvPcupspTurn,jdbcType=NUMERIC}
    </select>

        <select id="selectClmWrhsGodRt" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="clmWrhsGod">
        SELECT /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.selectClmWrhsGod][클레임 입고상품 조회][Aether] */
                CLM_NO
               ,CLM_WRHS_GOD_TURN
               ,ORD_NO
               ,DLV_PCUPSP_TURN
               ,CLM_RESN_CD
               ,CLM_RESN_CONT
               ,GOD_NO
               ,ITM_NO
               ,GOD_HIST_TURN
               ,ITM_HIST_TURN
               ,GOD_NM
               ,MOBILE_GOD_NM
               ,ITM_NM
               ,COLOR_NM
               ,ERP_GOD_NO
               ,BRND_ID
               ,BRND_GRP_ID
               ,GOD_VOL
               ,GOD_WT
               ,GOD_TP_CD
               ,PARTMAL_SECT_CD
               ,LST_IMG_URL
               ,COM_ID
               ,REPAIR_YN
               ,DMSTC_DLV_CST_PLC_SN
               ,OVSEA_DLV_DMSTC_DLV_CST_PLC_SN
               ,OVSEA_DLV_CST_PLC_SN
               ,SALE_SHOP_CD
               ,CLM_QTY
               ,CLM_WTHDRAW_SECT_CD
               ,CLM_WTHDRAW_QTY
               ,CRNCY_CD
               ,STDR_CRNCY_AMT
               ,PAY_EXCHG_RT_CRNCY_AMT
               ,RTL_PRC
               ,SALE_AMT
               ,WEB_DC_AMT
               ,GOD_DC_AMT
               ,EMP_DC_AMT
               ,GOD_CPN_DC_AMT
               ,BSK_CPN_DC_AMT
               ,UNITY_PNT_USE_AMT
               ,EVT_PNT_USE_AMT
               ,WEBPNT_USE_AMT
               ,UNITY_PNT_ACCML_AMT
               ,EVT_PNT_ACCML_AMT
               ,WEBPNT_ACCML_AMT
               ,REGTR_ID
               ,REG_DT
               ,UDTER_ID
               ,UDT_DT
        FROM    CLM_WRHS_GOD cwg
        WHERE   1 = 1
        AND cwg.clm_no = #{clmNo,jdbcType=VARCHAR}
        AND
            cwg.god_no = #{godNo,jdbcType=VARCHAR}
        AND
            cwg.itm_no = #{itmNo,jdbcType=NUMERIC}
        AND
            cwg.dlv_pcupsp_turn = #{dlvPcupspTurn,jdbcType=NUMERIC}
        AND NOT EXISTS (
                         SELECT 1
                           FROM ORD_GOD g
                          WHERE cwg.god_no = g.god_no
                            AND cwg.ORD_NO = g.ORD_NO
                            AND g.GOD_TP_CD IN ('SET_GOD','PCKAGE_GOD')

                          UNION ALL

                         SELECT 1
                           FROM ORD_CPST_GOD_CNNC gc
                           JOIN ORD_GOD g
                             ON g.ORD_NO = gc.ORD_NO
                            AND g.ORD_GOD_TURN = gc.ORD_CPST_GOD_TURN
                          WHERE cwg.god_no = g.god_no
                            AND cwg.ORD_NO = g.ORD_NO

                        )

    </select>


    <select id="selectClmWrhsGodForSet" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="clmWrhsGod">
		SELECT /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.selectClmWrhsGodForSet][세트상품 관련 클레임 입고상품 조회][Khan] */
		       clm_no
		     , clm_wrhs_god_turn
		     , ord_no
		     , dlv_pcupsp_turn
		     , clm_resn_cd
		     , clm_resn_cont
		     , god_no
		     , itm_no
		     , god_hist_turn
		     , itm_hist_turn
		     , erp_god_no
		     , sku_no
		     , god_nm
		     , mobile_god_nm
		     , itm_nm
		     , color_nm
		     , color_cd
		     , clor_chip_img_url
		     , brnd_id
		     , brnd_grp_id
		     , god_vol
		     , god_wt
		     , god_tp_cd
		     , partmal_sect_cd
		     , lst_img_url
		     , com_id
		     , repair_yn
		     , dmstc_dlv_cst_plc_sn
		     , ovsea_dlv_dmstc_dlv_cst_plc_sn
		     , ovsea_dlv_cst_plc_sn
		     , sale_shop_cd
		     , clm_qty
		     , clm_wthdraw_sect_cd
		     , clm_wthdraw_qty
		     , crncy_cd
		     , stdr_crncy_amt
		     , pay_exchg_rt_crncy_amt
		     , rtl_prc
		     , sale_amt
		     , web_dc_amt
		     , emp_dc_amt
		     , all_dc_amt
		     , god_dc_amt
		     , bundle_dc_amt
		     , crs_dc_amt
		     , god_cpn_dc_amt
		     , bsk_cpn_dc_amt
		     , unity_pnt_use_amt
		     , evt_pnt_use_amt
		     , webpnt_use_amt
		     , imdtl_dc_amt
		     , unity_pnt_accml_amt
		     , evt_pnt_accml_amt
		     , webpnt_accml_amt
		     , cal_dt
		     , aff_com_ord_god_no
		     , regtr_id
		     , reg_dt
		     , udter_id
		     , udt_dt
		  FROM clm_wrhs_god
		  where 1=1
		    AND clm_no = #{clmNo,jdbcType=VARCHAR}
			AND clm_wrhs_god_turn = #{clmWrhsGodTurn,jdbcType=NUMERIC}
    </select>



    <update id="updateClmWrhsGod" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
    UPDATE clm_wrhs_god
    <choose>
    	<when test='ordClmQty != null and ordClmQty != ""'>SET clm_qty = #{ordClmQty}</when>
    	<otherwise>SET clm_qty = #{clmQty}</otherwise>
    </choose>
    WHERE clm_wrhs_god_turn = #{clmWrhsGodTurn}
    AND clm_no = #{clmNo}
    </update>

    <!-- 클레임관리 - 철회 -->
    <select id="selectClmWrhsGodWthdraw" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="int">
        SELECT /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.selectClmWrhsGod][클레임관리 철회 - 클레임입고상품 철회 건수 조회][KEN] */
              COUNT(*)
         FROM CLM_WRHS_GOD
        WHERE clm_no = #{clmNo,jdbcType=VARCHAR}
          AND NVL(clm_wthdraw_sect_cd,'NRMLT') = 'NRMLT'
          AND god_tp_cd not in ('SET_GOD', 'PCKAGE_GOD','PCHS_GFT','CNVRS_GFT')
    </select>

    <!-- 클레임관리 - 철회 -->
    <select id="selectRepairClmWrhsGodWthdraw" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="int">
        SELECT /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.selectRepairClmWrhsGodWthdraw][클레임관리 철회 - 클레임입고상품 철회 건수 조회][KEN] */
              COUNT(*)
         FROM CLM_WRHS_GOD
        WHERE clm_no = #{clmNo,jdbcType=VARCHAR}
          AND NVL(clm_wthdraw_sect_cd,'NRMLT') IN ('NRMLT', 'PART_WTHDRAW')
          AND god_tp_cd not in ('SET_GOD', 'PCKAGE_GOD')
    </select>

	<!-- 클레임관리 - 철회 -->
    <select id="selectClmRtrvDrctWthdraw" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="int">
        SELECT /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.selectClmRtrvDrctWthdraw][클레임관리 철회 - 물류회수지시상품 건수 조회][KEN] */
               COUNT(1)
          FROM LGS_RTRVL_DRCT_GOD
         WHERE clm_no = #{clmNo,jdbcType=VARCHAR}
           AND RTRVL_STAT_CD NOT IN('RTRVL_DRCT_WAIT','RTRVL_WTHDRAW')
         <if test='clmWrhsGodTurn != null and clmWrhsGodTurn != ""'>
           AND clm_wrhs_god_turn = #{clmWrhsGodTurn}
    	</if>
    </select>
    
    <!-- 클레임관리 - 철회 erp 전송갯수 -->
    <select id="selectClmRtrvDrctWthdrawSendErp" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="int">
        SELECT /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.selectClmRtrvDrctWthdrawSendErp][클레임관리 철회 - 물류회수지시상품 ERP전송 건수 조회][KEN] */
               COUNT(1)
          FROM LGS_RTRVL_DRCT_GOD
         WHERE clm_no = #{clmNo,jdbcType=VARCHAR}
           AND RTRVL_STAT_CD IN('RTRVL_DRCT')
           AND ERP_TRNSMIS_YN = 'N'
    </select>
    
    <!-- 클레임관리 - 철회 회수지시건만  -->
    <select id="selectClmRtrvDrct" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="int">
        SELECT /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.selectClmRtrvDrct][클레임관리 철회 - 물류회수지시상품 회수지시 건수 조회][KEN] */
               COUNT(1)
          FROM LGS_RTRVL_DRCT_GOD
         WHERE clm_no = #{clmNo,jdbcType=VARCHAR}
           AND RTRVL_STAT_CD IN('RTRVL_DRCT')
    </select>
    
    <select id="selectClmRtrvDrctWthdrawSwitch" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="int">
        SELECT /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.selectClmRtrvDrctWthdrawSwitch][클레임관리 철회 - 물류회수지시상품 건수 조회][KEN] */
               COUNT(*)
          FROM LGS_RTRVL_DRCT_GOD
         WHERE clm_no = #{clmNo}
           AND RTRVL_STAT_CD NOT IN('RTRVL_COMPT')
           AND clm_wrhs_god_turn = #{clmWrhsGodTurn}
    </select>


    <!-- 클레임관리 - 반품/교환 접수 -->
    <update id="updateClmRcept" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
        UPDATE /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.updateClmErpWthdraw][클레임관리 철회 - 반품/교환 접수][khan] */
               clm
           SET udter_id                 = #{udterId,jdbcType=VARCHAR}
             , udt_dt                   = SYSDATE
             , rcept_admin_id           = #{udterId,jdbcType=VARCHAR}
             , rcept_dt                 = SYSDATE
             , clm_stat_cd              = #{clmStatCd,jdbcType=VARCHAR}
         WHERE 1=1
           AND clm_no                   = #{clmNo,jdbcType=VARCHAR}
    </update>

	<!-- 클레임관리 - 철회[인터페이스주문상품ERP분배] -->
    <update id="updateClmErpWthdraw" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
        UPDATE /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.updateClmErpWthdraw][클레임관리 철회 - 인터페이스주문상품ERP분배][khan] */
               inf_ord_god_erp_dstb
           SET clm_no 					= NULL
             , clm_wrhs_god_turn 		= NULL
             , udt_dt= SYSDATE
	         , udter_id = #{udterId}
         WHERE 1=1
           AND clm_no 					= #{clmNo,jdbcType=VARCHAR}
      	<if test='clmWrhsGodTurn != null and clmWrhsGodTurn != ""'>
           AND clm_wrhs_god_turn 		= #{clmWrhsGodTurn,jdbcType=VARCHAR}
        </if>
	    <if test="qtyTurn != null and qtyTurn > 0">
		   AND qty_turn					= #{qtyTurn}
	    </if>
    </update>

	<!-- 클레임관리 - 철회[클레임입고상품] -->
    <update id="updateClmWrhsGodWthdraw" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
	    UPDATE /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.updateClmWrhsGodWthdraw][클레임관리 철회 - 클레임입고상품][khan] */
	           clm_wrhs_god
	       SET clm_wthdraw_qty			= clm_qty
	       	<if test='clmWthdrawSectCd != null and clmWthdrawSectCd != ""'>
	       	 , clm_wthdraw_sect_cd 		= #{clmWthdrawSectCd,jdbcType=VARCHAR}
	       	</if>
	       	<if test='clmWthdrawSectCd == null or clmWthdrawSectCd == ""'>
	         , clm_wthdraw_sect_cd 		= 'ALL_WTHDRAW'
	       	</if>
	         , clm_wthdraw_dt			= SYSDATE
			 , udter_id          		= #{udterId,jdbcType=VARCHAR}
	         , udt_dt              		= SYSDATE
	     WHERE 1=1
	       AND clm_no 					= #{clmNo,jdbcType=VARCHAR}
	    <if test='clmWrhsGodTurn != null and clmWrhsGodTurn != ""'>
	       AND clm_wrhs_god_turn 		= #{clmWrhsGodTurn,jdbcType=VARCHAR}
    	</if>
    </update>


	<!-- 클레임관리 - 수선철회[클레임입고상품] -->
    <update id="updateRepairClmWrhsGodWthdraw" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
	    UPDATE /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.updateClmWrhsGodWthdraw][클레임관리 수선철회 - 클레임입고상품][YOON] */
	           clm_wrhs_god
	       SET udter_id          		= #{udterId,jdbcType=VARCHAR}
	    	 , udt_dt              		= SYSDATE
		    <choose>
			    <when test='dlivyQty != null and dlivyQty > 0'>
				    , clm_wthdraw_qty	= CASE WHEN NVL(clm_qty, 0) <![CDATA[>]]> NVL(clm_wthdraw_qty, 0) + #{dlivyQty}
											   THEN NVL(clm_wthdraw_qty, 0) + #{dlivyQty}
											   ELSE clm_qty
										   END
			    </when>
			    <otherwise>
				    , clm_wthdraw_qty	= clm_qty
			    </otherwise>
		    </choose>
	       	<if test='clmWthdrawSectCd != null and clmWthdrawSectCd != ""'>
	       	 , clm_wthdraw_sect_cd 		= #{clmWthdrawSectCd,jdbcType=VARCHAR}
	       	</if>
	       	<if test='clmWthdrawSectCd == null or clmWthdrawSectCd == ""'>
	         , clm_wthdraw_sect_cd 		= 'ALL_WTHDRAW'
	       	</if>
	    	 , clm_wthdraw_dt			= SYSDATE
	     WHERE 1=1
	       AND clm_no 					= #{clmNo,jdbcType=VARCHAR}
	    <if test='clmWrhsGodTurn != null and clmWrhsGodTurn != ""'>
	       AND clm_wrhs_god_turn 		= #{clmWrhsGodTurn,jdbcType=VARCHAR}
    	</if>
    </update>

	<!-- 클레임관리 - 철회[물류회수지시상품] -->
    <update id="updateRtrvlStatWthdraw" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
        UPDATE /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.updateRtrvlStatWthdraw][클레임관리 철회 - 물류회수지시상품][khan] */
               lgs_rtrvl_drct_god
           SET
               udter_id               	= #{udterId,jdbcType=VARCHAR}
             , udt_dt                 	= SYSDATE
             , rtrvl_drct_wthdraw_qty 	= rtrvl_drct_qty
             , rtrvl_stat_cd          	= 'RTRVL_WTHDRAW'
             , rtrvl_drct_wthdraw_dt  	= SYSDATE
         WHERE 1=1
           AND clm_no 					= #{clmNo,jdbcType=VARCHAR}
    	<if test='clmWrhsGodTurn != null and clmWrhsGodTurn != ""'>
           AND clm_wrhs_god_turn    	= #{clmWrhsGodTurn,jdbcType=VARCHAR}
    	</if>
    </update>

	<!-- 클레임관리 - 수선 철회[물류회수지시상품] -->
    <update id="updateRepairRtrvlStatWthdraw" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
        UPDATE /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.updateRtrvlStatWthdraw][클레임관리 철회 - 물류회수지시상품][YOON] */
               lgs_rtrvl_drct_god
           SET
               udter_id               	= #{udterId,jdbcType=VARCHAR}
             , udt_dt                 	= SYSDATE
	    <choose>
		    <when test='dlivyQty != null and dlivyQty > 0'>
			    , rtrvl_drct_wthdraw_qty	= CASE WHEN NVL(rtrvl_drct_qty, 0) <![CDATA[>]]> NVL(RTRVL_DRCT_WTHDRAW_QTY, 0) + #{dlivyQty}
											       THEN NVL(RTRVL_DRCT_WTHDRAW_QTY, 0) + #{dlivyQty}
											       ELSE rtrvl_drct_qty
											   END
		    </when>
		    <otherwise>
             , rtrvl_drct_wthdraw_qty 	= rtrvl_drct_qty
		    </otherwise>
	    </choose>
	    	<if test="@com.plgrim.ncp.framework.commons.StringService@equalsIgnoreCase('ALL_WTHDRAW',clmWthdrawSectCd)">
             , rtrvl_stat_cd          	= 'RTRVL_WTHDRAW'
		    </if>
             , rtrvl_drct_wthdraw_dt  	= SYSDATE
         WHERE 1=1
           AND clm_no 					= #{clmNo,jdbcType=VARCHAR}
    	<if test='clmWrhsGodTurn != null and clmWrhsGodTurn != ""'>
           AND clm_wrhs_god_turn    	= #{clmWrhsGodTurn,jdbcType=VARCHAR}
    	</if>
    </update>

     <!--K2 클레임관리 - 철회[ERP 출고상품] -->
     <select id="selectOrdErpErpCnt" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="int" >
	         select count(1) from clm_erp_trnsmis
             where clm_no= #{clmNo,jdbcType=VARCHAR}
             and clm_erp_trnsmis_tp_cd='ERP_OR_ERP'
             and erp_trnsmis_cd='Y'
     </select>


    <update id="updateRtrvlDstbWthdraw" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
         UPDATE INF_ORD_GOD_ERP_DSTB T1
            SET  T1.CLM_NO=#{wthDrawClmNo,jdbcType=VARCHAR}
                ,T1.udt_dt= SYSDATE
         WHERE T1.ORD_NO||T1.QTY_TURN IN (
          SELECT   oc.ord_no||isd.qty_turn
          FROM ord_clm_god_cnnc oc
                    JOIN lgs_dlivy_drct_god dl
                    ON oc.ord_no = dl.ord_no
                    AND oc.ord_god_turn = dl.ord_god_turn
                    JOIN inf_ord_god_erp_dstb isd
                    ON oc.ord_no=isd.ord_no
                    AND oc.ord_god_turn=isd.ord_god_turn
                    AND isd.clm_no is null
                    AND rownum <![CDATA[<=]]>  oc.ord_clm_qty
              WHERE oc.god_cnnc_tp_cd = 'DLIVY_GOD_CNNC'
              AND oc.clm_no = #{clmNo,jdbcType=VARCHAR}
              AND oc.clm_wrhs_god_turn = #{clmWrhsGodTurn,jdbcType=VARCHAR}
           )
       AND T1.ORD_NO=#{ordNo,jdbcType=VARCHAR}
    </update>

	<!-- 클레임관리 - 철회[물류출고지시상품] -->
    <select id="selectClmDrctWthdraw" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="int">
		SELECT /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.selectClmDrctWthdraw][클레임관리 철회 - 물류출고지시상품 건수 조회][KEN] */
		       COUNT(1)
		  FROM ord_clm_god_cnnc oc
		       JOIN lgs_dlivy_drct_god dl
		            ON oc.ord_no = dl.ord_no
		           AND oc.ord_god_turn = dl.ord_god_turn
		 WHERE oc.god_cnnc_tp_cd = 'DLIVY_GOD_CNNC'
		   AND dl.dlv_stat_cd NOT IN ('DLV_WAIT', 'DLIVY_DRCT_WAIT', 'SHTG_RCEPT','EXCHG_WRHS_WAIT', 'DLIVY_DRCT_CNCL')
		   AND oc.clm_no = #{clmNo,jdbcType=VARCHAR}
		<if test='clmWrhsGodTurn != null and clmWrhsGodTurn != ""'>
		   AND oc.clm_wrhs_god_turn = #{clmWrhsGodTurn}
		</if>
    </select>
	 <!-- 클레임관리 - 철회[물류출고지시상품 전환시체크] -->
    <select id="selectSwitchClmDrctWthdraw" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="int">
		SELECT /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.selectSwitchClmDrctWthdraw][클레임관리 철회 - 물류출고지시상품 건수 조회 전환시체크][KEN] */
		       COUNT(1)
		  FROM ord_clm_god_cnnc oc
		       JOIN lgs_dlivy_drct_god dl
		            ON oc.ord_no = dl.ord_no
		           AND oc.ord_god_turn = dl.ord_god_turn
		 WHERE oc.god_cnnc_tp_cd = 'DLIVY_GOD_CNNC'
		   AND (dlivy_drct_cncl_stat_cd is null or dlivy_drct_cncl_stat_cd != 'DLIVY_DRCT_CNCL_DCSN')
		   AND dl.dlv_stat_cd NOT IN ('DLV_WAIT', 'DLIVY_DRCT_WAIT', 'SHTG_RCEPT','EXCHG_WRHS_WAIT', 'DLIVY_DRCT_CNCL')
		   AND oc.clm_no = #{clmNo,jdbcType=VARCHAR}
		<if test='clmWrhsGodTurn != null and clmWrhsGodTurn != ""'>
		   AND oc.clm_wrhs_god_turn = #{clmWrhsGodTurn}
		</if>
    </select>
    
	<!-- 클레임관리 - 철회[클레임] -->
    <update id="updateClmForAllWthdraw" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
            UPDATE /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.updateClmForAllWthdraw][클레임관리 철회 - 클레임 update][khan] */
                   clm
               SET stdr_crncy_sum_amt           = 0
                 , pay_exchg_rt_crncy_sum_amt   = 0
                 , rtl_prc_sum_amt              = 0
                 , sale_sum_amt                 = 0
                 , web_dc_sum_amt               = 0
                 , god_dc_sum_amt               = 0
                 , emp_dc_sum_amt               = 0
                 , god_cpn_dc_sum_amt           = 0
                 , bsk_cpn_dc_sum_amt           = 0
                 , unity_pnt_use_sum_amt        = 0
                 , evt_pnt_use_sum_amt          = 0
                 , webpnt_use_sum_amt           = 0
                 , dlv_cst_sum_amt              = 0
                 , dlv_cst_cpn_dc_sum_amt       = 0
                 , imdtl_dc_sum_amt             = 0
                 , unity_pnt_accml_sum_amt      = 0
                 , webpnt_accml_sum_amt         = 0
                 , all_dc_sum_amt               = 0
                 , bundle_dc_sum_amt            = 0
                 , crs_dc_sum_amt               = 0
             WHERE clm_no = #{clmNo,jdbcType=VARCHAR}
    </update>

    <!-- 클레임관리 - 입고완료 -->
    <update id="updateRtrvlStat" parameterType="com.plgrim.ncp.base.entities.datasource1.lgs.LgsRtrvlDrctGodExtend">
        UPDATE /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.updateRtrvlStat][클레임관리 - 입고완료][khan] */
               lgs_rtrvl_drct_god
           SET
               udter_id         	= #{udterId,jdbcType=VARCHAR}
             , udt_dt        		= SYSDATE
        <choose>
            <when test='jobGbn == "gftWrhs"'>
             , rtrvl_stat_cd    	= 'RTRVL_COMPT'     /* 회수완료 */
             , rtrvl_compt_dt   	= SYSDATE           /* 회수완료일시 */
            </when>
            <otherwise>
             , rtrvl_stat_cd   		= 'WRHS_COMPT'      /* 입고완료     */
             , wrhs_compt_dt   		= SYSDATE           /* 입고완료일시 */
            </otherwise>
        </choose>
         WHERE clm_wrhs_god_turn    = #{clmWrhsGodTurn,jdbcType=VARCHAR}
           AND clm_no 				= #{clmNo,jdbcType=VARCHAR}
    </update>

    <!-- 클레임관리 상세 기본정보조회[반품 - 물류배송지별] -->
    <select id="selectReturnClaimDetail" parameterType="String" resultMap="returnClaimDetailResult">
        SELECT /*[claim.return.xml][selectReturnClaimDetail]*/
               ac.dlv_pcupsp_turn                               AS dlvPcupspTurn                            /* 배송 수거지 순번         */
             , ac.addrse_addr                                   AS addrseAddr                               /* 수취인 주소              */
             , ac.addrse_mobil                                  AS addrseMobil                              /* 수취인 휴대전화번호      */
             , ac.addrse_nm                                     AS addrseNm                                 /* 수취인                   */
             , ac.totalDlvCst                                   AS totalDlvCst                              /* 추가배송비               */
             , ac.cncl_dlv_cst                                  AS cnclDlvCst                               /* 환불배송비               */
             , ac.rtgod_dlv_cst                                 AS rtgodDlvCst                              /* 반품배송비               */
             , ac.exchg_dlv_cst                                 AS exchgDlvCst                              /* 교환배송비               */
             , ac.dlv_mn_nm                                     AS dlvMnNm                                  /* 회수방식명               */
             , ac.cvnstor_hdry_aprv_no                          AS cvnstorHdryAprvNo                        /* 편의점 택배 승인 번호    */
             , ac.god_no                                        AS godNo                                    /* 상품번호                 */
             , REPLACE(REPLACE(ac.god_nm,'''','‘'),'"','‘‘')    AS godnm                                    /* 상품명 */
             , ac.itm_no                                        AS itmNo                                    /* 단품번호                 */
             , ac.itm_nm                                        AS itmNm                                    /* 단품명                   */
             , ac.clm_resn_cd                                   AS clmResnCd								/* 클레임 사유 코드         */
             , ac.clm_resn_nm                                   AS clmResnNm								/* 클레임 사유 명           */
             , ac.dcDtl                                         AS dcDtl                        			/* 할인상세                 */
             , ac.rtl_prc                                       AS rtlPrc                                   /* 정소가                   */
             , ac.sale_amt                                      AS saleAmt                                  /* 판매금액                 */
             , ac.web_dc_amt                                    AS webDcAmt                                 /* 웹할인금액               */
             , ac.emp_dc_amt                                    AS empDcAmt                                 /* 임직원 할인 금액         */
               /* 할인금액계산 */
             , ac.all_dc_amt                                    AS allDcAmt                                 /* 전체 할인 금액           */
             , ac.imdtl_dc_amt                                  AS imdtlDcAmt                               /* 즉시 할인 금액           */
             , ac.god_dc_amt                                    AS godDcAmt                                 /* 상품 할인 금액           */
             , ac.bundle_dc_amt                                 AS bundleDcAmt                              /* 묶음 할인 금액           */
             , ac.crs_dc_amt                                    AS crsDcAmt                                 /* 교차 할인 금액           */
               /* 쿠폰할인금액계산 */
             , ac.god_cpn_dc_amt                                AS godCpnDcAmt                              /* 상품 쿠폰 할인 금액      */
             , ac.bsk_cpn_dc_amt                                AS bskCpnDcAmt                              /* 장바구니 쿠폰 할인 금액  */
                /* 고객자산사용금액계산 */
             , ac.unity_pnt_use_amt                             AS unityPntUseAmt                           /* 통합 포인트 사용 금액    */
             , ac.evt_pnt_use_amt                               AS evtPntUseAmt                             /* 이벤트 포인트 사용 금액  */
             , ac.webpnt_use_amt                                AS webPntUseAmt                             /* 웹포인트 사용 금액       */
               /* 적립금액계산 */
             , ac.unity_pnt_accml_amt                           AS unityPntAccmlamt                         /* 통합 포인트 적립 금액    */
             , ac.evt_pnt_accml_amt                             AS evtPntAccmlamt                           /* 이벤트 포인트 적립 금액  */
             , ac.webpnt_accml_amt                              AS webPntAccmlamt                           /* 웹포인트 적립 금액       */

             , ac.godDcSumAmt                                   AS godDcSumAmt                              /* 할인금액                 */
             , ac.godCpnDcSumAmt                                AS godCpnDcSumAmt                           /* 쿠폰할인금액             */
             , ac.godEtcDcSumAmt                                AS godEtcDcSumAmt                           /* 기타할인금액             */
             , ac.stdrCrncySumAmt                               AS stdrCrncySumAmt                          /* 주결제금액               */

             , ac.addrse_base_addr                              AS addrseBaseAddr                           /* 수취인 기본주소          */
             , ac.addrse_detail_addr                            AS addrseDetailAddr                         /* 수취인 상세주소          */
             , ac.addrse_mobil_area_no                          AS addrseMobilAreaNo                        /* 수취인 휴대전화 국가번호 */
             , ac.addrse_mobil_nation_no                        AS addrseMobilNationNo                      /* 수취인 휴대전화 지역번호 */
             , ac.addrse_mobil_tlof_no                          AS addrseMobilTlofNo                        /* 수취인 휴대전화 국번호   */
             , ac.addrse_mobil_tlof_wthn_no                     AS addrseMobilTlofWthnNo                    /* 수취인 휴대전화 국내번호 */
             , ac.dlv_mn_cd                                     AS dlvMnCd                                  /* 회수방식코드             */
             , ac.waybil_no_erp_trnsmis_cd                      AS waybilNoErpTrnsmisCd                     /* 운송장 번호 ERP 전송 코드*/
             , ac.dmstc_waybil_no			                    AS waybilNo				                    /* 송장번호					*/
             , ac.rtrvl_drct_god_no                             AS rtrvlDrctGodNo                           /* 회수지시 상품 번호       */
             , ac.ord_no                                        AS ordNo                                    /* 주문 번호                */
             , ac.clm_no                                        AS clmNo                                    /* 클레임 번호              */
             , ac.gft_yn                                        AS gftYn                                    /* 사은품 여부              */
             , ac.clm_wrhs_god_turn                             AS clmWrhsGodTurn                           /* 클레임 입고 상품 순번    */
             , ac.dlivy_drct_god_no                             AS dlivyDrctGodNo                           /* 출고지시 상품 번호       */
             , ac.dlv_turn                                      AS dlvTurn                                  /* 배송 순번                */
             , ac.rtrvl_shop_id                                 AS rtrvlShopId                              /* 회수 매장 ID             */
             , ac.shop_nm                                       AS shopNm                                   /* 회수 매장 명             */
             , ac.acmtl_god_wt                                  AS acmtlGodWt                               /* 누적 상품 무게           */
             , ac.acmtl_god_vol                                 AS acmtlGodVol                              /* 누적 상품 부피           */
             , ac.lgs_itm_yn                                    AS lgsItmYn                                 /* 물류 단품 여부           */
             , ac.rtrvl_drct_tgt_yn                             AS rtrvlDrctTgtYn                           /* 회수지시 대상 여부       */
             , ac.rtrvl_drct_yn                                 AS rtrvlDrctYn                              /* 회수지시 여부            */
             , ac.rtrvl_drct_grp_dgre                           AS rtrvlDrctGrpDgre                         /* 회수지시 그룹 차수       */
             , ac.rtrvl_drct_count                              AS rtrvlDrctCount                           /* 회수지시 횟수            */
             , ac.rtrvl_drct_tp_cd                              AS rtrvlDrctTpCd                            /* 회수지시 유형 코드       */
             , ac.rtrvl_drct_dt                                 AS rtrvlDrctDt                              /* 회수지시 일시            */
             , ac.rtrvl_drct_qty                                AS rtrvlDrctQty                             /* 회수지시 수량            */
             , ac.rtrvl_drct_wthdraw_qty                        AS rtrvlDrctWthdrawQty                      /* 회수지시 철회 수량       */
             , ac.rtrvl_drct_wthdraw_dt                         AS rtrvlDrctWthdrawDt                       /* 회수지시 철회 일시       */
             , ac.rtrvl_stat_cd                                 AS rtrvlStatCd                              /* 회수 상태 코드           */
             , ac.rtrvl_stat_nm                                 AS rtrvlStatNm                              /* 회수 상태 명             */
             , ac.wrhs_compt_dt                                 AS wrhsComptDt                              /* 입고 완료 일시           */
             , ac.udter_id                                      AS udterId                                  /* 처리자 아이디            */
             , ac.rtrvl_compt_dt                                AS rtrvlComptDt                             /* 회수 완료 일시           */
             , ac.rtrvl_god_stat_cd                             AS rtrvlGodStatCd                           /* 회수 상품 상태 코드      */
             , ac.rtrvl_god_prcs_compt_yn                       AS rtrvlGodPrcsComptYn                      /* 회수 상품 처리 완료 여부 */
             , ac.badn_reqest_cont                              AS badnReqestCont                           /* 불량 의뢰 내용           */
             , ac.hdry_com_trnsmis_tgt_yn                       AS hdryComTrnsmisTgtYn                      /* 택배사 전송 대상 여부    */
             , ac.hdry_com_trnsmis_yn                           AS hdryComTrnsmisYn                         /* 택배사 전송 여부         */
             , ac.hdry_com_trnsmis_dt                           AS hdryComTrnsmisDt                         /* 택배사 전송 일시         */
             , ac.hdry_com_key                                  AS hdryComKey                               /* 택배사 키                */
             , ac.erp_trnsmis_yn                                AS erpTrnsmisYn                             /* ERP 전송 여부            */
             , ac.erp_trnsmis_dt                                AS erpTrnsmisDt                             /* ERP 전송 일시            */
             , ac.erp_cnfirm_yn                                 AS erpCnfirmYn                              /* ERP 확인 여부            */
             , ac.erp_cnfirm_dt                                 AS erpCnfirmDt                              /* ERP 확인 일시            */
             , ac.erp_inv_trnsmis_sect_cd                       AS erpInvTrnsmisSectCd                      /* ERP 재고 전송 구분 코드  */
             , ac.erp_inv_trnsmis_dt                            AS erpInvTrnsmisDt                          /* ERP 재고 전송 일시       */
             , ac.rtgodcst_cal_sect_cd                          AS rtgodcstCalSectCd                        /* 반품비 정산 구분 코드    */
             , ac.rtgodcst_cal_amt                              AS rtgodcstCalAmt                           /* 반품비 정산 금액         */
             , ac.pckage_god_turn                               AS pckageGodTurn                            /* 패키지상품순번           */
             , ac.dlv_stat_cd                                   AS dlvStatCd                                /* 출고배송상태             */
             , ac.dlv_stat_nm                                   AS dlvStatNm                     			/* 출고배송상태명           */
             , ac.dlivy_drct_qty                                AS dlivyDrctQty                             /* 출고지시 수량            */
             , ac.dlivy_drct_cncl_qty                           AS dlivyDrctCnclQty                         /* 출고지시 취소 수량       */
             , ac.dlivyQty					                    AS dlivyQty          						/* 출고수량       			*/
             , ac.mbr_no                                        AS mbrNo                                    /* 회원번호                 */
             , ac.mbrTpCd                                       AS mbrTpCd                                  /* 회원유형코드             */
             , ac.mbrTpNm                                       AS mbrTp                                    /* 회원유형                 */
             , ac.ordCstGbn                                     AS ordCstGbn                                /* 주문배송비여부           */
             , ac.ord_god_turn                                  AS ordGodTurn                               /* 주문상품순번             */
             , ac.god_tp_cd                                     AS godTpCd                                  /* 상품유형코드             */
             , ac.pay_exchg_rt_crncy_amt                        AS payExchgRtCrncyAmt                       /* 결제환율통화금액         */
             , ac.partmal_sect_cd                        		AS partmalSectCd              				/* 입점 구분 코드ㅁ. 입점 구분 : PARTMAL_SECT   >. 자사 : MCOM   >. 입점 : PARTMAL */
             , ac.dlv_memo										AS dlvMemo
             ,(case 
             	when (ac.dlv_cst_cpn_no is not null or ac.dlv_cst_cpn_prm_no is not null ) 
             	then 'Y' ELSE 'N' END)  						AS dlvCstCpnYn								/* 무료 반품 교환 쿠폰 	*/
             , ac.gdgpStatCd									AS gdgpStatCd								/* 수거상태 */
          from (
                SELECT
                       cwg.dlv_pcupsp_turn                                                                  /* 배송 수거지 순번         */
                     , lds.addrse_base_addr                                                                 /* 수취인 기본주소          */
                     , lds.addrse_detail_addr                                                               /* 수취인 상세주소          */
                     , lds.addrse_base_addr||' '||
                       lds.addrse_detail_addr
                                                                            AS addrse_addr                  /* 수취인 주소              */
                     , lds.addrse_mobil_area_no                                                             /* 수취인 휴대전화 국가번호 */
                     , lds.addrse_mobil_nation_no                                                           /* 수취인 휴대전화 지역번호 */
                     , lds.addrse_mobil_tlof_no                                                             /* 수취인 휴대전화 국번호   */
                     , lds.addrse_mobil_tlof_wthn_no                                                        /* 수취인 휴대전화 국내번호 */
                     , lds.addrse_mobil_nation_no||'-'||
                       lds.addrse_mobil_area_no||'-'||
                       lds.addrse_mobil_tlof_no||'-'||
                       lds.addrse_mobil_tlof_wthn_no
                                                                            AS addrse_mobil                 /* 수취인 휴대전화번호      */
                     , lds.addrse_nm                                                                        /* 수취인                   */
                     , dm.cd_nm                                             AS dlv_mn_nm                    /* 회수방식명               */
                     , NVL(ld.cncl_dlv_cst, 0)
                      -NVL(ld.rtgod_dlv_cst, 0)
                                                                            AS totalDlvCst                  /* 추가배송비               */
                     , NVL(ld.cncl_dlv_cst, 0)                              AS cncl_dlv_cst                 /* 환불배송비               */
                     , NVL(ld.rtgod_dlv_cst, 0)                             AS rtgod_dlv_cst                /* 반품배송비               */
                     , ld.cvnstor_hdry_aprv_no                                                              /* 편의점 택배 승인 번호    */
                     , cwg.god_no                                                                           /* 상품번호                 */
                     , cwg.god_nm                                                                           /* 상품명                   */
                     , cwg.itm_no                                                                           /* 단품번호                 */
                     , cwg.itm_nm                                                                           /* 단품명                   */
                     , cwg.clm_resn_cd                                      AS clm_resn_cd					/* 클레임 사유 코드         */
                     , case when cwg.clm_resn_cd = 'ETC' or cwg.clm_resn_cd = 'ETC_GOD_INFO_GAP' then cr.cd_nm || ' : ' || cwg.clm_resn_cont
                        else cr.cd_nm
                        end clm_resn_nm                  /* 클레임 사유 명           */
                     , ''                                                   AS dcDtl                        /* 할인상세                 */
                     , NVL(cwg.rtl_prc, 0)                                  AS rtl_prc                      /* 정소가                   */
                     , NVL(cwg.sale_amt, 0)                                 AS sale_amt                     /* 판매금액                 */
                     , NVL(cwg.web_dc_amt, 0)                               AS web_dc_amt                   /* 웹할인금액               */
                     , NVL(cwg.emp_dc_amt, 0)                               AS emp_dc_amt                   /* 임직원 할인 금액         */
                     /* 할인금액계산 */
                     , NVL(cwg.all_dc_amt, 0)                               AS all_dc_amt                   /* 전체 할인 금액           */
                     , NVL(cwg.imdtl_dc_amt, 0)                             AS imdtl_dc_amt                 /* 즉시 할인 금액           */
                     , NVL(cwg.god_dc_amt, 0)                               AS god_dc_amt                   /* 상품 할인 금액           */
                     , NVL(cwg.bundle_dc_amt, 0)                            AS bundle_dc_amt                /* 묶음 할인 금액           */
                     , NVL(cwg.crs_dc_amt, 0)                               AS crs_dc_amt                   /* 교차 할인 금액           */
                     /* 쿠폰할인금액계산 */
                     , NVL(cwg.god_cpn_dc_amt, 0)                           AS god_cpn_dc_amt               /* 상품 쿠폰 할인 금액      */
                     , NVL(cwg.bsk_cpn_dc_amt, 0)                           AS bsk_cpn_dc_amt               /* 장바구니 쿠폰 할인 금액  */
                     /* 고객자산사용금액계산 */
                     , NVL(cwg.unity_pnt_use_amt, 0)                        AS unity_pnt_use_amt            /* 통합 포인트 사용 금액    */
                     , NVL(cwg.evt_pnt_use_amt, 0)                          AS evt_pnt_use_amt              /* 이벤트 포인트 사용 금액  */
                     , NVL(cwg.webpnt_use_amt, 0)                           AS webpnt_use_amt               /* 웹포인트 사용 금액       */
                     /* 적립금액계산 */
                     , NVL(cwg.unity_pnt_accml_amt, 0)                      AS unity_pnt_accml_amt          /* 통합 포인트 적립 금액    */
                     , NVL(cwg.evt_pnt_accml_amt, 0)                        AS evt_pnt_accml_amt            /* 이벤트 포인트 적립 금액  */
                     , NVL(cwg.webpnt_accml_amt, 0)                         AS webpnt_accml_amt             /* 웹포인트 적립 금액       */

                     , NVL(cwg.god_dc_amt, 0)                                                               /* 상품 할인 금액           */
                     + NVL(cwg.bundle_dc_amt, 0)                                                            /* 묶음 할인 금액           */
                     + NVL(cwg.crs_dc_amt, 0)                                                               /* 교차 할인 금액           */
                     + NVL(cwg.god_cpn_dc_amt, 0)                                                           /* 상품 쿠폰 할인 금액      */
                     + NVL(cwg.bsk_cpn_dc_amt, 0)                                                           /* 장바구니 쿠폰 할인 금액  */
                                                                            AS godDcSumAmt                  /* 할인금액                 */
                     , NVL(cwg.god_cpn_dc_amt, 0)                                                           /* 상품 쿠폰 할인 금액      */
                     + NVL(cwg.bsk_cpn_dc_amt, 0)                                                           /* 장바구니 쿠폰 할인 금액  */
                                                                            AS godCpnDcSumAmt               /* 쿠폰할인금액             */
                     , NVL(cwg.god_dc_amt, 0)                                                               /* 상품 할인 금액           */
                     + NVL(cwg.bundle_dc_amt, 0)                                                            /* 묶음 할인 금액           */
                     + NVL(cwg.crs_dc_amt, 0)                                                               /* 교차 할인 금액           */
                                                                            AS godEtcDcSumAmt               /* 기타할인금액             */
                     , NVL(cwg.stdr_crncy_amt,0)                            AS stdrCrncySumAmt              /* 주결제금액               */

<!-- ncp2
                     , lds.dlv_mn_cd                                                                        /* 회수방식코드             */
 -->

                     , ld.dlv_mn_cd                                                                         /* 회수방식코드             */
                     , NVL(ld.exchg_dlv_cst, 0)                             AS exchg_dlv_cst                /* 교환배송비               */
                     , ld.waybil_no_erp_trnsmis_cd                                                          /* 운송장 번호 ERP 전송 코드*/
                     , ld.dmstc_waybil_no                                                          			/* 송장 번호				*/
                     , lrdg.rtrvl_drct_god_no                                                               /* 회수지시 상품 번호       */
                     , lrdg.ord_no                                                                          /* 주문 번호                */
                     , lrdg.clm_no                                                                          /* 클레임 번호              */
                     , lrdg.gft_yn                                                                          /* 사은품 여부              */
                     , lrdg.clm_wrhs_god_turn                                                               /* 클레임 입고 상품 순번    */
                     , lrdg.dlivy_drct_god_no                                                               /* 출고지시 상품 번호       */
                     , lrdg.dlv_turn                                                                        /* 배송 순번                */
                     , lrdg.rtrvl_shop_id                                                                   /* 회수 매장 ID             */
                     , ss.shop_nm                                                                           /* 회수 매장 명             */
                     , lrdg.acmtl_god_wt                                                                    /* 누적 상품 무게           */
                     , lrdg.acmtl_god_vol                                                                   /* 누적 상품 부피           */
                     , lrdg.lgs_itm_yn                                                                      /* 물류 단품 여부           */
                     , lrdg.rtrvl_drct_tgt_yn                                                               /* 회수지시 대상 여부       */
                     , lrdg.rtrvl_drct_yn                                                                   /* 회수지시 여부            */
                     , lrdg.rtrvl_drct_grp_dgre                                                             /* 회수지시 그룹 차수       */
                     , lrdg.rtrvl_drct_count                                                                /* 회수지시 횟수            */
                     , lrdg.rtrvl_drct_tp_cd                                                                /* 회수지시 유형 코드       */
                     , lrdg.rtrvl_drct_dt                                                                   /* 회수지시 일시            */
                     , lrdg.rtrvl_drct_qty                                                                  /* 회수지시 수량            */
                     , lrdg.rtrvl_drct_wthdraw_qty                                                          /* 회수지시 철회 수량       */
                     , lrdg.rtrvl_drct_wthdraw_dt                                                           /* 회수지시 철회 일시       */
                     , lrdg.rtrvl_stat_cd                                                                   /* 회수 상태 코드           */
                     , rs.cd_nm                                             AS rtrvl_stat_nm                /* 회수 상태 명             */
                     , lrdg.wrhs_compt_dt                                                                   /* 입고 완료 일시           */
                     , lrdg.rtrvl_compt_dt                                                                  /* 회수 완료 일시           */
                     , lrdg.udter_id                                                                        /* 처리일자                 */
                     , lrdg.rtrvl_god_stat_cd                                                               /* 회수 상품 상태 코드      */
                     , lrdg.rtrvl_god_prcs_compt_yn                                                         /* 회수 상품 처리 완료 여부 */
                     , lrdg.badn_reqest_cont                                                                /* 불량 의뢰 내용           */
                     , lrdg.hdry_com_trnsmis_tgt_yn                                                         /* 택배사 전송 대상 여부    */
                     , lrdg.hdry_com_trnsmis_yn                                                             /* 택배사 전송 여부         */
                     , lrdg.hdry_com_trnsmis_dt                                                             /* 택배사 전송 일시         */
                     , lrdg.hdry_com_key                                                                    /* 택배사 키                */
                     , lrdg.erp_trnsmis_yn                                                                  /* ERP 전송 여부            */
                     , lrdg.erp_trnsmis_dt                                                                  /* ERP 전송 일시            */
                     , lrdg.erp_cnfirm_yn                                                                   /* ERP 확인 여부            */
                     , lrdg.erp_cnfirm_dt                                                                   /* ERP 확인 일시            */
                     , lrdg.erp_inv_trnsmis_sect_cd                                                         /* ERP 재고 전송 구분 코드  */
                     , lrdg.erp_inv_trnsmis_dt                                                              /* ERP 재고 전송 일시       */
                     , lrdg.rtgodcst_cal_sect_cd                                                            /* 반품비 정산 구분 코드    */
                     , lrdg.rtgodcst_cal_amt                                                                /* 반품비 정산 금액         */
                     , lddg.pckage_god_turn                                                                 /* 패키지상품순번           */
                     , lddg.dlv_stat_cd                                                                     /* 출고배송상태코드         */
                     , ds.cd_nm                                             AS dlv_stat_nm                  /* 출고배송상태명           */
                     , NVL(lddg.dlivy_drct_qty, 0)                          AS dlivy_drct_qty               /* 출고지시 수량            */
                     , NVL(lddg.dlivy_drct_cncl_qty, 0)                     AS dlivy_drct_cncl_qty          /* 출고지시 취소 수량       */
                     , NVL(lddg.dlivy_drct_qty, 0)
                     - NVL(lddg.dlivy_drct_cncl_qty, 0)                     AS dlivyQty          			/* 출고수량       			*/
                     , od.mbr_no                                                                            /* 회원번호                 */
                     , od.mbr_tp_cd                                         AS mbrTpCd                      /* 회원유형코드             */
                     , mt.cd_nm                                             AS mbrTpNm                      /* 회원유형명               */
                     , DECODE(NVL(od.dlv_cst_sum_amt, 0), 0, 'N', 'Y')      AS ordCstGbn                    /* 주문배송비여부           */
                     , ocgc.ord_god_turn                                                                    /* 주문상품순번             */
                     , og.god_tp_cd                                                                         /* 상품유형코드             */
                     , NVL(og.pay_exchg_rt_crncy_amt,0)           			AS pay_exchg_rt_crncy_amt       /* 결제환율통화금액         */
                     , og.partmal_sect_cd                        			AS partmal_sect_cd              /* 입점 구분 코드ㅁ. 입점 구분 : PARTMAL_SECT   >. 자사 : MCOM   >. 입점 : PARTMAL */
                     , lds.dlv_memo
                     , ld.dlv_cst_cpn_no 									AS dlv_cst_cpn_no				/* 무료 반품 교환 쿠폰 	*/
					 , ld.dlv_cst_cpn_prm_no 								AS dlv_cst_cpn_prm_no			/* 무료 반품 교환 쿠폰 	*/
					 , ld.gdgpStatCd										AS gdgpStatCd					/* 수거상태 */
                  FROM clm_wrhs_god cwg
                       JOIN lgs_dlvsp lds
                            ON (lds.ord_no = cwg.ord_no
                            AND lds.clm_no = cwg.clm_no
                            AND lds.dlv_pcupsp_turn = cwg.dlv_pcupsp_turn
                            AND lds.dlv_pcupsp_sect_cd = 'CLM_PCUPSP')
<!-- ncp2 추가
                       JOIN lgs_dlv ld
                            ON (ld.ord_no = lds.ord_no
                            AND ld.dlv_pcupsp_turn = lds.dlv_pcupsp_turn
                            AND ld.dmstc_dlv_cst_plc_sn = cwg.dmstc_dlv_cst_plc_sn
                            AND ld.clm_no = cwg.clm_no)
-->

<!-- ncp2 추가 물류배송 금액 SUM -->
                        JOIN (
                            SELECT ld.ord_no
                                    , ld.dlv_pcupsp_turn
<!--
                                    , ld.dmstc_dlv_cst_plc_sn
-->
                                    , cg.clm_no
                                    , cg.clm_wrhs_god_turn
                                    , ld.dlv_mn_cd
                                    , ld.waybil_no_erp_trnsmis_cd
                                    , MAX(ld.dmstc_waybil_no) AS dmstc_waybil_no				 /* 대표송장번호 */
                                    , ld.cvnstor_hdry_aprv_no                                    /* 편의점 택배 승인 번호 */
                                    , SUM(NVL(ld.cncl_dlv_cst, 0)) AS cncl_dlv_cst               /* 환불배송비 */
                                    , SUM(NVL(ld.rtgod_dlv_cst, 0)) AS rtgod_dlv_cst             /* 반품배송비 */
                                    , SUM(NVL(ld.exchg_dlv_cst, 0)) AS exchg_dlv_cst
                                    <!-- 무료 반품 교환 쿠폰 추가 -->
                                    , MAX(ld.dlv_cst_cpn_no) AS dlv_cst_cpn_no					 /* 무료 반품 교환 쿠폰 	*/
                                    , MAX(ld.dlv_cst_cpn_prm_no) AS dlv_cst_cpn_prm_no			 /* 무료 반품 교환 쿠폰 	*/
                                    , CASE WHEN ld.dlv_com_cd = 'CJKEX'
								               		THEN CASE WHEN ld.gdgp_stat_cd IS NOT NULL
								                         	  THEN (SELECT NVL(cd_nm, '-')
								                                    	FROM SYS_EXCP_CD
								                                    WHERE grp_cd = 'FRGHT_STAT'
								                                        AND cd = ld.gdgp_stat_cd)
								                               ELSE '-'
								                           END
								                     ELSE '-'    
								               END AS gdgpStatCd /* 수거상태 */
                            FROM clm_wrhs_god cg
                            	INNER JOIN lgs_rtrvl_drct_god rdg ON cg.clm_no = rdg.clm_no AND cg.clm_wrhs_god_turn = rdg.clm_wrhs_god_turn
                              	INNER JOIN lgs_dlv ld ON rdg.ord_no = ld.ord_no AND rdg.dlv_pcupsp_turn = ld.dlv_pcupsp_turn AND rdg.dlv_turn = ld.dlv_turn
                            WHERE 1 = 1
                            GROUP BY ld.ord_no
                                      , ld.dlv_pcupsp_turn
<!--
                                      , ld.dmstc_dlv_cst_plc_sn
-->
                                      , cg.clm_no
                                      , cg.clm_wrhs_god_turn
                                      , ld.dlv_mn_cd
                                      , ld.waybil_no_erp_trnsmis_cd
                                      , ld.cvnstor_hdry_aprv_no
                                      , ld.dlv_com_cd
                                      , ld.gdgp_stat_cd
                        ) ld
                        ON (ld.ord_no = lds.ord_no
                        AND ld.dlv_pcupsp_turn = lds.dlv_pcupsp_turn
                        AND ld.clm_no = cwg.clm_no
                        AND ld.clm_wrhs_god_turn = cwg.clm_wrhs_god_turn)
<!-- ncp2 추가 물류배송 금액 SUM -->

                       JOIN lgs_rtrvl_drct_god lrdg
                            ON (lrdg.clm_no = cwg.clm_no
                            AND lrdg.ord_no = cwg.ord_no
                            AND lrdg.clm_wrhs_god_turn = cwg.clm_wrhs_god_turn)
                       JOIN lgs_dlivy_drct_god lddg
                            ON (lddg.dlivy_drct_god_no = lrdg.dlivy_drct_god_no)
                       LEFT OUTER JOIN sys_shop ss ON lrdg.rtrvl_shop_id = ss.shop_id
                       JOIN ord od ON od.ord_no = cwg.ord_no
            LEFT OUTER JOIN mv_sys_cd mt
                            ON od.mbr_tp_cd = mt.cd
                           AND mt.lang_cd = 'KOR'
                           AND mt.upper_cd = 'MBR_TP'
            LEFT OUTER JOIN mv_sys_cd cr ON cwg.clm_resn_cd = cr.cd AND cr.lang_cd = 'KOR' AND cr.upper_cd = 'CLM_RSN'
            LEFT OUTER JOIN mv_sys_cd rs ON lrdg.rtrvl_stat_cd = rs.cd AND rs.lang_cd = 'KOR' AND rs.upper_cd = 'RTRVL_STAT'
            LEFT OUTER JOIN mv_sys_cd ds ON lddg.dlv_stat_cd = ds.cd AND ds.lang_cd = 'KOR' AND ds.upper_cd = 'DLV_STAT'
<!--
            LEFT OUTER JOIN mv_sys_cd dm ON lds.dlv_mn_cd = dm.cd AND dm.lang_cd = 'KOR' AND dm.upper_cd = 'DLV_MN'
 -->
            LEFT OUTER JOIN mv_sys_cd dm ON ld.dlv_mn_cd = dm.cd AND dm.lang_cd = 'KOR' AND dm.upper_cd = 'DLV_MN'
                       JOIN ord_clm_god_cnnc ocgc
                            ON (ocgc.ord_no = cwg.ord_no
                            AND ocgc.clm_no = cwg.clm_no
                            AND ocgc.clm_wrhs_god_turn = cwg.clm_wrhs_god_turn
                            AND ocgc.god_cnnc_tp_cd = 'WRHS_GOD_CNNC')
                       JOIN ord_god og
                            ON (ocgc.ord_no = og.ord_no
                            AND ocgc.ord_god_turn = og.ord_god_turn)
                       JOIN clm clm
                            ON (clm.clm_no = cwg.clm_no)
                 WHERE 1 = 1
                   AND cwg.clm_no = #{clmNo,jdbcType=VARCHAR}
                   AND clm.clm_tp_cd = 'RTGOD'
                   AND og.god_tp_cd NOT IN ('SET_GOD', 'PCKAGE_GOD')
<!--
                   AND lrdg.hdry_com_trnsmis_tgt_yn = 'Y'
 -->
               ) ac
               LEFT OUTER JOIN ord_cpst_god_cnnc oc
                    ON ac.ord_no = oc.ord_no
                   AND ac.ord_god_turn = oc.ord_cpst_god_turn
        ORDER BY ac.dlv_pcupsp_turn
               , ac.ord_god_turn
               , ac.ord_no
               , ac.itm_no
    </select>

    <!-- 클레임관리 상세 기본정보조회[반품 - 물류배송지별] -->
    <select id="selectReturnClaimDetail_bk" parameterType="String" resultMap="returnClaimDetailResult">
        SELECT /*[claim.return.xml][selectReturnClaimDetail_bk]*/
        ac.dlv_pcupsp_turn                               AS dlvPcupspTurn                            /* 배송 수거지 순번         */
        , ac.addrse_addr                                   AS addrseAddr                               /* 수취인 주소              */
        , ac.addrse_mobil                                  AS addrseMobil                              /* 수취인 휴대전화번호      */
        , ac.addrse_nm                                     AS addrseNm                                 /* 수취인                   */
        , ac.totalDlvCst                                   AS totalDlvCst                              /* 추가배송비               */
        , ac.cncl_dlv_cst                                  AS cnclDlvCst                               /* 환불배송비               */
        , ac.rtgod_dlv_cst                                 AS rtgodDlvCst                              /* 반품배송비               */
        , ac.exchg_dlv_cst                                 AS exchgDlvCst                              /* 교환배송비               */
        , ac.dlv_mn_nm                                     AS dlvMnNm                                  /* 회수방식명               */
        , ac.cvnstor_hdry_aprv_no                          AS cvnstorHdryAprvNo                        /* 편의점 택배 승인 번호    */
        , ac.god_no                                        AS godNo                                    /* 상품번호                 */
             , REPLACE(ac.god_nm,'''','‘')                     AS godNm                                    /* 상품명                   */
             , ac.itm_no                                        AS itmNo                                    /* 단품번호                 */
             , ac.itm_nm                                        AS itmNm                                    /* 단품명                   */
             , ac.clm_resn_cd                                   AS clmResnCd								/* 클레임 사유 코드         */
             , ac.clm_resn_nm                                   AS clmResnNm								/* 클레임 사유 명           */
             , ac.dcDtl                                         AS dcDtl                        			/* 할인상세                 */
             , ac.rtl_prc                                       AS rtlPrc                                   /* 정소가                   */
             , ac.sale_amt                                      AS saleAmt                                  /* 판매금액                 */
             , ac.web_dc_amt                                    AS webDcAmt                                 /* 웹할인금액               */
             , ac.emp_dc_amt                                    AS empDcAmt                                 /* 임직원 할인 금액         */
               /* 할인금액계산 */
             , ac.all_dc_amt                                    AS allDcAmt                                 /* 전체 할인 금액           */
             , ac.imdtl_dc_amt                                  AS imdtlDcAmt                               /* 즉시 할인 금액           */
             , ac.god_dc_amt                                    AS godDcAmt                                 /* 상품 할인 금액           */
             , ac.bundle_dc_amt                                 AS bundleDcAmt                              /* 묶음 할인 금액           */
             , ac.crs_dc_amt                                    AS crsDcAmt                                 /* 교차 할인 금액           */
               /* 쿠폰할인금액계산 */
             , ac.god_cpn_dc_amt                                AS godCpnDcAmt                              /* 상품 쿠폰 할인 금액      */
             , ac.bsk_cpn_dc_amt                                AS bskCpnDcAmt                              /* 장바구니 쿠폰 할인 금액  */
                /* 고객자산사용금액계산 */
             , ac.unity_pnt_use_amt                             AS unityPntUseAmt                           /* 통합 포인트 사용 금액    */
             , ac.evt_pnt_use_amt                               AS evtPntUseAmt                             /* 이벤트 포인트 사용 금액  */
             , ac.webpnt_use_amt                                AS webPntUseAmt                             /* 웹포인트 사용 금액       */
               /* 적립금액계산 */
             , ac.unity_pnt_accml_amt                           AS unityPntAccmlamt                         /* 통합 포인트 적립 금액    */
             , ac.evt_pnt_accml_amt                             AS evtPntAccmlamt                           /* 이벤트 포인트 적립 금액  */
             , ac.webpnt_accml_amt                              AS webPntAccmlamt                           /* 웹포인트 적립 금액       */

             , ac.godDcSumAmt                                   AS godDcSumAmt                              /* 할인금액                 */
             , ac.godCpnDcSumAmt                                AS godCpnDcSumAmt                           /* 쿠폰할인금액             */
             , ac.godEtcDcSumAmt                                AS godEtcDcSumAmt                           /* 기타할인금액             */
             , ac.stdrCrncySumAmt                               AS stdrCrncySumAmt                          /* 주결제금액               */

             , ac.addrse_base_addr                              AS addrseBaseAddr                           /* 수취인 기본주소          */
             , ac.addrse_detail_addr                            AS addrseDetailAddr                         /* 수취인 상세주소          */
             , ac.addrse_mobil_area_no                          AS addrseMobilAreaNo                        /* 수취인 휴대전화 국가번호 */
             , ac.addrse_mobil_nation_no                        AS addrseMobilNationNo                      /* 수취인 휴대전화 지역번호 */
             , ac.addrse_mobil_tlof_no                          AS addrseMobilTlofNo                        /* 수취인 휴대전화 국번호   */
             , ac.addrse_mobil_tlof_wthn_no                     AS addrseMobilTlofWthnNo                    /* 수취인 휴대전화 국내번호 */
             , ac.dlv_mn_cd                                     AS dlvMnCd                                  /* 회수방식코드             */
             , ac.waybil_no_erp_trnsmis_cd                      AS waybilNoErpTrnsmisCd                     /* 운송장 번호 ERP 전송 코드*/
             , ac.rtrvl_drct_god_no                             AS rtrvlDrctGodNo                           /* 회수지시 상품 번호       */
             , ac.ord_no                                        AS ordNo                                    /* 주문 번호                */
             , ac.clm_no                                        AS clmNo                                    /* 클레임 번호              */
             , ac.gft_yn                                        AS gftYn                                    /* 사은품 여부              */
             , ac.clm_wrhs_god_turn                             AS clmWrhsGodTurn                           /* 클레임 입고 상품 순번    */
             , ac.dlivy_drct_god_no                             AS dlivyDrctGodNo                           /* 출고지시 상품 번호       */
             , ac.dlv_turn                                      AS dlvTurn                                  /* 배송 순번                */
             , ac.rtrvl_shop_id                                 AS rtrvlShopId                              /* 회수 매장 ID             */
             , ac.shop_nm                                       AS shopNm                                   /* 회수 매장 명             */
             , ac.acmtl_god_wt                                  AS acmtlGodWt                               /* 누적 상품 무게           */
             , ac.acmtl_god_vol                                 AS acmtlGodVol                              /* 누적 상품 부피           */
             , ac.lgs_itm_yn                                    AS lgsItmYn                                 /* 물류 단품 여부           */
             , ac.rtrvl_drct_tgt_yn                             AS rtrvlDrctTgtYn                           /* 회수지시 대상 여부       */
             , ac.rtrvl_drct_yn                                 AS rtrvlDrctYn                              /* 회수지시 여부            */
             , ac.rtrvl_drct_grp_dgre                           AS rtrvlDrctGrpDgre                         /* 회수지시 그룹 차수       */
             , ac.rtrvl_drct_count                              AS rtrvlDrctCount                           /* 회수지시 횟수            */
             , ac.rtrvl_drct_tp_cd                              AS rtrvlDrctTpCd                            /* 회수지시 유형 코드       */
             , ac.rtrvl_drct_dt                                 AS rtrvlDrctDt                              /* 회수지시 일시            */
             , ac.rtrvl_drct_qty                                AS rtrvlDrctQty                             /* 회수지시 수량            */
             , ac.rtrvl_drct_wthdraw_qty                        AS rtrvlDrctWthdrawQty                      /* 회수지시 철회 수량       */
             , ac.rtrvl_drct_wthdraw_dt                         AS rtrvlDrctWthdrawDt                       /* 회수지시 철회 일시       */
             , ac.rtrvl_stat_cd                                 AS rtrvlStatCd                              /* 회수 상태 코드           */
             , ac.rtrvl_stat_nm                                 AS rtrvlStatNm                              /* 회수 상태 명             */
             , ac.wrhs_compt_dt                                 AS wrhsComptDt                              /* 입고 완료 일시           */
             , ac.rtrvl_compt_dt                                AS rtrvlComptDt                             /* 회수 완료 일시           */
             , ac.rtrvl_god_stat_cd                             AS rtrvlGodStatCd                           /* 회수 상품 상태 코드      */
             , ac.rtrvl_god_prcs_compt_yn                       AS rtrvlGodPrcsComptYn                      /* 회수 상품 처리 완료 여부 */
             , ac.badn_reqest_cont                              AS badnReqestCont                           /* 불량 의뢰 내용           */
             , ac.hdry_com_trnsmis_tgt_yn                       AS hdryComTrnsmisTgtYn                      /* 택배사 전송 대상 여부    */
             , ac.hdry_com_trnsmis_yn                           AS hdryComTrnsmisYn                         /* 택배사 전송 여부         */
             , ac.hdry_com_trnsmis_dt                           AS hdryComTrnsmisDt                         /* 택배사 전송 일시         */
             , ac.hdry_com_key                                  AS hdryComKey                               /* 택배사 키                */
             , ac.erp_trnsmis_yn                                AS erpTrnsmisYn                             /* ERP 전송 여부            */
             , ac.erp_trnsmis_dt                                AS erpTrnsmisDt                             /* ERP 전송 일시            */
             , ac.erp_cnfirm_yn                                 AS erpCnfirmYn                              /* ERP 확인 여부            */
             , ac.erp_cnfirm_dt                                 AS erpCnfirmDt                              /* ERP 확인 일시            */
             , ac.erp_inv_trnsmis_sect_cd                       AS erpInvTrnsmisSectCd                      /* ERP 재고 전송 구분 코드  */
             , ac.erp_inv_trnsmis_dt                            AS erpInvTrnsmisDt                          /* ERP 재고 전송 일시       */
             , ac.rtgodcst_cal_sect_cd                          AS rtgodcstCalSectCd                        /* 반품비 정산 구분 코드    */
             , ac.rtgodcst_cal_amt                              AS rtgodcstCalAmt                           /* 반품비 정산 금액         */
             , ac.pckage_god_turn                               AS pckageGodTurn                            /* 패키지상품순번           */
             , ac.dlv_stat_cd                                   AS dlvStatCd                                /* 출고배송상태             */
             , ac.dlv_stat_nm                                   AS dlvStatNm                     			/* 출고배송상태명           */
             , ac.dlivy_drct_qty                                AS dlivyDrctQty                             /* 출고지시 수량            */
             , ac.dlivy_drct_cncl_qty                           AS dlivyDrctCnclQty                         /* 출고지시 취소 수량       */
             , ac.dlivyQty					                    AS dlivyQty          						/* 출고수량       			*/
             , ac.mbr_no                                        AS mbrNo                                    /* 회원번호                 */
             , ac.mbrTpCd                                       AS mbrTpCd                                  /* 회원유형코드             */
             , ac.mbrTpNm                                       AS mbrTp                                    /* 회원유형                 */
             , ac.ordCstGbn                                     AS ordCstGbn                                /* 주문배송비여부           */
             , ac.ord_god_turn                                  AS ordGodTurn                               /* 주문상품순번             */
             , ac.god_tp_cd                                     AS godTpCd                                  /* 상품유형코드             */
             , ac.pay_exchg_rt_crncy_amt                        AS payExchgRtCrncyAmt                       /* 결제환율통화금액         */
          from (
                SELECT
                       cwg.dlv_pcupsp_turn                                                                  /* 배송 수거지 순번         */
                     , lds.addrse_base_addr                                                                 /* 수취인 기본주소          */
                     , lds.addrse_detail_addr                                                               /* 수취인 상세주소          */
                     , lds.addrse_base_addr||' '||
                       lds.addrse_detail_addr
                                                                            AS addrse_addr                  /* 수취인 주소              */
                     , lds.addrse_mobil_area_no                                                             /* 수취인 휴대전화 국가번호 */
                     , lds.addrse_mobil_nation_no                                                           /* 수취인 휴대전화 지역번호 */
                     , lds.addrse_mobil_tlof_no                                                             /* 수취인 휴대전화 국번호   */
                     , lds.addrse_mobil_tlof_wthn_no                                                        /* 수취인 휴대전화 국내번호 */
                     , lds.addrse_mobil_nation_no||'-'||
                       lds.addrse_mobil_area_no||'-'||
                       lds.addrse_mobil_tlof_no||'-'||
                       lds.addrse_mobil_tlof_wthn_no
                                                                            AS addrse_mobil                 /* 수취인 휴대전화번호      */
                     , lds.addrse_nm                                                                        /* 수취인                   */
                     , dm.cd_nm                                             AS dlv_mn_nm                    /* 회수방식명               */
                     , NVL(ld.cncl_dlv_cst, 0)
                      -NVL(ld.rtgod_dlv_cst, 0)
                                                                            AS totalDlvCst                  /* 추가배송비               */
                     , NVL(ld.cncl_dlv_cst, 0)                              AS cncl_dlv_cst                 /* 환불배송비               */
                     , NVL(ld.rtgod_dlv_cst, 0)                             AS rtgod_dlv_cst                /* 반품배송비               */
                     , ld.cvnstor_hdry_aprv_no                                                              /* 편의점 택배 승인 번호    */
                     , cwg.god_no                                                                           /* 상품번호                 */
                     , cwg.god_nm                                                                           /* 상품명                   */
                     , cwg.itm_no                                                                           /* 단품번호                 */
                     , cwg.itm_nm                                                                           /* 단품명                   */
                     , cwg.clm_resn_cd                                      AS clm_resn_cd					/* 클레임 사유 코드         */
                     , cr.cd_nm                                             AS clm_resn_nm                  /* 클레임 사유 명           */
                     , ''                                                   AS dcDtl                        /* 할인상세                 */
                     , NVL(cwg.rtl_prc, 0)                                  AS rtl_prc                      /* 정소가                   */
                     , NVL(cwg.sale_amt, 0)                                 AS sale_amt                     /* 판매금액                 */
                     , NVL(cwg.web_dc_amt, 0)                               AS web_dc_amt                   /* 웹할인금액               */
                     , NVL(cwg.emp_dc_amt, 0)                               AS emp_dc_amt                   /* 임직원 할인 금액         */
                     /* 할인금액계산 */
                     , NVL(cwg.all_dc_amt, 0)                               AS all_dc_amt                   /* 전체 할인 금액           */
                     , NVL(cwg.imdtl_dc_amt, 0)                             AS imdtl_dc_amt                 /* 즉시 할인 금액           */
                     , NVL(cwg.god_dc_amt, 0)                               AS god_dc_amt                   /* 상품 할인 금액           */
                     , NVL(cwg.bundle_dc_amt, 0)                            AS bundle_dc_amt                /* 묶음 할인 금액           */
                     , NVL(cwg.crs_dc_amt, 0)                               AS crs_dc_amt                   /* 교차 할인 금액           */
                     /* 쿠폰할인금액계산 */
                     , NVL(cwg.god_cpn_dc_amt, 0)                           AS god_cpn_dc_amt               /* 상품 쿠폰 할인 금액      */
                     , NVL(cwg.bsk_cpn_dc_amt, 0)                           AS bsk_cpn_dc_amt               /* 장바구니 쿠폰 할인 금액  */
                     /* 고객자산사용금액계산 */
                     , NVL(cwg.unity_pnt_use_amt, 0)                        AS unity_pnt_use_amt            /* 통합 포인트 사용 금액    */
                     , NVL(cwg.evt_pnt_use_amt, 0)                          AS evt_pnt_use_amt              /* 이벤트 포인트 사용 금액  */
                     , NVL(cwg.webpnt_use_amt, 0)                           AS webpnt_use_amt               /* 웹포인트 사용 금액       */
                     /* 적립금액계산 */
                     , NVL(cwg.unity_pnt_accml_amt, 0)                      AS unity_pnt_accml_amt          /* 통합 포인트 적립 금액    */
                     , NVL(cwg.evt_pnt_accml_amt, 0)                        AS evt_pnt_accml_amt            /* 이벤트 포인트 적립 금액  */
                     , NVL(cwg.webpnt_accml_amt, 0)                         AS webpnt_accml_amt             /* 웹포인트 적립 금액       */

                     , NVL(cwg.god_dc_amt, 0)                                                               /* 상품 할인 금액           */
                     + NVL(cwg.bundle_dc_amt, 0)                                                            /* 묶음 할인 금액           */
                     + NVL(cwg.crs_dc_amt, 0)                                                               /* 교차 할인 금액           */
                     + NVL(cwg.god_cpn_dc_amt, 0)                                                           /* 상품 쿠폰 할인 금액      */
                     + NVL(cwg.bsk_cpn_dc_amt, 0)                                                           /* 장바구니 쿠폰 할인 금액  */
                                                                            AS godDcSumAmt                  /* 할인금액                 */
                     , NVL(cwg.god_cpn_dc_amt, 0)                                                           /* 상품 쿠폰 할인 금액      */
                     + NVL(cwg.bsk_cpn_dc_amt, 0)                                                           /* 장바구니 쿠폰 할인 금액  */
                                                                            AS godCpnDcSumAmt               /* 쿠폰할인금액             */
                     , NVL(cwg.god_dc_amt, 0)                                                               /* 상품 할인 금액           */
                     + NVL(cwg.bundle_dc_amt, 0)                                                            /* 묶음 할인 금액           */
                     + NVL(cwg.crs_dc_amt, 0)                                                               /* 교차 할인 금액           */
                                                                            AS godEtcDcSumAmt               /* 기타할인금액             */
                     , NVL(cwg.stdr_crncy_amt,0)                            AS stdrCrncySumAmt              /* 주결제금액               */
                     , lds.dlv_mn_cd                                                                        /* 회수방식코드             */
                     , NVL(ld.exchg_dlv_cst, 0)                             AS exchg_dlv_cst                /* 교환배송비               */
                     , ld.waybil_no_erp_trnsmis_cd                                                          /* 운송장 번호 ERP 전송 코드*/
                     , lrdg.rtrvl_drct_god_no                                                               /* 회수지시 상품 번호       */
                     , lrdg.ord_no                                                                          /* 주문 번호                */
                     , lrdg.clm_no                                                                          /* 클레임 번호              */
                     , lrdg.gft_yn                                                                          /* 사은품 여부              */
                     , lrdg.clm_wrhs_god_turn                                                               /* 클레임 입고 상품 순번    */
                     , lrdg.dlivy_drct_god_no                                                               /* 출고지시 상품 번호       */
                     , lrdg.dlv_turn                                                                        /* 배송 순번                */
                     , lrdg.rtrvl_shop_id                                                                   /* 회수 매장 ID             */
                     , ss.shop_nm                                                                           /* 회수 매장 명             */
                     , lrdg.acmtl_god_wt                                                                    /* 누적 상품 무게           */
                     , lrdg.acmtl_god_vol                                                                   /* 누적 상품 부피           */
                     , lrdg.lgs_itm_yn                                                                      /* 물류 단품 여부           */
                     , lrdg.rtrvl_drct_tgt_yn                                                               /* 회수지시 대상 여부       */
                     , lrdg.rtrvl_drct_yn                                                                   /* 회수지시 여부            */
                     , lrdg.rtrvl_drct_grp_dgre                                                             /* 회수지시 그룹 차수       */
                     , lrdg.rtrvl_drct_count                                                                /* 회수지시 횟수            */
                     , lrdg.rtrvl_drct_tp_cd                                                                /* 회수지시 유형 코드       */
                     , lrdg.rtrvl_drct_dt                                                                   /* 회수지시 일시            */
                     , lrdg.rtrvl_drct_qty                                                                  /* 회수지시 수량            */
                     , lrdg.rtrvl_drct_wthdraw_qty                                                          /* 회수지시 철회 수량       */
                     , lrdg.rtrvl_drct_wthdraw_dt                                                           /* 회수지시 철회 일시       */
                     , lrdg.rtrvl_stat_cd                                                                   /* 회수 상태 코드           */
                     , rs.cd_nm                                             AS rtrvl_stat_nm                /* 회수 상태 명             */
                     , lrdg.wrhs_compt_dt                                                                   /* 입고 완료 일시           */
                     , lrdg.rtrvl_compt_dt                                                                  /* 회수 완료 일시           */
                     , lrdg.rtrvl_god_stat_cd                                                               /* 회수 상품 상태 코드      */
                     , lrdg.rtrvl_god_prcs_compt_yn                                                         /* 회수 상품 처리 완료 여부 */
                     , lrdg.badn_reqest_cont                                                                /* 불량 의뢰 내용           */
                     , lrdg.hdry_com_trnsmis_tgt_yn                                                         /* 택배사 전송 대상 여부    */
                     , lrdg.hdry_com_trnsmis_yn                                                             /* 택배사 전송 여부         */
                     , lrdg.hdry_com_trnsmis_dt                                                             /* 택배사 전송 일시         */
                     , lrdg.hdry_com_key                                                                    /* 택배사 키                */
                     , lrdg.erp_trnsmis_yn                                                                  /* ERP 전송 여부            */
                     , lrdg.erp_trnsmis_dt                                                                  /* ERP 전송 일시            */
                     , lrdg.erp_cnfirm_yn                                                                   /* ERP 확인 여부            */
                     , lrdg.erp_cnfirm_dt                                                                   /* ERP 확인 일시            */
                     , lrdg.erp_inv_trnsmis_sect_cd                                                         /* ERP 재고 전송 구분 코드  */
                     , lrdg.erp_inv_trnsmis_dt                                                              /* ERP 재고 전송 일시       */
                     , lrdg.rtgodcst_cal_sect_cd                                                            /* 반품비 정산 구분 코드    */
                     , lrdg.rtgodcst_cal_amt                                                                /* 반품비 정산 금액         */
                     , lddg.pckage_god_turn                                                                 /* 패키지상품순번           */
                     , lddg.dlv_stat_cd                                                                     /* 출고배송상태코드         */
                     , ds.cd_nm                                             AS dlv_stat_nm                  /* 출고배송상태명           */
                     , NVL(lddg.dlivy_drct_qty, 0)                          AS dlivy_drct_qty               /* 출고지시 수량            */
                     , NVL(lddg.dlivy_drct_cncl_qty, 0)                     AS dlivy_drct_cncl_qty          /* 출고지시 취소 수량       */
                     , NVL(lddg.dlivy_drct_qty, 0)
                     - NVL(lddg.dlivy_drct_cncl_qty, 0)                     AS dlivyQty          			/* 출고수량       			*/
                     , od.mbr_no                                                                            /* 회원번호                 */
                     , od.mbr_tp_cd                                         AS mbrTpCd                      /* 회원유형코드             */
                     , mt.cd_nm                                             AS mbrTpNm                      /* 회원유형명               */
                     , DECODE(NVL(od.dlv_cst_sum_amt, 0), 0, 'N', 'Y')      AS ordCstGbn                    /* 주문배송비여부           */
                     , ocgc.ord_god_turn                                                                    /* 주문상품순번             */
                     , og.god_tp_cd                                                                         /* 상품유형코드             */
                     , NVL(og.pay_exchg_rt_crncy_amt,0)           			AS pay_exchg_rt_crncy_amt       /* 결제환율통화금액         */
                  FROM clm_wrhs_god cwg
                       JOIN lgs_dlvsp lds
                            ON (lds.ord_no = cwg.ord_no
                            AND lds.clm_no = cwg.clm_no
                            AND lds.dlv_pcupsp_turn = cwg.dlv_pcupsp_turn
                            AND lds.dlv_pcupsp_sect_cd = 'CLM_PCUPSP')
                       JOIN lgs_dlv ld
                            ON (ld.ord_no = lds.ord_no
                            AND ld.dlv_pcupsp_turn = lds.dlv_pcupsp_turn
                            AND ld.clm_no = cwg.clm_no)
                       JOIN lgs_rtrvl_drct_god lrdg
                            ON (lrdg.clm_no = cwg.clm_no
                            AND lrdg.ord_no = cwg.ord_no
                            AND lrdg.clm_wrhs_god_turn = cwg.clm_wrhs_god_turn)
                       JOIN lgs_dlivy_drct_god lddg
                            ON (lddg.dlivy_drct_god_no = lrdg.dlivy_drct_god_no)
                       LEFT OUTER JOIN sys_shop ss ON lrdg.rtrvl_shop_id = ss.shop_id
                       JOIN ord od ON od.ord_no = cwg.ord_no
            LEFT OUTER JOIN mv_sys_cd mt
                            ON od.mbr_tp_cd = mt.cd
                           AND mt.lang_cd = 'KOR'
                           AND mt.upper_cd = 'MBR_TP'
            LEFT OUTER JOIN mv_sys_cd cr ON cwg.clm_resn_cd = cr.cd AND cr.lang_cd = 'KOR' AND cr.upper_cd = 'CLM_RSN'
            LEFT OUTER JOIN mv_sys_cd rs ON lrdg.rtrvl_stat_cd = rs.cd AND rs.lang_cd = 'KOR' AND rs.upper_cd = 'RTRVL_STAT'
            LEFT OUTER JOIN mv_sys_cd ds ON lddg.dlv_stat_cd = ds.cd AND ds.lang_cd = 'KOR' AND ds.upper_cd = 'DLV_STAT'
            LEFT OUTER JOIN mv_sys_cd dm ON lds.dlv_mn_cd = dm.cd AND dm.lang_cd = 'KOR' AND dm.upper_cd = 'DLV_MN'
                       JOIN ord_clm_god_cnnc ocgc
                            ON (ocgc.ord_no = cwg.ord_no
                            AND ocgc.clm_no = cwg.clm_no
                            AND ocgc.clm_wrhs_god_turn = cwg.clm_wrhs_god_turn
                            AND ocgc.god_cnnc_tp_cd = 'WRHS_GOD_CNNC')
                       JOIN ord_god og
                            ON (ocgc.ord_no = og.ord_no
                            AND ocgc.ord_god_turn = og.ord_god_turn)
                       JOIN clm clm
                            ON (clm.clm_no = cwg.clm_no)
                 WHERE 1 = 1
                   AND cwg.clm_no = #{clmNo,jdbcType=VARCHAR}
                   AND clm.clm_tp_cd = 'RTGOD'
<!--
                   AND lrdg.hdry_com_trnsmis_tgt_yn = 'Y'
 -->
               ) ac
               LEFT OUTER JOIN ord_cpst_god_cnnc oc
                    ON ac.ord_no = oc.ord_no
                   AND ac.ord_god_turn = oc.ord_cpst_god_turn
        ORDER BY ac.dlv_pcupsp_turn
               , CASE
                      WHEN oc.ord_god_turn IS NULL
                       AND ac.god_tp_cd IN ('SET_GOD', 'PCKAGE_GOD')
                      THEN
                           ac.ord_god_turn
                      WHEN oc.ord_god_turn IS NULL
                       AND ac.god_tp_cd NOT IN ('SET_GOD', 'PCKAGE_GOD')
                      THEN
                           NULL
                      ELSE
                           oc.ord_god_turn
                 END DESC
               , oc.ord_cpst_god_turn DESC
               , ac.ord_god_turn
               , ac.ord_no
               , ac.itm_no
    </select>


    <resultMap id="returnClaimDetailResult" type="com.plgrim.ncp.biz.claim.result.ClmDetailResult">
        <id property="dlvPcupspTurn"                    		column="dlvPcupspTurn"                                />
        <id property="addrseAddr"                       		column="addrseAddr"                                   />
        <id property="addrseMobil"                      		column="addrseMobil"                                  />
        <id property="addrseNm"                         		column="addrseNm"                                     />
        <id property="totalDlvCst"                              column="totalDlvCst"                                  />
        <id property="cnclDlvCst"                       		column="cnclDlvCst"                                   />
        <id property="rtgodDlvCst"                      		column="rtgodDlvCst"                                  />
        <id property="dlvMnNm"                          		column="dlvMnNm"                                      />
        <id property="cvnstorHdryAprvNo"                		column="cvnstorHdryAprvNo"                            />
        <id property="dlvMemo"                          		column="dlvMemo"                                      />
        <collection property="clmDetailList"                ofType="com.plgrim.ncp.biz.claim.result.ClmDetailListResult">
            <result property="godNo"                            column="godNo"                                        />
            <result property="godNm"                            column="godNm"                                        />
            <result property="itmNo"                            column="itmNo"                                        />
            <result property="itmNm"                            column="itmNm"                                        />
            <result property="clmResnCd"                        column="clmResnCd"                                    />
            <result property="clmResnNm"                        column="clmResnNm"                                    />
            <result property="dcDtl"                            column="dcDtl"                                        />
            <result property="rtlPrc"                           column="rtlPrc"                                       />
            <result property="saleAmt"                          column="saleAmt"                                      />
            <result property="webDcAmt"                         column="webDcAmt"                                     />
            <result property="empDcAmt"                         column="empDcAmt"                                     />
            <result property="allDcAmt"                         column="allDcAmt"                                     />
            <result property="imdtlDcAmt"                       column="imdtlDcAmt"                                   />
            <result property="godDcAmt"                         column="godDcAmt"                                     />
            <result property="bundleDcAmt"                      column="bundleDcAmt"                                  />
            <result property="crsDcAmt"                         column="crsDcAmt"                                     />
            <result property="godCpnDcAmt"                      column="godCpnDcAmt"                                  />
            <result property="bskCpnDcAmt"                      column="bskCpnDcAmt"                                  />
            <result property="unityPntUseAmt"                   column="unityPntUseAmt"                               />
            <result property="evtPntUseAmt"                     column="evtPntUseAmt"                                 />
            <result property="webPntUseAmt"                     column="webPntUseAmt"                                 />
            <result property="unityPntAccmlamt"                 column="unityPntAccmlamt"                             />
            <result property="evtPntAccmlamt"                   column="evtPntAccmlamt"                               />
            <result property="webPntAccmlamt"                   column="webPntAccmlamt"                               />
            <result property="godDcSumAmt"                      column="godDcSumAmt"                                  />
            <result property="godCpnDcSumAmt"                   column="godCpnDcSumAmt"                               />
            <result property="godEtcDcSumAmt"                   column="godEtcDcSumAmt"                               />
            <result property="stdrCrncySumAmt"                  column="stdrCrncySumAmt"                              />
            <result property="addrseBaseAddr"                   column="addrseBaseAddr"                               />
            <result property="addrseDetailAddr"                 column="addrseDetailAddr"                             />
            <result property="addrseMobilAreaNo"                column="addrseMobilAreaNo"                            />
            <result property="addrseMobilNationNo"              column="addrseMobilNationNo"                          />
            <result property="addrseMobilTlofNo"                column="addrseMobilTlofNo"                            />
            <result property="addrseMobilTlofWthnNo"            column="addrseMobilTlofWthnNo"                        />
            <result property="dlvMnCd"                          column="dlvMnCd"                                      />
            <result property="dlivyQty"                         column="dlivyQty"                                     />
            <result property="waybilNoErpTrnsmisCd"             column="waybilNoErpTrnsmisCd"                         />
            <result property="waybilNo"            				column="waybilNo"                         />
            <result property="rtrvlDrctGodNo"                   column="rtrvlDrctGodNo"                               />
            <result property="ordNo"                            column="ordNo"                                        />
            <result property="clmNo"                            column="clmNo"                                        />
            <result property="gftYn"                            column="gftYn"                                        />
            <result property="clmWrhsGodTurn"                   column="clmWrhsGodTurn"                               />
            <result property="dlivyDrctGodNo"                   column="dlivyDrctGodNo"                               />
            <result property="dlvTurn"                          column="dlvTurn"                                      />
            <result property="rtrvlShopId"                      column="rtrvlShopId"                                  />
            <result property="shopNm"                           column="shopNm"                                       />
            <result property="acmtlGodWt"                       column="acmtlGodWt"                                   />
            <result property="acmtlGodVol"                      column="acmtlGodVol"                                  />
            <result property="lgsItmYn"                         column="lgsItmYn"                                     />
            <result property="rtrvlDrctTgtYn"                   column="rtrvlDrctTgtYn"                               />
            <result property="rtrvlDrctYn"                      column="rtrvlDrctYn"                                  />
            <result property="rtrvlDrctGrpDgre"                 column="rtrvlDrctGrpDgre"                             />
            <result property="rtrvlDrctCount"                   column="rtrvlDrctCount"                               />
            <result property="rtrvlDrctTpCd"                    column="rtrvlDrctTpCd"                                />
            <result property="rtrvlDrctDt"                      column="rtrvlDrctDt"                                  />
            <result property="rtrvlDrctQty"                     column="rtrvlDrctQty"                                 />
            <result property="rtrvlDrctWthdrawQty"              column="rtrvlDrctWthdrawQty"                          />
            <result property="rtrvlDrctWthdrawDt"               column="rtrvlDrctWthdrawDt"                           />
            <result property="rtrvlStatCd"                      column="rtrvlStatCd"                                  />
            <result property="rtrvlStatNm"                      column="rtrvlStatNm"                                  />
            <result property="wrhsComptDt"                      column="wrhsComptDt"                                  />
            <result property="udterId"                          column="udterId"                                      />
            <result property="rtrvlComptDt"                     column="rtrvlComptDt"                                 />
            <result property="rtrvlGodStatCd"                   column="rtrvlGodStatCd"                               />
            <result property="rtrvlGodPrcsComptYn"              column="rtrvlGodPrcsComptYn"                          />
            <result property="badnReqestCont"                   column="badnReqestCont"                               />
            <result property="hdryComTrnsmisTgtYn"              column="hdryComTrnsmisTgtYn"                          />
            <result property="hdryComTrnsmisYn"                 column="hdryComTrnsmisYn"                             />
            <result property="hdryComTrnsmisDt"                 column="hdryComTrnsmisDt"                             />
            <result property="hdryComKey"                       column="hdryComKey"                                   />
            <result property="erpTrnsmisYn"                     column="erpTrnsmisYn"                                 />
            <result property="erpTrnsmisDt"                     column="erpTrnsmisDt"                                 />
            <result property="erpCnfirmYn"                      column="erpCnfirmYn"                                  />
            <result property="erpCnfirmDt"                      column="erpCnfirmDt"                                  />
            <result property="erpInvTrnsmisSectCd"              column="erpInvTrnsmisSectCd"                          />
            <result property="erpInvTrnsmisDt"                  column="erpInvTrnsmisDt"                              />
            <result property="rtgodcstCalSectCd"                column="rtgodcstCalSectCd"                            />
            <result property="rtgodcstCalAmt"                   column="rtgodcstCalAmt"                               />
            <result property="pckageGodTurn"                    column="pckageGodTurn"                                />
            <result property="dlvStatCd"                        column="dlvStatCd"                                    />
            <result property="dlvStatNm"                        column="dlvStatNm"                                    />
            <result property="dlivyDrctQty"                     column="dlivyDrctQty"                                 />
            <result property="dlivyDrctCnclQty"                 column="dlivyDrctCnclQty"                             />
            <result property="mbrNo"                            column="mbrNo"                                        />
            <result property="mbrTpCd"                          column="mbrTpCd"                                      />
            <result property="mbrTp"                            column="mbrTp"                                        />
            <result property="ordCstGbn"                        column="ordCstGbn"                                    />
            <result property="ordGodTurn"                       column="ordGodTurn"                                   />
            <result property="godTpCd"                          column="godTpCd"                                      />
            <result property="payExchgRtCrncyAmt"               column="payExchgRtCrncyAmt"                           />
            <result property="partmalSectCd"                    column="partmalSectCd"                                />
            <result property="dlvCstCpnYn"                     	column="dlvCstCpnYn"                                />
            <result property="gdgpStatCd"                    	column="gdgpStatCd"                                />
        </collection>
    </resultMap>


    <!-- 클레임관리 상세 기본정보조회[교환 - 물류배송지별] -->
    <select id="selectExchangeClaimDetail" parameterType="String" resultMap="exchangeClaimDetailResult">
        SELECT P.dlv_pcupsp_turn AS dlvpcupspturn	/*[claim.return.xml][selectExchangeClaimDetail][클레임관리 상세 기본정보조회[교환 - 물류배송지별]]*/
            , d.dlv_pcupsp_turn AS dlvpcupspturndlivy
            , P.addrse_base_addr || ' ' || P.addrse_detail_addr AS addrseaddr
            , dm.cd_nm AS dlvmnnm
            , d.addrse_base_addr || ' ' || d.addrse_detail_addr AS addrseaddrdlivy
            , lrdg.cvnstor_hdry_aprv_no          AS cvnstorhdryaprvno
            , NVL(lp.rtgod_dlv_cst, 0)
            + NVL(ld.rtgod_dlv_cst, 0)
            + NVL(lp.exchg_dlv_cst, 0)
            + NVL(ld.exchg_dlv_cst, 0)
                                                  AS totaldlvcst
            , NVL(lp.rtgod_dlv_cst, 0)
            + NVL(ld.rtgod_dlv_cst, 0)
                                                  AS rtgoddlvcst
            , NVL(lp.exchg_dlv_cst, 0)
            + NVL(ld.exchg_dlv_cst, 0)
                                                  AS exchgdlvcst
            , cwg.clm_wrhs_god_turn               AS clmwrhsgodturn
            , og.ord_god_turn AS ordgodturn
            , og.god_tp_cd AS godtpcd
            , cwg.god_no AS godno
            , REPLACE(REPLACE(cwg.god_nm,'''','‘'),'"','‘‘')    AS godnm                                    /* 상품명 */
            , cwg.itm_nm AS itmnm
            , ss.shop_nm AS shopnm
            , NVL(lddg.dlivy_drct_qty, 0)         AS dlivyqty
            , NVL(lrdg.rtrvl_drct_qty, 0)         AS rtrvldrctqty
            , lrdg.rtrvl_drct_wthdraw_qty         AS rtrvldrctwthdrawqty
            , og.itm_nm AS itmnmdlivy
            , rs.cd_nm AS rtrvlstatnm
            , lrdg.dmstc_waybil_no AS waybilno
            , lrdg.wrhs_compt_dt AS wrhscomptdt
            , lrdg.rtrvl_compt_dt AS rtrvlcomptdt              /* 회수완료일시 추가 0918 */
            , lrdg.udter_id AS udterid                         /* 회수자 추가 20160907 */
            , ds.cd_nm AS dlivystatnm
            , lddg.DMSTC_WAYBIL_NO        AS waybilnodlivy
            , lddg.dlivy_drct_dt AS dlivydrctdt
            , lddg.dlivy_compt_dt AS dlivycomptdt              /* 출고완료일시 추가 0831 */
            , lddg.shtg_dcsn_yn AS shtgdcsnyn
            , cr.cd_nm AS clmresnnm
            , cwg.clm_resn_cd AS clmResnCd
            , og.ord_no AS ordno
            , cwg.clm_no AS clmno
            , lddg.dlivy_drct_god_no AS dlivydrctgodno
            , P.dlv_pcupsp_turn AS dlvpcupspturnwthdraw          /*클레임 교환철회용 회수지*/
            , d.dlv_pcupsp_turn AS dlvpcupspturndlivywthdraw     /*클레임 교환철회용 수거지*/
            , 0 AS dlvTurn
            , og.partmal_sect_cd                        			AS partmalSectCd              /* 입점 구분 코드ㅁ. 입점 구분 : PARTMAL_SECT   >. 자사 : MCOM   >. 입점 : PARTMAL */
            , p.dlv_memo AS dlvMemo
            , lrdg.gdgpStatCd 			AS gdgpStatCd			 /* 수거상태(선진행변경 교환시 회수완료여부) */
            , lrdg.rtrvl_stat_cd        AS rtrvlStatCd			 /* 회수 상태 코드 */
        FROM LGS_DLVSP p
        JOIN (  SELECT ld.ord_no
                        , ld.dlv_pcupsp_turn
                        , ld.clm_no
                        , ld.dlv_mn_cd
                        , SUM(NVL(ld.cncl_dlv_cst, 0)) AS cncl_dlv_cst /* 환불배송비 */
                        , SUM(NVL(ld.rtgod_dlv_cst, 0)) AS rtgod_dlv_cst /* 반품배송비 */
                        , SUM(NVL(ld.exchg_dlv_cst, 0)) AS exchg_dlv_cst
                        FROM lgs_dlv ld
                        WHERE 1 = 1
                        AND ld.clm_no = #{clmNo,jdbcType=VARCHAR}
                        GROUP BY ld.ord_no
                        , ld.dlv_pcupsp_turn
                        , ld.clm_no
                        , ld.dlv_mn_cd
        ) lp
        ON lp.ord_no = P.ord_no
        AND lp.dlv_pcupsp_turn = P.dlv_pcupsp_turn
        AND lp.clm_no = P.clm_no
        JOIN LGS_DLVSP d
        ON p.clm_no = d.clm_no
        JOIN (  SELECT ld.ord_no
                        , ld.dlv_pcupsp_turn
                        , ld.clm_no
                        , ld.dlv_mn_cd
                        , SUM(NVL(ld.cncl_dlv_cst, 0)) AS cncl_dlv_cst /* 환불배송비 */
                        , SUM(NVL(ld.rtgod_dlv_cst, 0)) AS rtgod_dlv_cst /* 반품배송비 */
                        , SUM(NVL(ld.exchg_dlv_cst, 0)) AS exchg_dlv_cst
                        FROM lgs_dlv ld
                        WHERE 1 = 1
                        AND ld.clm_no = #{clmNo,jdbcType=VARCHAR}
                        GROUP BY ld.ord_no
                        , ld.dlv_pcupsp_turn
                        , ld.clm_no
                        , ld.dlv_mn_cd
        ) ld
        ON ld.ord_no = d.ord_no
        AND ld.dlv_pcupsp_turn = d.dlv_pcupsp_turn
        AND ld.clm_no = d.clm_no
        JOIN ORD_CLM_GOD_CNNC ogc
        ON ogc.clm_no = p.clm_no
        AND ogc.ord_no = p.ord_no
        JOIN CLM_WRHS_GOD cwg
        ON cwg.clm_no = ogc.clm_no
        AND cwg.ord_no = ogc.ord_no
        AND cwg.clm_wrhs_god_turn = ogc.clm_wrhs_god_turn
        AND cwg.dlv_pcupsp_turn =p.dlv_pcupsp_turn
        JOIN ORD_GOD og
        ON og.ord_no = ogc.ord_no
        AND og.ord_god_turn = ogc.ord_god_turn
        AND og.dlv_pcupsp_turn = d.dlv_pcupsp_turn
        LEFT OUTER JOIN MV_SYS_CD dm
        ON lp.dlv_mn_cd = dm.cd
        AND dm.lang_cd = 'KOR'
        AND dm.upper_cd = 'DLV_MN'

        <!--
                      JOIN LGS_DLIVY_DRCT_GOD lddg
                        ON lddg.dlivy_drct_god_no = lrdg.dlivy_drct_god_no
                       AND lddg.ord_no = lrdg.ord_no
         -->

        JOIN (SELECT lrdg.ord_no
                    , lrdg.RTRVL_DRCT_GOD_NO
                    , lrdg.CLM_NO
                    , lrdg.CLM_WRHS_GOD_TURN
                    , LRDG.DLIVY_DRCT_GOD_NO
                    , lrdg.DLV_PCUPSP_TURN
                    , lrdg.rtrvl_stat_cd
                    , NVL(lrdg.rtrvl_drct_qty, 0) AS rtrvl_drct_qty
                    , nvl(lrdg.rtrvl_drct_wthdraw_qty, 0) AS rtrvl_drct_wthdraw_qty
                    , lrdg.wrhs_compt_dt
                    , lrdg.rtrvl_compt_dt
                    , LD.DMSTC_WAYBIL_NO
                    , ld.cvnstor_hdry_aprv_no
                    , lrdg.udter_id
                    , CASE WHEN ld.dlv_com_cd = 'CJKEX'
		               		THEN CASE WHEN ld.gdgp_stat_cd IS NOT NULL
		                         	  THEN (SELECT NVL(cd_nm, '-')
		                                    	FROM SYS_EXCP_CD
		                                    WHERE grp_cd = 'FRGHT_STAT'
		                                        AND cd = ld.gdgp_stat_cd)
		                               ELSE '-'
		                           END
		                     ELSE '-'    
		               END AS gdgpStatCd /* 수거상태 */
                    FROM ord_clm_god_cnnc ocgc
                    JOIN lgs_rtrvl_drct_god lrdg
                    ON ocgc.ord_no = lrdg.ord_no
                    AND OCGC.CLM_NO = lrdg.clm_no
                    AND ocgc.clm_wrhs_god_turn = lrdg.clm_wrhs_god_turn
                    JOIN lgs_dlv ld
                    ON lrdg.ORD_NO = LD.ORD_NO
                    AND lrdg.DLV_PCUPSP_TURN = LD.DLV_PCUPSP_TURN
                    AND lrdg.DLV_TURN = LD.DLV_TURN
                    WHERE ocgc.clm_no = #{clmNo,jdbcType=VARCHAR}
                    AND ocgc.god_cnnc_tp_cd = 'WRHS_GOD_CNNC'
        ) lrdg
        ON lrdg.clm_no = cwg.clm_no
        AND lrdg.ord_no = cwg.ord_no
        AND lrdg.clm_wrhs_god_turn = cwg.clm_wrhs_god_turn

        JOIN (SELECT lddg.ord_no
                    , ocgc.ord_god_turn
                    , lddg.dlv_shop_id
                    , lddg.dlv_stat_cd
                    , lddg.shtg_dcsn_yn
                    , NVL(lddg.dlivy_drct_qty, 0) AS dlivy_drct_qty
                    , lddg.dlivy_drct_dt
                    , lddg.dlivy_compt_dt
                    , lddg.dlivy_drct_god_no
                    , LD.DMSTC_WAYBIL_NO
                    FROM ord_clm_god_cnnc ocgc
                    JOIN lgs_dlivy_drct_god lddg
                    ON ocgc.ord_no = lddg.ord_no
                    AND ocgc.ord_god_turn = lddg.ord_god_turn
                    JOIN lgs_dlv ld
                    ON LDDG.ORD_NO = LD.ORD_NO
                    AND LDDG.DLV_PCUPSP_TURN = LD.DLV_PCUPSP_TURN
                    AND LDDG.DLV_TURN = LD.DLV_TURN
                    WHERE ocgc.clm_no = #{clmNo,jdbcType=VARCHAR}
                    AND ocgc.god_cnnc_tp_cd = 'DLIVY_GOD_CNNC'
        ) lddg
        ON lddg.ord_no = lrdg.ord_no
        AND og.ord_god_turn = lddg.ord_god_turn
        LEFT OUTER JOIN SYS_SHOP ss
        ON lddg.dlv_shop_id = ss.shop_id
        JOIN MV_SYS_CD rs
        ON lrdg.rtrvl_stat_cd = rs.cd
        AND rs.lang_cd = 'KOR'
        AND rs.upper_cd = 'RTRVL_STAT'
        LEFT OUTER JOIN MV_SYS_CD ds
        ON lddg.dlv_stat_cd = ds.cd
        AND ds.lang_cd = 'KOR'
        AND ds.upper_cd = 'DLV_STAT'
        LEFT OUTER JOIN MV_SYS_CD cr
        ON cwg.clm_resn_cd = cr.cd
        AND cr.lang_cd = 'KOR'
        AND cr.upper_cd = 'CLM_RSN'
        LEFT OUTER JOIN ORD_CPST_GOD_CNNC oc
        ON og.ord_no        = oc.ord_no
        AND og.ord_god_turn  = oc.ord_cpst_god_turn
        WHERE p.clm_no = #{clmNo,jdbcType=VARCHAR}
        AND p.dlv_pcupsp_sect_cd ='CLM_PCUPSP'
        AND d.dlv_pcupsp_sect_cd ='CLM_DLVSP'
        ORDER BY CASE WHEN oc.ord_god_turn IS NULL AND og.god_tp_cd IN('SET_GOD','PCKAGE_GOD')  THEN  og.ord_god_turn
        WHEN oc.ord_god_turn IS NULL AND og.god_tp_cd NOT IN('SET_GOD','PCKAGE_GOD') THEN  NULL
        ELSE oc.ord_god_turn END DESC
        , oc.ord_cpst_god_turn DESC
        , cwg.clm_wrhs_god_turn
        , lddg.dlivy_drct_god_no
<!--
        , ld.dlv_turn
-->

    </select>




    <select id="selectExchangeClaimDetail_bk" parameterType="String" resultMap="exchangeClaimDetailResult">
            SELECT p.dlv_pcupsp_turn                                AS dlvPcupspTurn
                 , d.dlv_pcupsp_turn                                AS dlvPcupspTurnDlivy
                 , p.addrse_base_addr ||' '|| p.addrse_detail_addr  AS addrseAddr
                 , dm.cd_nm                                         AS dlvMnNm
                 , d.addrse_base_addr ||' '|| d.addrse_detail_addr  AS addrseAddrDlivy
                 , ld.cvnstor_hdry_aprv_no                          AS cvnstorHdryAprvNo

                 , NVL(lp.rtgod_dlv_cst, 0)
                  +NVL(ld.exchg_dlv_cst, 0)
                                                                    AS totalDlvCst
                 , NVL(lp.rtgod_dlv_cst, 0)                         AS rtgodDlvCst
                 , NVL(ld.exchg_dlv_cst, 0)                         AS exchgDlvCst
                 , cwg.clm_wrhs_god_turn                            AS clmWrhsGodTurn
                 , og.ord_god_turn                                  AS ordGodTurn
                 , og.god_tp_cd                                     AS godTpCd
                 , cwg.god_no                                       AS godNo
                 , REPLACE(cwg.god_nm,'''','‘')                     AS godNm
                 , cwg.itm_nm                                       AS itmNm
                 , ss.shop_nm                                       AS shopNm
                 , NVL(lddg.dlivy_drct_qty, 0)                      AS dlivyQty
                 , NVL(lrdg.rtrvl_drct_qty , 0)                     AS rtrvlDrctQty
                 , lrdg.rtrvl_drct_wthdraw_qty                      AS rtrvlDrctWthdrawQty
                 , og.ITM_NM                                        AS itmNmDlivy
                 , rs.cd_nm                                         AS rtrvlStatNm
                 , lp.dmstc_waybil_no                               AS waybilNo
                 , lrdg.wrhs_compt_dt                               AS wrhsComptDt
                 , lrdg.rtrvl_compt_dt                              AS rtrvlComptDt					/* 회수완료일시 추가 0918 */
                 , ds.cd_nm                                         AS dlivyStatNm
                 , ld.dmstc_waybil_no                               AS waybilNoDlivy
                 , lddg.dlivy_drct_dt                               AS dlivyDrctDt
                 , lddg.dlivy_compt_dt 								AS dlivyComptDt					/* 출고완료일시 추가 0831 */
                 , lddg.SHTG_DCSN_YN                                AS shtgDcsnYn
                 , cr.cd_nm                                         AS clmResnNm

                 , og.ord_no                                        AS ordno
                 , cwg.clm_no                                       AS clmno
                 , ld.dlv_turn                                      AS dlvturn
                 , lddg.dlivy_drct_god_no                           AS dlivydrctgodno
                 , p.dlv_pcupsp_turn                                AS dlvPcupspTurnWthdraw			/*클레임 교환철회용 회수지*/
                 , d.dlv_pcupsp_turn                                AS dlvPcupspTurnDlivyWthdraw	/*클레임 교환철회용 수거지*/
              FROM LGS_DLVSP p
              JOIN LGS_DLV lp
                ON lp.ord_no = p.ord_no
               AND lp.dlv_pcupsp_turn = p.dlv_pcupsp_turn
               AND lp.clm_no = p.clm_no
              JOIN LGS_DLVSP d
                ON p.clm_no = d.clm_no
              JOIN LGS_DLV ld
                ON ld.ord_no = d.ord_no
               AND ld.dlv_pcupsp_turn = d.dlv_pcupsp_turn
               AND ld.clm_no = d.clm_no
              JOIN ORD_CLM_GOD_CNNC ogc
                ON ogc.clm_no = p.clm_no
               AND ogc.ord_no = p.ord_no
              JOIN CLM_WRHS_GOD cwg
                ON cwg.clm_no = ogc.clm_no
               AND cwg.ord_no = ogc.ord_no
               AND cwg.clm_wrhs_god_turn = ogc.clm_wrhs_god_turn
               AND cwg.dlv_pcupsp_turn =p.dlv_pcupsp_turn
              JOIN ORD_GOD og
                ON og.ord_no = ogc.ord_no
               AND og.ord_god_turn = ogc.ord_god_turn
               AND og.dlv_pcupsp_turn = d.dlv_pcupsp_turn
   LEFT OUTER JOIN MV_SYS_CD dm
                ON lp.dlv_mn_cd = dm.cd
               AND dm.lang_cd = 'KOR'
               AND dm.upper_cd = 'DLV_MN'
              JOIN LGS_RTRVL_DRCT_GOD lrdg
                ON lrdg.clm_no = cwg.clm_no
               AND lrdg.ord_no = cwg.ord_no
               AND lrdg.clm_wrhs_god_turn = cwg.clm_wrhs_god_turn
<!--
              JOIN LGS_DLIVY_DRCT_GOD lddg
                ON lddg.dlivy_drct_god_no = lrdg.dlivy_drct_god_no
               AND lddg.ord_no = lrdg.ord_no
 -->
         JOIN (SELECT lddg.ORD_NO
                    , lddg.dlv_shop_id
                    , lddg.dlv_stat_cd
                    , lddg.shtg_dcsn_yn
                    , NVL(lddg.dlivy_drct_qty, 0) AS dlivy_drct_qty
                    , lddg.dlivy_drct_dt
                    , lddg.dlivy_compt_dt
                    , lddg.dlivy_drct_god_no
                 FROM ord_clm_god_cnnc ocgc
                 JOIN lgs_dlivy_drct_god lddg
                   ON ocgc.ord_no = lddg.ord_no AND ocgc.ord_god_turn = lddg.ord_god_turn
                WHERE ocgc.clm_no = #{clmNo,jdbcType=VARCHAR}
                  AND ocgc.god_cnnc_tp_cd = 'DLIVY_GOD_CNNC') lddg
                   ON lddg.ord_no = lrdg.ord_no
   LEFT OUTER JOIN SYS_SHOP ss
                ON lddg.dlv_shop_id = ss.shop_id
              JOIN MV_SYS_CD rs
                ON lrdg.rtrvl_stat_cd = rs.cd
               AND rs.lang_cd = 'KOR'
               AND rs.upper_cd = 'RTRVL_STAT'
   LEFT OUTER JOIN MV_SYS_CD ds
                ON lddg.dlv_stat_cd = ds.cd
               AND ds.lang_cd = 'KOR'
               AND ds.upper_cd = 'DLV_STAT'
   LEFT OUTER JOIN MV_SYS_CD cr
                ON cwg.clm_resn_cd = cr.cd
               AND cr.lang_cd = 'KOR'
               AND cr.upper_cd = 'CLM_RSN'
   LEFT OUTER JOIN ORD_CPST_GOD_CNNC oc
                ON og.ord_no        = oc.ord_no
               AND og.ord_god_turn  = oc.ord_cpst_god_turn
             WHERE p.clm_no = #{clmNo,jdbcType=VARCHAR}
               AND p.dlv_pcupsp_sect_cd ='CLM_PCUPSP'
               AND d.dlv_pcupsp_sect_cd ='CLM_DLVSP'
          ORDER BY CASE WHEN oc.ord_god_turn IS NULL AND og.god_tp_cd IN('SET_GOD','PCKAGE_GOD')  THEN  og.ord_god_turn
                        WHEN oc.ord_god_turn IS NULL AND og.god_tp_cd NOT IN('SET_GOD','PCKAGE_GOD') THEN  NULL
                        ELSE oc.ord_god_turn END DESC
                      , oc.ord_cpst_god_turn DESC
                      , cwg.clm_wrhs_god_turn
   			          , lddg.dlivy_drct_god_no
				      , ld.dlv_turn

    </select>

     <resultMap id="exchangeClaimDetailResult" type="com.plgrim.ncp.biz.claim.result.ClmDetailResult">
        <id property="dlvPcupspTurn"                            column="dlvPcupspTurn"                                />
        <id property="dlvPcupspTurnDlivy"                       column="dlvPcupspTurnDlivy"                           />
        <id property="addrseAddr"                               column="addrseAddr"                                   />
        <id property="addrseAddrDlivy"                          column="addrseAddrDlivy"                              />
        <id property="totalDlvCst"                              column="totalDlvCst"                                  />
        <id property="rtgodDlvCst"                              column="rtgodDlvCst"                                  />
        <id property="exchgDlvCst"                              column="exchgDlvCst"                                  />
        <id property="dlvMnNm"                                  column="dlvMnNm"                                      />
        <id property="dlvMemo"                                  column="dlvMemo"                                      />
        <id property="cvnstorHdryAprvNo"                        column="cvnstorHdryAprvNo"                            />
        <collection property="clmDetailList"                ofType="com.plgrim.ncp.biz.claim.result.ClmDetailListResult">
            <result property="clmWrhsGodTurn"                   column="clmWrhsGodTurn"                               />
            <result property="ordGodTurn"                       column="ordGodTurn"                                   />
            <result property="godTpCd"                          column="godTpCd"                                      />
            <result property="godNo"                            column="godNo"                                        />
            <result property="godNm"                            column="godNm"                                        />
            <result property="itmNm"                            column="itmNm"                                        />
            <result property="shopNm"                           column="shopNm"                                       />
            <result property="dlivyQty"                         column="dlivyQty"                                     />
            <result property="rtrvlDrctQty"                     column="rtrvlDrctQty"                                 />
            <result property="rtrvlDrctWthdrawQty"              column="rtrvlDrctWthdrawQty"                          />
            <result property="itmNmDlivy"                       column="itmNmDlivy"                                   />
            <result property="rtrvlStatNm"                      column="rtrvlStatNm"                                  />
            <result property="waybilNo"                         column="waybilNo"                                     />
            <result property="wrhsComptDt"                      column="wrhsComptDt"                                  />
            <result property="rtrvlComptDt"                     column="rtrvlComptDt"                                 />
            <result property="udterId"                          column="udterId"                                      />
            <result property="dlivyStatNm"                      column="dlivyStatNm"                                  />
            <result property="waybilNoDlivy"                    column="waybilNoDlivy"                                />
            <result property="dlivyDrctDt"                      column="dlivyDrctDt"                                  />
            <result property="dlivyComptDt"                     column="dlivyComptDt"                                 />
            <result property="shtgDcsnYn"                       column="shtgDcsnYn"                                   />
            <result property="clmResnNm"                        column="clmResnNm"                                    />
            <result property="clmResnCd"                        column="clmResnCd"                                    />
            <result property="ordNo"                            column="ordNo"                                        />
            <result property="clmNo"                            column="clmNo"                                        />
            <result property="dlvTurn"                          column="dlvTurn"                                      />
            <result property="ordGodTurn"                       column="ordGodTurn"                                   />
            <result property="dlivyDrctGodNo"                   column="dlivyDrctGodNo"                               />
            <result property="dlvPcupspTurnWthdraw"             column="dlvPcupspTurnWthdraw"                         />
            <result property="dlvPcupspTurnDlivyWthdraw"        column="dlvPcupspTurnDlivyWthdraw"                    />
            <result property="partmalSectCd"                    column="partmalSectCd"                                />
            <result property="gdgpStatCd"                    	column="gdgpStatCd"                                />
            <result property="rtrvlStatCd"                    	column="rtrvlStatCd"                                />
        </collection>
    </resultMap>


    <!-- 맞교환시 holdStock 하기 위한 접수번호 조회 -->
    <select id="selectSeqExchFpkey" parameterType="String" resultType="String">
        SELECT /* [com.plgrim.ncp.biz.claim.return.xml][selectSeqExchFpkey][][Khan] */
               TO_CHAR(SYSDATE, 'YYMMDD') || LPAD(seq_exch_fpkey.NEXTVAL, 4, '0') AS fpKey
          FROM dual
    </select>

    <!-- 클레임입고상품에 등록되어 있는 상품의 주문상품순번을 조회 -->
    <select id="selectOrdGodTurn" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="String">
        SELECT /* [com.plgrim.ncp.biz.claim.return.xml][selectOrdGodTurn][][Khan] */
               ocgc.ord_god_turn AS ordGodTurnArr
          FROM clm_wrhs_god cwg
               JOIN ord_clm_god_cnnc ocgc
                    ON (ocgc.ord_no = cwg.ord_no
                    AND ocgc.clm_no = cwg.clm_no
                    AND ocgc.clm_wrhs_god_turn = cwg.clm_wrhs_god_turn
                    AND ocgc.god_cnnc_tp_cd = 'WRHS_GOD_CNNC')
               JOIN clm clm
                    ON (cwg.ord_no = clm.ord_no
                    AND cwg.clm_no = clm.clm_no)
         WHERE 1 = 1
           AND cwg.ord_no = #{ordNo,jdbcType=VARCHAR}
           AND cwg.clm_no = #{clmNo,jdbcType=VARCHAR}
           AND cwg.clm_wthdraw_sect_cd = 'NRMLT'                       /* 클레임 철회 구분 : 정상 */
           AND clm.clm_stat_cd IN ('REQST', 'PAY_WAIT')                /* 클레임 상태 : 접수/결제대기 */
         ORDER BY ocgc.ord_god_turn
    </select>

	<update id="updateRfdBnk" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmExtend">
		UPDATE clm /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.updateRfdBnk][클레임 테이블 환불계좌정보 저장][Khan] */
		   SET rfd_bnk_acct_no	= PKG_CRYPTO.ENCRYPT(#{rfdBnkAcctNo,jdbcType=VARCHAR}, 'FNFBNT02-5200001')
		     , rfd_bnk_cd 		= #{rfdBnkCd,jdbcType=VARCHAR}
		     , rfd_acnthldr_nm 	= #{rfdAcnthldrNm,jdbcType=VARCHAR}
             , UDTER_ID 		= #{udterId,jdbcType=VARCHAR}
             , UDT_DT 			= SYSDATE
         WHERE 1 = 1
           AND CLM_NO = #{clmNo,jdbcType=VARCHAR}
	</update>


    <!--  클레임 삭제 관련 서비스   -->

    <delete id="deleteInfOrdGodErpDstb" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
 		DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteInfOrdGodErpDstb][인터페이스주문상품ERP분배 삭제][khan] */
		      FROM  inf_ord_god_erp_dstb iogsd
		      WHERE (iogsd.ord_no, iogsd.ord_god_turn, iogsd.dlivy_drct_god_no) IN
		                 (SELECT ocgc.ord_no
		                       , ocgc.ord_god_turn
		                       , lddg.dlivy_drct_god_no
		                    FROM clm_wrhs_god cwg
		                         JOIN
		                         ord_clm_god_cnnc ocgc
		                              ON (ocgc.ord_no = cwg.ord_no
		                              AND ocgc.clm_no = cwg.clm_no
		                              AND ocgc.clm_wrhs_god_turn =
		                                       cwg.clm_wrhs_god_turn
		                              AND ocgc.god_cnnc_tp_cd = 'DLIVY_GOD_CNNC')
		                         JOIN lgs_dlivy_drct_god lddg
		                              ON (lddg.ord_no = ocgc.ord_no
		                              AND lddg.ord_god_turn = ocgc.ord_god_turn)
		                         JOIN clm clm
		                              ON (cwg.ord_no = clm.ord_no
		                              AND cwg.clm_no = clm.clm_no)
		                   WHERE 1 = 1
		                     AND cwg.ord_no = #{ordNo,jdbcType=VARCHAR}
	                         AND cwg.clm_no = #{clmNo,jdbcType=VARCHAR}
		                     AND clm.clm_stat_cd IN ('REQST', 'PAY_WAIT'))
    </delete>

    <delete id="deleteLgsDlivyDrctGodHist" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
 		DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteLgsDlivyDrctGodHist][물류 출고지시상품 이력 삭제][khan] */
		      FROM  lgs_dlivy_drct_god_hist lg
		      WHERE (lg.dlivy_drct_god_no, lg.ord_no, lg.ord_god_turn) IN
		                 (SELECT lddg.dlivy_drct_god_no
		                       , ocgc.ord_no
		                       , ocgc.ord_god_turn
		                    FROM clm_wrhs_god cwg
		                         JOIN
		                         ord_clm_god_cnnc ocgc
		                              ON (ocgc.ord_no = cwg.ord_no
		                              AND ocgc.clm_no = cwg.clm_no
		                              AND ocgc.clm_wrhs_god_turn =
		                                       cwg.clm_wrhs_god_turn
		                              AND ocgc.god_cnnc_tp_cd = 'DLIVY_GOD_CNNC')
		                         JOIN lgs_dlivy_drct_god lddg
		                              ON (lddg.ord_no = ocgc.ord_no
		                              AND lddg.ord_god_turn = ocgc.ord_god_turn)
		                         JOIN clm clm
		                              ON (cwg.ord_no = clm.ord_no
		                              AND cwg.clm_no = clm.clm_no)
		                   WHERE 1 = 1
		                     AND cwg.ord_no = #{ordNo,jdbcType=VARCHAR}
	                         AND cwg.clm_no = #{clmNo,jdbcType=VARCHAR}
		                     AND clm.clm_stat_cd IN ('REQST', 'PAY_WAIT'))
    </delete>

    <delete id="deleteLgsDlivyDrctGod" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
		DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteLgsDlivyDrctGod][물류 출고지시상품 삭제][khan] */
		      FROM  lgs_dlivy_drct_god lg
		      WHERE (lg.dlivy_drct_god_no, lg.ord_no, lg.ord_god_turn) IN
		                 (SELECT lddg.dlivy_drct_god_no
		                       , ocgc.ord_no
		                       , ocgc.ord_god_turn
		                    FROM clm_wrhs_god cwg
		                         JOIN
		                         ord_clm_god_cnnc ocgc
		                              ON (ocgc.ord_no = cwg.ord_no
		                              AND ocgc.clm_no = cwg.clm_no
		                              AND ocgc.clm_wrhs_god_turn =
		                                       cwg.clm_wrhs_god_turn
		                              AND ocgc.god_cnnc_tp_cd = 'DLIVY_GOD_CNNC')
		                         JOIN lgs_dlivy_drct_god lddg
		                              ON (lddg.ord_no = ocgc.ord_no
		                              AND lddg.ord_god_turn = ocgc.ord_god_turn)
		                         JOIN clm clm
		                              ON (cwg.ord_no = clm.ord_no
		                              AND cwg.clm_no = clm.clm_no)
		                   WHERE 1 = 1
		                     AND cwg.ord_no = #{ordNo,jdbcType=VARCHAR}
	                         AND cwg.clm_no = #{clmNo,jdbcType=VARCHAR}
		                     AND clm.clm_stat_cd IN ('REQST', 'PAY_WAIT'))
    </delete>

    <delete id="deleteOrdGodAplPrm" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
 		DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteOrdGod][주문상품적용프로모션 삭제][khan] */
		      FROM  ord_god_apl_prm ogap
		      WHERE (ogap.ord_no, ogap.ord_god_turn) IN
		                 (SELECT ocgc.ord_no
		                       , ocgc.ord_god_turn
		                    FROM clm_wrhs_god cwg
		                         JOIN
		                         ord_clm_god_cnnc ocgc
		                              ON (ocgc.ord_no = cwg.ord_no
		                              AND ocgc.clm_no = cwg.clm_no
		                              AND ocgc.clm_wrhs_god_turn =
		                                       cwg.clm_wrhs_god_turn
		                              AND ocgc.god_cnnc_tp_cd = 'DLIVY_GOD_CNNC')
<!--
		                         JOIN lgs_dlivy_drct_god lddg
		                              ON (lddg.ord_no = ocgc.ord_no
		                              AND lddg.ord_god_turn = ocgc.ord_god_turn)
 -->
		                         JOIN clm clm
		                              ON (cwg.ord_no = clm.ord_no
		                              AND cwg.clm_no = clm.clm_no)
		                   WHERE 1 = 1
		                     AND cwg.ord_no = #{ordNo,jdbcType=VARCHAR}
	                         AND cwg.clm_no = #{clmNo,jdbcType=VARCHAR}
		                     AND clm.clm_stat_cd IN ('REQST', 'PAY_WAIT'))
<!--
 		DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteOrdGod][주문상품적용프로모션 삭제][khan] */
		      FROM  ord_god_apl_prm ogap
		      WHERE (ogap.ord_no, ogap.apl_prm_turn) IN
		                 (SELECT ocgc.ord_no
		                       , og.apl_prm_turn
		                    FROM clm_wrhs_god cwg
		                         JOIN
		                         ord_clm_god_cnnc ocgc
		                              ON (ocgc.ord_no = cwg.ord_no
		                              AND ocgc.clm_no = cwg.clm_no
		                              AND ocgc.clm_wrhs_god_turn =
		                                       cwg.clm_wrhs_god_turn
		                              AND ocgc.god_cnnc_tp_cd = 'DLIVY_GOD_CNNC')
		                         JOIN ord_god_apl_prm og
		                              ON (og.ord_no = ocgc.ord_no
		                              AND og.ord_god_turn = ocgc.ord_god_turn
		                              AND apl_tp_cd = 'APL')
		                         JOIN clm clm
		                              ON (cwg.ord_no = clm.ord_no
		                              AND cwg.clm_no = clm.clm_no)
		                   WHERE 1 = 1
		                     AND cwg.ord_no = #{ordNo,jdbcType=VARCHAR}
 	                         AND cwg.clm_no = #{clmNo,jdbcType=VARCHAR}
		                     AND clm.clm_stat_cd IN ('REQST', 'PAY_WAIT')
		                  UNION ALL
		                  SELECT ocgc.ord_no
		                       , og.apl_prm_turn - 1 AS apl_prm_turn
		                    FROM clm_wrhs_god cwg
		                         JOIN
		                         ord_clm_god_cnnc ocgc
		                              ON (ocgc.ord_no = cwg.ord_no
		                              AND ocgc.clm_no = cwg.clm_no
		                              AND ocgc.clm_wrhs_god_turn =
		                                       cwg.clm_wrhs_god_turn
		                              AND ocgc.god_cnnc_tp_cd = 'DLIVY_GOD_CNNC')
		                         JOIN ord_god_apl_prm og
		                              ON (og.ord_no = ocgc.ord_no
		                              AND og.ord_god_turn = ocgc.ord_god_turn
		                              AND apl_tp_cd = 'APL')
		                         JOIN clm clm
		                              ON (cwg.ord_no = clm.ord_no
		                              AND cwg.clm_no = clm.clm_no)
		                   WHERE 1 = 1
		                     AND cwg.ord_no = #{ordNo,jdbcType=VARCHAR}
		                     AND cwg.clm_no = #{clmNo,jdbcType=VARCHAR}
		                     AND clm.clm_stat_cd IN ('REQST', 'PAY_WAIT'))
 -->

    </delete>

    <select id="selectOrdGodListForClm" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
		SELECT /* [com.plgrim.ncp.biz.claim.return.xml][selectOrdGodListForClm][교환 수정후 접수 관련 삭제대상상품 조회][khan] */
		       ocgc.ord_no				AS ordNo
		     , ocgc.ord_god_turn    	AS ordGodTurn
		     , ocgc2.ord_god_turn       AS pckageGodTurn
		  FROM clm_wrhs_god cwg
		       JOIN ord_clm_god_cnnc ocgc
		            ON (ocgc.ord_no = cwg.ord_no
		            AND ocgc.clm_no = cwg.clm_no
		            AND ocgc.clm_wrhs_god_turn = cwg.clm_wrhs_god_turn
		            AND ocgc.god_cnnc_tp_cd = 'DLIVY_GOD_CNNC')
		       LEFT OUTER JOIN ord_cpst_god_cnnc ocgc2
		            ON (ocgc.ord_no = ocgc2.ord_no
		            AND ocgc.ord_god_turn = ocgc2.ord_cpst_god_turn)
		       JOIN clm clm
		            ON (cwg.ord_no = clm.ord_no
		            AND cwg.clm_no = clm.clm_no)
		 WHERE 1 = 1
		   AND cwg.ord_no = #{ordNo,jdbcType=VARCHAR}
		   AND cwg.clm_no = #{clmNo,jdbcType=VARCHAR}
		   AND clm.clm_stat_cd IN ('REQST', 'PAY_WAIT')
    </select>

    <delete id="deleteOrdCpstGodCnnc" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
		DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteOrdGod][주문구성상품연결 삭제][khan] */
          FROM ord_cpst_god_cnnc
	     WHERE 1 = 1
	       AND ord_no = #{ordNo,jdbcType=VARCHAR}
	       <choose>
		  	<when test='pckageGodTurn != null'>
		  	 	AND ord_god_turn = #{pckageGodTurn,jdbcType=NUMERIC}
		  	</when>
		  	<otherwise>
		  	 	AND ord_cpst_god_turn = #{ordGodTurn,jdbcType=NUMERIC}
		  	</otherwise>
		  </choose>
    </delete>

    <delete id="deleteOrdClmGodCnncDlivy" parameterType="ordClmGodCnnc">
        DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteOrdClmGodCnnc][주문 클레임 상품연결 삭제 - 출고 상품 연결][khan] */
        FROM ORD_CLM_GOD_CNNC
        WHERE   1 = 1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
        AND     ord_god_turn = #{ordGodTurn,jdbcType=NUMERIC}
        AND     GOD_CNNC_TP_CD = 'DLIVY_GOD_CNNC'
    </delete>

    <delete id="deleteOrdGod" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
		DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteOrdGod][주문 상품 삭제][khan] */
          FROM ord_god
	     WHERE 1 = 1
	       AND ord_no = #{ordNo,jdbcType=VARCHAR}
	       AND ord_god_turn = #{ordGodTurn,jdbcType=NUMERIC}
<!--
		DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteOrdGod][주문 상품 테이블 삭제][khan] */
		       FROM ord_god og
		      WHERE (og.ord_no, og.ord_god_turn) IN
		                 (  SELECT ocgc.ord_no, ocgc.ord_god_turn
		                      FROM clm_wrhs_god cwg
		                           JOIN
		                           ord_clm_god_cnnc ocgc
		                                ON (ocgc.ord_no = cwg.ord_no
		                                AND ocgc.clm_no = cwg.clm_no
		                                AND ocgc.clm_wrhs_god_turn =
		                                         cwg.clm_wrhs_god_turn
		                                AND ocgc.god_cnnc_tp_cd = 'DLIVY_GOD_CNNC')
		                           JOIN clm clm
		                                ON (cwg.ord_no = clm.ord_no
		                                AND cwg.clm_no = clm.clm_no)
		                     WHERE 1 = 1
		                       AND cwg.ord_no = #{ordNo,jdbcType=VARCHAR}
		                       AND cwg.clm_no = #{clmNo,jdbcType=VARCHAR}
		                       AND clm.clm_stat_cd IN ('REQST', 'PAY_WAIT'))
 -->
    </delete>



    <delete id="deleteLgsRtrvlDrctGodHist" parameterType="lgsRtrvlDrctGodHist">
        DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteLgsRtrvlDrctGodHist][물류 회수지시상품 이력 삭제][khan] */
        FROM LGS_RTRVL_DRCT_GOD_HIST
        WHERE   1 = 1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
    </delete>

    <delete id="deleteLgsRtrvlDrctGod" parameterType="lgsRtrvlDrctGod">
        DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteLgsRtrvlDrctGod][물류 회수지시상품 삭제][khan] */
        FROM LGS_RTRVL_DRCT_GOD
        WHERE   1 = 1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
    </delete>

    <delete id="deleteClmWrhsGodAplPrm" parameterType="clmWrhsGodAplPrm">
        DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteClmWrhsGodAplPrm][클레임 입고상품 적용 프로모션 삭제][khan] */
        FROM CLM_WRHS_GOD_APL_PRM
        WHERE   1 = 1
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
    </delete>

    <delete id="deleteOrdClmGodCnncWrhs" parameterType="ordClmGodCnnc">
        DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteOrdClmGodCnncWrhs][주문 클레임 상품연결 삭제 - 입고 상품 연결][khan] */
        FROM ORD_CLM_GOD_CNNC
        WHERE   1 = 1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
        AND     GOD_CNNC_TP_CD = 'WRHS_GOD_CNNC'
    </delete>

    <delete id="deleteClmWrhsCpstGodCnnc" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
        DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteClmWrhsCpstGodCnnc][클레임 입고상품 연결 삭제][khan] */
        FROM CLM_WRHS_CPST_GOD_CNNC
        WHERE   1 = 1
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
    </delete>

    <delete id="deleteClmWrhsGod" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend">
        DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteClmWrhsGod][클레임 입고상품 삭제][khan] */
        FROM CLM_WRHS_GOD
        WHERE   1 = 1
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
    </delete>

    <delete id="deleteLgsDlvHist" parameterType="lgsDlvHist">
        DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteLgsDlvHist][물류 배송 이력 삭제][khan] */
        FROM LGS_DLV_HIST
        WHERE   1 = 1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
<!--
        AND     DLV_PCUPSP_TURN = #{dlvPcupspTurn,jdbcType=NUMERIC}
 -->
    </delete>

    <delete id="deleteLgsDlv" parameterType="lgsDlv">
        DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteLgsDlv][물류 배송 삭제][Khan] */
        FROM LGS_DLV
        WHERE   1 = 1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
<!--
        AND     DLV_PCUPSP_TURN = #{dlvPcupspTurn,jdbcType=NUMERIC}
 -->
    </delete>

    <delete id="deleteLgsDlvspHist" parameterType="lgsDlvspHist">
        DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteLgsDlvspHist][물류 배송지 이력 삭제][Khan] */
        FROM LGS_DLVSP_HIST
        WHERE   1 = 1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
<!--
        AND     DLV_PCUPSP_TURN = #{dlvPcupspTurn,jdbcType=NUMERIC}
 -->
    </delete>

    <delete id="deleteLgsDlvsp" parameterType="lgsDlvsp">
        DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteLgsDlvsp][deleteLgsDlvsp][Khan] */
        FROM LGS_DLVSP
        WHERE   1 = 1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
<!--
        AND     DLV_PCUPSP_TURN = #{dlvPcupspTurn,jdbcType=NUMERIC}
 -->
    </delete>


    <delete id="deleteClmErpTrnsmis" parameterType="clm">
        DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteClmErpTrnsmis][클레임 ERP 전송 삭제][Khan] */
        FROM  clm_erp_trnsmis
        WHERE   1 = 1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
    </delete>


    <delete id="deleteClm" parameterType="clm">
        DELETE /* [com.plgrim.ncp.biz.claim.return.xml][deleteClm][클레임 마스터 삭제][Khan] */
        FROM CLM
        WHERE   1 = 1
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
    </delete>





    <update id="updateClm" parameterType="clm">
        UPDATE /* [com.plgrim.ncp.biz.claim.return.xml][deleteLgsRtrvlDrctGod][][Henry] */
        CLM SET CLM_STAT_CD = #{clmStatCd,jdbcType=VARCHAR}
                ,UDTER_ID = #{udterId,jdbcType=VARCHAR}
                ,UDT_DT = SYSDATE
        WHERE   1 = 1
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
    </update>

    <update id="updateOrdGod" parameterType="ordGod">
        UPDATE /* [com.plgrim.ncp.biz.claim.return.xml][updateOrdGod][][Henry] */
        ORD_GOD SET
        DLV_PCUPSP_TURN = #{dlvPcupspTurn,jdbcType=NUMERIC}
        ,GOD_NO = #{godNo,jdbcType=VARCHAR}
        ,ITM_NO = #{itmNo,jdbcType=VARCHAR}
        ,GOD_HIST_TURN = #{godHistTurn,jdbcType=NUMERIC}
        ,ITM_HIST_TURN = #{itmHistTurn,jdbcType=NUMERIC}
        ,GOD_NM = #{godNm,jdbcType=VARCHAR}
        ,MOBILE_GOD_NM = #{mobileGodNm,jdbcType=VARCHAR}
        ,ITM_NM = #{itmNm,jdbcType=VARCHAR}
        ,COLOR_NM = #{colorNm,jdbcType=VARCHAR}
        ,ERP_GOD_NO = #{erpGodNo,jdbcType=VARCHAR}
        ,SKU_NO = #{skuNo,jdbcType=VARCHAR}
        ,BRND_ID = #{brndId,jdbcType=VARCHAR}
        ,BRND_GRP_ID = #{brndGrpId,jdbcType=VARCHAR}
        ,GOD_VOL = #{godVol,jdbcType=NUMERIC}
        ,GOD_WT = #{godWt,jdbcType=NUMERIC}
        ,GOD_TP_CD = #{godTpCd,jdbcType=VARCHAR}
        ,PARTMAL_SECT_CD = #{partmalSectCd,jdbcType=VARCHAR}
        ,LST_IMG_URL = #{lstImgUrl,jdbcType=VARCHAR}
        ,COM_ID = #{comId,jdbcType=VARCHAR}
        ,DMSTC_DLV_CST_PLC_SN = #{dmstcDlvCstPlcSn,jdbcType=NUMERIC}
        ,OVSEA_DLV_DMSTC_DLV_CST_PLC_SN = #{ovseaDlvDmstcDlvCstPlcSn,jdbcType=NUMERIC}
        ,OVSEA_DLV_CST_PLC_SN = #{ovseaDlvCstPlcSn,jdbcType=NUMERIC}
        ,SALE_SHOP_CD = #{saleShopCd,jdbcType=VARCHAR}
        ,ORD_QTY = #{ordQty,jdbcType=NUMERIC}
        ,CRNCY_CD = #{crncyCd,jdbcType=VARCHAR}
        ,STDR_CRNCY_AMT = #{stdrCrncyAmt,jdbcType=NUMERIC}
        ,PAY_EXCHG_RT_CRNCY_AMT = #{payExchgRtCrncyAmt,jdbcType=NUMERIC}
        ,RTL_PRC = #{rtlPrc,jdbcType=NUMERIC}
        ,SALE_AMT = #{saleAmt,jdbcType=NUMERIC}
        ,WEB_DC_AMT = #{webDcAmt,jdbcType=NUMERIC}
        ,EMP_DC_AMT = #{empDcAmt,jdbcType=NUMERIC}
        ,ALL_DC_AMT = #{allDcAmt,jdbcType=NUMERIC}
        ,IMDTL_DC_AMT = #{imdtlDcAmt,jdbcType=NUMERIC}
        ,GOD_DC_AMT = #{godDcAmt,jdbcType=NUMERIC}
        ,BUNDLE_DC_AMT = #{bundleDcAmt,jdbcType=NUMERIC}
        ,CRS_DC_AMT = #{crsDcAmt,jdbcType=NUMERIC}
        ,GOD_CPN_DC_AMT = #{godCpnDcAmt,jdbcType=NUMERIC}
        ,BSK_CPN_DC_AMT = #{bskCpnDcAmt,jdbcType=NUMERIC}
        ,UNITY_PNT_USE_AMT = #{unityPntUseAmt,jdbcType=NUMERIC}
        ,EVT_PNT_USE_AMT = #{evtPntUseAmt,jdbcType=NUMERIC}
        ,WEBPNT_USE_AMT = #{webpntUseAmt,jdbcType=NUMERIC}
        ,UNITY_PNT_ACCML_AMT = #{unityPntAccmlAmt,jdbcType=NUMERIC}
        ,EVT_PNT_ACCML_AMT = #{evtPntAccmlAmt,jdbcType=NUMERIC}
        ,WEBPNT_ACCML_AMT = #{webpntAccmlAmt,jdbcType=NUMERIC}
        ,CAL_DT = #{calDt,jdbcType=TIMESTAMP}
        ,UDTER_ID = #{udterId,jdbcType=VARCHAR}
        ,UDT_DT = SYSDATE
        WHERE   1 = 1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     ORD_GOD_TURN = #{ordGodTurn,jdbcType=NUMERIC}
    </update>

    <update id="updateOrdGodAplPrm" parameterType="ordGodAplPrm">
        UPDATE /* [com.plgrim.ncp.biz.claim.return.xml][updateOrdGodAplPrm][][Henry] */
        ORD_GOD_APL_PRM SET
        PRM_NO = #{prmNo,jdbcType=VARCHAR}
        ,APL_TP_CD = #{aplTpCd,jdbcType=VARCHAR}
        ,APL_UNIT_CD = #{aplUnitCd,jdbcType=VARCHAR}
        ,PRM_TP_CD = #{prmTpCd,jdbcType=VARCHAR}
        ,PRM_DTL_TP_CD = #{prmDtlTpCd,jdbcType=VARCHAR}
        ,APL_AMT = #{aplAmt,jdbcType=NUMERIC}
        ,ORD_GOD_TURN = #{ordGodTurn,jdbcType=NUMERIC}
        ,APL_QTY = #{aplQty,jdbcType=NUMERIC}
        ,ORD_GOD_GFT_TURN = #{ordGodGftTurn,jdbcType=NUMERIC}
        ,ORD_GOD_GFT_NM = #{ordGodGftNm,jdbcType=VARCHAR}
        ,UDTER_ID = #{udterId,jdbcType=VARCHAR}
        ,MBR_CPN_NO = #{mbrCpnNo,jdbcType=VARCHAR}
        ,UDT_DT = SYSDATE
        WHERE   1 = 1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     APL_PRM_TURN = #{aplPrmTurn,jdbcType=NUMERIC}
    </update>

    <update id="updateLgsDlvsp" parameterType="lgsDlvsp">
        UPDATE /* [com.plgrim.ncp.biz.claim.return.xml][updateLgsDlvsp][][Henry] */
        LGS_DLVSP SET
        CLM_NO = #{clmNo,jdbcType=VARCHAR}
        ,DLV_PCUPSP_SECT_CD = #{dlvPcupspSectCd,jdbcType=VARCHAR}
        ,ADDRSE_NM = #{addrseNm,jdbcType=VARCHAR}
        ,DLV_SECT_CD = #{dlvSectCd,jdbcType=VARCHAR}
        ,DLV_MN_CD = #{dlvMnCd,jdbcType=VARCHAR}
        ,PKUP_SHOP_ID = #{pkupShopId,jdbcType=VARCHAR}
        ,PKUP_SHOP_BRND_ID = #{pkupShopBrndId,jdbcType=VARCHAR}
        ,PKUP_SHOP_VISIT_DATE = #{pkupShopVisitDate,jdbcType=VARCHAR}
        ,ADDR_SECT_CD = #{addrSectCd,jdbcType=VARCHAR}
        ,ADDRSE_NATION_CD = #{addrseNationCd,jdbcType=VARCHAR}
        ,ADDRSE_POST_NO = #{addrsePostNo,jdbcType=VARCHAR}
        ,ADDRSE_BASE_ADDR = #{addrseBaseAddr,jdbcType=VARCHAR}
        ,ADDRSE_DETAIL_ADDR = #{addrseDetailAddr,jdbcType=VARCHAR}
        ,ADDRSE_MOBIL_NATION_NO = #{addrseMobilNationNo,jdbcType=VARCHAR}
        ,ADDRSE_MOBIL_AREA_NO = #{addrseMobilAreaNo,jdbcType=VARCHAR}
        ,ADDRSE_MOBIL_TLOF_NO = #{addrseMobilTlofNo,jdbcType=VARCHAR}
        ,ADDRSE_MOBIL_TLOF_WTHN_NO = #{addrseMobilTlofWthnNo,jdbcType=VARCHAR}
        ,ADDRSE_TEL_NATION_NO = #{addrseTelNationNo,jdbcType=VARCHAR}
        ,ADDRSE_TEL_AREA_NO = #{addrseTelAreaNo,jdbcType=VARCHAR}
        ,ADDRSE_TEL_TLOF_NO = #{addrseTelTlofNo,jdbcType=VARCHAR}
        ,ADDRSE_TEL_TLOF_WTHN_NO = #{addrseTelTlofWthnNo,jdbcType=VARCHAR}
        ,DLV_MEMO = #{dlvMemo,jdbcType=VARCHAR}
        ,DLV_HOPE_DATE = #{dlvHopeDate,jdbcType=VARCHAR}
        ,UDTER_ID = #{udterId,jdbcType=VARCHAR}
        ,UDT_DT = SYSDATE
        WHERE   1 = 1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     DLV_PCUPSP_TURN = #{dlvPcupspTurn,jdbcType=NUMERIC}
    </update>

    <update id="updateLgsDlv" parameterType="lgsDlv">
        UPDATE /* [com.plgrim.ncp.biz.claim.return.xml][updateLgsDlv][][Henry] */
        LGS_DLV SET
        CLM_NO = #{clmNo,jdbcType=VARCHAR}
        ,DMSTC_DLV_CST_PLC_SN = #{dmstcDlvCstPlcSn,jdbcType=NUMERIC}
        ,OVSEA_DLV_DMSTC_DLV_CST_PLC_SN = #{ovseaDlvDmstcDlvCstPlcSn,jdbcType=NUMERIC}
        ,OVSEA_DLV_CST_PLC_SN = #{ovseaDlvCstPlcSn,jdbcType=NUMERIC}
        ,DLV_CST_BND_MBD_CD = #{dlvCstBndMbdCd,jdbcType=VARCHAR}
        ,DLV_COM_CD = #{dlvComCd,jdbcType=VARCHAR}
        ,DMSTC_WAYBIL_NO = #{dmstcWaybilNo,jdbcType=VARCHAR}
        ,DMSTC_WAYBIL_NO_REG_DT = #{dmstcWaybilNoRegDt,jdbcType=TIMESTAMP}
        ,OVSEA_WAYBIL_NO = #{ovseaWaybilNo,jdbcType=VARCHAR}
        ,OVSEA_WAYBIL_NO_REG_DT = #{ovseaWaybilNoRegDt,jdbcType=TIMESTAMP}
        ,CVNSTOR_HDRY_APRV_NO = #{cvnstorHdryAprvNo,jdbcType=VARCHAR}
        ,CRNCY_CD = #{crncyCd,jdbcType=VARCHAR}
        ,STDR_CRNCY_AMT = #{stdrCrncyAmt,jdbcType=NUMERIC}
        ,PAY_EXCHG_RT_CRNCY_AMT = #{payExchgRtCrncyAmt,jdbcType=NUMERIC}
        ,REALITY_DLV_CST = #{realityDlvCst,jdbcType=NUMERIC}
        ,PLC_DLV_CST = #{plcDlvCst,jdbcType=NUMERIC}
        ,CNCL_DLV_CST = #{cnclDlvCst,jdbcType=NUMERIC}
        ,RTGOD_DLV_CST = #{rtgodDlvCst,jdbcType=NUMERIC}
        ,EXCHG_DLV_CST = #{exchgDlvCst,jdbcType=NUMERIC}
        ,DLV_CST_CPN_DC_AMT = #{dlvCstCpnDcAmt,jdbcType=NUMERIC}
        ,WAYBIL_NO_ERP_TRNSMIS_CD = #{waybilNoErpTrnsmisCd,jdbcType=VARCHAR}
        ,WAYBIL_NO_ERP_TRNSMIS_ERR_CONT = #{waybilNoErpTrnsmisErrCont,jdbcType=VARCHAR}
        ,WAYBIL_NO_ERP_TRNSMIS_DT = #{waybilNoErpTrnsmisDt,jdbcType=TIMESTAMP}
        ,DLV_COM_TRNSMIS_TGT_YN = #{dlvComTrnsmisTgtYn,jdbcType=VARCHAR}
        ,DLV_COM_TRNSMIS_YN = #{dlvComTrnsmisYn,jdbcType=VARCHAR}
        ,DLV_COM_TRNSMIS_DT = #{dlvComTrnsmisDt,jdbcType=TIMESTAMP}
        ,MAIL_SND_YN = #{mailSndYn,jdbcType=VARCHAR}
        ,UDTER_ID = #{udterId,jdbcType=VARCHAR}
        ,UDT_DT = SYSDATE
        WHERE   1 = 1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     DLV_PCUPSP_TURN = #{dlvPcupspTurn,jdbcType=NUMERIC}
        AND     DLV_TURN = #{dlvTurn,jdbcType=NUMERIC}
    </update>

    <update id="updateLgsDlivyDrctGod" parameterType="lgsDlivyDrctGod">
        UPDATE /* [com.plgrim.ncp.biz.claim.return.xml][updateLgsDlivyDrctGod][][Henry] */
        LGS_DLIVY_DRCT_GOD SET
        ORD_NO = #{ordNo,jdbcType=VARCHAR}
        ,ORD_GOD_TURN = #{ordGodTurn,jdbcType=NUMERIC}
        ,PCKAGE_GOD_TURN = #{pckageGodTurn,jdbcType=NUMERIC}
        ,GFT_YN = #{gftYn,jdbcType=VARCHAR}
        ,DLV_PCUPSP_TURN = #{dlvPcupspTurn,jdbcType=NUMERIC}
        ,DLV_TURN = #{dlvTurn,jdbcType=NUMERIC}
        ,DLV_SHOP_ID = #{dlvShopId,jdbcType=VARCHAR}
        ,DLIVY_SHOP_ID = #{dlivyShopId,jdbcType=VARCHAR}
        ,ACMTL_GOD_VOL = #{acmtlGodVol,jdbcType=NUMERIC}
        ,ACMTL_GOD_WT = #{acmtlGodWt,jdbcType=NUMERIC}
        ,LGS_ITM_YN = #{lgsItmYn,jdbcType=VARCHAR}
        ,DLIVY_DRCT_TGT_YN = #{dlivyDrctTgtYn,jdbcType=VARCHAR}
        ,DLIVY_DRCT_YN = #{dlivyDrctYn,jdbcType=VARCHAR}
        ,DLIVY_DRCT_GRP_DGRE = #{dlivyDrctGrpDgre,jdbcType=NUMERIC}
        ,DLIVY_DRCT_USER_GRP_DGRE = #{dlivyDrctUserGrpDgre,jdbcType=NUMERIC}
        ,DLIVY_DRCT_COUNT = #{dlivyDrctCount,jdbcType=NUMERIC}
        ,DLIVY_DRCT_TP_CD = #{dlivyDrctTpCd,jdbcType=VARCHAR}
        ,DLIVY_DRCT_DT = #{dlivyDrctDt,jdbcType=TIMESTAMP}
        ,DLIVY_DRCT_QTY = #{dlivyDrctQty,jdbcType=NUMERIC}
        ,DLIVY_DRCT_CNCL_QTY = #{dlivyDrctCnclQty,jdbcType=NUMERIC}
        ,DLIVY_DRCT_CNCL_DT = #{dlivyDrctCnclDt,jdbcType=TIMESTAMP}
        ,DLV_STAT_CD = #{dlvStatCd,jdbcType=VARCHAR}
        ,SHTG_QTY = #{shtgQty,jdbcType=NUMERIC}
        ,SHTG_DT = #{shtgDt,jdbcType=TIMESTAMP}
        ,SHTG_DCSN_YN = #{shtgDcsnYn,jdbcType=VARCHAR}
        ,SHTG_DCSN_DT = #{shtgDcsnDt,jdbcType=TIMESTAMP}
        ,DLIVY_COMPT_QTY = #{dlivyComptQty,jdbcType=NUMERIC}
        ,DLIVY_COMPT_DT = #{dlivyComptDt,jdbcType=TIMESTAMP}
        ,DLV_COMPT_DT = #{dlvComptDt,jdbcType=TIMESTAMP}
        ,DLIVY_DRCT_GOD_MEMO_CONT = #{dlivyDrctGodMemoCont,jdbcType=VARCHAR}
        ,RCPTFR_NO = #{rcptfrNo,jdbcType=VARCHAR}
        ,RESVE_RCPTFR_CREAT_YN = #{resveRcptfrCreatYn,jdbcType=VARCHAR}
        ,RESVE_RCPTFR_CREAT_DT = #{resveRcptfrCreatDt,jdbcType=TIMESTAMP}
        ,RESVE_RCPTFR_DLIVY_YN = #{resveRcptfrDlivyYn,jdbcType=VARCHAR}
        ,RESVE_RCPTFR_DLIVY_DT = #{resveRcptfrDlivyDt,jdbcType=TIMESTAMP}
        ,RESVE_RCPTFR_DCSN_YN = #{resveRcptfrDcsnYn,jdbcType=VARCHAR}
        ,RESVE_RCPTFR_DCSN_DT = #{resveRcptfrDcsnDt,jdbcType=TIMESTAMP}
        ,ERP_RESVE_RCPTFR_CREAT_CNT = #{erpResveRcptfrCreatCnt,jdbcType=NUMERIC}
        ,ERP_RESVE_RCPTFR_CREAT_YN = #{erpResveRcptfrCreatYn,jdbcType=VARCHAR}
        ,ERP_RESVE_RCPTFR_CREAT_DT = #{erpResveRcptfrCreatDt,jdbcType=TIMESTAMP}
        ,ERP_RESVE_RCPTFR_RECREAT_YN = #{erpResveRcptfrRecreatYn,jdbcType=VARCHAR}
        ,ERP_RESVE_RCPTFR_RECREAT_DT = #{erpResveRcptfrRecreatDt,jdbcType=TIMESTAMP}
        ,ERP_RESVE_RCPTFR_CNCL_YN = #{erpResveRcptfrCnclYn,jdbcType=VARCHAR}
        ,ERP_RESVE_RCPTFR_CNCL_DT = #{erpResveRcptfrCnclDt,jdbcType=TIMESTAMP}
        ,INV_APL_YN = #{invAplYn,jdbcType=VARCHAR}
        ,CNTR_DLIVY_CNFIRM_YN = #{cntrDlivyCnfirmYn,jdbcType=VARCHAR}
        ,CNTR_DLIVY_CNFIRM_DT = #{cntrDlivyCnfirmDt,jdbcType=TIMESTAMP}
        ,P_STO_NO = #{pStoNo,jdbcType=VARCHAR}
        ,S_STO_NO = #{sStoNo,jdbcType=VARCHAR}
        ,S_DOC_NO = #{sDocNo,jdbcType=VARCHAR}
        ,UDTER_ID = #{udterId,jdbcType=VARCHAR}
        ,UDT_DT = SYSDATE
        WHERE   1 = 1
        AND     DLIVY_DRCT_GOD_NO = #{dlivyDrctGodNo,jdbcType=VARCHAR}
    </update>

    <!--<update id="updateOrdClmGodCnnc" parameterType="ordClmGodCnnc">
        UPDATE /* [com.plgrim.ncp.biz.claim.return.xml][updateOrdClmGodCnnc][][Henry] */
        ORD_CLM_GOD_CNNC SET
        GOD_CNNC_TP_CD = #{godCnncTpCd,jdbcType=VARCHAR}
        ,ORD_CLM_QTY = #{ordClmQty,jdbcType=NUMERIC}
        ,ORD_CLM_WTHDRAW_QTY = #{ordClmWthdrawQty,jdbcType=NUMERIC}
        ,UDTER_ID = #{udterId,jdbcType=VARCHAR}
        ,UDT_DT = SYSDATE
        WHERE   1 = 1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     ORD_GOD_TURN = #{ordGodTurn,jdbcType=NUMERIC}
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
        AND     CLM_WRHS_GOD_TURN = #{clmWrhsGodTurn,jdbcType=NUMERIC}
    </update>-->

    <!--<update id="updateClmWrhsGod" parameterType="clmWrhsGod">
        UPDATE /* [com.plgrim.ncp.biz.claim.return.xml][updateClmWrhsGod][][Henry] */
        CLM_WRHS_GOD SET
        ORD_NO = #{ordNo,jdbcType=VARCHAR}
        ,DLV_PCUPSP_TURN = #{dlvPcupspTurn,jdbcType=NUMERIC}
        ,CLM_RESN_CD = #{clmResnCd,jdbcType=VARCHAR}
        ,CLM_RESN_CONT = #{clmResnCont,jdbcType=VARCHAR}
        ,GOD_NO = #{godNo,jdbcType=VARCHAR}
        ,ITM_NO = #{itmNo,jdbcType=VARCHAR}
        ,GOD_HIST_TURN = #{godHistTurn,jdbcType=NUMERIC}
        ,ITM_HIST_TURN = #{itmHistTurn,jdbcType=NUMERIC}
        ,GOD_NM = #{godNm,jdbcType=VARCHAR}
        ,MOBILE_GOD_NM = #{mobileGodNm,jdbcType=VARCHAR}
        ,ITM_NM = #{itmNm,jdbcType=VARCHAR}
        ,COLOR_NM = #{colorNm,jdbcType=VARCHAR}
        ,ERP_GOD_NO = #{erpGodNo,jdbcType=VARCHAR}
        ,SKU_NO = #{skuNo,jdbcType=VARCHAR}
        ,BRND_ID = #{brndId,jdbcType=VARCHAR}
        ,BRND_GRP_ID = #{brndGrpId,jdbcType=VARCHAR}
        ,GOD_VOL = #{godVol,jdbcType=NUMERIC}
        ,GOD_WT = #{godWt,jdbcType=NUMERIC}
        ,GOD_TP_CD = #{godTpCd,jdbcType=VARCHAR}
        ,PARTMAL_SECT_CD = #{partmalSectCd,jdbcType=VARCHAR}
        ,LST_IMG_URL = #{lstImgUrl,jdbcType=VARCHAR}
        ,COM_ID = #{comId,jdbcType=VARCHAR}
        ,REPAIR_YN = #{repairYn,jdbcType=VARCHAR}
        ,DMSTC_DLV_CST_PLC_SN = #{dmstcDlvCstPlcSn,jdbcType=NUMERIC}
        ,OVSEA_DLV_DMSTC_DLV_CST_PLC_SN = #{ovseaDlvDmstcDlvCstPlcSn,jdbcType=NUMERIC}
        ,OVSEA_DLV_CST_PLC_SN = #{ovseaDlvCstPlcSn,jdbcType=NUMERIC}
        ,SALE_SHOP_CD = #{saleShopCd,jdbcType=VARCHAR}
        ,CLM_QTY = #{clmQty,jdbcType=NUMERIC}
        ,CLM_WTHDRAW_SECT_CD = #{clmWthdrawSectCd,jdbcType=VARCHAR}
        ,CLM_WTHDRAW_QTY = #{clmWthdrawQty,jdbcType=NUMERIC}
        ,CRNCY_CD = #{crncyCd,jdbcType=VARCHAR}
        ,STDR_CRNCY_AMT = #{stdrCrncyAmt,jdbcType=NUMERIC}
        ,PAY_EXCHG_RT_CRNCY_AMT = #{payExchgRtCrncyAmt,jdbcType=NUMERIC}
        ,RTL_PRC = #{rtlPrc,jdbcType=NUMERIC}
        ,SALE_AMT = #{saleAmt,jdbcType=NUMERIC}
        ,WEB_DC_AMT = #{webDcAmt,jdbcType=NUMERIC}
        ,EMP_DC_AMT = #{empDcAmt,jdbcType=NUMERIC}
        ,ALL_DC_AMT = #{allDcAmt,jdbcType=NUMERIC}
        ,IMDTL_DC_AMT = #{imdtlDcAmt,jdbcType=NUMERIC}
        ,GOD_DC_AMT = #{godDcAmt,jdbcType=NUMERIC}
        ,BUNDLE_DC_AMT = #{bundleDcAmt,jdbcType=NUMERIC}
        ,CRS_DC_AMT = #{crsDcAmt,jdbcType=NUMERIC}
        ,GOD_CPN_DC_AMT = #{godCpnDcAmt,jdbcType=NUMERIC}
        ,BSK_CPN_DC_AMT = #{bskCpnDcAmt,jdbcType=NUMERIC}
        ,UNITY_PNT_USE_AMT = #{unityPntUseAmt,jdbcType=NUMERIC}
        ,EVT_PNT_USE_AMT = #{evtPntUseAmt,jdbcType=NUMERIC}
        ,WEBPNT_USE_AMT = #{webpntUseAmt,jdbcType=NUMERIC}
        ,UNITY_PNT_ACCML_AMT = #{unityPntAccmlAmt,jdbcType=NUMERIC}
        ,EVT_PNT_ACCML_AMT = #{evtPntAccmlAmt,jdbcType=NUMERIC}
        ,WEBPNT_ACCML_AMT = #{webpntAccmlAmt,jdbcType=NUMERIC}
        ,CAL_DT = #{calDt,jdbcType=TIMESTAMP}
        ,UDTER_ID = #{udterId,jdbcType=VARCHAR}
        ,UDT_DT = SYSDATE
        WHERE   1 = 1
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
        AND     CLM_WRHS_GOD_TURN = #{clmWrhsGodTurn,jdbcType=NUMERIC}
    </update>-->

    <update id="updateClmWrhsGodAplPrm" parameterType="clmWrhsGodAplPrm">
        UPDATE /* [com.plgrim.ncp.biz.claim.return.xml][updateClmWrhsGodAplPrm][][Henry] */
        CLM_WRHS_GOD_APL_PRM SET
        PRM_NO = #{prmNo,jdbcType=VARCHAR}
        ,APL_TP_CD = #{aplTpCd,jdbcType=VARCHAR}
        ,APL_UNIT_CD = #{aplUnitCd,jdbcType=VARCHAR}
        ,PRM_TP_CD = #{prmTpCd,jdbcType=VARCHAR}
        ,PRM_DTL_TP_CD = #{prmDtlTpCd,jdbcType=VARCHAR}
        ,APL_AMT = #{aplAmt,jdbcType=NUMERIC}
        ,CLM_WRHS_GOD_TURN = #{clmWrhsGodTurn,jdbcType=NUMERIC}
        ,APL_QTY = #{aplQty,jdbcType=NUMERIC}
        ,CLM_WRHS_GOD_GFT_TURN = #{clmWrhsGodGftTurn,jdbcType=NUMERIC}
        ,CLM_WRHS_GOD_GFT_NM = #{clmWrhsGodGftNm,jdbcType=VARCHAR}
        ,UDTER_ID = #{udterId,jdbcType=VARCHAR}
        ,MBR_CPN_NO = #{mbrCpnNo,jdbcType=VARCHAR}
        ,UDT_DT = SYSDATE
        WHERE   1 = 1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
        AND     APL_PRM_TURN = #{aplPrmTurn,jdbcType=NUMERIC}
    </update>

    <update id="updateLgsRtrvlDrctGod" parameterType="lgsRtrvlDrctGod">
        UPDATE /* [com.plgrim.ncp.biz.claim.return.xml][updateLgsRtrvlDrctGod][][Henry] */
        LGS_RTRVL_DRCT_GOD SET
        ORD_NO = #{ordNo,jdbcType=VARCHAR}
        ,CLM_NO = #{clmNo,jdbcType=VARCHAR}
        ,GFT_YN = #{gftYn,jdbcType=VARCHAR}
        ,CLM_WRHS_GOD_TURN = #{clmWrhsGodTurn,jdbcType=NUMERIC}
        ,DLIVY_DRCT_GOD_NO = #{dlivyDrctGodNo,jdbcType=VARCHAR}
        ,DLV_PCUPSP_TURN = #{dlvPcupspTurn,jdbcType=NUMERIC}
        ,DLV_TURN = #{dlvTurn,jdbcType=NUMERIC}
        ,RTRVL_SHOP_ID = #{rtrvlShopId,jdbcType=VARCHAR}
        ,ACMTL_GOD_WT = #{acmtlGodWt,jdbcType=NUMERIC}
        ,ACMTL_GOD_VOL = #{acmtlGodVol,jdbcType=NUMERIC}
        ,LGS_ITM_YN = #{lgsItmYn,jdbcType=VARCHAR}
        ,RTRVL_DRCT_TGT_YN = #{rtrvlDrctTgtYn,jdbcType=VARCHAR}
        ,RTRVL_DRCT_YN = #{rtrvlDrctYn,jdbcType=VARCHAR}
        ,RTRVL_DRCT_GRP_DGRE = #{rtrvlDrctGrpDgre,jdbcType=NUMERIC}
        ,RTRVL_DRCT_USER_GRP_DGRE = #{rtrvlDrctUserGrpDgre,jdbcType=NUMERIC}
        ,RTRVL_DRCT_COUNT = #{rtrvlDrctCount,jdbcType=NUMERIC}
        ,RTRVL_DRCT_TP_CD = #{rtrvlDrctTpCd,jdbcType=VARCHAR}
        ,RTRVL_DRCT_DT = #{rtrvlDrctDt,jdbcType=TIMESTAMP}
        ,RTRVL_DRCT_QTY = #{rtrvlDrctQty,jdbcType=NUMERIC}
        ,RTRVL_DRCT_WTHDRAW_QTY = #{rtrvlDrctWthdrawQty,jdbcType=NUMERIC}
        ,RTRVL_DRCT_WTHDRAW_DT = #{rtrvlDrctWthdrawDt,jdbcType=TIMESTAMP}
        ,RTRVL_STAT_CD = #{rtrvlStatCd,jdbcType=VARCHAR}
        ,WRHS_COMPT_DT = #{wrhsComptDt,jdbcType=TIMESTAMP}
        ,RTRVL_COMPT_DT = #{rtrvlComptDt,jdbcType=TIMESTAMP}
        ,RTRVL_GOD_STAT_CD = #{rtrvlGodStatCd,jdbcType=VARCHAR}
        ,RTRVL_GOD_PRCS_COMPT_YN = #{rtrvlGodPrcsComptYn,jdbcType=VARCHAR}
        ,REPAIR_RCEPT_SN = #{repairRceptSn,jdbcType=NUMERIC}
        ,BADN_REQEST_CONT = #{badnReqestCont,jdbcType=VARCHAR}
        ,HDRY_COM_TRNSMIS_TGT_YN = #{hdryComTrnsmisTgtYn,jdbcType=VARCHAR}
        ,HDRY_COM_TRNSMIS_YN = #{hdryComTrnsmisYn,jdbcType=VARCHAR}
        ,HDRY_COM_TRNSMIS_DT = #{hdryComTrnsmisDt,jdbcType=TIMESTAMP}
        ,HDRY_COM_KEY = #{hdryComKey,jdbcType=VARCHAR}
        ,ERP_TRNSMIS_YN = #{erpTrnsmisYn,jdbcType=VARCHAR}
        ,ERP_TRNSMIS_DT = #{erpTrnsmisDt,jdbcType=TIMESTAMP}
        ,ERP_CNFIRM_YN = #{erpCnfirmYn,jdbcType=VARCHAR}
        ,ERP_CNFIRM_DT = #{erpCnfirmDt,jdbcType=TIMESTAMP}
        ,ERP_INV_TRNSMIS_SECT_CD = #{erpInvTrnsmisSectCd,jdbcType=VARCHAR}
        ,ERP_INV_TRNSMIS_DT = #{erpInvTrnsmisDt,jdbcType=TIMESTAMP}
        ,RTGODCST_CAL_SECT_CD = #{rtgodcstCalSectCd,jdbcType=VARCHAR}
        ,RTGODCST_CAL_AMT = #{rtgodcstCalAmt,jdbcType=NUMERIC}
        ,UDTER_ID = #{udterId,jdbcType=VARCHAR}
        ,UDT_DT = SYSDATE
        WHERE   1 = 1
        AND     RTRVL_DRCT_GOD_NO = #{rtrvlDrctGodNo,jdbcType=VARCHAR}
    </update>


    <update id="updateOrdGodErpForClmWthdraw" parameterType="String">
    	UPDATE /* [biz.claim.return.xml][updateOrdGodErpForClmWthdraw][ordGodErp 클레임정보 초기화][Aether] */
    		inf_ord_god_erp_dstb
    	SET clm_no = NULL
    		, clm_wrhs_god_turn = NULL
  			, udt_dt= SYSDATE
    	WHERE
    		clm_no = #{clmNo}
    </update>


    <insert id="insertLgsDlvspHist" parameterType="lgsDlvspHist">
        INSERT /* com.plgrim.ncp.base.repository.lgs.insertLgsDlvspHist  20150609 */
        INTO LGS_DLVSP_HIST
        (
        ORD_NO
        ,DLV_PCUPSP_TURN
        ,HIST_DT
        ,CLM_NO
        ,DLV_PCUPSP_SECT_CD
        ,ADDRSE_NM
        ,DLV_SECT_CD
        ,PKUP_SHOP_ID
        ,PKUP_SHOP_BRND_ID
        ,PKUP_SHOP_VISIT_DATE
        ,ADDR_SECT_CD
        ,ADDRSE_NATION_CD
        ,ADDRSE_POST_NO
        ,ADDRSE_BASE_ADDR
        ,ADDRSE_DETAIL_ADDR
        ,ADDRSE_MOBIL_NATION_NO
        ,ADDRSE_MOBIL_AREA_NO
        ,ADDRSE_MOBIL_TLOF_NO
        ,ADDRSE_MOBIL_TLOF_WTHN_NO
        ,ADDRSE_TEL_NATION_NO
        ,ADDRSE_TEL_AREA_NO
        ,ADDRSE_TEL_TLOF_NO
        ,ADDRSE_TEL_TLOF_WTHN_NO
        ,DLV_MEMO
        ,DLV_HOPE_DATE
        ,REGTR_ID
        ,UDTER_ID
        ,REG_DT
        ,UDT_DT
        )
        VALUES
        (
        #{ordNo,jdbcType=VARCHAR}
        ,#{dlvPcupspTurn,jdbcType=NUMERIC}
        ,#{histDt,jdbcType=TIMESTAMP}
        ,#{clmNo,jdbcType=VARCHAR}
        ,#{dlvPcupspSectCd,jdbcType=VARCHAR}
        ,#{addrseNm,jdbcType=VARCHAR}
        ,#{dlvSectCd,jdbcType=VARCHAR}
        ,#{pkupShopId,jdbcType=VARCHAR}
        ,#{pkupShopBrndId,jdbcType=VARCHAR}
        ,#{pkupShopVisitDate,jdbcType=VARCHAR}
        ,#{addrSectCd,jdbcType=VARCHAR}
        ,#{addrseNationCd,jdbcType=VARCHAR}
        ,#{addrsePostNo,jdbcType=VARCHAR}
        ,#{addrseBaseAddr,jdbcType=VARCHAR}
        ,#{addrseDetailAddr,jdbcType=VARCHAR}
        ,#{addrseMobilNationNo,jdbcType=VARCHAR}
        ,#{addrseMobilAreaNo,jdbcType=VARCHAR}
        ,#{addrseMobilTlofNo,jdbcType=VARCHAR}
        ,#{addrseMobilTlofWthnNo,jdbcType=VARCHAR}
        ,#{addrseTelNationNo,jdbcType=VARCHAR}
        ,#{addrseTelAreaNo,jdbcType=VARCHAR}
        ,#{addrseTelTlofNo,jdbcType=VARCHAR}
        ,#{addrseTelTlofWthnNo,jdbcType=VARCHAR}
        ,#{dlvMemo,jdbcType=VARCHAR}
        ,#{dlvHopeDate,jdbcType=VARCHAR}
        ,#{regtrId,jdbcType=VARCHAR}
        ,#{udterId,jdbcType=VARCHAR}
        ,SYSDATE
        ,SYSDATE
        )
    </insert>



    <insert id="insertLgsDlvHist" parameterType="lgsDlvHist">
        INSERT /* com.plgrim.ncp.base.repository.lgs.insertLgsDlvHist jackie 20150608 */
        INTO LGS_DLV_HIST
        (
        ORD_NO
        ,DLV_PCUPSP_TURN
        ,DLV_TURN
        ,HIST_DT
        ,CLM_NO
        ,DMSTC_DLV_CST_PLC_SN
        ,OVSEA_DLV_DMSTC_DLV_CST_PLC_SN
        ,OVSEA_DLV_CST_PLC_SN
        ,DLV_CST_BND_MBD_CD
        ,DLV_COM_CD
        ,DMSTC_WAYBIL_NO
        ,DMSTC_WAYBIL_NO_REG_DT
        ,OVSEA_WAYBIL_NO
        ,OVSEA_WAYBIL_NO_REG_DT
        ,CVNSTOR_HDRY_APRV_NO
        ,CRNCY_CD
        ,STDR_CRNCY_AMT
        ,PAY_EXCHG_RT_CRNCY_AMT
        ,REALITY_DLV_CST
        ,PLC_DLV_CST
        ,CNCL_DLV_CST
        ,RTGOD_DLV_CST
        ,EXCHG_DLV_CST
        ,DLV_CST_CPN_DC_AMT
        ,WAYBIL_NO_ERP_TRNSMIS_CD
        ,WAYBIL_NO_ERP_TRNSMIS_ERR_CONT
        ,WAYBIL_NO_ERP_TRNSMIS_DT
        ,DLV_COM_TRNSMIS_TGT_YN
        ,DLV_COM_TRNSMIS_YN
        ,DLV_COM_TRNSMIS_DT
        ,MAIL_SND_YN
        ,REGTR_ID
        ,UDTER_ID
        ,REG_DT
        ,UDT_DT
        )
        VALUES
        (
        #{ordNo,jdbcType=VARCHAR}
        ,#{dlvPcupspTurn,jdbcType=NUMERIC}
        ,#{dlvTurn,jdbcType=NUMERIC}
        ,#{histDt,jdbcType=TIMESTAMP}
        ,#{clmNo,jdbcType=VARCHAR}
        ,#{dmstcDlvCstPlcSn,jdbcType=NUMERIC}
        ,#{ovseaDlvDmstcDlvCstPlcSn,jdbcType=NUMERIC}
        ,#{ovseaDlvCstPlcSn,jdbcType=NUMERIC}
        ,#{dlvCstBndMbdCd,jdbcType=VARCHAR}
        ,#{dlvComCd,jdbcType=VARCHAR}
        ,#{dmstcWaybilNo,jdbcType=VARCHAR}
        ,#{dmstcWaybilNoRegDt,jdbcType=TIMESTAMP}
        ,#{ovseaWaybilNo,jdbcType=VARCHAR}
        ,#{ovseaWaybilNoRegDt,jdbcType=TIMESTAMP}
        ,#{cvnstorHdryAprvNo,jdbcType=VARCHAR}
        ,#{crncyCd,jdbcType=VARCHAR}
        ,#{stdrCrncyAmt,jdbcType=NUMERIC}
        ,#{payExchgRtCrncyAmt,jdbcType=NUMERIC}
        ,#{realityDlvCst,jdbcType=NUMERIC}
        ,#{plcDlvCst,jdbcType=NUMERIC}
        ,#{cnclDlvCst,jdbcType=NUMERIC}
        ,#{rtgodDlvCst,jdbcType=NUMERIC}
        ,#{exchgDlvCst,jdbcType=NUMERIC}
        ,#{dlvCstCpnDcAmt,jdbcType=NUMERIC}
        ,#{waybilNoErpTrnsmisCd,jdbcType=VARCHAR}
        ,#{waybilNoErpTrnsmisErrCont,jdbcType=VARCHAR}
        ,#{waybilNoErpTrnsmisDt,jdbcType=TIMESTAMP}
        ,#{dlvComTrnsmisTgtYn,jdbcType=VARCHAR}
        ,#{dlvComTrnsmisYn,jdbcType=VARCHAR}
        ,#{dlvComTrnsmisDt,jdbcType=TIMESTAMP}
        ,#{mailSndYn,jdbcType=VARCHAR}
        ,#{regtrId,jdbcType=VARCHAR}
        ,#{udterId,jdbcType=VARCHAR}
        ,SYSDATE
        ,SYSDATE
        )
    </insert>

    <insert id="insertLgsRtrvlDrctGodHist" parameterType="lgsRtrvlDrctGodHist">
        INSERT /* com.plgrim.ncp.base.repository.lgs.insertLgsRtrvlDrctGodHist jackie 20150616 */
        INTO LGS_RTRVL_DRCT_GOD_HIST
        (
        RTRVL_DRCT_GOD_NO
        ,HIST_TURN
        ,ORD_NO
        ,CLM_NO
        ,GFT_YN
        ,CLM_WRHS_GOD_TURN
        ,DLIVY_DRCT_GOD_NO
        ,DLV_PCUPSP_TURN
        ,DLV_TURN
        ,RTRVL_SHOP_ID
        ,ACMTL_GOD_WT
        ,ACMTL_GOD_VOL
        ,LGS_ITM_YN
        ,RTRVL_DRCT_TGT_YN
        ,RTRVL_DRCT_YN
        ,RTRVL_DRCT_GRP_DGRE
        ,RTRVL_DRCT_USER_GRP_DGRE
        ,RTRVL_DRCT_COUNT
        ,RTRVL_DRCT_TP_CD
        ,RTRVL_DRCT_DT
        ,RTRVL_DRCT_QTY
        ,RTRVL_DRCT_WTHDRAW_QTY
        ,RTRVL_DRCT_WTHDRAW_DT
        ,RTRVL_STAT_CD
        ,WRHS_COMPT_DT
        ,RTRVL_COMPT_DT
        ,RTRVL_GOD_STAT_CD
        ,RTRVL_GOD_PRCS_COMPT_YN
        ,REPAIR_RCEPT_SN
        ,BADN_REQEST_CONT
        ,HDRY_COM_TRNSMIS_TGT_YN
        ,HDRY_COM_TRNSMIS_YN
        ,HDRY_COM_TRNSMIS_DT
        ,HDRY_COM_KEY
        ,ERP_TRNSMIS_YN
        ,ERP_TRNSMIS_DT
        ,ERP_CNFIRM_YN
        ,ERP_CNFIRM_DT
        ,ERP_INV_TRNSMIS_SECT_CD
        ,ERP_INV_TRNSMIS_DT
        ,RTGODCST_CAL_SECT_CD
        ,RTGODCST_CAL_AMT
        ,REGTR_ID
        ,UDTER_ID
        ,REG_DT
        ,UDT_DT
        )
        VALUES
        (
        #{rtrvlDrctGodNo,jdbcType=VARCHAR}
        ,#{histTurn,jdbcType=NUMERIC}
        ,#{ordNo,jdbcType=VARCHAR}
        ,#{clmNo,jdbcType=VARCHAR}
        ,#{gftYn,jdbcType=VARCHAR}
        ,#{clmWrhsGodTurn,jdbcType=NUMERIC}
        ,#{dlivyDrctGodNo,jdbcType=VARCHAR}
        ,#{dlvPcupspTurn,jdbcType=NUMERIC}
        ,#{dlvTurn,jdbcType=NUMERIC}
        ,#{rtrvlShopId,jdbcType=VARCHAR}
        ,#{acmtlGodWt,jdbcType=NUMERIC}
        ,#{acmtlGodVol,jdbcType=NUMERIC}
        ,#{lgsItmYn,jdbcType=VARCHAR}
        ,#{rtrvlDrctTgtYn,jdbcType=VARCHAR}
        ,#{rtrvlDrctYn,jdbcType=VARCHAR}
        ,#{rtrvlDrctGrpDgre,jdbcType=NUMERIC}
        ,#{rtrvlDrctUserGrpDgre,jdbcType=NUMERIC}
        ,#{rtrvlDrctCount,jdbcType=NUMERIC}
        ,#{rtrvlDrctTpCd,jdbcType=VARCHAR}
        ,#{rtrvlDrctDt,jdbcType=TIMESTAMP}
        ,#{rtrvlDrctQty,jdbcType=NUMERIC}
        ,#{rtrvlDrctWthdrawQty,jdbcType=NUMERIC}
        ,#{rtrvlDrctWthdrawDt,jdbcType=TIMESTAMP}
        ,#{rtrvlStatCd,jdbcType=VARCHAR}
        ,#{wrhsComptDt,jdbcType=TIMESTAMP}
        ,#{rtrvlComptDt,jdbcType=TIMESTAMP}
        ,#{rtrvlGodStatCd,jdbcType=VARCHAR}
        ,#{rtrvlGodPrcsComptYn,jdbcType=VARCHAR}
        ,#{repairRceptSn,jdbcType=NUMERIC}
        ,#{badnReqestCont,jdbcType=VARCHAR}
        ,#{hdryComTrnsmisTgtYn,jdbcType=VARCHAR}
        ,#{hdryComTrnsmisYn,jdbcType=CHAR}
        ,#{hdryComTrnsmisDt,jdbcType=CHAR}
        ,#{hdryComKey,jdbcType=VARCHAR}
        ,#{erpTrnsmisYn,jdbcType=VARCHAR}
        ,#{erpTrnsmisDt,jdbcType=TIMESTAMP}
        ,#{erpCnfirmYn,jdbcType=VARCHAR}
        ,#{erpCnfirmDt,jdbcType=TIMESTAMP}
        ,#{erpInvTrnsmisSectCd,jdbcType=VARCHAR}
        ,#{erpInvTrnsmisDt,jdbcType=TIMESTAMP}
        ,#{rtgodcstCalSectCd,jdbcType=VARCHAR}
        ,#{rtgodcstCalAmt,jdbcType=NUMERIC}
        ,#{regtrId,jdbcType=VARCHAR}
        ,#{udterId,jdbcType=VARCHAR}
        ,SYSDATE
        ,SYSDATE
        )
    </insert>

    <insert id="insertLgsDlivyDrctGodHist" parameterType="lgsDlivyDrctGodHist">
        INSERT /* com.plgrim.ncp.base.repository.lgs.insertLgsDlivyDrctGodHist jackie 20150601 */
        INTO LGS_DLIVY_DRCT_GOD_HIST
        (
        DLIVY_DRCT_GOD_NO
        ,HIST_TURN
        ,ORD_NO
        ,ORD_GOD_TURN
        ,PCKAGE_GOD_TURN
        ,GFT_YN
        ,DLV_PCUPSP_TURN
        ,DLV_TURN
        ,DLV_SHOP_ID
        ,DLIVY_SHOP_ID
        ,ACMTL_GOD_VOL
        ,ACMTL_GOD_WT
        ,LGS_ITM_YN
        ,DLIVY_DRCT_TGT_YN
        ,DLIVY_DRCT_YN
        ,DLIVY_DRCT_GRP_DGRE
        ,DLIVY_DRCT_USER_GRP_DGRE
        ,DLIVY_DRCT_COUNT
        ,DLIVY_DRCT_TP_CD
        ,DLIVY_DRCT_DT
        ,DLIVY_DRCT_QTY
        ,DLIVY_DRCT_CNCL_QTY
        ,DLIVY_DRCT_CNCL_DT
        ,DLV_STAT_CD
        ,SHTG_QTY
        ,SHTG_DT
        ,SHTG_DCSN_YN
        ,SHTG_DCSN_DT
        ,DLIVY_COMPT_QTY
        ,DLIVY_COMPT_DT
        ,DLV_COMPT_DT
        ,DLIVY_DRCT_GOD_MEMO_CONT
        ,RCPTFR_NO
        ,RESVE_RCPTFR_CREAT_YN
        ,RESVE_RCPTFR_CREAT_DT
        ,RESVE_RCPTFR_DLIVY_YN
        ,RESVE_RCPTFR_DLIVY_DT
        ,RESVE_RCPTFR_DCSN_YN
        ,RESVE_RCPTFR_DCSN_DT
        ,ERP_RESVE_RCPTFR_CREAT_CNT
        ,ERP_RESVE_RCPTFR_CREAT_YN
        ,ERP_RESVE_RCPTFR_CREAT_DT
        ,ERP_RESVE_RCPTFR_RECREAT_YN
        ,ERP_RESVE_RCPTFR_RECREAT_DT
        ,ERP_RESVE_RCPTFR_CNCL_YN
        ,ERP_RESVE_RCPTFR_CNCL_DT
        ,INV_APL_YN
        ,CNTR_DLIVY_CNFIRM_YN
        ,CNTR_DLIVY_CNFIRM_DT
        ,P_STO_NO
        ,S_STO_NO
        ,S_DOC_NO
        ,REGTR_ID
        ,UDTER_ID
        ,REG_DT
        ,UDT_DT
        )
        VALUES
        (
        #{dlivyDrctGodNo,jdbcType=VARCHAR}
        ,#{histTurn,jdbcType=NUMERIC}
        ,#{ordNo,jdbcType=VARCHAR}
        ,#{ordGodTurn,jdbcType=NUMERIC}
        ,#{pckageGodTurn,jdbcType=NUMERIC}
        ,#{gftYn,jdbcType=VARCHAR}
        ,#{dlvPcupspTurn,jdbcType=NUMERIC}
        ,#{dlvTurn,jdbcType=NUMERIC}
        ,#{dlvShopId,jdbcType=VARCHAR}
        ,#{dlivyShopId,jdbcType=VARCHAR}
        ,#{acmtlGodVol,jdbcType=NUMERIC}
        ,#{acmtlGodWt,jdbcType=NUMERIC}
        ,#{lgsItmYn,jdbcType=VARCHAR}
        ,#{dlivyDrctTgtYn,jdbcType=VARCHAR}
        ,#{dlivyDrctYn,jdbcType=VARCHAR}
        ,#{dlivyDrctGrpDgre,jdbcType=NUMERIC}
        ,#{dlivyDrctUserGrpDgre,jdbcType=NUMERIC}
        ,#{dlivyDrctCount,jdbcType=NUMERIC}
        ,#{dlivyDrctTpCd,jdbcType=VARCHAR}
        ,#{dlivyDrctDt,jdbcType=TIMESTAMP}
        ,#{dlivyDrctQty,jdbcType=NUMERIC}
        ,#{dlivyDrctCnclQty,jdbcType=NUMERIC}
        ,#{dlivyDrctCnclDt,jdbcType=TIMESTAMP}
        ,#{dlvStatCd,jdbcType=VARCHAR}
        ,#{shtgQty,jdbcType=NUMERIC}
        ,#{shtgDt,jdbcType=TIMESTAMP}
        ,#{shtgDcsnYn,jdbcType=VARCHAR}
        ,#{shtgDcsnDt,jdbcType=TIMESTAMP}
        ,#{dlivyComptQty,jdbcType=NUMERIC}
        ,#{dlivyComptDt,jdbcType=TIMESTAMP}
        ,#{dlvComptDt,jdbcType=TIMESTAMP}
        ,#{dlivyDrctGodMemoCont,jdbcType=VARCHAR}
        ,#{rcptfrNo,jdbcType=VARCHAR}
        ,#{resveRcptfrCreatYn,jdbcType=VARCHAR}
        ,#{resveRcptfrCreatDt,jdbcType=TIMESTAMP}
        ,#{resveRcptfrDlivyYn,jdbcType=VARCHAR}
        ,#{resveRcptfrDlivyDt,jdbcType=TIMESTAMP}
        ,#{resveRcptfrDcsnYn,jdbcType=VARCHAR}
        ,#{resveRcptfrDcsnDt,jdbcType=TIMESTAMP}
        ,#{erpResveRcptfrCreatCnt,jdbcType=NUMERIC}
        ,#{erpResveRcptfrCreatYn,jdbcType=VARCHAR}
        ,#{erpResveRcptfrCreatDt,jdbcType=TIMESTAMP}
        ,#{erpResveRcptfrRecreatYn,jdbcType=VARCHAR}
        ,#{erpResveRcptfrRecreatDt,jdbcType=TIMESTAMP}
        ,#{erpResveRcptfrCnclYn,jdbcType=VARCHAR}
        ,#{erpResveRcptfrCnclDt,jdbcType=TIMESTAMP}
        ,#{invAplYn,jdbcType=VARCHAR}
        ,#{cntrDlivyCnfirmYn,jdbcType=VARCHAR}
        ,#{cntrDlivyCnfirmDt,jdbcType=TIMESTAMP}
        ,#{pStoNo,jdbcType=VARCHAR}
        ,#{sStoNo,jdbcType=VARCHAR}
        ,#{sDocNo,jdbcType=VARCHAR}
        ,#{regtrId,jdbcType=VARCHAR}
        ,#{udterId,jdbcType=VARCHAR}
        ,SYSDATE
        ,SYSDATE
        )
    </insert>


    <select id="selectLgsRtrvlDrctGodSwList" parameterType="lgsRtrvlDrctGod" resultType="lgsRtrvlDrctGod">
        SELECT /* selectLgsRtrvlDrctGodSwList */
                RTRVL_DRCT_GOD_NO
               ,ORD_NO
               ,CLM_NO
               ,GFT_YN
               ,CLM_WRHS_GOD_TURN
               ,DLIVY_DRCT_GOD_NO
               ,DLV_PCUPSP_TURN
               ,DLV_TURN
               ,RTRVL_SHOP_ID
               ,ACMTL_GOD_WT
               ,ACMTL_GOD_VOL
               ,LGS_ITM_YN
               ,RTRVL_DRCT_TGT_YN
               ,RTRVL_DRCT_YN
               ,RTRVL_DRCT_GRP_DGRE
               ,RTRVL_DRCT_COUNT
               ,RTRVL_DRCT_TP_CD
               ,RTRVL_DRCT_DT
               ,RTRVL_DRCT_QTY
               ,RTRVL_DRCT_WTHDRAW_QTY
               ,RTRVL_DRCT_WTHDRAW_DT
               ,RTRVL_STAT_CD
               ,WRHS_COMPT_DT
               ,RTRVL_COMPT_DT
               ,RTRVL_GOD_STAT_CD
               ,RTRVL_GOD_PRCS_COMPT_YN
               ,BADN_REQEST_CONT
               ,HDRY_COM_TRNSMIS_TGT_YN
               ,HDRY_COM_TRNSMIS_YN
               ,HDRY_COM_TRNSMIS_DT
               ,HDRY_COM_KEY
               ,HDRY_COM_WRHS_YN
               ,HDRY_COM_WRHS_DT
               ,ERP_TRNSMIS_YN
               ,ERP_TRNSMIS_DT
               ,ERP_CNFIRM_YN
               ,ERP_CNFIRM_DT
               ,ERP_INV_TRNSMIS_SECT_CD
               ,ERP_INV_TRNSMIS_DT
               ,RTGODCST_CAL_SECT_CD
               ,RTGODCST_CAL_AMT
               ,REGTR_ID
               ,REG_DT
               ,UDTER_ID
               ,UDT_DT
        FROM    LGS_RTRVL_DRCT_GOD t
        WHERE   ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
        AND     DLV_PCUPSP_TURN = #{dlvPcupspTurn,jdbcType=VARCHAR}
        AND     CLM_WRHS_GOD_TURN = #{clmWrhsGodTurn,jdbcType=VARCHAR}

    </select>

    <select id="selectInfOrdGodErpDstbSwList" parameterType="infOrdGodErpDstb" resultType="infOrdGodErpDstb">
        SELECT /* selectInfOrdGodErpDstbSwList */
                t.ORD_NO
               ,t.ORD_GOD_TURN
               ,t.QTY_TURN
               ,t.ORD_GOD_QTY_TURN
               ,t.SKU_NO
               ,t.CRNCY_CD
               ,t.STDR_CRNCY_UNT_PRC
               ,t.PAY_EXCHG_RT_CRNCY_UNT_PRC
               ,t.RTL_PRC
               ,t.SALE_UNT_PRC
               ,t.WEB_DC_UNT_PRC
               ,t.EMP_DC_UNT_PRC
               ,t.GOD_DC_UNT_PRC
               ,t.BUNDLE_DC_UNT_PRC
               ,t.CRS_DC_UNT_PRC
               ,t.GOD_CPN_DC_UNT_PRC
               ,t.BSK_CPN_DC_UNT_PRC
               ,t.IMDTL_DC_UNT_PRC
               ,t.UNITY_PNT_USE_UNT_PRC
               ,t.EVT_PNT_USE_UNT_PRC
               ,t.WEBPNT_USE_UNT_PRC
               ,t.UNITY_PNT_ACCML_UNT_PRC
               ,t.EVT_PNT_ACCML_UNT_PRC
               ,t.WEBPNT_ACCML_UNT_PRC
               ,t.CLM_NO
               ,t.CLM_WRHS_GOD_TURN
               ,t.CLM_ERP_INTRLCK_YN
               ,t.CLM_ERP_INTRLCK_DT
               ,t.CLM_PRCS_ERR_CONT
               ,t.DRT_EXCHG_QTY_TURN
               ,t.DRT_EXCHG_STO_NO
               ,t.OPT_MOD_NO
               ,t.CNTR_DLIVY_CNFIRM_YN
               ,t.CNTR_DLIVY_CNFIRM_DT
               ,t.DLIVY_DRCT_GOD_NO
               ,t.DLIVY_DRCT_TGT_YN
               ,t.DLIVY_DRCT_YN
               ,t.DLIVY_DRCT_DT
               ,t.RCPTFR_NO
               ,t.RESVE_RCPTFR_CREAT_YN
               ,t.RESVE_RCPTFR_CREAT_DT
               ,t.RESVE_RCPTFR_DLIVY_YN
               ,t.RESVE_RCPTFR_DLIVY_DT
               ,t.RESVE_RCPTFR_DCSN_YN
               ,t.RESVE_RCPTFR_DCSN_DT
               ,t.RTGOD_RCPTFR_NO
               ,t.RTGOD_RCPTFR_CREAT_YN
               ,t.RTGOD_RCPTFR_CREAT_DT
               ,t.ERP_RESVE_RCPTFR_NO
               ,t.ERP_RESVE_CNCL_RCPTFR_NO
               ,t.ERP_RESVE_RCPTFR_CREAT_CNT
               ,t.ERP_RESVE_RCPTFR_CREAT_YN
               ,t.ERP_RESVE_RCPTFR_CREAT_DT
               ,t.ERP_RESVE_RCPTFR_RECREAT_YN
               ,t.ERP_RESVE_RCPTFR_RECREAT_DT
               ,t.ERP_RESVE_RCPTFR_CNCL_YN
               ,t.ERP_RESVE_RCPTFR_CNCL_DT
               ,iogsdr.REPAIR_NO
               ,iogsdr.REPAIR_COMPT_YN
               ,iogsdr.REPAIR_COMPT_CD
               ,iogsdr.REPAIR_CONT
               ,iogsdr.BADN_GOD_AFF_COM_CNFIRM_DT
               ,iogsdr.BADN_GOD_CNFIRM_ADMIN_ID
               ,iogsdr.REPAIR_TP_CD
               ,t.RTGOD_SHOP_INV_MVMT_YN
               ,t.RTGOD_SHOP_INV_MVMT_DT
               ,t.P_STO_NO
               ,t.S_STO_NO
               ,t.S_DOC_NO
               ,t.CP_ERR_YN
               ,t.CP_ERR_DT
               ,t.CP_ERR_CONT
               ,t.ST_ERR_YN
               ,t.ST_ERR_DT
               ,t.ST_ERR_CONT
               ,t.DOCNO_A
               ,t.DOCNO_B
               ,t.DOCNO_C
               ,t.DOCNO_D
               ,t.DOCNO_E
               ,t.DOCNO_F
               ,t.DOCNO_G
               ,t.DOCNO_H
               ,t.DOCNO_J
               ,t.DOCNO_K
               ,t.ERP_GOD_SN
               ,t.ERP_GOD_SN_MOD_YN
               ,t.ERP_GOD_SN_MOD_DT
               ,t.DLIVY_ACPT_YN
               ,t.WRHS_ACPT_YN
        FROM    INF_ORD_GOD_ERP_DSTB t
                LEFT OUTER JOIN INF_ORD_GOD_ERP_DSTB_REPAIR iogsdr
                ON t.ORD_NO = iogsdr.ORD_NO and t.ORD_GOD_TURN = iogsdr.ORD_GOD_TURN and t.QTY_TURN = iogsdr.QTY_TURN
        WHERE   1 = 1
        AND     t.CLM_NO = #{clmNo,jdbcType=VARCHAR}
        AND     t.CLM_WRHS_GOD_TURN = #{clmWrhsGodTurn,jdbcType=NUMERIC}
    </select>

    <update id="updateInfOrdGodErpDstbSw" parameterType="infOrdGodErpDstb">
        UPDATE
               inf_ord_god_erp_dstb
           SET clm_no                   = #{clmNo,jdbcType=VARCHAR}
             , clm_wrhs_god_turn        = #{clmWrhsGodTurn,jdbcType=NUMERIC}
             , udt_dt= SYSDATE
         WHERE 1=1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     ORD_GOD_TURN = #{ordGodTurn,jdbcType=NUMERIC}
        AND     QTY_TURN = #{qtyTurn,jdbcType=NUMERIC}
    </update>


     <select id="selectOrdClmGodCnncSw" parameterType="ordClmGodCnnc" resultType="ordClmGodCnnc">
        SELECT
               ocgc.ord_no
             , ocgc.ord_god_turn
             , ocgc.clm_no
             , ocgc.clm_wrhs_god_turn
             , ocgc.god_cnnc_tp_cd
             , ocgc.ord_clm_qty
             , ocgc.ord_clm_wthdraw_qty
             , ocgc.regtr_id
             , ocgc.reg_dt
             , ocgc.udter_id
             , ocgc.udt_dt
          FROM ord_clm_god_cnnc ocgc
         WHERE 1 = 1
           AND ocgc.clm_no              = #{clmNo,jdbcType=VARCHAR}
           AND ocgc.clm_wrhs_god_turn   = #{clmWrhsGodTurn,jdbcType=NUMERIC}
           AND ocgc.god_cnnc_tp_cd      = 'WRHS_GOD_CNNC'
    </select>

    <update id="updateClmSumry" parameterType="String">
		UPDATE clm /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.updateClmSumry][클레임 테이블 sumry 저장][sangsic] */
    		  SET GOD_SUMRY	= (SELECT
													(CASE WHEN clmsum.clm_qty > 1 THEN clmsum.god_nm || ' 외' || (clmsum.clm_qty - 1)
          											  ELSE clmsum.god_nm END) AS clmGodNm
  										  FROM    CLM t
  											 left outer JOIN (SELECT clm_no
																	        , MAX(god_nm) god_nm
																	        , SUM(NVL(CLM_QTY,0)) AS CLM_QTY
																	        , SUM(NVL(CLM_WTHDRAW_QTY,0)) AS CLM_WTHDRAW_QTY
																	      FROM clm_wrhs_god GROUP BY clm_no) clmsum ON (clmsum.clm_no = t.clm_no)
																	  WHERE   1 = 1
																	    AND t.clm_no = #{clmNo})
        WHERE 1 = 1
            AND CLM_NO = #{clmNo}
	</update>

    <update id="updateClmSumryForRepair" parameterType="String">
		UPDATE clm /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.updateClmSumryForRepair][클레임 테이블 sumry 저장 - repair][dian] */
    		  SET GOD_SUMRY	= (SELECT
													(CASE WHEN clmsum.clm_qty > 1 THEN clmsum.god_nm || ' 외' || (clmsum.clm_qty - 1) ||'건'
          											  ELSE clmsum.god_nm END) AS clmGodNm
  										  FROM    CLM t
  											 left outer JOIN (SELECT clm_no
																	        , MAX(god_nm) god_nm
																	        , SUM(NVL(CLM_QTY,0)) AS CLM_QTY
																	        , SUM(NVL(CLM_WTHDRAW_QTY,0)) AS CLM_WTHDRAW_QTY
																	      FROM clm_wrhs_god GROUP BY clm_no) clmsum ON (clmsum.clm_no = t.clm_no)
																	  WHERE   1 = 1
																	    AND t.clm_no = #{clmNo})
        WHERE 1 = 1
            AND CLM_NO = #{clmNo}
	</update>

	<select id="selectClmWrhsGodCountForTempDel" parameterType="String" resultType="int" >
		SELECT /* [com.plgrim.ncp.biz.claim.return.xml][selectClmWrhsGodCountForTempDel][임시삭감복원처리를위한클레임입고상품수량조회] */
			COUNT(1)
		FROM (
			SELECT clm_no, clm_wrhs_god_turn
			FROM inf_ord_god_erp_dstb
			WHERE clm_no = #{clmNo,jdbcType=VARCHAR}
			AND unity_pnt_accml_unt_prc > 0
			GROUP BY clm_no, clm_wrhs_god_turn
		)
	</select>

    <select id="selectRepairClmWrhsGodCount" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="int" >
		SELECT /* [com.plgrim.ncp.biz.claim.return.xml][selectClmWrhsGodCount][클레임입고상품수량조회] */
			clm_qty - clm_wthdraw_qty AS clmWthdrawPosibleQty
		FROM clm_wrhs_god
		WHERE clm_no = #{clmNo,jdbcType=VARCHAR}
		  AND clm_wrhs_god_turn = #{clmWrhsGodTurn,jdbcType=NUMERIC}
	</select>

    <select id="selectClmWrhsGodCount" parameterType="String" resultType="int" >
		SELECT /* [com.plgrim.ncp.biz.claim.return.xml][selectClmWrhsGodCount][클레임입고상품수량조회] */
			COUNT(1)
		FROM clm_wrhs_god
		WHERE clm_no = #{clmNo,jdbcType=VARCHAR}
	</select>

    <select id="selectBaseDlvComCd" parameterType="String" resultType="String">
        SELECT DLV_COM_CD
          FROM COM_DMSTC_DLV_CST_PLC
         WHERE COM_ID='M00'
           AND BASE_DLV_CST_PLC_YN='Y'
           AND OVSEA_DLV_DMSTC_DLV_CST_PLC_YN='N'
           AND USE_YN='Y'
           AND DLV_MN_CD='APPN_HDRY'
		   AND MALL_ID = #{mallId, jdbcType=VARCHAR}
    </select>

    <resultMap id="dlvCom" type="map">
        <result property="dlvComCd"            column="DlV_COM_CD"              javaType="String"   />  <!-- 클레임번호                      -->
        <result property="cdNm"            column="CD_NM"              javaType="String"   />  <!-- 주문번호                       -->
    </resultMap>

    <select id="selectBaseDlvCom" parameterType="com.plgrim.ncp.base.entities.datasource1.lgs.LgsDlv" resultMap="dlvCom">
        SELECT cddcp.dlv_com_cd
               , msc.cd_nm
          FROM COM_DMSTC_DLV_CST_PLC cddcp
          JOIN MV_SYS_CD msc
            ON CDDCP.DLV_COM_CD = msc.CD
           AND MSC.UPPER_CD='DLV_COM'
           AND MSC.LANG_CD=#{lang,jdbcType=VARCHAR}
         WHERE CDDCP.COM_ID='M00'
           AND CDDCP.BASE_DLV_CST_PLC_YN='Y'
           AND CDDCP.OVSEA_DLV_DMSTC_DLV_CST_PLC_YN='N'
           AND CDDCP.USE_YN='Y'
           AND CDDCP.DLV_MN_CD='APPN_HDRY'
           AND CDDCP.MALL_ID=NVL(#{mallId,jdbcType=VARCHAR}, 'DXM')
    </select>

    <select id="selectclmErpTrnsmis" parameterType="com.plgrim.ncp.biz.claim.data.ClmErpTrnsmis" resultType="com.plgrim.ncp.biz.claim.data.ClmErpTrnsmis">
		SELECT /* [com.plgrim.ncp.biz.claim.return.xml][selectclmErpTrnsmis][클레임erp 전송 테이블 조회] */
                ORD_NO
               ,CLM_NO
               ,CLM_ERP_TRNSMIS_TP_CD
               ,ERP_TRNSMIS_CD
               ,ERP_TRNSMIS_DT
               ,REGTR_ID
               ,REG_DT
               ,UDTER_ID
               ,UDT_DT
        FROM    CLM_ERP_TRNSMIS t
        WHERE   1 = 1
        AND     ORD_NO = #{ordNo,jdbcType=VARCHAR}
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
        AND     CLM_ERP_TRNSMIS_TP_CD = #{clmErpTrnsmisTpCd,jdbcType=VARCHAR}
    </select>



	<!--<select id="selectReapirTargetList" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.ClmWrhsGodExtend" resultType="com.plgrim.ncp.interfaces.erp.jco.claim.data.RepairReceptionSDO">-->
		<!--SELECT-->
				  <!--iogsdr.clm_no AS onRepairNo-->
				<!--, iogsdr.qty_turn AS onRepairNoSeq-->
		  <!--FROM inf_ord_god_erp_dstb_repair iogsdr-->
		 <!--WHERE 1 = 1-->
		   <!--AND iogsdr.clm_no = #{clmNo,jdbcType=VARCHAR}-->
		   <!--AND iogsdr.clm_wrhs_god_turn = #{clmWrhsGodTurn,jdbcType=VARCHAR}-->
		   <!--AND iogsdr.repair_cncl_dt is null-->
	<!--</select>-->


	<select id="selectRepairGod" parameterType="String" resultType="com.plgrim.ncp.biz.claim.result.RepairResult" >
		SELECT	/* [claim.return.xml][selectRepairGod][수선 상품][YOON] */
				  cwg.clm_wrhs_god_turn               AS clmWrhsGodTurn
				, NVL(lddg.dlivy_drct_qty, 0)         AS dlivyQty
				, P.dlv_pcupsp_turn AS dlvPcupspTurnWthdraw
				, lrdg.dlv_turn AS dlvTurnWthdraw
				, lrdg.rtrvl_drct_god_no AS rtrvlDrctGodNo
				, lrdg.dmstc_waybil_no AS waybilNoWthdraw
				, d.dlv_pcupsp_turn AS dlvPcupspTurnDlivyWthdraw
				, og.ord_god_turn AS ordGodTurn
				, lddg.dlv_turn AS dlvTurnDlivyWthdraw
				, lddg.dmstc_waybil_no AS waybilNoDlivyWthdraw
				, lddg.ord_god_turn AS ordGodTurnDlivyWthdraw
				, lddg.dlivy_drct_god_no AS dlivyDrctGodNo
				, og.ord_no AS ordNo
				, cwg.clm_no AS clmNo
				, iogsdr.qty_turn AS qtyTurn
				, iogsd.wrhs_acpt_yn AS wrhsAcptYn
				, iogsdr.repair_compt_cd AS repairComptCd
				, iogsdr.repair_rcept_shop_id AS repairRceptShopId
				, iogsdr.repair_rcept_dt AS repairRceptDt
				, iogsdr.repair_cncl_dt AS repairCnclDt
		FROM LGS_DLVSP p
		JOIN (SELECT
					  ld.ord_no
					, ld.dlv_pcupsp_turn
					, ld.clm_no
					, ld.dlv_mn_cd
			  	FROM lgs_dlv ld
			   WHERE 1 = 1
				 AND ld.clm_no = #{clmNo,jdbcType=VARCHAR}
			) lp ON lp.ord_no = P.ord_no AND lp.dlv_pcupsp_turn = P.dlv_pcupsp_turn AND lp.clm_no = P.clm_no
		JOIN LGS_DLVSP d ON p.clm_no = d.clm_no
		JOIN (SELECT
					  ld.ord_no
					, ld.dlv_pcupsp_turn
					, ld.clm_no
					, ld.dlv_mn_cd
          			, ld.DLV_TURN
          			, ld.DMSTC_WAYBIL_NO
				FROM lgs_dlv ld
				WHERE 1 = 1
				AND ld.clm_no = #{clmNo,jdbcType=VARCHAR}
			) ld ON ld.ord_no = d.ord_no AND ld.dlv_pcupsp_turn = d.dlv_pcupsp_turn AND ld.clm_no = d.clm_no
		JOIN ORD_CLM_GOD_CNNC ogc ON ogc.clm_no = p.clm_no AND ogc.ord_no = p.ord_no
		JOIN CLM_WRHS_GOD cwg ON cwg.clm_no = ogc.clm_no AND cwg.ord_no = ogc.ord_no AND cwg.clm_wrhs_god_turn = ogc.clm_wrhs_god_turn AND cwg.dlv_pcupsp_turn = p.dlv_pcupsp_turn
		JOIN ORD_GOD og ON og.ord_no = ogc.ord_no AND og.ord_god_turn = ogc.ord_god_turn AND og.dlv_pcupsp_turn = d.dlv_pcupsp_turn
		JOIN (SELECT
					  lrdg.ord_no
					, lrdg.RTRVL_DRCT_GOD_NO
					, lrdg.CLM_NO
					, lrdg.CLM_WRHS_GOD_TURN
					, lrdg.DLIVY_DRCT_GOD_NO
					, lrdg.DLV_PCUPSP_TURN
					, lrdg.rtrvl_stat_cd
					, NVL(lrdg.rtrvl_drct_qty, 0)         AS rtrvl_drct_qty
					, NVL(lrdg.rtrvl_drct_wthdraw_qty, 0) AS rtrvl_drct_wthdraw_qty
					, lrdg.wrhs_compt_dt
					, lrdg.rtrvl_compt_dt
					, LD.DMSTC_WAYBIL_NO
					, ld.cvnstor_hdry_aprv_no
					, ld.dlv_turn
				FROM ord_clm_god_cnnc ocgc
				JOIN lgs_rtrvl_drct_god lrdg ON ocgc.ord_no = lrdg.ord_no AND OCGC.CLM_NO = lrdg.clm_no AND ocgc.clm_wrhs_god_turn = lrdg.clm_wrhs_god_turn
				JOIN lgs_dlv ld ON lrdg.ORD_NO = LD.ORD_NO AND lrdg.DLV_PCUPSP_TURN = LD.DLV_PCUPSP_TURN AND lrdg.DLV_TURN = LD.DLV_TURN
				WHERE ocgc.clm_no = #{clmNo,jdbcType=VARCHAR}
				AND ocgc.god_cnnc_tp_cd = 'WRHS_GOD_CNNC'
			) lrdg ON lrdg.clm_no = cwg.clm_no AND lrdg.ord_no = cwg.ord_no AND lrdg.clm_wrhs_god_turn = cwg.clm_wrhs_god_turn
		JOIN (SELECT
					  lddg.ord_no
					, ocgc.ord_god_turn
					, lddg.dlv_shop_id
					, lddg.dlv_stat_cd
					, lddg.shtg_dcsn_yn
					, NVL(lddg.dlivy_drct_qty, 0) AS dlivy_drct_qty
					, lddg.dlivy_drct_dt
					, lddg.dlivy_compt_dt
					, lddg.dlivy_drct_god_no
					, ld.DMSTC_WAYBIL_NO
					, ld.dlv_turn
		FROM ord_clm_god_cnnc ocgc
				JOIN lgs_dlivy_drct_god lddg ON ocgc.ord_no = lddg.ord_no AND ocgc.ord_god_turn = lddg.ord_god_turn
				JOIN lgs_dlv ld
				ON LDDG.ORD_NO = LD.ORD_NO AND LDDG.DLV_PCUPSP_TURN = LD.DLV_PCUPSP_TURN AND LDDG.DLV_TURN = LD.DLV_TURN
				WHERE ocgc.clm_no = #{clmNo,jdbcType=VARCHAR} AND ocgc.god_cnnc_tp_cd = 'DLIVY_GOD_CNNC'
       			) lddg ON lddg.ord_no = lrdg.ord_no AND og.ord_god_turn = lddg.ord_god_turn and ld.dlv_turn = lddg.DLV_TURN
		LEFT OUTER JOIN ORD_CPST_GOD_CNNC oc ON og.ord_no = oc.ord_no AND og.ord_god_turn = oc.ord_cpst_god_turn
		JOIN INF_ORD_GOD_ERP_DSTB iogsd ON ogc.ord_no = iogsd.ORD_NO AND ogc.CLM_NO = iogsd.CLM_NO and cwg.CLM_WRHS_GOD_TURN = iogsd.CLM_WRHS_GOD_TURN
		JOIN INF_ORD_GOD_ERP_DSTB_REPAIR iogsdr on iogsd.ORD_NO = iogsdr.ORD_NO AND iogsd.ORD_GOD_TURN = iogsdr.ORD_GOD_TURN AND iogsd.QTY_TURN = iogsdr.QTY_TURN
		WHERE 1 = 1
		  AND iogsdr.CLM_NO = #{clmNo}
		  AND iogsdr.QTY_TURN =#{qtyTurn}
	</select>

	<update id="updateRepairClm" parameterType="com.plgrim.ncp.base.entities.datasource1.clm.Clm">
		UPDATE CLM /* [claim.return.xml[updateRepairClm][수선 클레임 상태 업데이트][YOON]*/
		SET UDT_DT = SYSDATE
		, UDTER_ID = #{udterId}
		<if test="@com.plgrim.ncp.framework.commons.StringService@isNotEmpty(clmStatCd)">
			, CLM_STAT_CD = #{clmStatCd}
			<if test="@com.plgrim.ncp.framework.commons.StringService@equalsIgnoreCase('RCEPT', clmStatCd)">
				, CLM.RCEPT_DT = SYSDATE
			</if>
			<if test="@com.plgrim.ncp.framework.commons.StringService@equalsIgnoreCase('COMPT', clmStatCd)">
				, COMPT_DT = SYSDATE
			</if>
		</if>
		WHERE 1 = 1
		AND CLM_NO = #{clmNo}
	</update>

	<update id="updateInfOrdGodErpDstb" parameterType="com.plgrim.ncp.base.entities.datasource1.inf.InfOrdGodErpDstb">
		UPDATE /* [claim.return.xml[updateInfOrdGodErpDstb][인터페이스 주문 상품 ERP 분배 수선 상태 업데이트][YOON]*/
				INF_ORD_GOD_ERP_DSTB
		SET		UDT_DT = SYSDATE
			  , UDTER_ID = #{udterId}
			  <if test="@com.plgrim.ncp.framework.commons.StringService@isNotEmpty(wrhsAcptYn)">
				  , WRHS_ACPT_YN = #{wrhsAcptYn}
			  </if>
		WHERE 	1 = 1
		AND 	CLM_NO = #{clmNo}
		AND 	QTY_TURN = #{qtyTurn}
		<if test="erpResveRcptfrNo != null and erpResveRcptfrNo != ''">
		AND		ERP_RESVE_RCPTFR_NO = #{erpResveRcptfrNo}
		</if>
	</update>

	<select id="selectRepairCnt" parameterType="com.plgrim.ncp.biz.claim.data.RepairDTO" resultType="com.plgrim.ncp.biz.claim.result.RepairResult">
		SELECT /* [claim.return.xml[selectRepairCnt][수선 입고검품 / 수선완료 수량 조회][YOON]*/
		        COUNT(*)      AS repairTotCnt	/* 수선 클레임 수량 */
		      , COUNT(CASE WHEN iogsdr.REPAIR_COMPT_CD = 'A15' THEN 1 END) AS repairComptCnt /* 수선 클레임 완료 수량 */
		      , COUNT(CASE WHEN iogsdr.CLM_WRHS_GOD_TURN = #{clmWrhsGodTurn} THEN 1 END) AS wrhsAcptCnt /* 입고상품 입고 전체 수량 */
		      , COUNT(CASE WHEN iogsd.CLM_WRHS_GOD_TURN = #{clmWrhsGodTurn} AND iogsd.WRHS_ACPT_YN = 'Y' THEN 1 END) AS wrhsAcptComptCnt /* 입소상품 입고 완료 수량 */
		  FROM  INF_ORD_GOD_ERP_DSTB iogsd
		  JOIN  INF_ORD_GOD_ERP_DSTB_REPAIR iogsdr
		    ON  iogsd.ORD_NO = iogsdr.ORD_NO AND iogsd.ORD_GOD_TURN = iogsdr.ORD_GOD_TURN AND iogsd.QTY_TURN = iogsdr.QTY_TURN
	     WHERE 1 = 1
	       AND iogsd.CLM_NO = #{clmNo}
	</select>

	<update id="updateRepairLgsRdg" parameterType="com.plgrim.ncp.biz.delivery.data.DeliveryOrderGoodDTO">
		UPDATE LGS_RTRVL_DRCT_GOD /* [claim.return.xml[updateRepairLgsRdg][수선 상품 회수상태 UPDATE][YOON]*/
		SET   udt_dt = SYSDATE
			, udter_id = #{udterId,jdbcType=VARCHAR}
			, rtrvl_stat_cd = #{rtrvlStatCd}
			, wrhs_compt_dt = SYSDATE
			, rtrvl_compt_dt = SYSDATE
		WHERE rtrvl_drct_god_no = #{rtrvlDrctGodNo,jdbcType=VARCHAR}
	</update>

	<!-- 원 물류출고지시상품 데이터 수정 :: 출고지시수량(원 출고지시 수량 - 신규 출고지시 수량) -->
	<update id="updateRepairLgsDdgInfo4DivWayBil" parameterType="com.plgrim.ncp.biz.delivery.data.DeliveryOrderGoodDTO">
		UPDATE LGS_DLIVY_DRCT_GOD /* [claim.return.xml[updateRepairLgsDdgInfo4DivWayBil][수선 상품 출고지시수량/배송완료 수량 UPDATE][YOON]*/
		SET udt_dt = SYSDATE
		, udter_id = #{udterId,jdbcType=VARCHAR}
		<if test="dlvTurn != null and dlvTurn != '' and dlvTurn != 0">
			, dlv_turn = #{dlvTurn,jdbcType=NUMERIC}
		</if>
		<if test="dlivyQty != null and dlivyQty != '' and dlivyQty != 0">
			, dlv_stat_cd = #{dlvStatCd}
			, dlivy_compt_qty	= CASE WHEN NVL(dlivy_drct_qty, 0) <![CDATA[>]]> NVL(dlivy_compt_qty, 0) + #{dlivyQty,jdbcType=NUMERIC}
									   THEN NVL(dlivy_compt_qty, 0) + #{dlivyQty,jdbcType=NUMERIC}
									   ELSE dlivy_drct_qty
								   END
			, dlivy_compt_dt = SYSDATE
			, dlv_compt_dt = SYSDATE
		</if>
		WHERE dlivy_drct_god_no = #{dlivyDrctGodNo,jdbcType=VARCHAR}
	</update>

	<insert id="insertRepairLgsRdgHist" parameterType="lgsRtrvlDrctGod">
		INSERT /* com.plgrim.ncp.base.repository.lgs.insertLgsRtrvlDrctGodHist yoon 20151123 */
		INTO LGS_RTRVL_DRCT_GOD_HIST
		(
		RTRVL_DRCT_GOD_NO
		,HIST_TURN
		,ORD_NO
		,CLM_NO
		,GFT_YN
		,CLM_WRHS_GOD_TURN
		,DLIVY_DRCT_GOD_NO
		,DLV_PCUPSP_TURN
		,DLV_TURN
		,RTRVL_SHOP_ID
		,ACMTL_GOD_WT
		,ACMTL_GOD_VOL
		,LGS_ITM_YN
		,RTRVL_DRCT_TGT_YN
		,RTRVL_DRCT_YN
		,RTRVL_DRCT_GRP_DGRE
		,RTRVL_DRCT_COUNT
		,RTRVL_DRCT_TP_CD
		,RTRVL_DRCT_DT
		,RTRVL_DRCT_QTY
		,RTRVL_DRCT_WTHDRAW_QTY
		,RTRVL_DRCT_WTHDRAW_DT
		,RTRVL_STAT_CD
		,WRHS_COMPT_DT
		,RTRVL_COMPT_DT
		,RTRVL_GOD_STAT_CD
		,RTRVL_GOD_PRCS_COMPT_YN
		,BADN_REQEST_CONT
		,HDRY_COM_TRNSMIS_TGT_YN
		,HDRY_COM_TRNSMIS_YN
		,HDRY_COM_TRNSMIS_DT
		,HDRY_COM_KEY
		,HDRY_COM_WRHS_YN
		,HDRY_COM_WRHS_DT
		,ERP_TRNSMIS_YN
		,ERP_TRNSMIS_DT
		,ERP_CNFIRM_YN
		,ERP_CNFIRM_DT
		,ERP_INV_TRNSMIS_SECT_CD
		,ERP_INV_TRNSMIS_DT
		,RTGODCST_CAL_SECT_CD
		,RTGODCST_CAL_AMT
		,RFD_DELAY_CD
		,RFD_DELAY_DT
		,RFD_DELAY_RESN_DSCR
		,REGTR_ID
		,UDTER_ID
		,REG_DT
		,UDT_DT
		)
		SELECT
			RTRVL_DRCT_GOD_NO
			,(SELECT /*+ INDEX_DESC(PK_LGS_RTRVL_DRCT_GOD_HIST) */
				NVL(MAX(hist_turn), 0) + 1
				FROM LGS_RTRVL_DRCT_GOD_HIST a
				WHERE a.RTRVL_DRCT_GOD_NO = lrdg.RTRVL_DRCT_GOD_NO)
			,ORD_NO
			,CLM_NO
			,GFT_YN
			,CLM_WRHS_GOD_TURN
			,DLIVY_DRCT_GOD_NO
			,DLV_PCUPSP_TURN
			,DLV_TURN
			,RTRVL_SHOP_ID
			,ACMTL_GOD_WT
			,ACMTL_GOD_VOL
			,LGS_ITM_YN
			,RTRVL_DRCT_TGT_YN
			,RTRVL_DRCT_YN
			,RTRVL_DRCT_GRP_DGRE
			,RTRVL_DRCT_COUNT
			,RTRVL_DRCT_TP_CD
			,RTRVL_DRCT_DT
			,RTRVL_DRCT_QTY
			,RTRVL_DRCT_WTHDRAW_QTY
			,RTRVL_DRCT_WTHDRAW_DT
			,RTRVL_STAT_CD
			,WRHS_COMPT_DT
			,RTRVL_COMPT_DT
			,RTRVL_GOD_STAT_CD
			,RTRVL_GOD_PRCS_COMPT_YN
			,BADN_REQEST_CONT
			,HDRY_COM_TRNSMIS_TGT_YN
			,HDRY_COM_TRNSMIS_YN
			,HDRY_COM_TRNSMIS_DT
			,HDRY_COM_KEY
			,HDRY_COM_WRHS_YN
			,HDRY_COM_WRHS_DT
			,ERP_TRNSMIS_YN
			,ERP_TRNSMIS_DT
			,ERP_CNFIRM_YN
			,ERP_CNFIRM_DT
			,ERP_INV_TRNSMIS_SECT_CD
			,ERP_INV_TRNSMIS_DT
			,RTGODCST_CAL_SECT_CD
			,RTGODCST_CAL_AMT
			,RFD_DELAY_CD
			,RFD_DELAY_DT
			,RFD_DELAY_RESN_DSCR
			,#{udterId}
			,#{udterId}
			,SYSDATE
			,SYSDATE
		FROM LGS_RTRVL_DRCT_GOD lrdg
	   WHERE 1 = 1
		<if test="@com.plgrim.ncp.framework.commons.StringService@isNotEmpty(rtrvlDrctGodNo)">
		AND RTRVL_DRCT_GOD_NO = #{rtrvlDrctGodNo}
		</if>
		<if test="@com.plgrim.ncp.framework.commons.StringService@isNotEmpty(clmNo)">
		AND CLM_NO = #{clmNo}
		</if>
		<if test="clmWrhsGodTurn != null and clmWrhsGodTurn > 0">
		AND CLM_WRHS_GOD_TURN = #{clmWrhsGodTurn}
		</if>
	</insert>

	<select id="selectRcptnoNullCntByClmNo" parameterType="String" resultType="int">
		SELECT COUNT (1) /* [claim.return.xml][selectRcptnoNullCntByClmNo][클레임번호로 판매영수증이 없는 카운트를 구한다][Aether]*/
		  FROM inf_ord_god_erp_dstb i
		  join ord_god og on og.ord_no = i.ord_no and og.ord_god_turn = i.ord_god_turn
		 WHERE i.rcptfr_no IS NULL AND i.clm_no = #{clmNo}
		 and og.partmal_sect_cd = 'MCOM' /*입점사상품은 판매영수증이 없어 카운트 하지 않음*/
	</select>

	<select id="selectInfOrdGodErpDstbRepair" parameterType="infOrdGodErpDstbRepair" resultType="infOrdGodErpDstbRepair">
        SELECT /* com.plgrim.ncp.base.repository.inf.selectInfOrdGodErpDstbRepair yoon 20170523 */
        		ORD_NO
			  , ORD_GOD_TURN
			  , QTY_TURN
			  , REPAIR_NO
			  , REPAIR_RCEPT_CHRGER_NM
			  , REPAIR_RCEPT_SHOP_ID
			  , REPAIR_RCEPT_CHRGER_PHON
			  , REPAIR_RCEPT_DT
			  , REPAIR_CNCL_DT
			  , REPAIR_COMPT_YN
			  , REPAIR_COMPT_CD
			  , REPAIR_COMPT_DT
			  , REPAIR_CONT
			  , REPAIR_DLV_SECT_CD
			  , REPAIR_DLV_HDRY_COM_CD
			  , REPAIR_DLV_WAYBIL_NO
			  , CLM_NO
			  , CLM_WRHS_GOD_TURN
			  , BADN_GOD_AFF_COM_CNFIRM_DT
			  , BADN_GOD_CNFIRM_ADMIN_ID
			  , REGTR_ID
			  , REG_DT
			  , UDTER_ID
			  , UDT_DT
        FROM    INF_ORD_GOD_ERP_DSTB_REPAIR
        WHERE   1 = 1
        AND     CLM_NO = #{clmNo,jdbcType=VARCHAR}
        AND     QTY_TURN = #{qtyTurn,jdbcType=NUMERIC}
    </select>

	<update id="updateInfOrdGodErpRepair" parameterType="com.plgrim.ncp.base.entities.datasource1.inf.InfOrdGodErpDstbRepair">
		UPDATE /* [claim.return.xml[updateInfOrdGodErpRepair][INF_ORD_GOD_ERP_DSTB UPDATE][YOON]*/
		INF_ORD_GOD_ERP_DSTB_REPAIR iogsdr SET
			  udt_dt = SYSDATE
			, udter_id = #{udterId,jdbcType=VARCHAR}
			<if test="repairCnclDt != null">
			, repair_cncl_dt = #{repairCnclDt}
			</if>
			<if test="repairDlvSectCd != null and repairDlvSectCd != ''">
			, repair_Dlv_Sect_Cd = #{repairDlvSectCd}
			</if>
			<if test="repairDlvWaybilNo != null and repairDlvWaybilNo != ''">
			, REPAIR_DLV_WAYBIL_NO = #{repairDlvWaybilNo}
			</if>
			<if test="repairDlvHdryComCd != null and repairDlvHdryComCd != ''">
			, REPAIR_DLV_HDRY_COM_CD = #{repairDlvHdryComCd}
			</if>
			<if test="repairComptYn != null and repairComptYn != ''">
			, REPAIR_COMPT_YN = #{repairComptYn}
			</if>
			<if test="repairComptDt != null">
			, REPAIR_COMPT_DT = #{repairComptDt}
			</if>
			<if test="repairRceptDt != null">
			, REPAIR_RCEPT_DT = #{repairRceptDt}
			</if>
			<if test="repairRceptShopId != null and repairRceptShopId != ''">
			, REPAIR_RCEPT_SHOP_ID = #{repairRceptShopId}
			</if>
			<if test="repairNo != null and repairNo != ''">
			, REPAIR_NO = #{repairNo}
			</if>
			<if test="repairComptCd != null and repairComptCd != ''">
			, REPAIR_COMPT_CD = #{repairComptCd}
			</if>
			<if test="repairRceptChrgerNm != null and repairRceptChrgerNm != ''">
			, REPAIR_RCEPT_CHRGER_NM = #{repairRceptChrgerNm}
			</if>
			<if test="repairRceptChrgerPhon != null and repairRceptChrgerPhon != ''">
				, REPAIR_RCEPT_CHRGER_PHON = #{repairRceptChrgerPhon}
			</if>
		WHERE 1 = 1
		  AND iogsdr.clm_no = #{clmNo}
		  AND iogsdr.qty_turn = #{qtyTurn}
	</update>
	
    <select id="selectClmWrhsGodNrmltCount" parameterType="String" resultType="int">
        SELECT /* [claim.return.xml][com.plgrim.ncp.biz.claim.return.selectClmWrhsGodNrmltCount][클레임관리 철회 - 클레임입고상품 철회제외 건수 조회] */
              COUNT(*)
         FROM CLM_WRHS_GOD
        WHERE clm_no = #{clmNo,jdbcType=VARCHAR}
          AND NVL(clm_wthdraw_sect_cd,'NRMLT') = 'NRMLT'
    </select>
	

</mapper>