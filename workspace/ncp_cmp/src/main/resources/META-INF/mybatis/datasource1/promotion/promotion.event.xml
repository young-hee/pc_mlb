<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.plgrim.ncp.biz.promotion"> 
	
	<select id="selectEventEndList" resultType="com.plgrim.ncp.biz.promotion.data.EventExtendsFoDTO" parameterType="com.plgrim.ncp.biz.promotion.data.EventSearchFoDTO">
		<include refid="com.plgrim.ncp.base.beginPage"/>
		<include refid="selectEventListQuery"/>
		<include refid="com.plgrim.ncp.base.endPage"/>
	</select>
	<select id="selectEventListNoPaging" resultType="com.plgrim.ncp.biz.promotion.data.EventExtendsFoDTO" parameterType="com.plgrim.ncp.biz.promotion.data.EventSearchFoDTO">
		<include refid="selectEventListQuery"/>
	</select>	
	<select id="selectEventList" resultType="com.plgrim.ncp.biz.promotion.data.EventExtendsFoDTO" parameterType="com.plgrim.ncp.biz.promotion.data.EventSearchFoDTO">
		SELECT *
		  FROM (SELECT T.*, ROWNUM ROWCNT FROM (
		<include refid="selectEventListQuery"/>
		) T)
		 WHERE ROWCNT BETWEEN #{beginIndex, jdbcType=VARCHAR} AND #{endIndex, jdbcType=VARCHAR}
	</select>		
	<sql id="selectEventListQuery">
		/* [promotion.event.xml][selectEventList][이벤트 목록 조회][홍찬희] */
		SELECT 	T1.EVT_NO
        ,		T1.EVT_NM
        ,		T1.EVT_DSCR
        ,		T1.EVT_STAT_CD
        ,		T1.EVT_BEG_DT
        ,		T1.EVT_END_DT
        ,		T1.PC_URL
        ,		T1.MOBILE_URL
        ,		T2.IMG_FILE_URL||'/'||T2.IMG_FILE_NM IMG_FILE_URL1
        ,		T2.IMG_EXPSR_TXT1_CONT IMG_EXPSR_TXT1_CONT1 
        ,		T2.IMG_EXPSR_TXT2_CONT IMG_EXPSR_TXT2_CONT1
        ,		T2.IMG_ALTRTV_CONT IMG_ALTRTV_CONT1
        ,		T3.IMG_FILE_URL||'/'||T3.IMG_FILE_NM IMG_FILE_URL2
        ,		T3.IMG_ALTRTV_CONT IMG_ALTRTV_CONT2
        ,		T3.IMG_EXPSR_TXT1_CONT IMG_EXPSR_TXT1_CONT2 
        ,		T3.IMG_EXPSR_TXT2_CONT IMG_EXPSR_TXT2_CONT2        
        FROM EVT T1 
		LEFT OUTER JOIN EVT_IMG T2 
        ON   T1.EVT_NO = T2.EVT_NO 
        AND  T2.EVT_IMG_SECT_CD = 'RPRST_IMG_1PCE'
		<choose>
	    <when test="device == 'PC'">
	    AND  T2.DVC_SECT_CD IN ('PC','PC_MOBILE')
	    </when>
	    <when test="device == 'MOBILE_APP' or device == 'MOBILE_WEB'">
	    AND  T2.DVC_SECT_CD IN ('MOBILE','PC_MOBILE')
	    </when>
   	 	</choose>
		LEFT OUTER JOIN EVT_IMG T3 
        ON   T1.EVT_NO = T3.EVT_NO 
        AND  T3.EVT_IMG_SECT_CD = 'RPRST_IMG_2PCE'
		<choose>
	    <when test="device == 'PC'">
	    AND  T3.DVC_SECT_CD IN ('PC','PC_MOBILE')
	    </when>
	    <when test="device == 'MOBILE_APP' or device == 'MOBILE_WEB'">
	    AND  T3.DVC_SECT_CD IN ('MOBILE','PC_MOBILE')
	    </when>
   	 	</choose>   	 	
		WHERE 1 = 1
		   <!-- AND EXISTS
		          (SELECT 1
		             FROM EVT_PARTCPTN_TGT A
		            WHERE PARTCPTN_TGT_TP_CD = 'MALL_ID' AND A.EVT_NO = T1.EVT_NO AND MALL_ID = #{mallId, jdbcType=VARCHAR})
		   <if test="lang != null and lang != ''">
		   AND EXISTS
		          (SELECT 1
		             FROM EVT_PARTCPTN_TGT A
		            WHERE PARTCPTN_TGT_TP_CD = 'LANG' AND A.EVT_NO = T1.EVT_NO AND LANG_CD = #{lang, jdbcType=VARCHAR})
		   </if> -->
	       AND EVT_STAT_CD = 'APRV'
           AND DSP_YN = 'Y'
           AND T1.UPPER_EVT_NO IS NULL
			AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = T1.evt_no AND evt_dsp_tgt_tp_cd = 'MALL_ID' AND mall_id = #{mallId, jdbcType=VARCHAR})
			AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = T1.evt_no AND evt_dsp_tgt_tp_cd = 'LANG' AND lang_cd = #{lang,jdbcType=VARCHAR})
			AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = T1.evt_no AND evt_dsp_tgt_tp_cd = 'DVC' AND dvc_cd = #{device,jdbcType=VARCHAR})
			<if test="tgtMbrTpCd != null">
			AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = T1.evt_no AND evt_dsp_tgt_tp_cd = 'TGT_MBR_TP' AND TGT_MBR_TP_CD = #{tgtMbrTpCd,jdbcType=VARCHAR})
			</if>
			<if test="absMbrAtrbCd != null">
			AND
				<if test="absMbrAtrbCd != 'GRPCO'">
				EXISTS (SELECT 1 FROM EVT_DSP_TGT
						WHERE evt_no = T1.evt_no
							AND evt_dsp_tgt_tp_cd = 'TGT_MBR_ATRB' AND TGT_MBR_ATRB_CD = #{absMbrAtrbCd,jdbcType=VARCHAR})
				</if>
				<if test="absMbrAtrbCd == 'GRPCO'">
					(	EXISTS (SELECT 1 FROM EVT_DSP_TGT
								WHERE evt_no = T1.evt_no
									AND evt_dsp_tgt_tp_cd = 'TGT_MBR_ATRB' AND TGT_MBR_ATRB_CD = 'GRPCO_IND' AND GRPCO_ID = #{absGepcoId,jdbcType=VARCHAR})
					OR	EXISTS (SELECT 1 FROM EVT_DSP_TGT
								WHERE evt_no = T1.evt_no 
									AND evt_dsp_tgt_tp_cd = 'TGT_MBR_ATRB' AND TGT_MBR_ATRB_CD = 'GRPCO_ALL')
					)
				</if>
			</if> 			
	    <choose>
	    <when test="endYn == 'no'">
	       AND SYSDATE BETWEEN EVT_BEG_DT AND EVT_END_DT
	    </when>
	    <when test="endYn == 'yes'">
	       AND SYSDATE <![CDATA[ > ]]> EVT_END_DT
	    </when>
	    </choose>
	   ORDER BY T1.EVT_BEG_DT DESC
	</sql>	
	<select id="selectEventCount" resultType="java.lang.Long" parameterType="com.plgrim.ncp.biz.promotion.data.EventSearchFoDTO">
		SELECT COUNT(*)
	    FROM EVT T1 WHERE 1 = 1
		  <!--  AND EXISTS
		          (SELECT 1
		             FROM EVT_PARTCPTN_TGT A
		            WHERE PARTCPTN_TGT_TP_CD = 'MALL_ID' AND A.EVT_NO = T1.EVT_NO AND MALL_ID = #{mallId, jdbcType=VARCHAR})
		   <if test="lang != null and lang != ''">
		   AND EXISTS
		          (SELECT 1
		             FROM EVT_PARTCPTN_TGT A
		            WHERE PARTCPTN_TGT_TP_CD = 'LANG' AND A.EVT_NO = T1.EVT_NO AND LANG_CD = #{lang, jdbcType=VARCHAR})
		   </if> -->
	       AND EVT_STAT_CD = 'APRV'
	       AND DSP_YN = 'Y'
           AND UPPER_EVT_NO IS NULL
			AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = T1.evt_no AND evt_dsp_tgt_tp_cd = 'MALL_ID' AND mall_id = #{mallId, jdbcType=VARCHAR})
			AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = T1.evt_no AND evt_dsp_tgt_tp_cd = 'LANG' AND lang_cd = #{lang,jdbcType=VARCHAR})
			AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = T1.evt_no AND evt_dsp_tgt_tp_cd = 'DVC' AND dvc_cd = #{device,jdbcType=VARCHAR})
			<if test="tgtMbrTpCd != null">
			AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = T1.evt_no AND evt_dsp_tgt_tp_cd = 'TGT_MBR_TP' AND TGT_MBR_TP_CD = #{tgtMbrTpCd,jdbcType=VARCHAR})
			</if>
			<if test="absMbrAtrbCd != null">
			AND
				<if test="absMbrAtrbCd != 'GRPCO'">
				EXISTS (SELECT 1 FROM EVT_DSP_TGT
						WHERE evt_no = T1.evt_no
							AND evt_dsp_tgt_tp_cd = 'TGT_MBR_ATRB' AND TGT_MBR_ATRB_CD = #{absMbrAtrbCd,jdbcType=VARCHAR})
				</if>
				<if test="absMbrAtrbCd == 'GRPCO'">
					(	EXISTS (SELECT 1 FROM EVT_DSP_TGT
								WHERE evt_no = T1.evt_no
									AND evt_dsp_tgt_tp_cd = 'TGT_MBR_ATRB' AND TGT_MBR_ATRB_CD = 'GRPCO_IND' AND GRPCO_ID = #{absGepcoId,jdbcType=VARCHAR})
					OR	EXISTS (SELECT 1 FROM EVT_DSP_TGT
								WHERE evt_no = T1.evt_no 
									AND evt_dsp_tgt_tp_cd = 'TGT_MBR_ATRB' AND TGT_MBR_ATRB_CD = 'GRPCO_ALL')
					)
				</if>
			</if> 			
	    <choose>
	    <when test="endYn == 'no'">
	       AND SYSDATE BETWEEN EVT_BEG_DT AND EVT_END_DT
	    </when>
	    <when test="endYn == 'yes'">
	       AND SYSDATE <![CDATA[ > ]]> EVT_END_DT
	    </when>
	    </choose>
	</select>
	
	<select id="selectEvent" resultType="com.plgrim.ncp.biz.promotion.data.EventExtendsFoDTO">
	/* [promotion.event.xml][selectEvent][이벤트 상세 조회][홍찬희] */
		SELECT T1.EVT_NO
		      ,T1.EVT_NM
		      ,T1.EVT_DSCR
		      ,T1.EVT_STAT_CD
		      ,T1.EVT_BEG_DT
		      ,T1.EVT_END_DT
              ,T1.APPLCN_BEG_DT
              ,T1.APPLCN_END_DT		      
		      ,T1.EVT_TP_CD
		      ,T1.EVT_DETAIL_TP_CD
		      ,T1.PC_URL
		      ,T1.MOBILE_URL
		      ,T1.PC_HTML
              ,T1.DSP_YN
		      ,T1.MOBILE_HTML
              ,T1.GNB_UPEND_BANNER_EXPSR_YN
		      ,T2.IMG_FILE_URL ||'/'||T2.IMG_FILE_NM IMG_FILE_URL
		      ,T2.IMG_ALTRTV_CONT
		      ,T3.IMG_FILE_URL||'/'||T3.IMG_FILE_NM BCRN_IMG_FILE_URL
		      ,T3.IMG_ALTRTV_CONT BCRN_IMG_ALTRTV_CONT
		      ,TO_CHAR (LAST_DAY (SYSDATE), 'dd') LAST_DATE
		      ,TO_CHAR (TO_DATE (TO_CHAR (SYSDATE, 'YYYYMM') || '01', 'YYYYMMDD'), 'd') FIRST_WEEK
		      ,TO_NUMBER (TO_CHAR (SYSDATE, 'DD')) TODATE
		      ,CASE WHEN T1.EVT_END_DT <![CDATA[<]]> SYSDATE THEN 'Y' ELSE 'N' END EVENT_END_YN
		      ,T1.EVT_GOD_SORT_STDR_CD
			  ,T1.RPRST_LWPRT_SECT_CD
			  ,(SELECT NVL(LISTAGG(T4.EVT_NO , ',') WITHIN GROUP (ORDER BY T4.EVT_NO), '') FROM EVT T4 WHERE T4.UPPER_EVT_NO = T1.EVT_NO AND T4.RPRST_LWPRT_SECT_CD = 'LWPRT_EVT') AS LWPRT_EVT_LIST
		  FROM EVT T1
		       LEFT OUTER JOIN EVT_IMG T2 ON (T1.EVT_NO = T2.EVT_NO AND T2.EVT_IMG_SECT_CD = 'RPRST_IMG_1PCE'
									        <choose>
										    <when test="device == 'PC'">
										        AND T2.DVC_SECT_CD IN ('PC','PC_MOBILE')
										    </when>
										    <when test="device == 'MOBILE_APP' or device == 'MOBILE_WEB'">
										        AND T2.DVC_SECT_CD IN ('MOBILE','PC_MOBILE')
										    </when>
										    </choose>)
		       LEFT OUTER JOIN EVT_IMG T3 ON (T1.EVT_NO = T3.EVT_NO AND T3.EVT_IMG_SECT_CD = 'BCRN'
									        <choose>
										    <when test="device == 'PC'">
										        AND T3.DVC_SECT_CD IN ('PC','PC_MOBILE')
										    </when>
										    <when test="device == 'MOBILE_APP' or device == 'MOBILE_WEB'">
										        AND T3.DVC_SECT_CD IN ('MOBILE','PC_MOBILE')
										    </when>
										    </choose>)
		 WHERE T1.EVT_NO = UPPER(#{evtNo, jdbcType=VARCHAR})
		 <!--   AND EXISTS
		          (SELECT 1
		             FROM EVT_PARTCPTN_TGT A
		            WHERE PARTCPTN_TGT_TP_CD = 'MALL_ID' AND A.EVT_NO = T1.EVT_NO AND MALL_ID = #{mallId, jdbcType=VARCHAR})  -->
		 AND   EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = T1.evt_no AND evt_dsp_tgt_tp_cd = 'MALL_ID' AND mall_id = #{mallId, jdbcType=VARCHAR})
		 AND   EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = T1.evt_no AND evt_dsp_tgt_tp_cd = 'LANG'    AND lang_cd = #{lang,jdbcType=VARCHAR})
		 AND   EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = T1.evt_no AND evt_dsp_tgt_tp_cd = 'DVC'     AND dvc_cd  = #{device,jdbcType=VARCHAR})
	     <if test="boAccess == '' or boAccess != 'BODSPYN'">
		 AND SYSDATE BETWEEN T1.EVT_BEG_DT AND T1.EVT_END_DT
	     AND T1.EVT_STAT_CD = 'APRV'
         AND T1.DSP_YN = 'Y'
		 </if> 
	</select>
	<select id="selectEventAtend" resultType="java.lang.Integer">
	/* [promotion.event.xml][selectEventAtend][출석이벤트 참여 목록 조회][홍찬희] */
		SELECT TO_NUMBER (TO_CHAR (TO_DATE (ATEND_DATE, 'YYYYMMDD'), 'DD')) ATTEND_DATE
		  FROM EVT_ATEND
		 WHERE EVT_NO = #{evtNo, jdbcType=VARCHAR} AND MBR_NO = #{mbrNo, jdbcType=VARCHAR}
	</select>
	<select id="selectFreeGiftTurnList" resultType="com.plgrim.ncp.biz.promotion.data.EventFreeGiftTurnExtendsFoDTO">
	/* [promotion.event.xml][selectFreeGiftTurnList][이벤트 경품 목록 조회][홍찬희] */
		SELECT T1.FREE_GIFT_TURN
              ,T1.FREE_GIFT_KND_CD
		      ,PRIZE_RANK
		      ,T2.DC_AMT
		      ,T2.DC_RT
		      ,T2.DC_SECT_CD
		      ,T2.MAX_DC_PSB_AMT
		      ,T1.PRPARE_FREE_GIFT_QTY
              ,T1.FREE_GIFT_NM
              ,CASE WHEN T3.EVT_TP_CD = 'ATEND_CHK' OR T3.EVT_TP_CD = 'TM_CPN' OR T3.EVT_TP_CD = 'STMP'
                    THEN (SELECT T1.PRPARE_FREE_GIFT_QTY - COUNT (1)
                            FROM EVT_PRIZE A, EVT_PRIZE_FREE_GIFT B
                           WHERE A.EVT_PARTCPTN_SN = B.EVT_PARTCPTN_SN
                             AND A.PRIZE_TURN = B.PRIZE_TURN
                             AND B.EVT_NO = T1.EVT_NO
                             AND B.FREE_GIFT_TURN = T1.FREE_GIFT_TURN
                             AND TO_CHAR (A.PRIZE_DT, 'YYYYMMDD') = TO_CHAR (SYSDATE, 'YYYYMMDD')
                         )
                    ELSE T1.FREE_GIFT_INV_QTY
               END AS FREE_GIFT_INV_QTY
		      ,T1.CPN_PRM_NO
              ,T1.PNT_AMT
              ,T3.EVT_NM
              ,T1.ATEND_DAYCNT
              ,T1.PRIZE_QTY
		  FROM EVT_FREE_GIFT_INFO T1
		  JOIN EVT T3 ON T3.EVT_NO = T1.EVT_NO
		  LEFT OUTER JOIN PRM T2 ON T1.CPN_PRM_NO = T2.PRM_NO
		 WHERE T1.EVT_NO = #{evtNo, jdbcType=VARCHAR}
         ORDER BY CASE WHEN T3.EVT_TP_CD = 'ATEND_CHK' OR T3.EVT_TP_CD = 'TM_CPN' OR T3.EVT_TP_CD = 'STMP'
                       THEN T1.ATEND_DAYCNT
                       ELSE T1.FREE_GIFT_TURN 
                  END
	</select>
    <select id="selectFreeGiftTimeList" resultType="com.plgrim.ncp.biz.promotion.data.EventFreeGiftTurnExtendsFoDTO">
    /* [promotion.event.xml][selectFreeGiftTimeList][이벤트 경품 적용기간별 목록 조회] */
        SELECT
              E.EVT_NO
            , E.EVT_STAT_CD
            , GI.FREE_GIFT_KND_CD
            , GI.PRIZE_RANK
            , GI.FREE_GIFT_NM
            , P.DC_AMT
            , P.DC_RT
            , P.DC_SECT_CD
            , P.MAX_DC_PSB_AMT
            , (SELECT C.CPN_MAX_DC_PSB_AMT FROM PRM_CPN C WHERE P.PRM_NO = C.PRM_NO) AS CPN_MAX_DC_PSB_AMT
            , AP.FREE_GIFT_TURN
            , AP.BEG_DT
            , AP.END_DT
            , AP.FREE_GIFT_QTY
            , (GI.PRPARE_FREE_GIFT_QTY * PRIZE_QTY) AS BASE_FREE_GIFT_QTY
        FROM  EVT E
        JOIN  EVT_FREE_GIFT_INFO GI
        ON    E.EVT_NO          = GI.EVT_NO
        LEFT OUTER JOIN  EVT_FREE_GIFT_APL_PD AP
        ON    GI.EVT_NO         = AP.EVT_NO
        AND   GI.FREE_GIFT_TURN = AP.FREE_GIFT_TURN
        LEFT OUTER JOIN  PRM P
        ON    GI.CPN_PRM_NO     = P.PRM_NO
        WHERE 1 = 1
        AND   E.EVT_NO          = #{evtNo:VARCHAR}
        AND   SYSDATE BETWEEN AP.BEG_DT AND AP.END_DT
        ORDER BY GI.PRIZE_RANK
    </select>
	<select id="checkEventAtend" resultType="java.lang.String">
	/* [promotion.event.xml][checkEventAtend][출석체크 중복 확인][홍찬희] */
		SELECT 1
		  FROM EVT_ATEND
		 WHERE MBR_NO = #{mbrNo, jdbcType=VARCHAR} 
		   AND ATEND_DATE = TO_CHAR(sysdate,'YYYYMMDD') 
		   AND EVT_NO = #{evtNo, jdbcType=VARCHAR} 
		   AND ROWNUM = 1	
	</select>
	
	<insert id="insertEvtAtend" parameterType="evtAtend">
	    INSERT /* [promotion.event.xml][insertEvtAtend][출석체크 등록][홍찬희] */
	    INTO EVT_ATEND
		(
	        MBR_NO
	       ,ATEND_DATE
	       ,ATEND_HOUR
	       ,EVT_NO
	       ,EVT_PARTCPTN_SN
	       ,REGTR_ID
	       ,REG_DT
	       ,UDTER_ID
	       ,UDT_DT
		)
		VALUES
		(
	        #{mbrNo,jdbcType=VARCHAR}
	       ,TO_CHAR(SYSDATE, 'YYYYMMDD')
	       ,TO_CHAR(SYSDATE, 'hh24miss')
	       ,#{evtNo,jdbcType=VARCHAR}
	       ,#{evtPartcptnSn,jdbcType=NUMERIC}
	       ,#{regtrId,jdbcType=NUMERIC}
	       ,SYSDATE
	       ,#{udterId,jdbcType=VARCHAR}
	       ,SYSDATE
		)   
    </insert>	
	<resultMap id="selectEventGoodsListResult" type="com.plgrim.ncp.biz.promotion.data.GoodsListFoDTO">
		<id property="godNo" column="GOD_NO" />
        <id property="sprtrTurn" column="SPRTR_TURN"/>
		<result property="godNo" column="GOD_NO"/>
		<result property="godNm" column="GOD_NM"/>
		<result property="tagNm" column="TAG_NM"/>
		<result property="rtlPrc" column="RTL_PRC"/>
		<result property="lastSalePrc" column="LAST_SALE_PRC"/>
		<result property="dcIcon" column="DC_ICON"/>
		<result property="cpnIcon" column="CPN_ICON"/>
		<result property="imgUrl1" column="IMG_URL_1"/>
		<result property="imgUrl2" column="IMG_URL_2"/>
		<result property="brndNm" column="BRND_NM"/>
		<result property="sprtrTurn" column="SPRTR_TURN"/>
		<result property="colorStyleCd" column="COLOR_STYLE_CD"/>
		<collection property="iconNmList" ofType="string">
			<id column="ICON_NM" jdbcType="VARCHAR" />
		</collection>
	</resultMap>    
    <select id="selectEventGoodsList" resultMap="selectEventGoodsListResult">
    /* [promotion.event.xml][selectEventGoodsList][이벤트 연관 상품 목록 조회][강창구] */
		SELECT T1.GOD_NO
		      ,NVL(DECODE (#{lang , jdbcType=VARCHAR} , 'KOR' , T2.GOD_NM , (SELECT GOD_NM FROM GOD_LANGBY_GOD_NM D WHERE D.LANG_CD = #{lang , jdbcType=VARCHAR} AND D.GOD_NO = T2.GOD_NO) ), '') AS GOD_NM
			  ,NVL (  (
						SELECT DECODE ( #{lang , jdbcType=VARCHAR} , 'KOR' , B.TAG_NM , C.TAG_NM )
		                FROM GOD_TAG_RESVE_CNNC A
		                INNER JOIN GOD_TAG_RESVE B
		                ON (A.TAG_RESVE_SN = B.TAG_RESVE_SN
		                AND SYSDATE <![CDATA[>=]]> B.RESVE_BEG_DT
		                AND SYSDATE <![CDATA[<=]]> B.RESVE_END_DT
		                AND USE_YN = 'Y')
                        LEFT OUTER JOIN GOD_LANGBY_TAG_RESVE C ON (A.TAG_RESVE_SN = C.TAG_RESVE_SN AND C.LANG_CD = #{lang , jdbcType=VARCHAR} )
		                WHERE A.GOD_NO = T1.GOD_NO AND ROWNUM <![CDATA[<]]> 2
					  )
                    , DECODE ( #{lang , jdbcType=VARCHAR} , 'KOR' , T2.TAG_NM , (SELECT TAG_NM FROM GOD_LANGBY_GOD_NM D WHERE D.LANG_CD = #{lang , jdbcType=VARCHAR} AND D.GOD_NO = T2.GOD_NO) )
               ) AS TAG_NM		      
		      ,T3.RTL_PRC
		      ,T3.LAST_SALE_PRC
			  ,CASE
				   WHEN (T3.RTL_PRC - T3.LAST_SALE_PRC) > 0 OR T3.GOD_DC_RT > 0
				   THEN
                      CASE
                          WHEN T3.GOD_DC_RT > 0 THEN
                              ROUND ((T3.RTL_PRC - T3.DC_PRC) / T3.RTL_PRC * 100) || '%'
                          ELSE
                          CASE WHEN   ROUND (( T3.RTL_PRC - T3.CSMR_PRC) / T3.RTL_PRC * 100) > 0
                               THEN   ROUND (( T3.RTL_PRC - T3.CSMR_PRC) / T3.RTL_PRC * 100) || '%'   
                               ELSE ''
                               END                    
                      END
				   ELSE
				      ''
				END
				   DC_ICON
			  ,CASE
				   WHEN T3.CPN_DC_RT > 0
				   THEN
				      T3.CPN_DC_RT || '%'
				   ELSE
				      ''
				END
		       	   CPN_ICON
		      ,T4.IMG_URL IMG_URL_1
		      ,T8.IMG_URL IMG_URL_2
		      ,T5.BRND_NM
		      ,T7.ICON_NM
		      ,T1.SPRTR_TURN
              ,(
                SELECT  LISTAGG(
                		B.color_style_cd
                		, ',') WITHIN GROUP (ORDER BY  B.COLOR_STYLE_CD)  AS COLOR_STYLE_CD
                  FROM GOD g
              JOIN INF_COLOR_GRP B ON (g.COLOR_CD = B.COLOR_GRP_CD AND B.LANGUAGE = DECODE( #{lang,jdbcType=VARCHAR} , 'ENG' , 'EN' , 'CHI' , 'ZH' , 'KO' ))
                 WHERE g.DSP_YN = 'Y'
                   AND g.GOD_APRV_SECT_CD = 'APRV_COMPT'
                   -- AND g.GOD_SALE_SECT_CD IN ('SLDOUT', 'SALE_PROGRS') -- #47237 국문몰 픽업 Only 판매 상태 개발의 건
                   AND g.GOD_SALE_SECT_CD IN ('SLDOUT', 'SALE_PROGRS', 'SALE_PROGRS_PKUP')
               AND g.PARTMAL_SECT_CD ='MCOM'
                   AND EXISTS
                          (SELECT 1
                             FROM DSP_CTGRY_CNNC_GOD T1
                                  INNER JOIN DSP_CTGRY T2
                                     ON (T1.DSP_CTGRY_NO = T2.DSP_CTGRY_NO AND T2.DSP_YN = 'Y' AND T2.DELETE_YN = 'N')
                            WHERE T1.GOD_NO = g.GOD_NO AND T1.DSP_YN = 'Y')
                        AND T2.DSGN_GRP_NO  = g.DSGN_GRP_NO
               )  AS COLOR_STYLE_CD 
		  FROM EVT_RELATE_GOD T1
		       INNER JOIN EVT A1 ON A1.EVT_NO = T1.EVT_NO
		       INNER JOIN EVT_SPRTR A2 ON A2.EVT_NO = A1.EVT_NO AND T1.SPRTR_TURN = A2.SPRTR_TURN AND A2.DSP_YN='Y'
		       <if test="sprtrTurn !='' and sprtrTurn !=null">AND A2.SPRTR_TURN = #{sprtrTurn,jdbcType=NUMERIC} </if>
		       INNER JOIN GOD T2 ON T1.GOD_NO = T2.GOD_NO
		       INNER JOIN DSP_GOD_PRC T3
		          ON (T1.GOD_NO = T3.GOD_NO AND T3.LANG_CD = #{lang,jdbcType=VARCHAR} 
		          AND T3.MALL_ID = #{mallId,jdbcType=VARCHAR}
		          <if test='spcPrmTp != null and spcPrmTp != ""'>
				  AND T3.PRC_SECT_CD = CASE
									   WHEN (SELECT 1
											   FROM DSP_GOD_PRC A
											  WHERE A.PRC_SECT_CD = #{spcPrmTp, jdbcType=VARCHAR} AND A.GOD_NO = T2.GOD_NO AND ROWNUM = 1)
											   IS NOT NULL
									   THEN #{spcPrmTp, jdbcType=VARCHAR} ELSE #{prcSectCd, jdbcType=VARCHAR} END
				  </if>
				  <if test='spcPrmTp == null or spcPrmTp == ""'>
				  AND T3.PRC_SECT_CD = #{prcSectCd, jdbcType=VARCHAR}
				  </if>
		          )
		       LEFT OUTER JOIN GOD_IMG T4 ON T1.GOD_NO = T4.GOD_NO AND T4.IMG_SIZE_CD = '346X457' AND T4.IMG_TP_CD = 'THNAIL' AND T4.IMG_APRV_YN = 'Y' AND T4.IMG_USE_YN = 'Y' AND T4.IMG_TURN = 0
		       LEFT OUTER JOIN GOD_IMG T8 ON T1.GOD_NO = T8.GOD_NO AND T8.IMG_SIZE_CD = '346X457' AND T8.IMG_TP_CD = 'THNAIL' AND T8.IMG_APRV_YN = 'Y' AND T8.IMG_USE_YN = 'Y' AND T8.IMG_TURN = 1
		       INNER JOIN SYS_BRND T5 ON T2.BRND_GRP_ID = T5.BRND_ID
		       LEFT OUTER JOIN GOD_ICON_CNNC T6 ON T2.GOD_NO = T6.GOD_NO
		       LEFT OUTER JOIN GOD_ICON T7 ON T6.ICON_TURN = T7.ICON_TURN
		 WHERE T1.EVT_NO = #{evtNo,jdbcType=VARCHAR} AND T1.DSP_YN = 'Y'
		 ORDER BY A1.EVT_GOD_SORT_STDR_CD ,A2.SPRTR_TURN
		 <if test="orderBy =='NEW_GOD_SEQ'">
		 ,T2.REG_DT DESC
		 </if>
		 <if test="orderBy =='LWET_PRC_SEQ'">
		 ,T3.LAST_SALE_PRC ASC
		 </if>	
        <if test="orderBy == 'MD_RECOMMEND_SEQ'">
         ,T1.sort_seq 
        </if>
        <if test="orderBy == null">
           ,T3.LAST_SALE_PRC ASC
        </if>
        <if test="orderBy == ''">
           ,T3.LAST_SALE_PRC ASC
        </if>
		 , T1.GOD_NO DESC	 
    </select>
    <select id="selectEvtSprtrList" resultType="com.plgrim.ncp.base.entities.datasource1.evt.EvtSprtr">
    /* [promotion.event.xml][selectEvtSprtrList][상품 구분 타이틀 목록 조회][홍찬희] */
		SELECT SPRTR_TURN
		      ,SPRTR_NM
		      ,SPRTR_IMG_FILE_URL||'/'|| SPRTR_IMG_FILE_NM SPRTR_IMG_FILE_URL
		      ,SPRTR_IMG_ALTRTV_CONT
		      ,SORT_SEQ
		      ,RPRST_SPRTR_YN
		  FROM EVT_SPRTR
		 WHERE EVT_NO = #{evtNo,jdbcType=VARCHAR} AND DSP_YN = 'Y'   
		 ORDER BY SORT_SEQ ASC, sprtr_turn ASC
    </select>
    <select id="checkEvtApplcnToday" parameterType="com.plgrim.ncp.biz.promotion.data.EventSearchFoDTO" resultType="java.lang.String">
    /* [promotion.event.xml][checkEvtApplcnToday][타임쿠폰 응모 중복 체크][홍찬희] */
		SELECT 1
		  FROM EVT_APPLCN
		 WHERE EVT_NO = #{evtNo,jdbcType=VARCHAR} 
		   AND MBR_NO = #{mbrNo,jdbcType=VARCHAR} 
			<if test="freeGiftTurn != null and freeGiftTurn != 0 ">
		   		AND FREE_GIFT_TURN = #{freeGiftTurn,jdbcType=NUMERIC}
			</if>
			<if test='dayCheckCpnYn == null or dayCheckCpnYn == ""  or dayCheckCpnYn == "Y" '>
				AND TO_CHAR (APPLCN_DT, 'YYYY-MM-DD') =
		          CASE
		             WHEN TO_CHAR (SYSDATE, 'HH24') <![CDATA[<]]> 10 THEN TO_CHAR (SYSDATE - 1, 'YYYY-MM-DD')
		             ELSE TO_CHAR (SYSDATE, 'YYYY-MM-DD')
		          END	
			</if>
		   
		   
    </select>
    <select id="selectFreeGiftInvQty"  resultType="java.lang.Integer">
    /* [promotion.event.xml][selectFreeGiftInvQty][경품 남은 수량 조회][홍찬희] */
		SELECT FREE_GIFT_INV_QTY
		  FROM EVT_FREE_GIFT_INFO
		 WHERE EVT_NO = #{evtNo,jdbcType=VARCHAR}  
		   AND FREE_GIFT_TURN =  #{freeGiftTurn,jdbcType=VARCHAR}  
    </select>
    <select id="selectSnsReplyList" resultType="com.plgrim.ncp.base.entities.datasource1.evt.EvtSnsReply">
	/* [promotion.event.xml][selectSnsReplyList][SNS 댓글 목록 조회][홍찬희] */    
		<include refid="com.plgrim.ncp.base.beginPage"/>
		SELECT ES.REPLY_SN
		      ,ES.EVT_NO
		      ,ES.SNS_SECT_CD
		      ,ES.REPLY_CONT
		      ,ES.SNS_IMG_URL
		      ,FN_MASKING('ID', M.MBR_ID, '', 'Y') AS SNS_ID
		      ,ES.REG_DT
		      ,ES.REGTR_ID
		  FROM EVT_SNS_REPLY ES
      JOIN MBR M ON ES.REGTR_ID = M.MBR_NO
		 WHERE ES.EVT_NO = #{evtNo,jdbcType=VARCHAR}
		   <!-- #41419 이벤트 기획전 (SNS댓글) 기능 개선 170417 -->
		   AND ES.DSP_YN = 'Y'
		 ORDER BY ES.REG_DT DESC <!-- #41419 이벤트 기획전 (SNS댓글) 기능 개선 추가요청 170419 -->
		<include refid="com.plgrim.ncp.base.endPage"/>  		 
    </select>
    <select id="selectSnsReplyListCount" resultType="java.lang.Long">
	/* [promotion.event.xml][selectSnsReplyListCount][SNS 댓글 목록 카운트][홍찬희] */    
		SELECT COUNT(1)
		  FROM EVT_SNS_REPLY ES
      JOIN MBR M ON ES.REGTR_ID = M.MBR_NO
		 WHERE ES.EVT_NO = #{evtNo,jdbcType=VARCHAR}
		   <!-- #41419 이벤트 기획전 (SNS댓글) 기능 개선 170417 -->
		   AND ES.DSP_YN = 'Y'
    </select>    
    <update id="updateFreeGiftInvQty">
    /* [promotion.event.xml][updateFreeGiftInvQty][경품 재고 수량 감소][홍찬희] */    
		UPDATE EVT_FREE_GIFT_INFO
		   SET FREE_GIFT_INV_QTY = FREE_GIFT_INV_QTY - 1
		 WHERE EVT_NO = #{evtNo,jdbcType=VARCHAR}   
		   AND FREE_GIFT_TURN = #{freeGiftTurn,jdbcType=NUMERIC}  
    </update>
    <update id="updateEvtFreeGiftAplPd" parameterType="evtFreeGiftInfo">
    /* [promotion.event.xml][updateEvtFreeGiftAplPd][이벤트 경품 적용기간 경품수량 감소] */    
		UPDATE EVT_FREE_GIFT_APL_PD AP
		   SET AP.FREE_GIFT_QTY     = FREE_GIFT_QTY - 1
		 WHERE AP.EVT_NO            = #{evtNo,jdbcType=VARCHAR}
		   AND AP.FREE_GIFT_TURN    = #{freeGiftTurn,jdbcType=NUMERIC}
           AND SYSDATE BETWEEN AP.BEG_DT AND AP.END_DT
    </update>
    <update id="updateFreeGiftInvQtyAplPd" parameterType="evtFreeGiftInfo">
    /* [promotion.event.xml][updateFreeGiftInvQty][경품재고수량 적용기간 반영 update] */    
		UPDATE EVT_FREE_GIFT_INFO E
		   SET E.FREE_GIFT_INV_QTY = NVL((SELECT SUM(Q.FREE_GIFT_QTY) FROM EVT_FREE_GIFT_APL_PD Q WHERE Q.EVT_NO = E.EVT_NO), 0)
		 WHERE E.EVT_NO            = #{evtNo,jdbcType=VARCHAR}   
		   AND E.FREE_GIFT_TURN    = #{freeGiftTurn,jdbcType=NUMERIC}  
    </update>
    <select id="getFreeGiftIssuCount" resultType="java.lang.Integer">
    /* [promotion.event.xml][getFreeGiftIssuCount][타임쿠폰 경품지급 건 COUNT] */
        SELECT
              NVL(SUM(CHECK_COUNT), 0) AS CNT
        FROM  (
                 SELECT
                       CASE (SELECT (GI.PRPARE_FREE_GIFT_QTY * GI.PRIZE_QTY)
                             FROM   EVT_FREE_GIFT_INFO GI
                             WHERE  GI.EVT_NO = AP.EVT_NO
                             AND    GI.FREE_GIFT_TURN = AP.FREE_GIFT_TURN)
                            WHEN AP.FREE_GIFT_QTY
                            THEN 0
                            ELSE 1
                       END AS CHECK_COUNT
                 FROM  EVT_FREE_GIFT_APL_PD AP
                 WHERE AP.EVT_NO = #{evtNo:VARCHAR}
                 <if test="freeGiftTurn != null and freeGiftTurn != '' and freeGiftTurn != 0">
                 AND   AP.FREE_GIFT_TURN = #{freeGiftTurn,jdbcType=NUMERIC}
                 </if>
              )
    </select>
    <delete id="deleteEvtFreeGiftAplPd" parameterType="evtFreeGiftAplPd">
        DELETE /* [promotion.event.xml][deleteEvtFreeGiftAplPd][이벤트경품적용기간 삭제] */
        FROM    EVT_FREE_GIFT_APL_PD 
        WHERE   1 = 1
        AND     EVT_NO = #{evtNo,jdbcType=VARCHAR}
        <if test="freeGiftTurn != null and freeGiftTurn != '' and freeGiftTurn != 0">
        AND     FREE_GIFT_TURN = #{freeGiftTurn,jdbcType=NUMERIC}
        </if>
    </delete>
    <select id="getEvtApplcnEnable" resultType="java.lang.String">
    /* [promotion.event.xml][getEvtApplcnEnable][이벤트 응모 가능여부 체크][홍찬희] */    
		SELECT EVT_NO
		  FROM EVT T1
		 WHERE T1.EVT_STAT_CD = 'APRV'
		   AND TO_CHAR (SYSDATE, 'HH24MI') BETWEEN DATEBY_APPLCN_BEG_HOUR AND DATEBY_APPLCN_END_HOUR
		   AND SYSDATE BETWEEN APPLCN_BEG_DT AND APPLCN_END_DT AND EVT_NO = #{evtNo,jdbcType=VARCHAR}  
    </select>
    <select id="selectTimeCouponPrizeCountByDay" resultType="java.lang.Integer">
    /* [promotion.event.xml][getEvtApplcnEnable][타임쿠폰 경품별 당일 당첨수 조회][홍찬희] */    
		SELECT COUNT (1)
		  FROM EVT_PRIZE T1, EVT_PRIZE_FREE_GIFT T2
		 WHERE T1.EVT_PARTCPTN_SN = T2.EVT_PARTCPTN_SN
		   AND T1.PRIZE_TURN = T2.PRIZE_TURN
		   AND T2.EVT_NO = #{evtNo,jdbcType=VARCHAR}  
		   AND FREE_GIFT_TURN = #{freeGiftTurn,jdbcType=NUMERIC}  
		   AND TO_CHAR (T1.PRIZE_DT, 'YYYYMMDD') = TO_CHAR (SYSDATE, 'YYYYMMDD')    
    </select>
    <select id="selectEvtPartcptnTgtList" resultType="com.plgrim.ncp.base.entities.datasource1.evt.EvtPartcptnTgt">
    /* [promotion.event.xml][selectEvtPartcptnTgtList][이벤트 응모 대상 조건 목록 조회][홍찬희] */    
		SELECT *
		  FROM EVT_PARTCPTN_TGT
		 WHERE EVT_NO = #{evtNo,jdbcType=VARCHAR}  
    </select>
    <select id="selectEvtApplMemList" resultType="java.lang.String">
     /* [promotion.event.xml][selectEvtApplMemList][응모자로부터 당첨][홍찬희] */        
		  SELECT mbr_no
		    FROM (  SELECT mbr_no, MIN (applcn_dt) applcn_dt
		              FROM (  SELECT mbr_no, applcn_dt
		                        FROM evt_applcn
		                       WHERE evt_no = #{evtNo,jdbcType=VARCHAR}
		                         AND TO_CHAR (applcn_dt - (1 / 24 * 9), 'YYYYMMDD') = TO_CHAR (SYSDATE - (1 / 24 * 9), 'YYYYMMDD')
		                         AND applcn_dt <![CDATA[ > ]]> TO_DATE ('201509010900', 'yyyymmddhhmi')
		                    ORDER BY applcn_dt)
		          GROUP BY mbr_no)
		ORDER BY applcn_dt		
    </select>
    <select id="checkEventEnable" resultType="java.lang.String">
		SELECT 1
		  FROM evt
		 WHERE TO_CHAR (applcn_beg_dt, 'yyyymmdd') <![CDATA[ <= ]]> TO_CHAR (SYSDATE, 'yyyymmdd')
		   AND TO_CHAR (applcn_end_dt, 'yyyymmdd') <![CDATA[ >= ]]> TO_CHAR (SYSDATE, 'yyyymmdd')
		   AND evt_stat_cd = 'APRV'
		   AND evt_no = #{evtNo,jdbcType=VARCHAR}
    </select>    
    
    <!-- 이벤트 경품(쿠폰) 목록 가져오기 -->
    <select id="selecEvtFreeGiftList" resultType="com.plgrim.ncp.biz.promotion.data.EventFreeGiftTurnExtendsFoDTO">
        /* [promotion.event.xml][selecEvtFreeGiftList][이벤트 경품 목록 가져오기][Leo] */
         SELECT   EVT.EVT_NO
                , EFGI.CPN_PRM_NO
                , (EFGI.PRIZE_QTY - (SELECT COUNT(*)
                                      FROM MBR_ISSU_CPN
                                     WHERE PRM_NO = EFGI.CPN_PRM_NO
                                       AND TO_CHAR(CPN_PUBLI_DT, 'yyyymmdd') = TO_CHAR(SYSDATE, 'yyyymmdd'))
                  ) PRIZE_QTY
           FROM EVT EVT JOIN EVT_FREE_GIFT_INFO EFGI
                          ON EVT.EVT_NO = EFGI.EVT_NO
          WHERE EVT.EVT_NO = #{evtNo, jdbcType=VARCHAR}
            AND EVT.EVT_BEG_DT <![CDATA[ <= ]]> SYSDATE
            AND EVT.EVT_END_DT <![CDATA[ >= ]]> SYSDATE
            AND EFGI.FREE_GIFT_KND_CD = 'CPN'
            AND EVT_STAT_CD = 'APRV'
    </select>
    
    <select id="seleceventCouponDownIssueCheck" resultType="java.lang.String">
        /* [promotion.event.xml][seleceventCouponDownIssueCheck][경품(쿠폰) 재고 잔여 여부][Leo] */
         SELECT CASE
                  WHEN APPLCN_BEG_DT <![CDATA[ > ]]> TO_CHAR(SYSDATE, 'YYYYMMDD') THEN 'ISMCBTW_OFF'
                  WHEN APPLCN_END_DT <![CDATA[ < ]]> TO_CHAR(SYSDATE, 'YYYYMMDD') THEN 'ISMCBTW_OFF'
                  WHEN APPLCN_BEG_HOUR <![CDATA[ > ]]> TO_CHAR(SYSDATE, 'HH24MISS') THEN 'ISMCBTW_OFF'
                  WHEN APPLCN_END_HOUR <![CDATA[ < ]]> TO_CHAR(SYSDATE, 'HH24MISS') THEN 'ISMCBTW_OFF'
                  WHEN MBR_ISSU_CNT <![CDATA[ > ]]> 0 THEN 'IDBY_ISSU_QTY_EXCESS'
                  WHEN PRIZE_QTY = 0 THEN 'TOT_ISSU_QTY_EXCESS'
                  ELSE 'SUCCES'
                END ISSU_YN
           FROM (SELECT   EVT.EVT_NO
                        , EFGI.CPN_PRM_NO
                        , TO_CHAR(EVT.APPLCN_BEG_DT, 'YYYYMMDD') AS APPLCN_BEG_DT
                        , EVT.DATEBY_APPLCN_BEG_HOUR || '00' AS APPLCN_BEG_HOUR
                        , TO_CHAR(EVT.APPLCN_END_DT, 'YYYYMMDD') AS APPLCN_END_DT
                        , EVT.DATEBY_APPLCN_END_HOUR || '59' AS APPLCN_END_HOUR
                        , EFGI.PRPARE_FREE_GIFT_QTY
                        , EFGI.FREE_GIFT_INV_QTY
                        , EFGI.PRIZE_QTY - (SELECT COUNT(*)
                                              FROM MBR_ISSU_CPN
                                             WHERE PRM_NO = EFGI.CPN_PRM_NO
                                               AND TO_CHAR(CPN_PUBLI_DT, 'yyyymmdd') = TO_CHAR(SYSDATE, 'yyyymmdd')) PRIZE_QTY
                        , (SELECT COUNT(*)
                             FROM MBR_ISSU_CPN
                            WHERE PRM_NO = EFGI.CPN_PRM_NO
                              AND TO_CHAR(CPN_PUBLI_DT, 'yyyymmdd') = TO_CHAR(SYSDATE, 'yyyymmdd')
                              AND MBR_NO = #{mbrNo, jdbcType=VARCHAR}) MBR_ISSU_CNT
                   FROM EVT EVT JOIN EVT_FREE_GIFT_INFO EFGI
                                  ON EVT.EVT_NO = EFGI.EVT_NO
                  WHERE EVT.EVT_NO = #{evtNo, jdbcType=VARCHAR}
                    AND EVT.EVT_BEG_DT <![CDATA[ <= ]]> SYSDATE
                    AND EVT.EVT_END_DT <![CDATA[ >= ]]> SYSDATE
                    AND EFGI.FREE_GIFT_KND_CD = 'CPN'
                    AND EVT_STAT_CD = 'APRV') X
    </select>
    
    
    <resultMap id="evtPayBagResultMap" type="com.plgrim.ncp.biz.promotion.result.EventOthersMemberResult">
    	<result property="ord.ordNo" 												column="ORD_NO"/>								<!-- 주문 번호 -->
    	<result property="ord.stdrCrncySumAmt" 							column="STDR_CRNCY_SUM_AMT"/>		<!-- 기준 통화 합계 금액 -->
    	<result property="ord.unityPntUseSumAmt" 							column="UNITY_PNT_USE_SUM_AMT"/>	<!-- 통합 포인트 사용 합계 금액 -->
    	<result property="ord.saleSumAmt"										column="SALE_SUM_AMT"/>					<!-- 판매 합계 금액 -->
    	<result property="ord.regDt" 												column="REG_DT"/>								<!-- 등록 일시 -->
    </resultMap>
    
    <select id="selectNoClaimEvtApplCnOrdList" parameterType="com.plgrim.ncp.biz.promotion.data.EventSearchFoDTO" resultMap="evtPayBagResultMap">
    /* [promotion.event.xml][selectNoClaimEvtApplCnOrdList][이벤트 응모 대상 조건 주문 목록 조회(클레임 보지 않음) - paybag Event용][Neps] */
		SELECT 
		      ORD.ORD_NO
		    , ORD.STDR_CRNCY_SUM_AMT
		    , ORD.UNITY_PNT_USE_SUM_AMT    
		    , ORD.SALE_SUM_AMT
		    , ORD.REG_DT  
		  FROM ORD ORD 
		  JOIN MBR MBR 
		  ON ORD.MBR_NO = MBR.MBR_NO
		 WHERE 1=1
		   AND MBR.MBR_NO = #{mbrNo,jdbcType=VARCHAR}
		   AND ORD.ORD_DT BETWEEN TO_DATE(#{begDt, jdbcType=VARCHAR}, 'yyyyMMdd') AND TO_DATE(#{endDt, jdbcType=VARCHAR}, 'yyyyMMdd')+1-1/86400
		   AND ORD.ORD_STAT_CD IN ('PAY_COMPT','RESVE_ORD_PAY_COMPT','DLV_PRPARE','DLV_PROGRS','DLV_COMPT')		   
		   <if test="pchAmt != null and pchAmt > 0 ">
		   AND (ORD.STDR_CRNCY_SUM_AMT + ORD.UNITY_PNT_USE_SUM_AMT) <![CDATA[>=]]> #{pchAmt, jdbcType=NUMERIC}
		   </if>		   
		 ORDER BY ORD.ORD_DT DESC     
    </select>
    
    <select id="isExsistEvtApplCn" parameterType="com.plgrim.ncp.biz.promotion.data.EventSearchFoDTO" resultType="java.lang.String">
    /* [promotion.event.xml][isExsistEvtApplCn][이벤트 응모 여부 확인 - paybag Event용][Neps] */
	    SELECT EA.EVT_PARTCPTN_SN
	      FROM EVT E          
	      JOIN EVT_APPLCN EA
	      ON E.EVT_NO = EA.EVT_NO             
	     WHERE 1 = 1
	       AND E.EVT_STAT_CD = 'APRV'
	       AND E.EVT_NO = #{evtNo,jdbcType=VARCHAR}
	       <if test="!@com.plgrim.ncp.framework.commons.StringService@isEmpty(mbrNo)">
	       AND EA.MBR_NO = #{mbrNo, jdbcType=VARCHAR}
	       </if>
    </select>

    <resultMap id="validEventPartcptnApplcnResultMap" type="com.plgrim.ncp.biz.promotion.result.EventBoResult">
        <result property="evt.evtNo"                column="EVT_NO"/>
        <result property="evt.evtNm"                column="EVT_NM"/>
        <result property="evt.upperEvtNo"           column="UPPER_EVT_NO"/>
        <result property="evt.rprstLwprtSectCd"     column="RPRST_LWPRT_SECT_CD"/>
        <result property="evt.evtTpCd"              column="EVT_TP_CD"/>
        <result property="evt.evtStatCd"            column="EVT_STAT_CD"/>
        <result property="evt.applcnBegDt"          column="APPLCN_BEG_DT"/>
        <result property="evt.applcnEndDt"          column="APPLCN_END_DT"/>
        <result property="evt.applcnCountSectCd"    column="APPLCN_COUNT_SECT_CD"/>
        <result property="applcnDateCheck"          column="APPLCN_DATE_CHECK"/>
        <result property="memberTypeCheck"          column="MEMBER_TYPE_CHECK"/>
        <result property="deviceCheck"              column="DEVICE_CHECK"/>
        <result property="deviceCodes"              column="DEVICE_CODES"/>
        <result property="evtFreeGiftInfo.freeGiftTurn"         column="FREE_GIFT_TURN"/>
        <result property="evtFreeGiftInfo.freeGiftKndCd"        column="FREE_GIFT_KND_CD"/>
        <result property="evtFreeGiftInfo.prpareFreeGiftQty"    column="PRPARE_FREE_GIFT_QTY"/>
        <result property="evtFreeGiftInfo.prizeQty"             column="PRIZE_QTY"/>
        <result property="evtFreeGiftInfo.cpnPrmNo"             column="CPN_PRM_NO"/>
        <result property="evtFreeGiftInfo.pntAmt"               column="PNT_AMT"/>
        <result property="evtFreeGiftInfo.webpntAmt"            column="WEBPNT_AMT"/>
        <result property="evtFreeGiftInfo.webpntUseBegDt"            column="WEBPNT_USE_BEG_DT"/>
        <result property="evtFreeGiftInfo.webpntUseEndDt"            column="WEBPNT_USE_END_DT"/>
        <result property="evtFreeGiftInfo.stmpCount"            column="STMP_COUNT"/>
        <result property="mbrNo"                                column="MBR_NO"/>
        <result property="applcnCount"                          column="APPLCN_COUNT"/>
        <result property="applcnCheck"                          column="APPLCN_CHECK"/>
        <result property="prmAplPdCheck"                          column="PRM_APL_PD_CHECK"/>
    </resultMap>
    
    <select id="validEventPartcptn" parameterType="com.plgrim.ncp.biz.promotion.data.EventBoDTO" resultMap="validEventPartcptnApplcnResultMap">
    /* [promotion.event.xml][validEventPartcptn][이벤트 참여 유효성 체크] */
	    SELECT
              E.EVT_NO
            , E.UPPER_EVT_NO
            , E.RPRST_LWPRT_SECT_CD
            , E.EVT_TP_CD
            , E.EVT_STAT_CD
            , E.APPLCN_BEG_DT
            , E.APPLCN_END_DT
            , CASE E.EVT_TP_CD
                  WHEN 'TM_CPN'
                  THEN
                      CASE
                          WHEN EXISTS(SELECT 1 FROM EVT_FREE_GIFT_APL_PD AP WHERE E.EVT_NO = AP.EVT_NO AND SYSDATE BETWEEN AP.BEG_DT AND AP.END_DT)
                          THEN 'Y'
                          ELSE 'N'
                      END
                  ELSE
                      CASE
                          WHEN SYSDATE BETWEEN E.APPLCN_BEG_DT AND E.APPLCN_END_DT
                          THEN 'Y'
                          ELSE 'N'
                      END
              END AS APPLCN_DATE_CHECK
            , CASE
                  WHEN EXISTS(SELECT 1 FROM EVT_PARTCPTN_TGT T WHERE E.EVT_NO = T.EVT_NO AND T.TGT_MBR_TP_CD = (SELECT M.MBR_TP_CD FROM MBR M WHERE M.MBR_NO = #{mbrNo:VARCHAR}))
                  THEN 'Y'
                  ELSE 'N'
              END AS MEMBER_TYPE_CHECK
            , CASE
                  WHEN EXISTS(SELECT 1 FROM EVT_PARTCPTN_TGT T WHERE E.EVT_NO = T.EVT_NO AND T.DVC_CD = #{device:VARCHAR})
                  THEN 'Y'
                  ELSE 'N'
              END AS DEVICE_CHECK
            , (SELECT
                     LISTAGG(ET.DVC_CD,',') WITHIN GROUP(ORDER BY ET.APL_TURN) AS DVC_CD
               FROM  EVT_PARTCPTN_TGT ET
               WHERE 1 = 1
               AND   ET.EVT_NO = E.EVT_NO
              ) AS DEVICE_CODES
        FROM  EVT E
        WHERE 1 = 1
        AND   E.EVT_NO = #{evtNo:VARCHAR}
    </select>
    
    <select id="validEventApplcn" parameterType="com.plgrim.ncp.biz.promotion.data.EventBoDTO" resultMap="validEventPartcptnApplcnResultMap">
    /* [promotion.event.xml][validEventApplcn][이벤트 응모 유효성 체크] */
	    SELECT
               E.APPLCN_COUNT
             , E.EVT_NO
             , E.EVT_NM
             , E.EVT_TP_CD
             , E.MBR_NO
             , E.MBR_ATRB_CD
             , E.APPLCN_COUNT_SECT_CD
             , E.APPLCN_CHECK
             , FG.FREE_GIFT_TURN
             , FG.FREE_GIFT_KND_CD
             , FG.PRPARE_FREE_GIFT_QTY
             , FG.PRIZE_QTY
             , FG.CPN_PRM_NO
             , CASE FG.FREE_GIFT_KND_CD
                    WHEN 'CPN'
                    THEN
                        CASE
                            WHEN EXISTS(SELECT 1 FROM PRM_APL_PD P WHERE FG.CPN_PRM_NO = P.PRM_NO AND P.APL_PD_CD = 'APL_PD' AND SYSDATE BETWEEN P.BEG_DT AND P.END_DT)
                            THEN 'Y'
                            ELSE 'N'
                        END
                    ELSE 'Y'
               END AS PRM_APL_PD_CHECK
             , FG.PNT_AMT
			 , FG.WEBPNT_AMT
			 , FG.WEBPNT_USE_BEG_DT
			 , FG.WEBPNT_USE_END_DT
			 , FG.STMP_COUNT
         FROM  (
                  SELECT
                        A.APPLCN_COUNT
                      , A.EVT_NO
                      , (SELECT EVT_NM FROM EVT WHERE EVT_NO = A.EVT_NO) AS EVT_NM
                      , (SELECT EVT_TP_CD FROM EVT WHERE EVT_NO = A.EVT_NO) AS EVT_TP_CD
                      , A.MBR_NO
                      , (SELECT MBR_ATRB_CD FROM MBR WHERE MBR_NO = A.MBR_NO) AS MBR_ATRB_CD
                      , (SELECT APPLCN_COUNT_SECT_CD FROM EVT WHERE EVT_NO = A.EVT_NO) AS APPLCN_COUNT_SECT_CD
                      , CASE  (SELECT APPLCN_COUNT_SECT_CD FROM EVT WHERE EVT_NO = A.EVT_NO)
                            WHEN 'EVT_STDR_1BT'
                            THEN
                                CASE
                                    WHEN A.APPLCN_COUNT > 0
                                    THEN 'N'
                                    ELSE 'Y'
                                END
                            WHEN '1DAY_1BT'
                            THEN
                                CASE
                                    WHEN  EXISTS (SELECT 1
                                                  FROM EVT_APPLCN
                                                  WHERE EVT_NO = A.EVT_NO
                                                  AND MBR_NO = A.MBR_NO
                                                  AND TO_CHAR(SYSDATE, 'YYYYMMDD') = TO_CHAR(APPLCN_DT, 'YYYYMMDD')
                                                  <if test="@com.plgrim.ncp.framework.commons.StringService@equalsIgnoreCase(multiDownloadYn,'Y')">
                                                  AND   FREE_GIFT_TURN = #{freeGiftInfo.freeGiftTurn, jdbcType=NUMERIC}
                                                  </if>
                                                 )
                                    THEN 'N'
                                    ELSE 'Y'
                                END
                            ELSE 'Y'
                        END AS APPLCN_CHECK
                  FROM  (
                           SELECT
                                 COUNT(1) AS APPLCN_COUNT
                               , #{evtNo:VARCHAR} AS EVT_NO
                               , #{mbrNo:VARCHAR} AS MBR_NO
                           FROM  EVT_APPLCN E
                           WHERE 1 = 1
                           AND   E.EVT_NO = #{evtNo:VARCHAR}
                           AND   E.MBR_NO = #{mbrNo:VARCHAR}
                           <if test="@com.plgrim.ncp.framework.commons.StringService@equalsIgnoreCase(multiDownloadYn,'Y')">
                           AND   E.FREE_GIFT_TURN = #{freeGiftInfo.freeGiftTurn, jdbcType=NUMERIC}
                           </if>
                        ) A
               ) E
		<choose>
			<when test="evtTpCd != null and evtTpCd.equals('TM_CPN')">
				LEFT OUTER JOIN (SELECT * FROM EVT_FREE_GIFT_INFO F WHERE F.EVT_NO = #{evtNo:VARCHAR} AND F.FREE_GIFT_TURN = (SELECT MIN(A.FREE_GIFT_TURN) FROM EVT_FREE_GIFT_INFO A WHERE A.EVT_NO = #{evtNo:VARCHAR})) FG
			</when>
			<otherwise>
				LEFT OUTER JOIN EVT_FREE_GIFT_INFO FG
			</otherwise>
		</choose>
        ON   E.EVT_NO = FG.EVT_NO
        <if test="evtTpCd != null and !evtTpCd.equals('TM_CPN')">
	        <choose>
	            <when test="evtTpCd.equals('ALL_PRIZE')">
	            AND  FG.PRIZE_RANK = #{prizeRank:NUMERIC}
	            </when>
	            <when test="evtTpCd.equals('ALL_DRWT')">
	            AND  FG.FREE_GIFT_TURN = #{evtApplcn.freeGiftTurn,jdbcType=VARCHAR}
	            </when>
	            <!--<when test="evtTpCd.equals('TM_CPN')">
	            AND  FG.FREE_GIFT_TURN = (SELECT MIN(FREE_GIFT_TURN) FROM FREE_GIFT_INFO WHERE EVT_NO =  #{evtNo:VARCHAR})
	            </when>-->
	           <!-- <when test="evtTpCd.equals('STMP')">
	            AND  (E.APPLCN_COUNT + 1) <![CDATA[<=]]> FG.STMP_COUNT
	            AND ROWNUM = 1
	            </when>-->
				<when test="evtTpCd.equals('STMP') and randomStmpYn == 'RANDOM' ">
					AND FG.FREE_GIFT_TURN = #{freeGiftInfo.freeGiftTurn, jdbcType=NUMERIC}
				</when>
	            <otherwise>
	            AND  (E.APPLCN_COUNT + 1) = CASE E.EVT_TP_CD
	                                              WHEN 'SNS_REPLY' THEN FG.PRIZE_RANK
	                                              WHEN 'ATEND_CHK' THEN FG.ATEND_DAYCNT
	                                              WHEN 'STMP'      THEN FG.STMP_COUNT
	                                              ELSE	FG.PRIZE_RANK
	                                         END
	            </otherwise>
	    	</choose>
        </if>
	 	<if test="evtTpCd == null">
         	AND ROWNUM = 1
        </if>
    </select>
    
    <select id="selectEventTotalPrize" parameterType="com.plgrim.ncp.biz.promotion.data.EventBoDTO" resultMap="validEventPartcptnApplcnResultMap">
    /* [promotion.event.xml][selectEventTotalPrize][이벤트 총 당첨정보] */
         SELECT
               COUNT(EP.EVT_NO) AS APPLCN_COUNT
             , SUM((SELECT DECODE(GI.FREE_GIFT_KND_CD, 'PNT', GI.PNT_AMT, 'WEBPNT', GI.WEBPNT_AMT, 0) AS PNT_AMT FROM EVT_FREE_GIFT_INFO GI, EVT_PRIZE_FREE_GIFT FG WHERE GI.EVT_NO = EP.EVT_NO AND GI.FREE_GIFT_TURN = FG.FREE_GIFT_TURN AND FG.EVT_PARTCPTN_SN = EP.EVT_PARTCPTN_SN)) AS PNT_AMT
         FROM  EVT_PRIZE EP
         JOIN  EVT_APPLCN EA
         ON    EA.EVT_PARTCPTN_SN = EP.EVT_PARTCPTN_SN
         AND   EA.EVT_NO = EP.EVT_NO
         AND   EA.MBR_NO = #{mbrNo:VARCHAR}
         WHERE 1 = 1
         AND   EP.EVT_NO = #{evtNo:VARCHAR}
    </select>
    
    <select id="validEventApplcnList" parameterType="com.plgrim.ncp.biz.promotion.data.EventBoDTO" resultMap="validEventPartcptnApplcnResultMap">
	    SELECT /* [promotion.event.xml][validEventApplcnList][이벤트 응모 유효성 체크리스트] */
               E.APPLCN_COUNT
             , E.EVT_NO
             , E.EVT_NM
             , E.EVT_TP_CD
             , E.MBR_NO
             , E.MBR_ATRB_CD
             , E.APPLCN_COUNT_SECT_CD
             , E.APPLCN_CHECK
             , FG.FREE_GIFT_TURN
             , FG.FREE_GIFT_KND_CD
             , FG.PRPARE_FREE_GIFT_QTY
             , FG.PRIZE_QTY
             , FG.CPN_PRM_NO
             , CASE FG.FREE_GIFT_KND_CD
                    WHEN 'CPN'
                    THEN
                        CASE
                            WHEN EXISTS(SELECT 1 FROM PRM_APL_PD P WHERE FG.CPN_PRM_NO = P.PRM_NO AND P.APL_PD_CD = 'APL_PD' AND SYSDATE BETWEEN P.BEG_DT AND P.END_DT)
                            THEN 'Y'
                            ELSE 'N'
                        END
                    ELSE 'Y'
               END AS PRM_APL_PD_CHECK
             , FG.PNT_AMT
         FROM  (
                  SELECT
                        A.APPLCN_COUNT
                      , A.EVT_NO
                      , (SELECT EVT_NM FROM EVT WHERE EVT_NO = A.EVT_NO) AS EVT_NM
                      , (SELECT EVT_TP_CD FROM EVT WHERE EVT_NO = A.EVT_NO) AS EVT_TP_CD
                      , A.MBR_NO
                      , (SELECT MBR_ATRB_CD FROM MBR WHERE MBR_NO = A.MBR_NO) AS MBR_ATRB_CD
                      , (SELECT APPLCN_COUNT_SECT_CD FROM EVT WHERE EVT_NO = A.EVT_NO) AS APPLCN_COUNT_SECT_CD
                      , CASE  (SELECT APPLCN_COUNT_SECT_CD FROM EVT WHERE EVT_NO = A.EVT_NO)
                            WHEN 'EVT_STDR_1BT'
                            THEN
                                CASE
                                    WHEN A.APPLCN_COUNT > 0
                                    THEN 'N'
                                    ELSE 'Y'
                                END
                            WHEN '1DAY_1BT'
                            THEN
                                CASE
                                    WHEN  EXISTS (SELECT 1 FROM EVT_APPLCN WHERE EVT_NO = A.EVT_NO AND MBR_NO = A.MBR_NO AND TO_CHAR(SYSDATE, 'YYYYMMDD') = TO_CHAR(APPLCN_DT, 'YYYYMMDD'))
                                    THEN 'N'
                                    ELSE 'Y'
                                END
                            ELSE 'Y'
                        END AS APPLCN_CHECK
                  FROM  (
                           SELECT
                                 COUNT(1) AS APPLCN_COUNT
                               , #{evtNo:VARCHAR} AS EVT_NO
                               , #{mbrNo:VARCHAR} AS MBR_NO
                           FROM  EVT_APPLCN E
                           WHERE 1 = 1
                           AND   E.EVT_NO = #{evtNo:VARCHAR}
                           AND   E.MBR_NO = #{mbrNo:VARCHAR}
                        ) A
               ) E
         LEFT OUTER JOIN EVT_FREE_GIFT_INFO FG ON   E.EVT_NO = FG.EVT_NO
    </select>
    
    <select id="validEventApplcn_1" parameterType="com.plgrim.ncp.biz.promotion.data.EventBoDTO" resultMap="validEventPartcptnApplcnResultMap">
	    /* [promotion.event.xml][validEventApplcn_1][이벤트 응모 유효성 체크_1] */
	    SELECT
	           E.APPLCN_COUNT
	         , E.EVT_NO
	         , E.EVT_NM
	         , E.EVT_TP_CD
	         , E.MBR_NO
	         , E.MBR_ATRB_CD
	         , E.APPLCN_COUNT_SECT_CD
	         , E.APPLCN_CHECK
	         , CASE E.EVT_TP_CD
                  WHEN 'TM_CPN'
                  THEN
                      CASE
                          WHEN EXISTS(SELECT 1 FROM EVT_FREE_GIFT_APL_PD AP WHERE E.EVT_NO = AP.EVT_NO AND SYSDATE BETWEEN AP.BEG_DT AND AP.END_DT)
                          THEN 'Y'
                          ELSE 'N'
                      END
                  ELSE
                      CASE
                          WHEN EXISTS(SELECT 1 FROM EVT EV WHERE EV.EVT_NO = E.EVT_NO AND SYSDATE BETWEEN EV.APPLCN_BEG_DT AND EV.APPLCN_END_DT)
                          THEN 'Y'
                          ELSE 'N'
                      END
              END AS APPLCN_DATE_CHECK
	         , FG.FREE_GIFT_TURN
	         , FG.FREE_GIFT_KND_CD
	         , FG.PRPARE_FREE_GIFT_QTY
	         , FG.PRIZE_QTY
	         , FG.CPN_PRM_NO
	         , CASE FG.FREE_GIFT_KND_CD
	                WHEN 'CPN'
	                THEN
	                    CASE
	                        WHEN EXISTS(SELECT 1 FROM PRM_APL_PD P WHERE FG.CPN_PRM_NO = P.PRM_NO AND P.APL_PD_CD = 'APL_PD' AND SYSDATE BETWEEN P.BEG_DT AND P.END_DT)
	                        THEN 'Y'
	                        ELSE 'N'
	                    END
	                ELSE 'Y'
	           END AS PRM_APL_PD_CHECK
	         , FG.PNT_AMT
	         , FG.WEBPNT_AMT
	         , FG.WEBPNT_USE_BEG_DT
	         , FG.WEBPNT_USE_END_DT
	     FROM  (
	              SELECT
	                    A.APPLCN_COUNT
	                  , A.EVT_NO
	                  , (SELECT EVT_NM FROM EVT WHERE EVT_NO = A.EVT_NO) AS EVT_NM
	                  , (SELECT EVT_TP_CD FROM EVT WHERE EVT_NO = A.EVT_NO) AS EVT_TP_CD
	                  , A.MBR_NO
	                  , (SELECT MBR_ATRB_CD FROM MBR WHERE MBR_NO = A.MBR_NO) AS MBR_ATRB_CD
	                  , (SELECT APPLCN_COUNT_SECT_CD FROM EVT WHERE EVT_NO = A.EVT_NO) AS APPLCN_COUNT_SECT_CD
	                  , CASE  (SELECT APPLCN_COUNT_SECT_CD FROM EVT WHERE EVT_NO = A.EVT_NO)
	                        WHEN 'EVT_STDR_1BT'
	                        THEN
	                            CASE
	                                WHEN A.APPLCN_COUNT > 0
	                                THEN 'N'
	                                ELSE 'Y'
	                            END
	                        WHEN '1DAY_1BT'
	                        THEN
	                            CASE      
	                                WHEN EXISTS (SELECT 1 FROM EVT_APPLCN WHERE EVT_NO = A.EVT_NO AND MBR_NO = A.MBR_NO AND TO_CHAR(SYSDATE, 'YYYYMMDD') = TO_CHAR(APPLCN_DT, 'YYYYMMDD'))
	                                THEN 'N'
	                                ELSE 'Y'
	                            END
	                        ELSE 'Y'
	                    END AS APPLCN_CHECK
	              FROM  (
	                       SELECT
	                             COUNT(1) AS APPLCN_COUNT
	                           , #{evtNo:VARCHAR} AS EVT_NO
	                           , #{mbrNo:VARCHAR} AS MBR_NO
	                       FROM  EVT_APPLCN E
	                       WHERE 1 = 1
	                       AND   E.EVT_NO = #{evtNo:VARCHAR}
	                       AND   E.MBR_NO = #{mbrNo:VARCHAR}
	                    ) A
	           ) E
	    LEFT OUTER JOIN EVT_FREE_GIFT_INFO FG
	    ON   E.EVT_NO = FG.EVT_NO
	    AND  FG.PRIZE_RANK = #{prizeRank:NUMERIC}
	</select>


	<!-- 이벤트 약관 조회 -->
	<select id="selectStplatList" parameterType="sysStplat" resultType="sysStplat">
		SELECT 	/* [promotion.event.xml][selectStplatList][이벤트 약관 조회] */
				SS.STPLAT_CD 	stplatCd,
				SS.STPLAT_DSCR 	stplatDscr,
				SS.STPLAT_CONT 	stplatCont
		FROM 	SYS_STPLAT SS, SYS_STPLAT_USE SSU
		WHERE 	SS.STPLAT_CD = SSU.STPLAT_CD
		AND 	SSU.STPLAT_USE_TP_CD = #{stplatUseTpCd:VARCHAR} /* PRM_EVT_PARTCPTN */
	</select>

    <select id="selectCampaginEvtInfo" resultType="java.lang.String">
    /* [promotion.event.xml][selectCampaginEvtInfo][수신동의 유도 캠페인 이벤트 응모가능여부][Moon.Sungho] */
		SELECT 
				CASE WHEN EVT_BEG_DT <![CDATA[<=]]> SYSDATE AND EVT_END_DT <![CDATA[>=]]> SYSDATE THEN 'Y' ELSE 'N' END EVENT_ENTRY_YN
		  FROM EVT
		 WHERE 1=1
		   AND EVT_NO = #{evtNo,jdbcType=VARCHAR}
    </select>

    <select id="selectFnMakingData" parameterType="java.util.HashMap" resultType="java.lang.String">
		SELECT /* [promotion.event.xml][selectFnMakingData][마스킹 처리 후 반환][yoonsh] */ 
			   FN_MASKING(#{maskingType}, #{sourceString}, '', #{maskingYn}) AS RETURN_STRING
		  FROM DUAL
    </select>

	<select id="selectEvtStmpCount" parameterType="com.plgrim.ncp.base.entities.datasource1.evt.EvtStmpExtend" resultType="java.lang.Integer">
		SELECT /* [promotion.event.xml][selectEvtStmpCount][이벤트 스탬프 건수 조회][Id] */ 
			   COUNT(1)
		  FROM EVT_STMP
		 WHERE 1=1
		   AND EVT_NO = #{evtNo,jdbcType=VARCHAR}
		 <if test="@com.plgrim.ncp.framework.commons.StringService@isNotEmpty(freeGiftTurn) and freeGiftTurn != 0">
		   AND FREE_GIFT_TURN = #{freeGiftTurn, jdbcType=NUMERIC}
		 </if>
		 <if test="@com.plgrim.ncp.framework.commons.StringService@isNotEmpty(mbrNo)">
		   AND MBR_NO = #{mbrNo,jdbcType=VARCHAR}
		 </if>
		 <if test="@com.plgrim.ncp.framework.commons.StringService@isNotEmpty(selectType) and selectType.equals('TOTAL')">
		   AND STMP_DT BETWEEN TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD')||'000000', 'YYYYMMDDHH24MISS') AND TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD')||'235959', 'YYYYMMDDHH24MISS')
		 </if>
    </select>

</mapper>
