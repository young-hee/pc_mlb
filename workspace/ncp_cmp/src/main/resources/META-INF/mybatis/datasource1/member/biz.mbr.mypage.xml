<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.plgrim.ncp.biz.mypage">

    <resultMap id="mtmResult" type="com.plgrim.ncp.biz.member.result.MypageMtmFoResult">
        <result property="csoMtmInq.mtmInqSn" column="MTM_INQ_SN" />
        <result property="inqRegDt" column="inqRegDt" />
        <result property="csoMtmInq.inqTpCd" column="INQ_TP_CD" />
        <result property="csoMtmInq.inqMbrNo" column="INQ_MBR_NO" />
        <result property="csoMtmInq.inqCstmrNm" column="INQ_CSTMR_NM" />
        <result property="csoMtmInq.inqSj" column="INQ_SJ" />
        <result property="csoMtmInq.inqCont" column="INQ_CONT" />
        <result property="deleteYn" column="DELETE_YN" />
        <result property="csoMtmInq.inqDt" column="INQ_DT" />
        <result property="inqDt" column="inqDt" />
        <result property="csoMtmInq.ansStatCd" column="ANS_STAT_CD" />
        <result property="csoMtmInq.inqireCount" column="INQIRE_COUNT" />
        <result property="csoMtmInq.prcsComptDt" column="PRCS_COMPT_DT" />
        <result property="csoMtmInq.cstmrEmail" column="CSTMR_EMAIL" />
        <result property="csoMtmInq.cstmrtelAreaNo" column="CSTMRTEL_AREA_NO" />
        <result property="csoMtmInq.cstmrtelTlofNo" column="CSTMRTEL_TLOF_NO" />
        <result property="csoMtmInq.cstmrtelTlofWthnNo" column="CSTMRTEL_TLOF_WTHN_NO" />
        <result property="csoMtmInq.cstmrtelNationNo" column="CSTMRTEL_NATION_NO" />
        <result property="csoMtmInq.cstmrmobilAreaNo" column="CSTMRMOBIL_AREA_NO" />
        <result property="csoMtmInq.cstmrmobilTlofNo" column="CSTMRMOBIL_TLOF_NO" />
        <result property="csoMtmInq.cstmrmobilTlofWthnNo" column="CSTMRMOBIL_TLOF_WTHN_NO" />
        <result property="csoMtmInq.cstmrmobilNationNo" column="CSTMRMOBIL_NATION_NO" />
        <result property="csoMtmInq.cstmrSmsRecptnYn" column="CSTMR_SMS_RECPTN_YN" />
        <result property="csoMtmInq.cstmrEmailRecptnYn" column="CSTMR_EMAIL_RECPTN_YN" />
        <result property="csoMtmInq.langCd" column="LANG_CD" />
        <result property="csoMtmInq.mallId" column="MALL_ID" />

        <result property="csoMtmInq.ansEvlCd"					column="ANS_EVL_CD"/>
		<result property="csoMtmInq.ansEvlCont"					column="ANS_EVL_CONT"/>
		<result property="csoMtmInq.ansEvlWritngDt"				column="ANS_EVL_WRITNG_DT"/>
		<result property="csoMtmInq.ansEvlAdminAnsCont"			column="ANS_EVL_ADMIN_ANS_CONT"/>
		<result property="csoMtmInq.ansEvlAdminAnsDt"			column="ANS_EVL_ADMIN_ANS_DT"/>

        <result property="csoMtmInq.regtrId" column="REGTR_ID" />
        <result property="csoMtmInq.udterId" column="UDTER_ID" />
        <result property="csoMtmInq.udtDt" column="UDT_DT" />
        <result property="csoMtmInqAns.ansSj" column="ANS_SJ" />
        <result property="mtmInqSn" column="mtmInqSn" />
        <result property="csoMtmInqAns.ansCont" column="ANS_CONT" />
        <result property="csoMtmInqAns.detailAnsStatCd" column="DETAIL_ANS_STAT_CD" />
        <result property="csoMtmInqAns.ansCnfirmYn" column="ANS_CNFIRM_YN" />
        <result property="csoMtmInqAns.regDt" column="REG_DT" />
        <result property="ansRegDt" column="ansRegDt" />

        <result property="csoMtmInqOrdGod.mtmInqOrdGodTurn" column="MTM_INQ_ORD_GOD_TURN" />
        <result property="csoMtmInqOrdGod.ordNo" column="ORD_NO" />
        <result property="csoMtmInqOrdGod.godNm" column="GOD_NM" />
        <result property="csoMtmInqOrdGod.ordGodTurn" column="ORD_GOD_TURN" />
        <result property="ordGod.lstImgUrl" column="LST_IMG_URL" />
        <result property="ordGod.godNo" column="GOD_NO" />

        <result property="csoMtmInqAtchFile.mtmInqAtchFileTurn" column="MTM_INQ_ATCH_FILE_TURN" />
        <result property="csoMtmInqAtchFile.mtmInqAtchFileNm" column="MTM_INQ_ATCH_FILE_NM" />
        <result property="csoMtmInqAtchFile.mtmInqAtchFileCpcty" column="MTM_INQ_ATCH_FILE_CPCTY" />
        <result property="csoMtmInqAtchFile.mtmInqAtchFileUrl" column="MTM_INQ_ATCH_FILE_URL" />

        <result property="rowNum"      column="ROW_NUM"     />
        <result property="inqDateTime" column="inqDateTime" />

    </resultMap>

    <!-- 1:1 문의 리스트 -->
    <select id="selectMyInquiryList" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO" resultMap="mtmResult">
            <include refid="com.plgrim.ncp.base.beginPage"/>
            SELECT  /* [biz.mbr.mypage.xml][selectMyInquiryList][조회 : 1:1문의 리스트 조회 ][김대영] */
                     ROW_NUMBER() OVER(ORDER BY MTM_INQ_SN ASC ) AS ROW_NUM
                    ,MTM_INQ_SN                              /* 일대일 문의 일련번호*/
                    ,INQ_TP_CD                               /* 문의 유형 코드*/
                    ,INQ_MBR_NO                              /* 문의 회원 번호*/
                    ,INQ_CSTMR_NM                            /* 문의 고객 명  */
                    ,INQ_SJ                                  /* 문의 제목*/
                    ,INQ_CONT                                /* 문의 내용*/
                    ,TO_CHAR(INQ_DT,'YYYY-MM-DD') as inqDt                                   /* 문의 일시*/
                    ,ANS_STAT_CD                             /* 답변 상태 코드*/
                    ,DELETE_YN                               /* 삭제 여부*/
                    ,INQIRE_COUNT                            /* 조회 횟수*/
                    ,PRCS_COMPT_DT                           /* 처리 완료 일시*/
                    ,CSTMR_EMAIL                             /* 고객 이메일*/
                    ,CSTMRTEL_AREA_NO                        /* 고객전화 지역번호*/
                    ,CSTMRTEL_TLOF_NO                        /* 고객전화 국번호*/
                    ,CSTMRTEL_TLOF_WTHN_NO                   /* 고객전화 국내번호*/
                    ,CSTMRTEL_NATION_NO                      /* 고객전화 국가번호*/
                    ,CSTMRMOBIL_AREA_NO                      /* 고객휴대전화 지역번호*/
                    ,CSTMRMOBIL_TLOF_NO                      /* 고객휴대전화 국번호*/
                    ,CSTMRMOBIL_TLOF_WTHN_NO                 /* 고객휴대전화 국내번호*/
                    ,CSTMRMOBIL_NATION_NO                    /* 고객휴대전화 국가번호*/
                    ,CSTMR_SMS_RECPTN_YN                     /* SMS 수신여부*/
                    ,CSTMR_EMAIL_RECPTN_YN                   /* EMAIL 수신여부*/
                    ,LANG_CD                                 /* 언어 코드*/
                    ,MALL_ID                                 /* 몰 ID*/
                    ,DVC_CD                                  /* 디바이스 코드*/
                    ,REGTR_ID                                /* 등록자 ID*/
                    ,TO_CHAR(REG_DT, 'YYYY.MM.DD')  AS inqRegDt   /* 등록 일시*/
                    ,UDTER_ID                                     /* 수정자 ID*/
                    ,UDT_DT                                       /* 수정 일시*/
               FROM CSO_MTM_INQ
              WHERE INQ_MBR_NO = #{mbrNo,jdbcType=VARCHAR}
               AND  DELETE_YN = 'N'
               AND mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
               <if test='srchMtmInqSn != null and srchMtmInqSn !=""'>
                   AND MTM_INQ_SN = #{srchMtmInqSn,jdbcType=NUMERIC}
               </if>
				<!-- <if test="langCd != null and langCd !=''">
					AND LANG_CD = #{langCd,jdbcType=VARCHAR}
				</if> 주석처리 2018.08.08 ryan -->
              ORDER BY INQ_DT DESC
              <include refid="com.plgrim.ncp.base.endPage"/>
    </select>

    <select id="selectInquiryCount" parameterType ="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO" resultType="long">
        SELECT /*[biz.mbr.mypage.xml][selectInquiryCount][조회 : 1:1문의 리스트 카운트 ][김대영]*/
                COUNT(*)
        FROM CSO_MTM_INQ
        WHERE INQ_MBR_NO = #{mbrNo,jdbcType=VARCHAR}
               AND  DELETE_YN = 'N'
               AND mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
               <if test='srchMtmInqSn != null and srchMtmInqSn !=""'>
                   AND MTM_INQ_SN = #{srchMtmInqSn,jdbcType=NUMERIC}
               </if>
                <!-- <if test='langCd != null and langCd !=""'>
                AND LANG_CD = #{langCd,jdbcType=VARCHAR}
                </if> 주석처리 2018.08.08 ryan -->
    </select>

    <select id="selectMyInquiryListMobile" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO" resultMap="mtmResult">
            SELECT  /* [biz.mbr.mypage.xml][selectMyInquiryListMobile][조회 : 모바일 1:1문의 리스트 조회 ][김대영] */
                     MTM_INQ_SN                              /* 일대일 문의 일련번호*/
                    ,INQ_TP_CD                               /* 문의 유형 코드*/
                    ,INQ_MBR_NO                              /* 문의 회원 번호*/
                    ,INQ_CSTMR_NM                            /* 문의 고객 명  */
                    ,INQ_SJ                                  /* 문의 제목*/
                    ,INQ_CONT                                /* 문의 내용*/
                    ,TO_CHAR(INQ_DT,'YYYY-MM-DD') as inqDt                                   /* 문의 일시*/
                    ,TO_CHAR(INQ_DT,'YYYY-MM-DD HH24:MI') AS inqDateTime                     /* 문의 일자시간*/
                    ,ANS_STAT_CD                             /* 답변 상태 코드*/
                    ,DELETE_YN                               /* 삭제 여부*/
                    ,INQIRE_COUNT                            /* 조회 횟수*/
                    ,PRCS_COMPT_DT                           /* 처리 완료 일시*/
                    ,CSTMR_EMAIL                             /* 고객 이메일*/
                    ,CSTMRTEL_AREA_NO                        /* 고객전화 지역번호*/
                    ,CSTMRTEL_TLOF_NO                        /* 고객전화 국번호*/
                    ,CSTMRTEL_TLOF_WTHN_NO                   /* 고객전화 국내번호*/
                    ,CSTMRTEL_NATION_NO                      /* 고객전화 국가번호*/
                    ,CSTMRMOBIL_AREA_NO                      /* 고객휴대전화 지역번호*/
                    ,CSTMRMOBIL_TLOF_NO                      /* 고객휴대전화 국번호*/
                    ,CSTMRMOBIL_TLOF_WTHN_NO                 /* 고객휴대전화 국내번호*/
                    ,CSTMRMOBIL_NATION_NO                    /* 고객휴대전화 국가번호*/
                    ,CSTMRTEL_AREA_NO                        /* 고객 지역번호*/
                    ,CSTMR_SMS_RECPTN_YN                     /* SMS 수신여부*/
                    ,CSTMR_EMAIL_RECPTN_YN                   /* EMAIL 수신여부*/
                    ,LANG_CD                                 /* 언어 코드*/
                    ,MALL_ID                                 /* 몰 ID*/
                    ,DVC_CD                                  /* 디바이스 코드*/
                    ,ANS_EVL_CD
				    ,ANS_EVL_CONT
				    ,ANS_EVL_WRITNG_DT
				    ,ANS_EVL_ADMIN_ANS_CONT
				    ,ANS_EVL_ADMIN_ANS_DT
                    ,REGTR_ID                                /* 등록자 ID*/
                    ,TO_CHAR(REG_DT, 'YYYY.MM.DD')  AS inqRegDt   /* 등록 일시*/
                    ,UDTER_ID                                     /* 수정자 ID*/
                    ,UDT_DT                                       /* 수정 일시*/
               FROM CSO_MTM_INQ
              WHERE INQ_MBR_NO = #{mbrNo,jdbcType=VARCHAR}
               AND  DELETE_YN = 'N'
               AND mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
               <if test='srchMtmInqSn != null and srchMtmInqSn !=""'>
                   AND MTM_INQ_SN = #{srchMtmInqSn,jdbcType=NUMERIC}
               </if>
		       <!-- <if test='langCd != null and langCd !=""'>
		        AND LANG_CD = #{langCd,jdbcType=VARCHAR}
		       </if> 주석처리 2018.08.08 ryan -->
              ORDER BY INQ_DT DESC
    </select>

    <select id="selectMyInquiryListMobileCnt" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO" resultType="Integer">
            SELECT /* [biz.mbr.mypage.xml][selectMyInquiryListMobileCnt][조회 : 모바일 1:1문의 리스트 조회 ][김대영] */
                  COUNT(1) as cnt
            FROM CSO_MTM_INQ
            WHERE INQ_MBR_NO = #{mbrNo,jdbcType=VARCHAR}
            AND DELETE_YN = 'N'
            AND mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
            <if test='srchMtmInqSn != null and srchMtmInqSn !=""'>
                AND MTM_INQ_SN = #{srchMtmInqSn,jdbcType=NUMERIC}
            </if>
		    <!-- <if test='langCd != null and langCd !=""'>
		    AND LANG_CD = #{langCd,jdbcType=VARCHAR}
		    </if> 주석처리 2018.08.08 ryan -->
    </select>

    <!-- 1:1 문의 파일 리스트 조회 -->
    <select id="selectMyInquiryFileList" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO" resultMap="mtmResult">
            SELECT  /* [biz.mbr.mypage.xml][selectMyInquiryFileList][조회 : 1:1문의 파일 리스트 조회 ][] */
            MTM_INQ_ATCH_FILE_TURN
                   ,MTM_INQ_ATCH_FILE_NM
                   ,MTM_INQ_ATCH_FILE_URL
                   ,MTM_INQ_ATCH_FILE_CPCTY
               FROM CSO_MTM_INQ_ATCH_FILE
              WHERE 1=1
               <if test='srchMtmInqSn != null and srchMtmInqSn !=""'>
                   AND MTM_INQ_SN = #{srchMtmInqSn,jdbcType=NUMERIC}
               </if>
              ORDER BY REG_DT DESC
    </select>
    <!-- 1:1 문의 주문조회 리스트 -->
    <select id="selectMyInquiryOrdGodList" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO" resultMap="mtmResult">
            SELECT  /* [biz.mbr.mypage.xml][selectMyInquiryOrdGodList][조회 : 1:1문의 주문조회 리스트 조회 ][김대영] */
                     iog.MTM_INQ_ORD_GOD_TURN
                   ,iog.GOD_NM
                   ,iog.ORD_NO
                   ,iog.ORD_GOD_TURN
                   ,gi.IMG_URL as LST_IMG_URL
                    ,og.god_no
            FROM CSO_MTM_INQ_ORD_GOD iog
               INNER JOIN ORD_GOD og
               ON iog.ORD_NO = og.ORD_NO
               AND iog.ORD_GOD_TURN = og.ORD_GOD_TURN
                LEFT OUTER JOIN GOD_IMG gi
                ON og.god_no = gi.GOD_NO
                and img_size_cd=#{imgSizeCd,jdbcType=VARCHAR}
                and img_turn = 0
                and img_tp_cd='THNAIL'
        WHERE 1=1
               <if test='srchMtmInqSn != null and srchMtmInqSn !=""'>
                   AND MTM_INQ_SN = #{srchMtmInqSn,jdbcType=NUMERIC}
               </if>
              ORDER BY iog.REG_DT DESC
    </select>



    <!-- 1:1 문의 상세 -->
    <select id ="selectCsInquiryDetail" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO" resultMap="mtmResult">
                SELECT  /* [biz.mbr.mypage.xml][selectCsInquiryDetail][조회 : 1:1문의 상세 ][김대영] */
                        A.MTM_INQ_SN
                      ,A.INQ_CONT
                      ,A.INQ_TP_CD
                      ,B.MTM_INQ_SN as mtmInqSn
                      ,B.ANS_SJ
                      ,B.ANS_CONT
                      ,B.DETAIL_ANS_STAT_CD
                      ,B.ANS_CNFIRM_YN
                      ,TO_CHAR(B.ANS_DT,'YYYY-MM-DD HH24:MI') as ansRegDt
                      ,TO_CHAR(A.INQ_DT,'YYYY-MM-DD') as inqDt
                  FROM CSO_MTM_INQ A, CSO_MTM_INQ_ANS B
                 WHERE 1=1
                   AND A.MTM_INQ_SN = B.MTM_INQ_SN
                   AND B.MTM_INQ_SN =#{srchMtmInqSn,jdbcType=NUMERIC}
                   AND A.DELETE_YN = 'N'
                   AND A.INQ_MBR_NO = #{mbrNo,jdbcType=VARCHAR}
                   AND B.DETAIL_ANS_STAT_CD IN ('ANS_COMPT','ANS_WAIT')
                ORDER BY B.REG_DT DESC
    </select>
    <!-- 1:1 문의 만족도 평가 -->
    <update id="updateMyInqAnsEvl" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO">
	/* [biz.mbr.mypage.xml][updateMyInqAnsEvl][1:1상담 만족도 평가] */
		UPDATE CSO_MTM_INQ
        SET
             UDT_DT = SYSDATE
             ,UDTER_ID = #{mbrId, jdbcType=VARCHAR}
             ,ANS_EVL_WRITNG_DT = SYSDATE
             <if test="csoMtmInq.ansEvlCd != null">
             ,ANS_EVL_CD = #{csoMtmInq.ansEvlCd,jdbcType=VARCHAR}
             </if>
             <if test="csoMtmInq.ansEvlCont != null">
             ,ANS_EVL_CONT = #{csoMtmInq.ansEvlCont,jdbcType=VARCHAR}
             </if>
        WHERE   1 = 1
        AND MTM_INQ_SN = #{mtmInqSn,jdbcType=NUMERIC}
        AND INQ_MBR_NO = #{mbrNo, jdbcType=VARCHAR}
	</update>
    <!-- 1:1 문의 수정 -->
    <update id = "updateMyInquiry" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO">
        UPDATE   /* [biz.mbr.mypage.xml][updateMyInquiry][수정 : 1:1상담 수정   ] [김대영]*/
        CSO_MTM_INQ
         SET    INQ_TP_CD = #{csoMtmInq.inqTpCd,jdbcType=VARCHAR}
               ,INQ_CONT = #{csoMtmInq.inqCont,jdbcType=VARCHAR}
               ,INQ_SJ = #{csoMtmInq.inqSj,jdbcType=VARCHAR}
               ,CSTMR_EMAIL = #{csoMtmInq.cstmrEmail,jdbcType=VARCHAR}
               ,CSTMRMOBIL_NATION_NO = #{mobilNationNo,jdbcType=VARCHAR}
               ,CSTMRMOBIL_AREA_NO = #{csoMtmInq.cstmrmobilAreaNo,jdbcType=VARCHAR}
               ,CSTMRMOBIL_TLOF_NO = #{csoMtmInq.cstmrmobilTlofNo,jdbcType=VARCHAR}
               ,CSTMRMOBIL_TLOF_WTHN_NO = #{csoMtmInq.cstmrmobilTlofWthnNo,jdbcType=VARCHAR}
               ,CSTMR_SMS_RECPTN_YN = #{csoMtmInq.cstmrSmsRecptnYn,jdbcType=VARCHAR}
               ,CSTMR_EMAIL_RECPTN_YN = #{csoMtmInq.cstmrEmailRecptnYn,jdbcType=VARCHAR}
               ,UDTER_ID = #{mbrId,jdbcType=VARCHAR}
               ,UDT_DT = SYSDATE
        WHERE   1 = 1
        AND     MTM_INQ_SN = #{srchMtmInqSn,jdbcType=NUMERIC}
        AND     INQ_MBR_NO = #{mbrNo,jdbcType=VARCHAR}
    </update>
    <!-- 1:1 문의 주문목록 수정 -->
    <update id = "updateMyOrdGodInquiry" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO">
        UPDATE  /* [biz.mbr.mypage.xml][updateMyOrdGodInquiry][수정 : 1:1상담 주문 수정   ][김대영] */
             CSO_MTM_INQ_ORD_GOD
         SET    INQ_TP_CD = #{csoMtmInq.inqTpCd,jdbcType=VARCHAR}
               ,INQ_CONT = #{csoMtmInq.inqCont,jdbcType=VARCHAR}
               ,CSTMR_EMAIL = #{csoMtmInq.cstmrEmail,jdbcType=VARCHAR}
               ,CSTMRMOBIL_NATION_NO = #{mobilNationNo,jdbcType=VARCHAR}
               ,CSTMRMOBIL_AREA_NO = #{csoMtmInq.cstmrmobilAreaNo,jdbcType=VARCHAR}
               ,CSTMRMOBIL_TLOF_NO = #{csoMtmInq.cstmrmobilTlofNo,jdbcType=VARCHAR}
               ,CSTMRMOBIL_TLOF_WTHN_NO = #{csoMtmInq.cstmrmobilTlofWthnNo,jdbcType=VARCHAR}
               ,CSTMR_SMS_RECPTN_YN = #{csoMtmInq.cstmrSmsRecptnYn,jdbcType=VARCHAR}
               ,CSTMR_EMAIL_RECPTN_YN = #{csoMtmInq.cstmrEmailRecptnYn,jdbcType=VARCHAR}
               ,UDTER_ID = #{mbrId,jdbcType=VARCHAR}
               ,UDT_DT = SYSDATE
        WHERE   1 = 1
        AND     MTM_INQ_SN = #{srchMtmInqSn,jdbcType=NUMERIC}
        AND     INQ_MBR_NO = #{mbrNo,jdbcType=VARCHAR}
    </update>
    <!-- 1:1 문의 파일 삭제 -->
    <update id = "deleteMyFileInquiry" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO">
        DELETE  /* [biz.mbr.mypage.xml][deleteMyInquiryFileList][삭제 : 1:1상담 파일 삭제   ][김대영] */
         FROM      CSO_MTM_INQ_ATCH_FILE
         WHERE   1=1
        AND     MTM_INQ_SN = #{csoMtmInqAtchFile.mtmInqSn,jdbcType=NUMERIC}
        <if test ='deleteFileNm != null and deleteFileNm != ""'>
        AND     MTM_INQ_ATCH_FILE_NM IN
                <foreach collection="deleteFileNm" item="fileNm" index="index" separator="," open="(" close=")">
                    #{fileNm}
                </foreach>
        </if>
    </update>
    <!-- 1:1 문의 삭제 -->
    <update id = "deleteMyInquiry" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO">
        UPDATE  /* [biz.mbr.mypage.xml][deleteMyInquiry][삭제 : 1:1상담 삭제   ][김대영] */
          CSO_MTM_INQ
         SET    DELETE_YN = 'Y'
                ,UDTER_ID = #{mbrId,jdbcType=VARCHAR}
                ,UDT_DT = SYSDATE
        WHERE   1 = 1
        AND     MTM_INQ_SN = #{srchMtmInqSn,jdbcType=NUMERIC}
        AND     INQ_MBR_NO = #{mbrNo,jdbcType=VARCHAR}
    </update>
    <!-- 1:1 문의 주문 목록 삭제 -->
    <delete id ="deleteMyOrdGodInquiry" parameterType ="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO">
        DELETE /* [biz.mbr.mypage.xml][deleteMyOrdGodInquiry][삭제 : 1:1상담 주문 목록 삭제   ][김대영] */
         FROM CSO_MTM_INQ_ORD_GOD
        WHERE MTM_INQ_SN = #{csoMtmInq.mtmInqSn,jdbcType=NUMERIC}
    </delete>

    <resultMap id="godResult" type="com.plgrim.ncp.biz.member.result.MypageQnaFoResult">
        <result property="csoGodInq.godInqSn" column="GOD_INQ_SN" />
        <result property="csoGodInq.godNo" column="GOD_NO"/>
        <result property="csoGodInq.mbrNo" column="MBR_NO"/>
        <result property="csoGodInq.inqSj" column="INQ_SJ" />
        <result property="csoGodInq.inqCont" column="INQ_CONT" />
        <result property="csoGodInq.inqDt" column="INQ_DT" />
        <result property="csoGodInq.deleteYn" column="DELETE_YN" />
        <result property="csoGodInq.secretsntncYn" column="SECRETSNTNC_YN" />
        <result property="csoGodInq.ansStatCd" column="ANS_STAT_CD" />
        <result property="csoGodInq.inqireCount" column="INQIRE_COUNT" />
        <result property="csoGodInq.prcsComptDt" column="PRCS_COMPT_DT" />
        <result property="csoGodInq.cstmrEmail" column="CSTMR_EMAIL" />
        <result property="csoGodInq.inqCstmrNm" column="INQ_CSTMR_NM" />
        <result property="csoGodInq.cstmrtelNationNo" column="CSTMRTEL_NATION_NO" />
        <result property="csoGodInq.cstmrtelAreaNo" column="CSTMRTEL_AREA_NO" />
        <result property="csoGodInq.cstmrtelTlofNo" column="CSTMRTEL_TLOF_NO" />
        <result property="csoGodInq.cstmrtelTlofWthnNo" column="CSTMRTEL_TLOF_WTHN_NO" />
        <result property="csoGodInq.cstmrmobilNationNo" column="CSTMRMOBIL_NATION_NO" />
        <result property="csoGodInq.cstmrmobilAreaNo" column="CSTMRMOBIL_AREA_NO" />
        <result property="csoGodInq.cstmrmobilTlofNo" column="CSTMRMOBIL_TLOF_NO" />
        <result property="csoGodInq.cstmrmobilTlofWthnNo" column="CSTMRMOBIL_TLOF_NO" />
        <result property="csoGodInq.cstmrSmsRecptnYn" column="CSTMR_SMS_RECPTN_YN" />
        <result property="csoGodInq.cstmrEmailRecptnYn" column="CSTMR_EMAIL_RECPTN_YN" />
        <result property="csoGodInq.langCd" column="LANG_CD" />
        <result property="csoGodInq.mallId" column="MALL_ID" />
        <result property="csoGodInq.dvcCd" column="DVC_CD" />
        <result property="csoGodInq.regtrId" column="REGTR_ID" />
        <result property="csoGodInq.regDt" column="REG_DT" />
        <result property="csoGodInq.udterId" column="UDTER_ID" />
        <result property="csoGodInq.udtDt" column="UDT_DT" />
        <result property="csoGodInq.ansEvlCd"					column="ANS_EVL_CD"/>
		<result property="csoGodInq.ansEvlCont"					column="ANS_EVL_CONT"/>
		<result property="csoGodInq.ansEvlWritngDt"				column="ANS_EVL_WRITNG_DT"/>
		<result property="csoGodInq.ansEvlAdminAnsCont"			column="ANS_EVL_ADMIN_ANS_CONT"/>
		<result property="csoGodInq.ansEvlAdminAnsDt"			column="ANS_EVL_ADMIN_ANS_DT"/>
        <result property="csoGodInqAns.ansSj" column="ANS_SJ" />
        <result property="csoGodInqAns.ansCont" column="ANS_CONT" />
        <result property="csoGodInqAns.detailAnsStatCd" column="DETAIL_ANS_STAT_CD" />
        <result property="csoGodInqAns.regDt" column="REG_DT" />
        <result property="godInqSn" column="godInqSn" />
        <result property="inqRegDt" column="inqRegDt" />
        <result property="ansRegDt" column="ansRegDt" />
        <result property="godImg.imgNm" column="IMG_NM" />
        <result property="god.godNm" column="GOD_NM" />
        <result property="god.colorNm" column="COLOR_NM" />
        <result property="itmNm"  column="ITM_NM" />
        <result property="brndNm" column="BRND_NM" />
        <result property="imgUrl" column="IMG_URL" />
        <result property="imgSizeCd" column="IMG_SIZE_CD" />
    </resultMap>

    <!--  Qna 리스트 조회  -->
    <select id ="selectMyQnaList" parameterType="com.plgrim.ncp.biz.member.data.MypageQnaFoDTO" resultMap="godResult">
            <include refid="com.plgrim.ncp.base.beginPage"/>
            SELECT  /* [biz.mbr.mypage.xml][selectMyQnaList][Qna 리스트 ][김대영] */
                    A.GOD_INQ_SN,
                       A.GOD_NO,
                       A.MBR_NO,
                       A.INQ_CONT,
                       A.INQ_DT,
                       A.SECRETSNTNC_YN,
                       A.ANS_STAT_CD,
                       A.INQIRE_COUNT,
                       A.PRCS_COMPT_DT,
                       A.DELETE_YN,
                       A.CSTMR_EMAIL,
                       A.INQ_CSTMR_NM,
                       A.CSTMR_EMAIL_RECPTN_YN,
                       A.LANG_CD,
                       A.MALL_ID,
                       A.DVC_CD,
                       A.REGTR_ID,
                       TO_CHAR(A.REG_DT, 'YYYY.MM.DD') as inqRegDt,
                       A.UDTER_ID,
                       A.UDT_DT,
					   A.ANS_EVL_CD,
				       A.ANS_EVL_CONT,
				       A.ANS_EVL_WRITNG_DT,
				       A.ANS_EVL_ADMIN_ANS_CONT,
				       A.ANS_EVL_ADMIN_ANS_DT,
                       CASE WHEN #{lang,jdbcType=VARCHAR} = 'KOR'
                            THEN C.GOD_NM
                            ELSE glgn.GOD_NM
                            END GOD_NM,
                       C.COLOR_NM,
                       CASE WHEN #{lang,jdbcType=VARCHAR} = 'KOR'
                           THEN S.brnd_nm
                           ELSE sbl.brnd_nm
                           END brnd_nm
        <!-- ,
                       GI.IMG_URL,
                       GI.IMG_SIZE_CD -->
              FROM CSO_GOD_INQ A
              JOIN GOD C
               ON  A.GOD_NO = C.GOD_NO
                  LEFT OUTER JOIN GOD_LANGBY_GOD_NM glgn
                    ON C.GOD_NO = glgn.GOD_NO
                    AND glgn.LANG_CD=#{lang,jdbcType=VARCHAR}
              JOIN SYS_BRND S
               ON  C.BRND_ID = S.BRND_ID
              LEFT OUTER JOIN SYS_BRND_LANG sbl
                ON S.BRND_ID =  sbl.BRND_ID
                AND sbl.LANG_CD =#{lang,jdbcType=VARCHAR}
              <!-- JOIN GOD_IMG GI
               ON  A.GOD_NO = GI.GOD_NO -->
             Where 1=1
               AND A.DELETE_YN = 'N'
               AND a.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
               <if test='mbrNo != null and mbrNo !=""'>
                   AND A.MBR_NO = #{mbrNo,jdbcType=VARCHAR}
<!-- qna는 국내, 해외 공통으로 노출되야 한다 하여 주석처리 -->
<!-- 				   <choose> -->
<!-- 					   <when test=" lang == 'KOR' "> -->
<!-- 						   AND A.LANG_CD='KOR' -->
<!-- 					   </when> -->
<!-- 					   <otherwise> -->
<!-- 						   AND A.LANG_CD!='KOR' -->
<!-- 					   </otherwise> -->
<!-- 				   </choose> -->
               </if>
               <if test='searchQna != null and searchQna !=""'>
                   AND A.ANS_STAT_CD =#{searchQna,jdbcType=VARCHAR}
               </if>
               <if test='searchGodInqSn != null and searchGodInqSn !=""'>
                   AND A.GOD_INQ_SN = #{searchGodInqSn,jdbcType=NUMERIC}
               </if>
               <!-- AND GI.IMG_TURN = '0'
               AND GI.IMG_SIZE_CD = '64' -->
              ORDER BY A.REG_DT DESC
                <!-- AND  A.GOD_NO = (SELECT IMG_URL
                                 FROM GOD_IMG
                                 WHERE GOD_NO = #{csoGodInq.godNo,jdbcType=VARCHAR}
                                 IMG_URL = '0') -->
              <include refid="com.plgrim.ncp.base.endPage"/>
    </select>
    <select id ="selectMyQnaListMobile" parameterType="com.plgrim.ncp.biz.member.data.MypageQnaFoDTO" resultMap="godResult">
            SELECT     /* [biz.mbr.mypage.xml][selectMyQnaListMobile][모바일 Qna 리스트 ][김대영] */
                      A.GOD_INQ_SN,
                       A.GOD_NO,
                       A.MBR_NO,
                       A.INQ_CONT,
                       A.INQ_DT,
                       A.SECRETSNTNC_YN,
                       A.ANS_STAT_CD,
                       A.INQIRE_COUNT,
                       A.PRCS_COMPT_DT,
                       A.DELETE_YN,
                       A.CSTMR_EMAIL,
                       A.INQ_CSTMR_NM,
                       A.CSTMR_EMAIL_RECPTN_YN,
                       A.LANG_CD,
                       A.MALL_ID,
                       A.DVC_CD,
                       A.REGTR_ID,
                       TO_CHAR(A.REG_DT, 'YYYY.MM.DD') as inqRegDt,
                       A.UDTER_ID,
                       A.UDT_DT,
                       C.GOD_NM,
                       C.COLOR_NM,
                       S.BRND_NM<!-- ,
                       GI.IMG_URL,
                       GI.IMG_SIZE_CD -->
              FROM CSO_GOD_INQ A
              JOIN GOD C
               ON  A.GOD_NO = C.GOD_NO
              JOIN SYS_BRND S
               ON  C.BRND_ID = S.BRND_ID
              <!-- JOIN GOD_IMG GI
               ON  A.GOD_NO = GI.GOD_NO -->
             Where 1=1
               AND A.DELETE_YN = 'N'
               AND a.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
               <if test='mbrNo != null and mbrNo !=""'>
                   AND A.MBR_NO = #{mbrNo,jdbcType=VARCHAR}
               </if>
               <if test='searchQna != null and searchQna !=""'>
                   AND A.ANS_STAT_CD =#{searchQna,jdbcType=VARCHAR}
               </if>
               <if test='searchGodInqSn != null and searchGodInqSn !=""'>
                   AND A.GOD_INQ_SN = #{searchGodInqSn,jdbcType=NUMERIC}
               </if>
               <!-- AND GI.IMG_TURN = '0'
               AND GI.IMG_SIZE_CD = '64' -->
              ORDER BY A.REG_DT DESC
                <!-- AND  A.GOD_NO = (SELECT IMG_URL
                                 FROM GOD_IMG
                                 WHERE GOD_NO = #{csoGodInq.godNo,jdbcType=VARCHAR}
                                 IMG_URL = '0') -->
    </select>

    <select id ="selectMyQnaListMobileCnt" parameterType="com.plgrim.ncp.biz.member.data.MypageQnaFoDTO" resultType="Integer">

        SELECT  /* [biz.mbr.mypage.xml][selectMyQnaListMobile][모바일 Qna 리스트 ][김대영] */
             COUNT(1) as cnt
        FROM CSO_GOD_INQ A
       WHERE 1 = 1
       AND A.MBR_NO = #{mbrNo,jdbcType=VARCHAR}
       AND A.DELETE_YN = 'N'
       AND a.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
    </select>

    <select id="selectQnaCount" parameterType ="com.plgrim.ncp.biz.member.data.MypageQnaFoDTO" resultType="long">
        SELECT /* [biz.mbr.mypage.xml][selectQnaCount][Qna 리스트 카운트][김대영] */
                COUNT(*)
        FROM CSO_GOD_INQ A
        JOIN GOD C
               ON  A.GOD_NO = C.GOD_NO
              JOIN SYS_BRND S
               ON  C.BRND_ID = S.BRND_ID
               <!-- JOIN GOD_IMG GI
               ON  A.GOD_NO = GI.GOD_NO -->
             Where 1=1
               AND A.DELETE_YN = 'N'
               AND a.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
               <if test='mbrNo != null and mbrNo !=""'>
                   AND A.MBR_NO = #{mbrNo,jdbcType=VARCHAR}
<!-- qna는 국내, 해외 공통으로 노출되야 한다 하여 주석처리 -->
<!-- 				   <choose> -->
<!-- 					   <when test=" lang == 'KOR' "> -->
<!-- 						   AND A.LANG_CD='KOR' -->
<!-- 					   </when> -->
<!-- 					   <otherwise> -->
<!-- 						   AND A.LANG_CD!='KOR' -->
<!-- 					   </otherwise> -->
<!-- 				   </choose> -->
               </if>
               <if test='searchQna != null and searchQna !=""'>
                   AND A.ANS_STAT_CD =#{searchQna,jdbcType=VARCHAR}
               </if>
               <if test='searchGodInqSn != null and searchGodInqSn !=""'>
                   AND A.GOD_INQ_SN = #{searchGodInqSn,jdbcType=NUMERIC}
               </if>
    </select>

    <!-- Qna 리스트 상세 -->
    <select id = "selectMyQnaListDetail" parameterType="com.plgrim.ncp.biz.member.data.MypageQnaFoDTO" resultMap ="godResult">
                SELECT/* [biz.mbr.mypage.xml][selectMyQnaDetail][조회 : 상품 Qa 답변 ][김대영] */
                        A.GOD_INQ_SN
                      ,A.INQ_CONT
                      ,B.GOD_INQ_SN as godInqSn
                      ,B.ANS_SJ
                      ,B.ANS_CONT
                      ,B.DETAIL_ANS_STAT_CD
                      ,TO_CHAR(B.ANS_DT, 'YYYY.MM.DD') as ansRegDt
                  FROM CSO_GOD_INQ A, CSO_GOD_INQ_ANS B
                 WHERE 1=1
                  AND  A.DELETE_YN ='N'
                  AND  A.GOD_INQ_SN = B.GOD_INQ_SN
                  AND  A.ANS_STAT_CD = B.DETAIL_ANS_STAT_CD
                  AND  B.DETAIL_ANS_STAT_CD != 'ANS_BF'
                  AND  A.MBR_NO = #{mbrNo,jdbcType=VARCHAR}
                  AND a.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
    </select>

    <!-- Qna 수정 -->
    <update id = "updateMyQna" parameterType="com.plgrim.ncp.biz.member.data.MypageQnaFoDTO">
        UPDATE /* [biz.mbr.mypage.xml][updateMyQna][수정 : 상품 Qa  ][김대영] */
                    CSO_GOD_INQ
         SET         UDTER_ID = #{mbrId,jdbcType=VARCHAR}
                    ,UDT_DT = SYSDATE
                    ,INQ_CONT = #{csoGodInq.inqCont,jdbcType=VARCHAR}
                    ,SECRETSNTNC_YN = #{rdGroup01,jdbcType=VARCHAR}
                    ,INQ_CSTMR_NM = #{csoGodInq.inqCstmrNm,jdbcType=VARCHAR}
                    ,CSTMR_EMAIL = #{csoGodInq.cstmrEmail,jdbcType=VARCHAR}
        WHERE   1 = 1
          AND     GOD_INQ_SN = #{csoGodInq.godInqSn,jdbcType=NUMERIC}
          AND MBR_NO = #{mbrNo,jdbcType=VARCHAR}
    </update>

    <!-- Qna 삭제 -->
    <update id = "deleteMyQna" parameterType="com.plgrim.ncp.biz.member.data.MypageQnaFoDTO">
        UPDATE  /* [biz.mbr.mypage.xml][deleteMyQna][삭제 : 상품 Qa  ][김대영] */
           CSO_GOD_INQ
         SET         UDTER_ID = #{mbrId,jdbcType=VARCHAR}
                    ,UDT_DT = SYSDATE
                    ,DELETE_YN = 'Y'
        WHERE   1 = 1
        AND     GOD_INQ_SN = #{searchGodInqSn,jdbcType=NUMERIC}
        AND MBR_NO = #{mbrNo,jdbcType=VARCHAR}
    </update>


    <resultMap id="evtResult" type="com.plgrim.ncp.biz.member.result.MypageEvtFoResult">
        <result property="evt.evtNo"                     column="EVT_NO" />
        <result property="evt.evtNm"                     column="EVT_NM" />
        <result property="evt.evtDscr"                   column="EVT_DSCR" />
        <result property="evt.evtTpCd"                   column="EVT_TP_CD" />
        <result property="evt.evtStatCd"                 column="EVT_STAT_CD" />
        <result property="evtBegDt"                      column="EVT_BEG_DT" />
        <result property="evtEndDt"                      column="EVT_END_DT" />
        <result property="evt.applcnBegDt"               column="APPLCN_BEG_DT" />
        <result property="evt.applcnEndDt"               column="APPLCN_END_DT" />
        <result property="prizePresnatnDate"             column="PRIZE_PRESNATN_DATE" />
        <result property="evt.pcHtml"        column="PC_HTML" />
        <result property="evt.mobileHtml"    column="MOBILE_HTML" />
        <result property="evt.pcUrl"        column="PC_URL" />
        <result property="evt.mobileUrl"    column="MOBILE_URL" />
        <result property="prsYn"                         column="PRS_YN" />
        <result property="winYn"                         column="WIN_YN" />
    </resultMap>
    <select id = "selectMyEventList" parameterType ="com.plgrim.ncp.biz.member.data.MypageFoDTO" resultMap="evtResult">
        <include refid="com.plgrim.ncp.base.beginPage"/>
               SELECT  /* [biz.mbr.mypage.selectMyEventList][이벤트 리스트][LimJinseok]*/
                     e.EVT_NO
                    ,e.EVT_NM
                    ,e.EVT_DSCR
                    ,e.EVT_TP_CD
                    ,e.EVT_STAT_CD
                    ,CASE WHEN SYSDATE BETWEEN e.EVT_BEG_DT AND e.EVT_END_DT THEN 'P'
                          ELSE 'E' END AS PRS_YN
                    , TO_CHAR(e.EVT_BEG_DT, 'YYYY.MM.DD') AS EVT_BEG_DT
                    , TO_CHAR(e.EVT_END_DT, 'YYYY.MM.DD') AS EVT_END_DT
                    ,e.APPLCN_BEG_DT
                    ,e.APPLCN_END_DT
                    , TO_CHAR(TO_DATE(e.PRIZE_PRESNATN_DATE, 'YYYY.MM.DD') , 'YYYY.MM.DD')   AS PRIZE_PRESNATN_DATE
                    ,e.PC_HTML
                    ,e.MOBILE_HTML
                    ,CASE WHEN e.PC_URL is null
                           THEN
                               CASE
                                   WHEN e.UPPER_EVT_NO is null
                                   THEN '/event/'|| e.EVT_NO || '/view'
                                   ELSE '/event/'|| e.UPPER_EVT_NO || '/view'
                               END
                           ELSE e.PC_URL
                    END PC_URL
                   ,CASE WHEN e.MOBILE_URL is null
                            THEN
                                CASE
                                    WHEN e.UPPER_EVT_NO is null
                                    THEN '/event/'|| e.EVT_NO || '/view'
                                    ELSE '/event/'|| e.UPPER_EVT_NO || '/view'
                                END
                            ELSE e.MOBILE_URL
                    END MOBILE_URL
                    ,DECODE(NVL(ep.EVT_PARTCPTN_SN , '') , '','N' , 'Y') AS WIN_YN
                FROM EVT e
                INNER JOIN EVT_APPLCN eapp
                      ON e.EVT_NO = eapp.EVT_NO
                LEFT OUTER JOIN EVT_PRIZE ep ON eapp.EVT_PARTCPTN_SN = ep.EVT_PARTCPTN_SN AND e.EVT_NO = ep.EVT_NO
<!-- 몰구분, 언어구분은 적용대상 테이블이 아닌 전시대상 테이블을 바라보도록 변경 2016.04.08 -->
<!--                 INNER JOIN EVT_PARTCPTN_TGT ept ON ept.EVT_NO = e.EVT_NO AND ept.PARTCPTN_TGT_TP_CD = 'LANG' AND ept.LANG_CD = #{lang, jdbcType=VARCHAR} -->
<!--                 INNER JOIN EVT_DSP_TGT ept ON ept.EVT_NO = e.EVT_NO AND ept.EVT_DSP_TGT_TP_CD = 'LANG' AND ept.LANG_CD = #{lang, jdbcType=VARCHAR} -->
              WHERE eapp.MBR_NO = #{mbr.mbrNo}
<!-- 몰구분, 언어구분은 적용대상 테이블이 아닌 전시대상 테이블을 바라보도록 변경 2016.04.08 -->
<!--               	AND EXISTS (SELECT 1 FROM EVT_PARTCPTN_TGT WHERE evt_no = e.evt_no AND partcptn_tgt_tp_cd = 'MALL_ID' AND mall_id = #{mallId,jdbcType=VARCHAR}) -->
              	AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = e.evt_no AND EVT_DSP_TGT_TP_CD = 'MALL_ID' AND mall_id = #{mallId,jdbcType=VARCHAR})
              	AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = e.evt_no AND EVT_DSP_TGT_TP_CD = 'LANG' AND LANG_CD = #{lang, jdbcType=VARCHAR})
               <if test="dateStart != null ">
               AND eapp.APPLCN_DT BETWEEN  TO_DATE(#{dateStart , jdbcType=VARCHAR}||' 00:00:00','YYYY-MM-DD HH24:MI:SS') AND TO_DATE(#{dateEnd}||' 23:59:59','YYYY-MM-DD HH24:MI:SS')
               </if>
                <if test="dateStart == null ">
               AND eapp.APPLCN_DT BETWEEN  ADD_MONTHS(SYSDATE , -3) AND SYSDATE
               </if>
               <if test="srchType == 'getEvent' ">
                    AND ep.EVT_PARTCPTN_SN  IS NOT NULL
               </if>
              <include refid="com.plgrim.ncp.base.endPage"/>
    </select>

    <select id = "selectMyEventListCount" parameterType ="com.plgrim.ncp.biz.member.data.MypageFoDTO" resultType="long">
            SELECT /* [biz.mbr.mypage.selectMyEventListCount][이벤트 리스트][LimJinseok]*/
                    COUNT(*)
               FROM EVT e
                INNER JOIN EVT_APPLCN eapp
                      ON e.EVT_NO = eapp.EVT_NO
                LEFT OUTER JOIN EVT_PRIZE ep ON eapp.EVT_PARTCPTN_SN = ep.EVT_PARTCPTN_SN  AND e.EVT_NO = ep.EVT_NO
<!-- 몰구분, 언어구분은 적용대상 테이블이 아닌 전시대상 테이블을 바라보도록 변경 2016.04.08 -->
<!--                 INNER JOIN EVT_PARTCPTN_TGT ept ON ept.EVT_NO = e.EVT_NO AND ept.PARTCPTN_TGT_TP_CD = 'LANG' AND ept.LANG_CD = #{lang, jdbcType=VARCHAR} -->
                INNER JOIN EVT_DSP_TGT ept ON ept.EVT_NO = e.EVT_NO AND ept.EVT_DSP_TGT_TP_CD = 'LANG' AND ept.LANG_CD = #{lang, jdbcType=VARCHAR}
              WHERE eapp.MBR_NO = #{mbr.mbrNo}
<!-- 몰구분, 언어구분은 적용대상 테이블이 아닌 전시대상 테이블을 바라보도록 변경 2016.04.08 -->
<!--               	AND EXISTS (SELECT 1 FROM EVT_PARTCPTN_TGT WHERE evt_no = e.evt_no AND partcptn_tgt_tp_cd = 'MALL_ID' AND mall_id = #{mallId,jdbcType=VARCHAR}) -->
              	AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = e.evt_no AND EVT_DSP_TGT_TP_CD = 'MALL_ID' AND mall_id = #{mallId,jdbcType=VARCHAR})
              	AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = e.evt_no AND EVT_DSP_TGT_TP_CD = 'LANG' AND LANG_CD = #{lang, jdbcType=VARCHAR})
              <if test="dateStart != null ">
               AND eapp.APPLCN_DT BETWEEN TO_DATE(#{dateStart , jdbcType=VARCHAR}||' 00:00:00','YYYY-MM-DD HH24:MI:SS') AND TO_DATE(#{dateEnd}||' 23:59:59','YYYY-MM-DD HH24:MI:SS')
               </if>
                <if test="dateStart == null ">
               AND eapp.APPLCN_DT BETWEEN  ADD_MONTHS(SYSDATE , -3) AND SYSDATE
               </if>
    </select>

    <select id = "selectMyEventPrizeListCount" parameterType ="com.plgrim.ncp.biz.member.data.MypageFoDTO" resultType="long">
            SELECT /* [biz.mbr.mypage.selectMyEventPrizeListCount][당첨 된 수 이벤트 리스트][LimJinseok]*/
                    COUNT(*)
                FROM EVT e
                INNER JOIN EVT_APPLCN eapp
                      ON e.EVT_NO = eapp.EVT_NO
                LEFT OUTER JOIN EVT_PRIZE ep ON eapp.EVT_PARTCPTN_SN = ep.EVT_PARTCPTN_SN AND e.EVT_NO = ep.EVT_NO
<!-- 몰구분, 언어구분은 적용대상 테이블이 아닌 전시대상 테이블을 바라보도록 변경 2016.04.08 -->
<!--                 INNER JOIN EVT_PARTCPTN_TGT ept ON ept.EVT_NO = e.EVT_NO AND ept.PARTCPTN_TGT_TP_CD = 'LANG' AND ept.LANG_CD = #{lang, jdbcType=VARCHAR} -->
<!--                 INNER JOIN EVT_DSP_TGT ept ON ept.EVT_NO = e.EVT_NO AND ept.EVT_DSP_TGT_TP_CD = 'LANG' AND ept.LANG_CD = #{lang, jdbcType=VARCHAR} -->
              WHERE eapp.MBR_NO = #{mbr.mbrNo}
<!-- 몰구분, 언어구분은 적용대상 테이블이 아닌 전시대상 테이블을 바라보도록 변경 2016.04.08 -->
<!--               	AND EXISTS (SELECT 1 FROM EVT_PARTCPTN_TGT WHERE evt_no = e.evt_no AND partcptn_tgt_tp_cd = 'MALL_ID' AND mall_id = #{mallId,jdbcType=VARCHAR}) -->
              	AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = e.evt_no AND EVT_DSP_TGT_TP_CD = 'MALL_ID' AND mall_id = #{mallId,jdbcType=VARCHAR})
              	AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = e.evt_no AND EVT_DSP_TGT_TP_CD = 'LANG' AND LANG_CD = #{lang, jdbcType=VARCHAR})
              <if test="dateStart != null ">
               AND eapp.APPLCN_DT BETWEEN  TO_DATE(#{dateStart , jdbcType=VARCHAR}||' 00:00:00','YYYY-MM-DD HH24:MI:SS') AND TO_DATE(#{dateEnd}||' 23:59:59','YYYY-MM-DD HH24:MI:SS')
               </if>
                <if test="dateStart == null ">
               AND eapp.APPLCN_DT BETWEEN  ADD_MONTHS(SYSDATE , -3) AND SYSDATE
               </if>
               AND ep.EVT_PARTCPTN_SN  IS NOT NULL
    </select>


    <resultMap id="cpnResult" type="com.plgrim.ncp.biz.member.result.MypageCpnFoResult">
        <result property="cpnTpCd" column="cpnTpCd" />
        <result property="dcNm" column="dcNm" />
        <result property="cpnNm" column="cpnNm" />
        <result property="validClosDt" column="validClosDt" />
        <result property="validDay" column="validDay" />
        <result property="validHour" column="validHour" />
    </resultMap>

    <!-- 회원 보유쿠폰 리스트 조회 -->
    <select id ="selectMyCouponsList" parameterType="mbrIssuCpn" resultMap="cpnResult">
            SELECT  /* [biz.mbr.mypage.xml][selectMyCouponsList][조회 : 회원 쿠폰 조회 ] */
            CPN_TP_CD AS cpnTpCd        /*쿠폰유형코드*/
                 , (SELECT CASE WHEN DC_RT IS NULL AND DC_AMT IS NULL THEN
                               ''
                           ELSE
                               CASE WHEN DC_RT IS NULL THEN
                                    DC_AMT||'원'
                               ELSE
                                    DC_RT||'%'
                               END
                           END
                      FROM PRM
                     WHERE PRM_NO = A.PRM_NO
                   ) AS dcNm
                 , (SELECT PRM_NM
                      FROM PRM
                     WHERE PRM_NO = A.PRM_NO
                   ) AS cpnNm
                 , TO_CHAR(A.VALID_CLOS_DT,'YYYY.MM.DD') AS validClosDt
                 , TO_NUMBER(TO_DATE(TO_CHAR(A.VALID_CLOS_DT,'YYYYMMDD'),'YYYYMMDD') - TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'),'YYYYMMDD')) AS validDay
                 , TO_NUMBER(TO_CHAR(A.VALID_CLOS_DT,'HH24') - TO_CHAR(SYSDATE,'HH24')) AS validHour
              FROM MBR_ISSU_CPN A
             WHERE 1=1
               AND A.MBR_NO = #{mbrNo,jdbcType=VARCHAR}
               AND A.CPN_STAT_CD = 'NO_USE'
               AND A.VALID_BEG_DT IS NOT NULL
               AND A.VALID_CLOS_DT IS NOT NULL
               AND A.VALID_CLOS_DT >= SYSDATE
    </select>

    <!-- 회원 보유쿠폰 리스트 카운트 -->
    <select id = "selectMyCouponsCount" parameterType ="com.plgrim.ncp.base.entities.datasource1.mbr.MbrIssuCpn" resultType="long">
            SELECT  /* [biz.mbr.mypage.xml][selectMyCouponsCount][조회 : 회원 쿠폰 카운트 ] */
            COUNT(*)
              FROM MBR_ISSU_CPN A
             WHERE 1=1
               AND MBR_NO = #{mbrNo,jdbcType=VARCHAR}
               <if test='prmNo != null and prmNo != "" '>
               	AND PRM_NO = #{prmNo,jdbcType=VARCHAR}
               </if>
               AND CPN_STAT_CD = 'NO_USE'
               AND A.VALID_BEG_DATE IS NOT NULL
               AND A.VALID_END_DATE IS NOT NULL
               AND A.VALID_END_DATE >= TO_CHAR(SYSDATE,'YYYYMMDD')
    </select>

    <!-- 1:1 문의 등록 -->
    <insert id="insertCsInquiry" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO">
        INSERT /* [biz.mbr.mypage.xml][insertCsInquiry][등록 : 1:1문의 등록 ][김대영] */
        INTO CSO_MTM_INQ
        (
               MTM_INQ_SN
              ,INQ_TP_CD
              ,INQ_MBR_NO
              ,INQ_CSTMR_NM
              ,INQ_SJ
              ,INQ_CONT
              ,INQ_DT
              ,ANS_STAT_CD
              ,INQIRE_COUNT
              ,PRCS_COMPT_DT
              ,CSTMR_EMAIL
              ,CSTMRTEL_AREA_NO
              ,CSTMRTEL_TLOF_NO
              ,CSTMRTEL_TLOF_WTHN_NO
              ,CSTMRMOBIL_AREA_NO
              ,CSTMRMOBIL_TLOF_NO
              ,CSTMRMOBIL_TLOF_WTHN_NO
              ,CSTMRMOBIL_NATION_NO
              ,CSTMR_SMS_RECPTN_YN
              ,CSTMR_EMAIL_RECPTN_YN
              ,LANG_CD
              ,MALL_ID
              ,DVC_CD
              ,UDTER_ID
              ,UDT_DT
              ,REGTR_ID
              ,REG_DT
              ,UTID
              ,ERP_GOD_NO
              ,GOD_NO
        )
        VALUES
        (
            #{csoMtmInq.mtmInqSn,jdbcType=NUMERIC}
           ,#{csoMtmInq.inqTpCd,jdbcType=VARCHAR}
           ,#{mbrNo,jdbcType=VARCHAR}
           ,#{mbrNm,jdbcType=VARCHAR}
           ,#{csoMtmInq.inqSj,jdbcType=VARCHAR}
           ,#{csoMtmInq.inqCont,jdbcType=VARCHAR}
           ,SYSDATE
           ,'ANS_BF'
           ,'0'
           ,#{csoMtmInq.prcsComptDt,jdbcType=DATE}
           ,#{csoMtmInq.cstmrEmail,jdbcType=VARCHAR}
           ,#{csoMtmInq.cstmrtelAreaNo,jdbcType=VARCHAR}
           ,#{csoMtmInq.cstmrtelTlofNo,jdbcType=VARCHAR}
           ,#{csoMtmInq.cstmrtelTlofWthnNo,jdbcType=VARCHAR}
           ,#{csoMtmInq.cstmrmobilAreaNo,jdbcType=VARCHAR}
           ,#{csoMtmInq.cstmrmobilTlofNo,jdbcType=VARCHAR}
           ,#{csoMtmInq.cstmrmobilTlofWthnNo,jdbcType=VARCHAR}
           ,#{mobilNationNo,jdbcType=VARCHAR}
           ,#{csoMtmInq.cstmrSmsRecptnYn,jdbcType=VARCHAR}
           ,#{csoMtmInq.cstmrEmailRecptnYn,jdbcType=VARCHAR}
           ,#{langCd,jdbcType=VARCHAR}
           ,#{mallId,jdbcType=VARCHAR}
           ,#{dvcCd,jdbcType=VARCHAR}
           ,#{mbrId,jdbcType=VARCHAR}
           ,SYSDATE
           ,#{mbrId,jdbcType=VARCHAR}
           ,SYSDATE
           ,#{userTrackingId,jdbcType=VARCHAR}
           ,#{csoMtmInq.erpGodNo,jdbcType=VARCHAR}
           ,#{csoMtmInq.godNo,jdbcType=VARCHAR}
        )
    </insert>

    <!-- 1:1 문의 첨부파일 등록 -->
    <insert id="insertCsInquiryFile" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO">
        INSERT /* [biz.mbr.mypage.xml][insertCsInquiryFile][등록 : 1:1문의 첨부파일등록 ][김대영] */
        INTO CSO_MTM_INQ_ATCH_FILE
        (
               MTM_INQ_SN
              ,MTM_INQ_ATCH_FILE_TURN
              ,MTM_INQ_ATCH_FILE_NM
              ,MTM_INQ_ATCH_FILE_URL
              ,MTM_INQ_ATCH_FILE_CPCTY
              ,UDTER_ID
              ,UDT_DT
        )
        VALUES
        (
            #{csoMtmInq.mtmInqSn,jdbcType=NUMERIC}
           ,#{csoMtmInqAtchFile.mtmInqAtchFileTurn,jdbcType=NUMERIC}
           ,#{csoMtmInqAtchFile.mtmInqAtchFileNm,jdbcType=VARCHAR}
           ,#{csoMtmInqAtchFile.mtmInqAtchFileUrl,jdbcType=VARCHAR}
           ,#{csoMtmInqAtchFile.mtmInqAtchFileCpcty,jdbcType=NUMERIC}
           ,#{mbrId,jdbcType=VARCHAR}
           ,SYSDATE
        )
    </insert>


    <!-- 1:1 문의 주문상품 등록 -->
    <insert id="insertCsInquiryOrdGod" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO">
        INSERT /* [biz.mbr.mypage.xml][insertCsInquiryOrdGod][등록 : 1:1문의 주문상품등록 ][김대영] */
        INTO CSO_MTM_INQ_ORD_GOD
        (
               MTM_INQ_SN
              ,MTM_INQ_ORD_GOD_TURN
              ,GOD_NM
              ,ORD_NO
              ,ORD_GOD_TURN
              ,UDTER_ID
              ,UDT_DT
        )
        VALUES
        (
            #{csoMtmInq.mtmInqSn,jdbcType=NUMERIC}
           ,#{mtmInqOrdGodTurn,jdbcType=NUMERIC}
           ,#{ordGod.godNm,jdbcType=VARCHAR}
           ,#{ordGod.ordNo,jdbcType=VARCHAR}
           ,#{ordGod.ordGodTurn,jdbcType=NUMERIC}
           ,#{mbrId,jdbcType=VARCHAR}
           ,SYSDATE
        )
    </insert>

    <!-- 1:1 문의 주문상품 등록 /상품이름 가져오기 hdiv -->
    <select id="selectOrdGodNm" parameterType="String" resultType="ordGod">
        select ord_god_turn
              ,god_nm
        from ord_god
        where ord_no=#{ordNo, jdbcType=VARCHAR}
    </select>


    <!-- 1:1 첨부파일 등록 -->
    <insert id="insertCsoMtmInqAtchFile" parameterType="csoMtmInqAtchFile">
        INSERT /*[biz.mbr.mypage.xml][insertCsoMtmInqAtchFile][등록 : 1:1 첨부파일 등록 ][김대영]*/
        INTO CSO_MTM_INQ_ATCH_FILE
        (
            MTM_INQ_SN
           ,MTM_INQ_ATCH_FILE_TURN
           ,MTM_INQ_ATCH_FILE_NM
           ,MTM_INQ_ATCH_FILE_URL
           ,MTM_INQ_ATCH_FILE_CPCTY
           ,UDTER_ID
           ,UDT_DT
        )
        VALUES
        (
            #{mtmInqSn,jdbcType=NUMERIC}
           ,#{mtmInqAtchFileTurn,jdbcType=NUMERIC}
           ,#{mtmInqAtchFileNm,jdbcType=VARCHAR}
           ,#{mtmInqAtchFileUrl,jdbcType=VARCHAR}
           ,#{mtmInqAtchFileCpcty,jdbcType=NUMERIC}
           ,#{udterId,jdbcType=VARCHAR}
           ,SYSDATE
        )
    </insert>
    <resultMap id ="mtmMap" type ="com.plgrim.ncp.biz.member.result.MypageMtmFoResult">
        <result property="ordGod.itmNo" column="ITM_NO" />
        <result property="ordGod.ordGodTurn" column="ORD_GOD_TURN" />
        <result property="ordGod.godNo" column="GOD_NO" />
        <result property="ordGod.godNm" column="GOD_NM" />
        <result property="ordGod.colorNm" column="COLOR_NM" />
        <result property="ordGod.colorCd" column="COLOR_CD" />
        <result property="ordGod.clorChipImgUrl" column="CLOR_CHIP_IMG_URL" />
        <result property="ordGod.erpGodNo" column="ERP_GOD_NO" />
        <result property="ordGod.godTpCd" column="GOD_TP_CD" />
        <result property="ordGod.lstImgUrl" column="LST_IMG_URL" />
        <result property="ordGod.itmNm" column="ITM_NM" />
        <result property="ordGod.dlvStatCd" column="DLV_STAT_CD" />
        <result property="ord.ordNo" column="ORD_NO" />
        <result property="ord.ordStatCd" column="ORD_STAT_CD" />
        <result property="ord.ordTpCd" column="ORD_TP_CD" />
        <result property="ordDt" column="ORD_DT" />
        <result property="ordGod.ordNo" column="ordNo" />
        <result property="ord.mbrTpCd" column="MBR_TP_CD" />
        <result property="ord.mbrNo" column="MBR_NO" />
        <result property="ord.mbrAtrbCd" column="MBR_ATRB_CD" />
        <result property="ord.regDt" column="REG_DT" />
        <result property="mbrEmail" column="MBR_EMAIL" />
        <result property="mobilNo" column="mobilNo" />
        <result property="ord.cstmrMobilNationNo" column="MOBIL_NATION_NO" />
        <result property="mbrNo" column="MBR_NO" />
        <result property="mbrNm" column="MBR_NM" />
        <result property="mbrId" column="MBR_ID" />
        <result property="brndNm" column="BRND_NM"/>
        <result property="ordGod.ordQty" column="ORD_QTY"/>
        <result property="ordGod.saleAmt" column="SALE_AMT"/>
        <result property="ord.ordStatCd" column="ORD_STAT_CD"/>



    </resultMap>

	<resultMap id="mtmMapMo" type="com.plgrim.ncp.biz.member.result.MypageMtmFoResult">
	<id property="ord.ordNo" column="ORD_NO" />
	<id property="ordDt" column="ORD_DT" />
	<result property="ordGod.ordGodTurn"                     column="ORD_GOD_TURN" />
    <collection property="ordGodList"   ofType="com.plgrim.ncp.biz.member.result.MypageMtmFoResult" >
    <result property="ordGod.erpGodNo"                     column="ERP_GOD_NO" />
    <result property="ordGod.colorNm"                     column="COLOR_NM" />                      <!-- 상품번호 -->
    <result property="ordGod.ordGodTurn"                     column="ORD_GOD_TURN" />                             <!-- 상품번호 -->
    <result property="ordGod.godNm"                     column="GOD_NM" />                             <!-- 상품번호 -->
    <result property="ordGod.ordQty"                     column="ORD_QTY" />
    <result property="ordGod.itmNm"                     column="ITM_NM" />
    <result property="ordGod.lstImgUrl"                     column="LST_IMG_URL" />
    </collection>
	</resultMap>

	<select id ="selectInquiryOrdMOListBefor0822" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO" resultType ="int">
   /* [biz.mbr.mypage.xml][selectInquiryOrdMOListBefor0822][리스트 : 1:1문의 주문상품리스트MO 8월22일 이전][brandon] */
        SELECT
            count(*)
        FROM ORD A
        INNER JOIN ORD_GOD B ON A.ORD_NO = B.ORD_NO
        WHERE 1=1
        AND A.MBR_NO = #{mbrNo,jdbcType=VARCHAR}
		<!-- AND ORD_DT <![CDATA[  < ]]> '2017/08/02' -->
		AND ORD_DT <![CDATA[  < ]]> TO_DATE('20180822000000', 'yyyyMMddhh24miss')

    </select>

	<select id ="selectInquiryGodMOList" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO" resultMap ="mtmMap">
		<if test='mallId != null and (mallId.equalsIgnoreCase("MBM") or mallId.equalsIgnoreCase("SAM"))'>
			<include refid="com.plgrim.ncp.base.beginPage"/>
		</if>
        SELECT  /* [biz.mbr.mypage.xml][selectInquiryGodMOList][리스트 : 1:1문의 주문상품리스트MO ][brandon] */
            /* TO_CHAR(A.ORD_DT,'YYYY-MM-DD mm:ss') as ORD_DT,
             A.ORD_NO,
             B.ORD_GOD_TURN,
             B.GOD_NM,
           	 B.ORD_QTY,
           	 B.ERP_GOD_NO,
           	 B.COLOR_NM,
           	 B.ITM_NM,
           	 B.LST_IMG_URL */



             A.MBR_NO,
             B.ORD_NO
            ,A.ORD_STAT_CD
            ,B.ITM_NO
            ,B.ORD_GOD_TURN
            ,B.GOD_NO
            ,B.GOD_NM
            ,TO_CHAR(A.ORD_DT,'YYYY-MM-DD') as ORD_DT
            ,B.COLOR_NM
            ,B.COLOR_CD
            ,B.ERP_GOD_NO
            ,B.GOD_TP_CD
            ,B.LST_IMG_URL
            ,B.ITM_NM
            ,B.CLOR_CHIP_IMG_URL,
            B.ORD_QTY,
            B.SALE_AMT
        FROM ORD A
        INNER JOIN ORD_GOD B ON A.ORD_NO = B.ORD_NO
        WHERE 1=1
<!--         AND A.MBR_NO = #{mbrNo,jdbcType=VARCHAR} -->
         AND A.MBR_NO = #{mbrNo,jdbcType=VARCHAR}
		 <if test='mallId != null and mallId != ""'>
		 AND MALL_ID = #{mallId, jdbcType=VARCHAR}
		 </if>
         <if test='calendarFrom !=null  and calendarTo != null'>
		 AND ORD_DT BETWEEN  #{calendarFrom}  and  #{calendarTo}
		 </if>
		 <if test ='calendarFrom ==null or calendarTo == null'>
		 AND ORD_DT BETWEEN add_months(SYSDATE,-3) AND SYSTIMESTAMP
		 </if>
		 <if test ='searchOrdNo !=null'>
		 AND A.ORD_NO = #{searchOrdNo, jdbcType=VARCHAR}
		 </if>
		ORDER BY ORD_NO DESC ,B.ORD_GOD_TURN ASC
		<if test='mallId != null and (mallId.equalsIgnoreCase("MBM") or mallId.equalsIgnoreCase("SAM"))'>
			<include refid="com.plgrim.ncp.base.endPage"/>
		</if>
    </select>

    <!-- 1:1문의 상품 리스트 -->
    <select id ="selectGodList" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO" resultMap ="mtmMap">
    <include refid="com.plgrim.ncp.base.beginPage"/>
        SELECT  /* [biz.mbr.mypage.xml][selectGodList][리스트 : 1:1문의 주문상품리스트 ][brandon] */
             A.MBR_NO
            ,B.ORD_NO
            ,A.ORD_STAT_CD
            ,B.ITM_NO
            ,B.ORD_GOD_TURN
            ,B.GOD_NO
            ,B.GOD_NM
            ,TO_CHAR(A.ORD_DT,'YYYY-MM-DD') as ORD_DT
            ,B.COLOR_NM
            ,B.COLOR_CD
            ,B.ERP_GOD_NO
            ,B.GOD_TP_CD
            ,B.LST_IMG_URL
            ,B.ITM_NM
            ,B.CLOR_CHIP_IMG_URL
		<choose>
		<when test='mallId != null and (mallId.equalsIgnoreCase("MBM") or mallId.equalsIgnoreCase("SAM"))'>
            , DECODE(LDDG.DLV_STAT_CD, '', (SELECT MAX(T1.DLV_STAT_CD)
            								FROM LGS_DLIVY_DRCT_GOD T1, ORD_CPST_GOD_CNNC T2
            								WHERE T1.PCKAGE_GOD_TURN = B.ORD_GOD_TURN
            								AND T1.ORD_NO = A.ORD_NO
            								AND T1.ORD_NO = T2.ORD_NO
            								AND T1.PCKAGE_GOD_TURN = T2.ORD_GOD_TURN
            								AND T1.ORD_GOD_TURN = T2.ORD_CPST_GOD_TURN
            								AND T2.PCKAGE_GOD_TP_CD <![CDATA[ <> ]]> 'ADIT_CPST_GOD'), LDDG.DLV_STAT_CD) AS DLV_STAT_CD
            , NVL(B.ORD_QTY,0) - NVL(C.CLM_QTY,0) AS ORD_QTY
		</when>
		<otherwise>
            ,B.ORD_QTY
		</otherwise>
        </choose>
            ,B.SALE_AMT
        FROM ORD A
        INNER JOIN ORD_GOD B ON A.ORD_NO = B.ORD_NO
		<if test="mallId eq 'MBM' or mallId eq 'SAM'">
        LEFT JOIN LGS_DLIVY_DRCT_GOD LDDG ON LDDG.ORD_NO = B.ORD_NO AND LDDG.ORD_GOD_TURN = B.ORD_GOD_TURN
        LEFT OUTER JOIN (
	        SELECT C.ORD_NO
	             , CWG.ITM_NO
	             , OCGC.ORD_GOD_TURN
	             , SUM(NVL(CWG.PAY_EXCHG_RT_CRNCY_AMT,0)) AS PAY_EXCHG_RT_CRNCY_AMT
	             , SUM(NVL(CWG.GOD_DC_AMT,0)) AS GOD_DC_AMT
	             , SUM(NVL(CWG.CLM_QTY,0) - NVL(CWG.CLM_WTHDRAW_QTY,0)) AS CLM_QTY
	          FROM CLM C
	          JOIN CLM_WRHS_GOD CWG ON C.ORD_NO = CWG.ORD_NO AND C.CLM_NO = CWG.CLM_NO
	          JOIN ORD_CLM_GOD_CNNC OCGC ON CWG.CLM_NO = OCGC.CLM_NO
	     	 					AND CWG.CLM_WRHS_GOD_TURN = OCGC.CLM_WRHS_GOD_TURN
	     	 					AND CWG.ORD_NO = OCGC.ORD_NO
	     						AND OCGC.GOD_CNNC_TP_CD = 'WRHS_GOD_CNNC'
	         WHERE C.CLM_STAT_CD != 'WTHDRAW' /* 클레임 철회 제외 */
	        GROUP BY CWG.ITM_NO , OCGC.ORD_GOD_TURN , C.ORD_NO
        ) C ON B.ITM_NO = C.ITM_NO  AND  B.ORD_GOD_TURN = C.ORD_GOD_TURN AND B.ORD_NO = C.ORD_NO
		</if>
        WHERE 1=1
        AND A.MBR_NO = #{mbrNo,jdbcType=VARCHAR}
		 <if test='mallId != null and mallId != ""'>
		 AND MALL_ID = #{mallId, jdbcType=VARCHAR}
		 </if>
         <if test='calendarFrom !=null  and calendarTo != null'>
		 AND ORD_DT BETWEEN  #{calendarFrom}  and  #{calendarTo}
		 </if>
		 <if test ='calendarFrom ==null or calendarTo == null'>
		 AND ORD_DT BETWEEN add_months(SYSDATE,-3) AND SYSTIMESTAMP
		 </if>
		 ORDER BY B.ORD_NO DESC , B.ORD_GOD_TURN ASC
 	 <include refid="com.plgrim.ncp.base.endPage"/>
    </select>

    <!-- 1:1문의 주문리스트 정보 -->
    <select id ="selectOrdList" parameterType="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO" resultMap ="mtmMap">
        <include refid="com.plgrim.ncp.base.beginPage"/>
        SELECT /* [biz.mbr.mypage.xml][selectOrdList][리스트 : 1:1문의 주문리스트 정보][김대영] */
             ORD_NO, MBR_NO
         FROM ORD
         WHERE 1=1
           AND MBR_NO = #{mbrNo,jdbcType=VARCHAR}
        <!-- ncp 3차 -->
        <if test="!@com.plgrim.ncp.framework.commons.StringService@isEmpty(mallId)">
           AND MALL_ID IN (SELECT cntc_mall_id
                               FROM sys_mall_cntc
                              WHERE mall_id = #{mallId, jdbcType=VARCHAR})
        </if>
        <if test="!@com.plgrim.ncp.framework.commons.StringService@isEmpty(langCd)">
           AND LANG_CD = #{langCd:VARCHAR}
        </if>

         ORDER BY ORD_NO DESC , B.ORD_GOD_TURN ASC
         <include refid="com.plgrim.ncp.base.endPage"/>
    </select>

       <!-- 1:1문의 주문리스트 정보  카운트 -->
    <select id="selectInquiryOrdGodListCount" parameterType="com.plgrim.ncp.biz.helpdesk.data.HelpdeskFaqFoDTO" resultType="long">
        SELECT /* [biz.help.xml][selectInquiryOrdGodListCount][1:1문의 주문리스트 정보  카운트][brandon] */
                COUNT(*)
        FROM    ORD o JOIN ORD_GOD g
        ON o.ord_no =g.ord_no
        WHERE   1 = 1
         AND MBR_NO = #{mbrNo,jdbcType=VARCHAR}
		 <if test='mallId != null and mallId != ""'>
		 AND MALL_ID = #{mallId, jdbcType=VARCHAR}
		 </if>
		 <if test='calendarFrom !=null and calendarTo != null'>
		 AND ORD_DT BETWEEN  #{calendarFrom}  and  #{calendarTo}
		 </if>
		 <if test ='calendarFrom ==null or calendarTo== null  '>
		 AND ORD_DT BETWEEN add_months(SYSDATE,-3) AND SYSDATE
		 </if>
		  <if test ='searchOrdNo !=null'>
		 AND o.ORD_NO = #{searchOrdNo, jdbcType=VARCHAR}
		 </if>

    </select>

    <!-- 회원 이메일,휴대폰번호 가져오기 -->
    <select id ="selectMemberMtmInfo" parameterType ="com.plgrim.ncp.biz.member.data.MypageMtmFoDTO" resultMap ="mtmMap">
        SELECT  /* [biz.mbr.mypage.xml][selectMemberMtmInfo][회원 이메일,휴대폰번호 가져오기 ][김대영] */
               mbr.MBR_EMAIL,
               mbr.MOBIL_NATION_NO,
               mbr.MBR_NO,
               mbr.MBR_NM,
               mbr.MBR_ID,
               ord.ORD_NO,
               (mbr.MOBIL_AREA_NO||'-'||mbr.MOBIL_TLOF_NO||'-'||mbr.MOBIL_TLOF_WTHN_NO) as mobilNo
        FROM   MBR mbr
        JOIN   ORD ord
         ON  mbr.MBR_NO = ord.MBR_NO
        WHERE   mbr.MBR_NO = #{mbrNo,jdbcType=VARCHAR}
    </select>

    <resultMap id="myWishResult" type="com.plgrim.ncp.biz.member.result.MypageWishFoResult">
        <result property="wishlstSn" column="WISHLST_SN" />
        <result property="godTurn" column="GOD_TURN" />
        <result property="godNo" column="GOD_NO" />
        <result property="ovseaDspStatCd" column="OVSEA_DSP_STAT_CD" />
        <result property="ovseaDlvPsbYn" column="OVSEA_DLV_PSB_YN" />
        <result property="godNm" column="GOD_NM" />
        <result property="csmrPrc" column="CSMR_PRC" />
        <result property="rtlPrc" column="RTL_PRC" /> <!-- mlb/sa 정소가 추가 -->
        <result property="colorNm" column="COLOR_NM" />
        <result property="imgUrl" column="IMG_URL" />
        <result property="godUrl" column="GOD_URL" />
        <result property="itmQty" column="ITM_QTY" />
        <result property="brndId" column="BRND_ID" />
        <result property="brndNm" column="BRND_NM" />
        <result property="godSaleSectCd" column="GOD_SALE_SECT_CD" />
        <result property="lastSalePrc" column="LAST_SALE_PRC" />
        <result property="clorChipImgUrl" column="CLOR_CHIP_IMG_URL" />
        <collection property="godIcon" ofType="com.plgrim.ncp.base.entities.datasource1.god.GodIcon">
            <result property="iconImgUrl" column="ICON_IMG_URL" />
            <result property="iconNm" column="ICON_NM" />
        </collection>
    </resultMap>
    <select id="selectMyWishList" parameterType="com.plgrim.ncp.biz.member.data.MypageFoDTO" resultMap="myWishResult">
        SELECT /* [biz.mbr.mypage.xml][selectMyWishList]MyPage Wish 목록조회][csh] */
                wh.WISHLST_SN
              , wh.GOD_TURN
              , wh.GOD_NM
              , wh.GOD_NO
			  , wh.OVSEA_DSP_STAT_CD
			  , wh.OVSEA_DLV_PSB_YN
              <!-- , TO_CHAR(wh.CSMR_PRC * wh.ITM_QTY, '999,999,999') AS CSMR_PRC -->
              , wh.CSMR_PRC
              , wh.RTL_PRC
              , wh.COLOR_NM
              , wh.IMG_URL
              , wh.GOD_URL
              , wh.ICON_IMG_URL
              , wh.ICON_NM
              , wh.GOD_SALE_SECT_CD
              , wh.ITM_QTY
              , wh.BRND_ID
              , wh.BRND_NM
              , wh.LAST_SALE_PRC
              , wh.CLOR_CHIP_IMG_URL
          FROM (
          <include refid="com.plgrim.ncp.base.beginPage"/>

                SELECT   bw.WISHLST_SN
                       , bwg.GOD_TURN
                       , bwg.GOD_NO
                       , NVL(gl.god_nm,gd.god_nm) as  god_nm
					   , gl.ovsea_dsp_stat_cd
					   , gd.ovsea_dlv_psb_yn
                       , gd.COLOR_NM
                       , gig.IMG_URL
                       <choose>
						<when test='mallId != null and (mallId.equalsIgnoreCase("MBM") or mallId.equalsIgnoreCase("SAM"))'>
                       , dsp.CSMR_PRC
					   , FN_SEO_URL(#{mallId, jdbcType=VARCHAR}, #{lang,jdbcType=VARCHAR}, gd.GOD_NO) AS GOD_URL
						</when>
						<otherwise>
                       , gd.CSMR_PRC
                       , '/goods/'|| (SELECT CD_NM FROM MV_SYS_CD WHERE UPPER_CD = 'RECOMEND_SEX' AND CD= GD.RECOMEND_SEX_CD  AND LANG_CD ='KOR') || '/'
                                  || (SELECT SB.BRND_PRDLST_NM FROM SYS_BRND_PRDLST SB WHERE SB.BRND_ID = GD.BRND_ID AND SB.PRDLST_CD  = GD.PRDLST_CD) || '/'
                                  || GD.ERP_GOD_NO AS GOD_URL
                        </otherwise>
                       </choose>
                       , gi.ICON_IMG_URL
                       , gi.ICON_NM
                       , DECODE(gd.GOD_SALE_SECT_CD , 'TMP_SLDOUT' , 'SLDOUT' , gd.GOD_SALE_SECT_CD) AS GOD_SALE_SECT_CD
                       , bwg.ITM_QTY
                       , gd.BRND_ID
                       , NVL(sbl.BRND_NM,sb.BRND_NM) as brnd_nm
                       , dsp.RTL_PRC
                       , dsp.LAST_SALE_PRC
                       , gd.CLOR_CHIP_IMG_URL
                  FROM BSK_WISHLST bw
                  INNER JOIN BSK_WISHLST_GOD bwg ON bw.WISHLST_SN = bwg.WISHLST_SN
                                                 AND bw.MBR_NO =  #{mbr.mbrNo, jdbcType=VARCHAR}
                  INNER JOIN GOD gd ON bwg.GOD_NO = gd.GOD_NO
                  INNER JOIN SYS_BRND SB ON gd.BRND_GRP_ID = SB.BRND_ID AND SB.USE_YN ='Y'
                  LEFT OUTER JOIN GOD_IMG gig ON gd.GOD_NO = gig.GOD_NO
                                              AND gig.IMG_TURN = 1 /* 대표 이미지, 0 -> 1 변경(2018.06.14 ryan) */
                                              AND gig.IMG_TP_CD = 'THNAIL' /* 상품 이미지 */
                                              --AND gig.IMG_SIZE_CD = '228X301' /*가로X세로, 주석처리 변경(2018.06.14 ryan) */
                                              AND gig.IMG_APRV_YN = 'Y'
                                              AND gig.IMG_USE_YN = 'Y'

                  LEFT OUTER JOIN GOD_LANGBY_GOD_NM gl ON gd.GOD_NO = gl.GOD_NO
                                                       AND gl.LANG_CD = #{lang,jdbcType=VARCHAR}
                  LEFT OUTER JOIN GOD_ICON_CNNC gic ON gd.GOD_NO = gic.GOD_NO
                  LEFT OUTER JOIN GOD_ICON gi ON gic.ICON_TURN = gi.ICON_TURN
                  INNER JOIN DSP_GOD_PRC dsp ON dsp.GOD_NO = gd.GOD_NO
                                                  AND dsp.MALL_ID = #{mallId, jdbcType=VARCHAR}
                                                  AND dsp.LANG_CD = 'KOR' /* 2018.08.07 ryan) */
                                                  <!-- AND dsp.LANG_CD =#{lang, jdbcType=VARCHAR} 주석처리 2018.08.07 ryan-->
                                                  <!-- AND dsp.PRC_SECT_CD = #{prcSectCd, jdbcType=VARCHAR} -->
                                                  <if test='spcPrmTp != null and spcPrmTp != ""'>
                                                  AND dsp.PRC_SECT_CD = CASE
                                                                       WHEN (SELECT 1
                                                                               FROM DSP_GOD_PRC A
                                                                              WHERE A.PRC_SECT_CD = #{spcPrmTp, jdbcType=VARCHAR} AND A.GOD_NO = gd.GOD_NO AND ROWNUM = 1)
                                                                               IS NOT NULL
                                                                       THEN #{spcPrmTp, jdbcType=VARCHAR} ELSE #{prcSectCd, jdbcType=VARCHAR} END
                                                  </if>
                                                  <if test='spcPrmTp == null or spcPrmTp == ""'>
                                                  AND dsp.PRC_SECT_CD = #{prcSectCd, jdbcType=VARCHAR}
                                                  </if>
                  LEFT OUTER JOIN SYS_BRND_LANG sbl
                        ON SB.BRND_ID =  sbl.BRND_ID
                        AND sbl.LANG_CD =#{lang,jdbcType=VARCHAR}
              WHERE 1=1
                 AND gd.DSP_YN = 'Y'
                 AND gd.GOD_APRV_SECT_CD = 'APRV_COMPT'
                 -- AND gd.GOD_SALE_SECT_CD IN ('SLDOUT', 'SALE_PROGRS', 'TMPR_SLDOUT') -- #47237 국문몰 픽업 Only 판매 상태 개발의 건
                 -- AND gd.GOD_SALE_SECT_CD IN ('SLDOUT', 'SALE_PROGRS', 'TMPR_SLDOUT', 'SALE_PROGRS_PKUP')
                 AND gd.GOD_SALE_SECT_CD IN ('SALE_PROGRS', 'SMTM_SLDOUT', 'SLDOUT')    -- 판매중, 일시품절, 품절
				 <!-- AND bw.LANG_CD = #{lang,jdbcType=VARCHAR} /* 다국어 구분없이 전체조회 2018.08.07 ryan */ -->
                 AND EXISTS
                          (SELECT 1
                             FROM DSP_CTGRY_CNNC_GOD A
                              INNER JOIN DSP_CTGRY B
                                     ON (A.DSP_CTGRY_NO = B.DSP_CTGRY_NO AND B.DSP_YN = 'Y' AND B.DELETE_YN = 'N')
                            WHERE A.GOD_NO = gd.GOD_NO )<!-- AND A.DSP_YN = 'Y') --> <!-- 2019.01.07 위시리스트 목록 조회에서 카테고리 상품 전시 여부 체크 제외 -->
                  <if test="godNoList != null and godNoList.size() > 0">
                   AND bwg.god_no IN
                    <foreach collection="godNoList" item="godNo" index="index" separator="," open=" (" close=")">
                        #{godNo}
                    </foreach>
                  </if>
                  ORDER BY bwg.WISHLST_REG_DT DESC
          <include refid="com.plgrim.ncp.base.endPage"/>
              )wh
    </select>


     <select id="countMyWishList" parameterType="com.plgrim.ncp.biz.member.data.MypageFoDTO" resultMap="myWishResult">
        SELECT /* [biz.mbr.mypage.xml][countMyWishList]MyPage Wish 목록Count조회][csh] */
                wh.WISHLST_SN
              , wh.GOD_TURN
              , wh.GOD_NM
              , wh.GOD_NO
              , TO_CHAR(wh.CSMR_PRC * wh.ITM_QTY, '999,999,999') AS CSMR_PRC
              , wh.COLOR_NM
              , wh.IMG_URL
              , wh.ICON_IMG_URL
              , wh.ICON_NM
              , wh.GOD_SALE_SECT_CD
              , wh.ITM_QTY
              , wh.BRND_ID
              , wh.BRND_NM
              , wh.LAST_SALE_PRC
          FROM (

                SELECT   bw.WISHLST_SN
                       , bwg.GOD_TURN
                       , bwg.GOD_NO
                       , NVL(gl.god_nm,gd.god_nm) as  god_nm
					   , gl.ovsea_dsp_stat_cd
					   , gd.ovsea_dlv_psb_yn
                       , gd.CSMR_PRC
                       , gd.COLOR_NM
                       , gig.IMG_URL
                       , gi.ICON_IMG_URL
                       , gi.ICON_NM
                       , DECODE(gd.GOD_SALE_SECT_CD , 'TMP_SLDOUT' , 'SLDOUT' , gd.GOD_SALE_SECT_CD) AS GOD_SALE_SECT_CD
                       , bwg.ITM_QTY
                       , gd.BRND_ID
                       , sb.BRND_NM
                       , dsp.LAST_SALE_PRC
                  FROM BSK_WISHLST bw
                  INNER JOIN BSK_WISHLST_GOD bwg ON bw.WISHLST_SN = bwg.WISHLST_SN
                                                 AND bw.MBR_NO =  #{mbr.mbrNo, jdbcType=VARCHAR}
                  INNER JOIN GOD gd ON bwg.GOD_NO = gd.GOD_NO
                  INNER JOIN SYS_BRND SB ON gd.BRND_ID = SB.BRND_ID AND SB.USE_YN ='Y'
                  LEFT OUTER JOIN GOD_IMG gig ON gd.GOD_NO = gig.GOD_NO
                                              AND gig.IMG_TURN = 0 /* 대표 이미지, 0 -> 1 변경(2018.06.14 ryan)*/
                                              AND gig.IMG_TP_CD = 'THNAIL' /* 상품 이미지 */
                                              --AND gig.IMG_SIZE_CD = '228X301' /*가로X세로, 주석처리 변경(2018.06.14 ryan) */
                                              AND gig.IMG_APRV_YN = 'Y'
                                              AND gig.IMG_USE_YN = 'Y'

                  LEFT OUTER JOIN GOD_LANGBY_GOD_NM gl ON gd.GOD_NO = gl.GOD_NO
                                                       AND gl.LANG_CD = #{lang,jdbcType=VARCHAR}
                  LEFT OUTER JOIN GOD_ICON_CNNC gic ON gd.GOD_NO = gic.GOD_NO
                  LEFT OUTER JOIN GOD_ICON gi ON gic.ICON_TURN = gi.ICON_TURN
                  INNER JOIN DSP_GOD_PRC dsp ON dsp.GOD_NO = gd.GOD_NO
                                                  AND dsp.MALL_ID = #{mallId, jdbcType=VARCHAR}
                                                  AND dsp.LANG_CD = 'KOR' /* 2018.08.07 ryan) */
                                                  <!-- AND dsp.LANG_CD =#{lang, jdbcType=VARCHAR} 주석처리 2018.08.07 ryan-->
                                                  <!-- AND dsp.PRC_SECT_CD = #{prcSectCd, jdbcType=VARCHAR} -->
                                                  <if test='spcPrmTp != null and spcPrmTp != ""'>
                                                  AND dsp.PRC_SECT_CD = CASE
                                                                       WHEN (SELECT 1
                                                                               FROM DSP_GOD_PRC A
                                                                              WHERE A.PRC_SECT_CD = #{spcPrmTp, jdbcType=VARCHAR} AND A.GOD_NO = gd.GOD_NO AND ROWNUM = 1)
                                                                               IS NOT NULL
                                                                       THEN #{spcPrmTp, jdbcType=VARCHAR} ELSE #{prcSectCd, jdbcType=VARCHAR} END
                                                  </if>
                                                  <if test='spcPrmTp == null or spcPrmTp == ""'>
                                                  AND dsp.PRC_SECT_CD = #{prcSectCd, jdbcType=VARCHAR}
                                                  </if>
              WHERE 1=1
                 AND gd.DSP_YN = 'Y'
                 AND gd.GOD_APRV_SECT_CD = 'APRV_COMPT'
                 -- AND gd.GOD_SALE_SECT_CD IN ('SLDOUT', 'SALE_PROGRS', 'TMPR_SLDOUT') -- #47237 국문몰 픽업 Only 판매 상태 개발의 건
                 -- AND gd.GOD_SALE_SECT_CD IN ('SLDOUT', 'SALE_PROGRS', 'TMPR_SLDOUT', 'SALE_PROGRS_PKUP')
                 AND gd.GOD_SALE_SECT_CD IN ('SALE_PROGRS', 'SMTM_SLDOUT', 'SLDOUT')    -- 판매중, 일시품절, 품절
				 <!-- AND bw.LANG_CD = #{lang,jdbcType=VARCHAR} /* 다국어 구분없이 전체조회 2018.08.07 ryan */ -->
                 AND EXISTS
                          (SELECT 1
                             FROM DSP_CTGRY_CNNC_GOD A
                              INNER JOIN DSP_CTGRY B
                                     ON (A.DSP_CTGRY_NO = B.DSP_CTGRY_NO AND B.DSP_YN = 'Y' AND B.DELETE_YN = 'N')
                            WHERE A.GOD_NO = gd.GOD_NO) <!-- AND A.DSP_YN = 'Y') --> <!-- 2019.01.07 위시리스트 목록 조회에서 카테고리 상품 전시 여부 체크 제외 -->
                  <if test="godNoList != null and godNoList.size() > 0">
                   AND bwg.god_no IN
                    <foreach collection="godNoList" item="godNo" index="index" separator="," open=" (" close=")">
                        #{godNo}
                    </foreach>
                  </if>
                  ORDER BY bwg.WISHLST_REG_DT DESC
              )wh
    </select>

    <update id="deleteMyWishList" parameterType="com.plgrim.ncp.biz.member.data.MemberOrdGodFoDTO">
        DELETE /* [biz.mbr.mypage.xml][deleteMyWishList][Wish List삭제 ][csh] */
               BSK_WISHLST_GOD
         WHERE WISHLST_SN = #{wishlstSn ,jdbcType=NUMERIC}
           AND GOD_TURN= #{godTurn ,jdbcType=NUMERIC}
    </update>

    <update id="deleteMainMyWishList" parameterType="com.plgrim.ncp.biz.member.data.MypageFoDTO">
        DELETE /* [biz.mbr.mypage.xml][deleteMyWishList][Wish List삭제 ][csh] */
               BSK_WISHLST_GOD
         WHERE GOD_NO = #{godNo ,jdbcType=VARCHAR}
           AND REGTR_ID = #{mbrNo ,jdbcType=VARCHAR}
    </update>

    <update id="deleteAllMyWishList" parameterType="com.plgrim.ncp.biz.member.data.MypageFoDTO">
        DELETE /* [biz.mbr.mypage.xml][deleteAllMyWishList][Wish List전체삭제 ][kjs] */
               FROM (SELECT bwg.* FROM BSK_WISHLST bw
                  INNER JOIN BSK_WISHLST_GOD bwg ON bw.WISHLST_SN = bwg.WISHLST_SN
                                                 AND bw.MBR_NO =  #{mbr.mbrNo, jdbcType=VARCHAR}
                                                 <!-- AND bw.LANG_CD = #{lang,jdbcType=VARCHAR} /* 다국어 구분없이 전체삭제 2018.08.07 ryan */ -->
                                                 )
    </update>

    <update id="deleteMyAlarmsForStock" parameterType="com.plgrim.ncp.biz.member.data.MypageFoDTO">
        DELETE /* [biz.mbr.mypage.xml][deleteMyAlarmsForStock][재입고 알림 삭제 ][kjs] */
               GOD_RE_WHSG_NTCN
         WHERE RE_WHSG_NTCN_SN = #{reWhsgNtcnSn ,jdbcType=NUMERIC}
           AND GOD_NO = #{godNo ,jdbcType=NUMERIC}
           <if test='setGodNo != null and setGodNo != "" '>
           AND SET_GOD_NO = #{setGodNo ,jdbcType=NUMERIC}
            </if>
           AND MBR_NO = #{mbr.mbrNo ,jdbcType=NUMERIC}
    </update>

    <resultMap id="reviewMap" type="com.plgrim.ncp.biz.member.result.MemberOrdGodFoResult">
        <result property="ord.ordDt" column="ORD_DT" />
        <result property="ordGod.godNo" column="GOD_NO" />
        <result property="ordGod.godNm" column="GOD_NM" />
        <result property="ordGod.mobileGodNm" column="MOBILE_GOD_NM" />
        <result property="ordGod.itmNm" column="ITM_NM" />
        <result property="ordGod.itmNo" column="ITM_NO" />
        <result property="ordGod.colorNm" column="COLOR_NM" />
        <result property="ordGod.colorCd" column="COLOR_CD" />
        <result property="ordGod.brndId" column="BRND_ID" />
        <result property="ordGod.brndGrpId" column="BRND_GRP_ID" />
        <result property="ordGod.lstImgUrl" column="LST_IMG_URL" />
        <result property="ordGod.ordQty" column="ORD_QTY" />
        <result property="ordGod.ordGodTurn" column="ORD_GOD_TURN" />
        <result property="ordGod.ordNo" column="ORD_NO" />
        <result property="ordGod.unityPntAccmlAmt" column="UNITY_PNT_ACCML_AMT" />
        <result property="ordGod.cstmrPchDcsnYn" column="CSTMR_PCH_DCSN_YN" />
        <result property="ordGod.skuNo" column="SKU_NO" />
        <result property="realOrdQty" column="realOrdQty" />                      <!-- 주문상품수량 - 클레임수량 -->
        <result property="godGodEvl.godEvlSj" column="GOD_EVL_SJ"/>
        <result property="godGodEvl.godEvlCont" column="GOD_EVL_CONT"/>
        <result property="godGodEvl.pkgEvlScore" column="PKG_EVL_SCORE"/>
        <result property="godGodEvl.qltyEvlScore" column="QLTY_EVL_SCORE"/>
        <result property="godGodEvl.dlvEvlScore" column="DLV_EVL_SCORE"/>
        <result property="godGodEvl.sizeEvlCd" column="SIZE_EVL_CD"/>
        <result property="godGodEvl.colorEvlCd" column="COLOR_EVL_CD"/>
        <result property="godGodEvl.bstGodEvlYn" column="BST_GOD_EVL_YN"/>
        <result property="godGodEvl.ntceYn" column="NTCE_YN"/>
        <result property="godGodEvl.inqireNum" column="INQIRE_NUM"/>
        <result property="godGodEvl.regDt" column="REG_DT"/>
        <result property="godGodEvl.godEvlTurn" column="GOD_EVL_TURN"/>
        <result property="godGodEvl.godEvlWritngDt" column="GOD_EVL_WRITNG_DT"/>
        <result property="godGodEvl.mallId" column="MALL_ID"/>
        <result property="godGodEvl.langCd" column="LANG_CD"/>
        <result property="godGodEvl.dvcCd" column="DVC_CD"/>
        <result property="sysBrnd.brndNm" column="BRND_NM"/>
        <result property="mbrPntIntrlckHist.pntAmt" column="PNT_AMT"/>
        <result property="pckageGodTpCd" column="pckageGodTpCd" />  <!-- 패키지형 상품 유형 코드-->
        <result property="dlvStatCd" column="dlvStatCd" />   <!-- 배송상태코드-->
       	<result property="recomendSexNm" column="RECOMEND_SEX_CD" />
       	<result property="textYn" column="textYn" />
       	<result property="photoYn" column="photoYn" />
       	<result property="godUrl" column="GOD_URL"/>
       	<result property="accmlAmt" column="ACCML_AMT"/>
        <collection property="godGodEvlAtchFiles" ofType="godGodEvlAtchFile" >
<!--        <id property="mbr.mbrNo" column="MBR_NO" /> -->
            <result property="atchFileTurn" column="ATCH_FILE_TURN" />
            <result property="atchFileUrl" column="ATCH_FILE_URL" />
            <result property="atchFileNm" column="ATCH_FILE_NM" />
       </collection>
    </resultMap>
    <resultMap id="reviewStoreMap" type="com.plgrim.ncp.biz.member.result.MemberOrdGodFoResult">
        <result property="ordGod.godNo" column="GOD_NO" />
        <result property="ordGod.godNm" column="GOD_NM" />
        <result property="ordGod.colorNm" column="COLOR_NM" />
        <result property="ordGod.mobileGodNm" column="MOBILE_GOD_NM" />
        <result property="godGodEvl.godEvlSj" column="GOD_EVL_SJ"/>
        <result property="godGodEvl.godEvlCont" column="GOD_EVL_CONT"/>
        <result property="godGodEvl.pkgEvlScore" column="PKG_EVL_SCORE"/>
        <result property="godGodEvl.qltyEvlScore" column="QLTY_EVL_SCORE"/>
        <result property="godGodEvl.dlvEvlScore" column="DLV_EVL_SCORE"/>
        <result property="godGodEvl.sizeEvlCd" column="SIZE_EVL_CD"/>
        <result property="godGodEvl.colorEvlCd" column="COLOR_EVL_CD"/>
        <result property="godGodEvl.bstGodEvlYn" column="BST_GOD_EVL_YN"/>
        <result property="godGodEvl.ntceYn" column="NTCE_YN"/>
        <result property="godGodEvl.inqireNum" column="INQIRE_NUM"/>
        <result property="godGodEvl.regDt" column="REG_DT"/>
        <result property="godGodEvl.godEvlTurn" column="GOD_EVL_TURN"/>
        <result property="godGodEvl.godEvlWritngDt" column="GOD_EVL_WRITNG_DT"/>
        <result property="godGodEvl.mallId" column="MALL_ID"/>
        <result property="godGodEvl.langCd" column="LANG_CD"/>
        <result property="godGodEvl.dvcCd" column="DVC_CD"/>
        <result property="sysBrnd.brndNm" column="BRND_NM"/>
        <result property="ordGod.lstImgUrl" column="LST_IMG_URL" />
        <collection property="godGodEvlAtchFiles" ofType="godGodEvlAtchFile" >
        <result property="atchFileTurn" column="ATCH_FILE_TURN" />
        <result property="atchFileUrl" column="ATCH_FILE_URL" />
        <result property="atchFileNm" column="ATCH_FILE_NM" />
       </collection>
    </resultMap>
    <select id = "selectMyGoodsReviewList" parameterType ="com.plgrim.ncp.biz.member.data.MemberOrdGodFoDTO" resultMap="reviewMap">
        SELECT  /* [biz.mbr.mypage.selectMyGoodsReviewList][상품평 작성 리스트][muba]*/
            GGE.*
            ,FI.ATCH_FILE_TURN
            ,FI.ATCH_FILE_URL
            ,FI.ATCH_FILE_NM
            ,(
				SELECT SUM(MWH.WEBPNT_AMT)
            	FROM MBR_WEBPNT_HIST MWH
				WHERE MWH.GOD_NO = GGE.GOD_NO
					AND MWH.GOD_EVL_TURN = GGE.GOD_EVL_TURN
					AND MWH.MBR_NO = #{mbr.mbrNo,jdbcType=VARCHAR}
					AND	WEBPNT_RESN_CD = 'EVT'
					AND WEBPNT_DETAIL_RESN_CD = 'GOD_REV'
					AND WEBPNT_STAT_CD = 'ACCML_DCSN'
			 ) AS pnt_amt
			,(SELECT SUM(NVL(WEBPNT_AMT,0))
			    FROM MBR_WEBPNT_HIST MWH
			   WHERE MWH.MBR_NO = GGE.MBR_NO
			     AND MWH.ORD_NO = GGE.ORD_NO
			     AND MWH.GOD_NO = GGE.GOD_NO
			     AND MWH.GOD_EVL_TURN = GGE.GOD_EVL_TURN
			     AND MWH.WEBPNT_DETAIL_RESN_CD IN ('PHOTO_GOD_REVW','TEXT_GOD_REVW')
			     ) AS ACCML_AMT
        FROM (
        <include refid="com.plgrim.ncp.base.beginPage"/>
            SELECT
				 OG.GOD_NM
				,OG.ORD_NO
				,OG.MOBILE_GOD_NM
				,OG.ITM_NM
				,OG.ITM_NO
				,OG.COLOR_NM
				,OG.COLOR_CD
				,OG.BRND_ID
				,OG.BRND_GRP_ID
				,OG.GOD_NO
				,OG.ORD_QTY
				,OG.ORD_GOD_TURN
				,OG.UNITY_PNT_ACCML_AMT
				,GG.GOD_EVL_SJ
				,GG.GOD_EVL_CONT
				,GG.PKG_EVL_SCORE
				,GG.QLTY_EVL_SCORE
				,GG.DLV_EVL_SCORE
				,GG.SIZE_EVL_CD
				,GG.COLOR_EVL_CD
				,GG.BST_GOD_EVL_YN
				,GG.NTCE_YN
				,GG.INQIRE_NUM
				,GG.REG_DT
				,GG.GOD_EVL_TURN
				,GG.GOD_EVL_WRITNG_DT
				,GG.MALL_ID
				,GG.DVC_CD
				,GG.LANG_CD
				,NVL(OG.ORD_QTY,0)-NVL(C.CLM_QTY,0) AS realOrdQty
				,IMG.IMG_URL AS LST_IMG_URL
                ,G.RECOMEND_SEX_CD
		        ,CASE WHEN NOT EXISTS (SELECT 1 FROM  GOD_GOD_EVL_ATCH_FILE WHERE GG.GOD_NO = GOD_NO AND GG.GOD_EVL_TURN = GOD_EVL_TURN)
		         THEN 'Y'
		         ELSE 'N' END AS textYn
		         ,CASE WHEN EXISTS (SELECT 1 FROM  GOD_GOD_EVL_ATCH_FILE WHERE GG.GOD_NO = GOD_NO AND GG.GOD_EVL_TURN = GOD_EVL_TURN)
		         THEN 'Y'
		         ELSE 'N' END AS photoYn
				 <choose>
				    <when test='mallId != null and (mallId.equalsIgnoreCase("MBM") or mallId.equalsIgnoreCase("SAM"))'>
				        , FN_SEO_URL(#{mallId, jdbcType=VARCHAR}, #{lang,jdbcType=VARCHAR}, OG.GOD_NO) AS GOD_URL
				    </when>
				    <otherwise>
						,'/goods/'|| (SELECT CD_NM FROM MV_SYS_CD WHERE UPPER_CD = 'RECOMEND_SEX' AND CD= G.RECOMEND_SEX_CD  AND LANG_CD = 'KOR') || '/'
						          || (SELECT SB.BRND_PRDLST_NM
						         	 	FROM SYS_BRND_PRDLST SB WHERE SB.BRND_ID = G.BRND_ID AND SB.PRDLST_CD  = G.PRDLST_CD)|| '/'|| G.ERP_GOD_NO AS GOD_URL
				    </otherwise>
				</choose>
                  , O.MBR_NO
            FROM ORD O
				INNER JOIN ORD_GOD OG ON O.ORD_NO = OG.ORD_NO
				LEFT OUTER JOIN GOD_IMG IMG ON OG.GOD_NO = IMG.GOD_NO
					AND IMG.IMG_TP_CD ='THNAIL'
				INNER JOIN GOD_GOD_EVL GG ON GG.MBR_NO = O.MBR_NO
					AND O.ORD_NO = GG.ORD_NO
					AND GG.GOD_NO = OG.GOD_NO
					AND GG.ORD_GOD_TURN = OG.ORD_GOD_TURN
				INNER JOIN SYS_BRND BRND ON BRND.BRND_ID = OG.BRND_ID
				LEFT OUTER JOIN SYS_BRND_LANG SBL ON BRND.BRND_ID =  SBL.BRND_ID
					AND SBL.LANG_CD = #{lang,jdbcType=VARCHAR}
				LEFT OUTER JOIN(
					SELECT C.ORD_NO
						, CWG.ITM_NO
						, OCGC.ORD_GOD_TURN
						, SUM(NVL(CWG.CLM_QTY,0) - NVL(CWG.CLM_WTHDRAW_QTY,0)) AS clm_qty
						FROM CLM C
						JOIN CLM_WRHS_GOD CWG ON C.ORD_NO = CWG.ORD_NO AND C.CLM_NO = CWG.CLM_NO
						JOIN ORD_CLM_GOD_CNNC OCGC ON CWG.CLM_NO = OCGC.CLM_NO
							AND CWG.CLM_WRHS_GOD_TURN = OCGC.CLM_WRHS_GOD_TURN
							AND CWG.ORD_NO = OCGC.ORD_NO
							AND OCGC.GOD_CNNC_TP_CD = 'WRHS_GOD_CNNC'
						WHERE C.CLM_STAT_CD != 'WTHDRAW'
						GROUP BY CWG.ITM_NO , OCGC.ORD_GOD_TURN , C.ORD_NO
					)C ON OG.ITM_NO = C.ITM_NO  AND  OG.ORD_GOD_TURN = C.ORD_GOD_TURN AND OG.ORD_NO = C.ORD_NO
                INNER JOIN GOD G ON OG.GOD_NO = G.GOD_NO AND G.GOD_TP_CD != 'GFCT'
             WHERE O.MBR_NO = #{mbr.mbrNo,jdbcType=VARCHAR}
             AND O.MALL_ID IN ( SELECT CNTC_MALL_ID FROM SYS_MALL_CNTC WHERE MALL_ID = #{mallId, jdbcType=VARCHAR} )
	         AND
	         (
	             OG.CSTMR_PCH_DCSN_DT IS NULL OR
	             OG.CSTMR_PCH_DCSN_DT > SYSDATE - 90
	         )
	         AND GG.NTCE_YN != 'N'
             <if test="dateStart != null ">
             	AND GG.GOD_EVL_WRITNG_DT BETWEEN TO_DATE(#{dateStart , jdbcType=VARCHAR}||' 00:00:00','YYYY-MM-DD HH24:MI:SS') AND TO_DATE(#{dateEnd}||' 23:59:59','YYYY-MM-DD HH24:MI:SS')
             </if>
             <if test="dateStart == null ">
                AND GG.GOD_EVL_WRITNG_DT BETWEEN ADD_MONTHS(SYSDATE,-3) AND SYSDATE
             </if>
             ORDER BY GG.GOD_EVL_WRITNG_DT DESC
             <include refid="com.plgrim.ncp.base.endPage"/>
             ) GGE
             LEFT OUTER JOIN GOD_GOD_EVL_ATCH_FILE FI ON FI.GOD_NO = GGE.GOD_NO AND FI.GOD_EVL_TURN = GGE.GOD_EVL_TURN ORDER BY GGE.GOD_EVL_WRITNG_DT DESC
    </select>
    <select id = "selectMyGoodsReviewListCount" parameterType ="com.plgrim.ncp.biz.member.data.MemberOrdGodFoDTO" resultType="Long" >
		SELECT  /* [biz.mbr.mypage.selectMyGoodsReviewListCount][상품평 작성 리스트][muba]*/
			COUNT(*)
		FROM ORD O
			INNER JOIN ORD_GOD OG ON O.ORD_NO = OG.ORD_NO AND O.MBR_NO = #{mbr.mbrNo,jdbcType=VARCHAR}
			INNER JOIN GOD_GOD_EVL GG ON GG.MBR_NO = O.MBR_NO
				AND O.ORD_NO = GG.ORD_NO
				AND GG.GOD_NO = OG.GOD_NO
				AND GG.ORD_GOD_TURN = OG.ORD_GOD_TURN
		WHERE O.MBR_NO = #{mbr.mbrNo,jdbcType=VARCHAR}
		AND O.MALL_ID IN ( SELECT CNTC_MALL_ID FROM SYS_MALL_CNTC WHERE MALL_ID = #{mallId, jdbcType=VARCHAR} )
        AND
        (
	        OG.CSTMR_PCH_DCSN_DT IS NULL OR
	        OG.CSTMR_PCH_DCSN_DT > SYSDATE - 90
        )
        AND GG.NTCE_YN != 'N'
		<if test="dateStart != null ">
			AND GG.GOD_EVL_WRITNG_DT BETWEEN TO_DATE(#{dateStart , jdbcType=VARCHAR}||' 00:00:00','YYYY-MM-DD HH24:MI:SS') AND TO_DATE(#{dateEnd}||' 23:59:59','YYYY-MM-DD HH24:MI:SS')
		</if>
		<if test="dateStart == null ">
			AND GG.GOD_EVL_WRITNG_DT BETWEEN ADD_MONTHS(SYSDATE,-3) AND SYSDATE
		</if>
    </select>

    <select id = "selectMyGoodsNoReviewList" parameterType ="com.plgrim.ncp.biz.member.data.MemberOrdGodFoDTO" resultMap="reviewMap">
        <include refid="com.plgrim.ncp.base.beginPage"/>
		SELECT * /* [biz.mbr.mypage.selectMyGoodsNoReviewList][상품평 작성 하지 않은 리스트][muba]*/
		FROM
			(
			SELECT
				 OG.GOD_NM
				,OG.ORD_NO
				,OG.MOBILE_GOD_NM
				,OG.ITM_NM
				,OG.ITM_NO
				,OG.COLOR_NM
				,OG.COLOR_CD
				,OG.BRND_ID
				,OG.BRND_GRP_ID
				,OG.GOD_NO
				,OG.ORD_QTY
				,OG.ORD_GOD_TURN
				,O.ORD_DT
				,NVL(OG.ORD_QTY,0)-NVL(C.CLM_QTY,0) AS realOrdQty
				,OCGC.PCKAGE_GOD_TP_CD AS pckageGodTpCd
				,CASE
					WHEN LDDG.DLV_STAT_CD IS NULL
					THEN
					(
					SELECT MAX (DLV_STAT_CD)
						FROM LGS_DLIVY_DRCT_GOD
						WHERE PCKAGE_GOD_TURN = OG.ORD_GOD_TURN
						AND ORD_NO = O.ORD_NO
					)
					ELSE LDDG.DLV_STAT_CD
					END AS dlvStatCd
				,IMG.IMG_URL AS LST_IMG_URL
				,G.DSP_YN
				,LDDG.DLIVY_DRCT_TP_CD
		        ,G.RECOMEND_SEX_CD
        		,OG.CSTMR_PCH_DCSN_YN
		        ,CASE WHEN (SELECT COUNT(1) FROM GOD_GOD_EVL GE
		            WHERE ORD_NO = OG.ORD_NO
		            AND ORD_GOD_TURN = OG.ORD_GOD_TURN
		            AND MBR_NO = O.MBR_NO
		            AND GE.NTCE_YN != 'N'
		            AND NOT EXISTS (SELECT 1 FROM  GOD_GOD_EVL_ATCH_FILE WHERE GE.GOD_NO = GOD_NO AND GE.GOD_EVL_TURN = GOD_EVL_TURN)

		         ) > 0 THEN 'Y'
		         ELSE 'N' END AS textYn
		         ,CASE WHEN (SELECT COUNT(1) FROM GOD_GOD_EVL GE
		            WHERE ORD_NO = OG.ORD_NO
		            AND ORD_GOD_TURN = OG.ORD_GOD_TURN
		            AND MBR_NO = O.MBR_NO
		            AND GE.NTCE_YN != 'N'
		            AND EXISTS (SELECT 1 FROM  GOD_GOD_EVL_ATCH_FILE WHERE GE.GOD_NO = GOD_NO AND GE.GOD_EVL_TURN = GOD_EVL_TURN)

		         ) > 0 THEN 'Y'
		         ELSE 'N' END AS photoYn
				<choose>
				    <when test='mallId != null and (mallId.equalsIgnoreCase("MBM") or mallId.equalsIgnoreCase("SAM"))'>
				        , FN_SEO_URL(#{mallId, jdbcType=VARCHAR}, #{lang,jdbcType=VARCHAR}, OG.GOD_NO) AS GOD_URL
				    </when>
				    <otherwise>
						,'/goods/'|| (SELECT CD_NM FROM MV_SYS_CD WHERE UPPER_CD = 'RECOMEND_SEX' AND CD= G.RECOMEND_SEX_CD  AND LANG_CD = 'KOR') || '/'
						          || (SELECT SB.BRND_PRDLST_NM
						         	 	FROM SYS_BRND_PRDLST SB WHERE SB.BRND_ID = G.BRND_ID AND SB.PRDLST_CD  = G.PRDLST_CD)|| '/'|| G.ERP_GOD_NO AS GOD_URL
				    </otherwise>
				</choose>
			FROM ORD O 
				INNER JOIN ORD_GOD OG ON O.ORD_NO = OG.ORD_NO AND O.MBR_NO = #{mbr.mbrNo,jdbcType=VARCHAR} AND OG.GOD_TP_CD != 'PCHS_GFT' AND OG.GOD_TP_CD != 'CNVRS_GFT'
				LEFT OUTER JOIN GOD_IMG IMG
				ON OG.GOD_NO = IMG.GOD_NO
					AND IMG.IMG_TP_CD ='THNAIL'
				LEFT OUTER JOIN ORD_CPST_GOD_CNNC OCGC ON OG.ORD_NO = OCGC.ORD_NO AND OG.ORD_GOD_TURN = OCGC.ORD_CPST_GOD_TURN
				INNER JOIN GOD G ON OG.GOD_NO = G.GOD_NO AND G.GOD_TP_CD != 'GFCT'
				LEFT OUTER JOIN(
					SELECT
					  C.ORD_NO
					, CWG.ITM_NO
					, OCGC.ORD_GOD_TURN
					, SUM(NVL(CWG.CLM_QTY,0) - NVL(CWG.CLM_WTHDRAW_QTY,0)) AS CLM_QTY
					FROM CLM C
					JOIN CLM_WRHS_GOD CWG ON C.ORD_NO = CWG.ORD_NO AND C.CLM_NO = CWG.CLM_NO
					JOIN ORD_CLM_GOD_CNNC OCGC ON CWG.CLM_NO = OCGC.CLM_NO
						AND CWG.CLM_WRHS_GOD_TURN = OCGC.CLM_WRHS_GOD_TURN
						AND CWG.ORD_NO = OCGC.ORD_NO
						AND OCGC.GOD_CNNC_TP_CD = 'WRHS_GOD_CNNC'
					WHERE C.CLM_STAT_CD != 'WTHDRAW'
					GROUP BY CWG.ITM_NO , OCGC.ORD_GOD_TURN , C.ORD_NO
				)C ON OG.ITM_NO = C.ITM_NO  AND  OG.ORD_GOD_TURN = C.ORD_GOD_TURN AND OG.ORD_NO = C.ORD_NO
				LEFT OUTER JOIN LGS_DLIVY_DRCT_GOD LDDG
				ON OG.ORD_NO = LDDG.ORD_NO
				AND OG.ORD_GOD_TURN = LDDG.ORD_GOD_TURN
				AND OG.DLV_PCUPSP_TURN = LDDG.DLV_PCUPSP_TURN
				INNER JOIN SYS_BRND BRND ON BRND.BRND_ID = OG.BRND_ID
			WHERE  O.MBR_NO = #{mbr.mbrNo,jdbcType=VARCHAR}
				   AND O.MALL_ID IN ( SELECT CNTC_MALL_ID FROM SYS_MALL_CNTC WHERE MALL_ID = #{mallId, jdbcType=VARCHAR} )
		           AND
		           	(
		                OG.CSTMR_PCH_DCSN_DT IS NULL OR
		                OG.CSTMR_PCH_DCSN_DT > SYSDATE - 90
		           	)
		           <if test="mallId neq 'MBM' and mallId neq 'SAM'">
				   AND NOT EXISTS
					(
						SELECT 1
						FROM GOD_GOD_EVL GG
						WHERE GG.MBR_NO = O.MBR_NO AND O.ORD_NO = GG.ORD_NO AND GG.ORD_GOD_TURN = OG.ORD_GOD_TURN AND NTCE_YN = 'N'
					)
					</if>
					AND NOT EXISTS
						(
						SELECT 1
						FROM (
							SELECT C.ORD_NO
								, CWG.ITM_NO
								, OCGC.ORD_GOD_TURN
								, SUM(NVL(CWG.CLM_QTY,0)) AS CLM_QTY
							FROM CLM C
							   JOIN CLM_WRHS_GOD CWG ON C.ORD_NO = CWG.ORD_NO AND C.CLM_NO = CWG.CLM_NO
							   JOIN ORD_CLM_GOD_CNNC OCGC ON CWG.CLM_NO = OCGC.CLM_NO
									AND CWG.CLM_WRHS_GOD_TURN = OCGC.CLM_WRHS_GOD_TURN
									AND CWG.ORD_NO = OCGC.ORD_NO
									AND OCGC.GOD_CNNC_TP_CD = 'WRHS_GOD_CNNC'
							WHERE 1 = 1 AND CWG.CLM_WTHDRAW_SECT_CD != 'ALL_WTHDRAW'
							GROUP BY CWG.ITM_NO , OCGC.ORD_GOD_TURN , C.ORD_NO
						  ) C WHERE OG.ITM_NO = C.ITM_NO  AND  OG.ORD_GOD_TURN = C.ORD_GOD_TURN AND OG.ORD_NO = C.ORD_NO AND OG.ORD_QTY = C.CLM_QTY
						)
				  ORDER BY O.ORD_DT DESC
			) A
		WHERE (A.pckageGodTpCd IS NULL OR (A.pckageGodTpCd = 'ADIT_CPST_GOD' AND A.DSP_YN='Y')) AND A.dlvStatCd = 'DLV_COMPT' AND (textYn = 'N' OR photoYn = 'N')
        <include refid="com.plgrim.ncp.base.endPage"/>
    </select>
    <select id = "selectMyGoodsNoReviewListCount" parameterType ="com.plgrim.ncp.biz.member.data.MemberOrdGodFoDTO" resultType="Long">
		SELECT  /* [biz.mbr.mypage.selectMyGoodsNoReviewListCount][상품평 작성 하지 않은 리스트][muba] */
			COUNT(*)
		FROM (
			SELECT
				 OG.GOD_NM
				,OG.ORD_NO
				,OG.MOBILE_GOD_NM
				,OG.ITM_NM
				,OG.ITM_NO
				,OG.COLOR_NM
				,OG.COLOR_CD
				,OG.BRND_ID
				,OG.BRND_GRP_ID
				,OG.LST_IMG_URL
				,OG.GOD_NO
				,OG.ORD_QTY
				,OG.ORD_GOD_TURN
				,O.ORD_DT
				,NVL(OG.ORD_QTY,0)-NVL(C.CLM_QTY,0) AS realOrdQty
				,OCGC.PCKAGE_GOD_TP_CD AS pckageGodTpCd
				,CASE
					WHEN LDDG.DLV_STAT_CD IS NULL
					THEN
					(
					SELECT MAX(DLV_STAT_CD)
					FROM LGS_DLIVY_DRCT_GOD
					WHERE PCKAGE_GOD_TURN = OG.ORD_GOD_TURN AND ORD_NO = O.ORD_NO
					)
					ELSE LDDG.DLV_STAT_CD
					END AS dlvStatCd
				,G.DSP_YN
				,LDDG.DLIVY_DRCT_TP_CD
		        ,G.RECOMEND_SEX_CD
        		,OG.CSTMR_PCH_DCSN_YN
		        ,CASE WHEN (SELECT COUNT(1) FROM GOD_GOD_EVL GE
		            WHERE ORD_NO = OG.ORD_NO
		            AND ORD_GOD_TURN = OG.ORD_GOD_TURN
		            AND MBR_NO = O.MBR_NO
		            AND GE.NTCE_YN != 'N'
		            AND NOT EXISTS (SELECT 1 FROM  GOD_GOD_EVL_ATCH_FILE WHERE GE.GOD_NO = GOD_NO AND GE.GOD_EVL_TURN = GOD_EVL_TURN)

		         ) > 0 THEN 'Y'
		         ELSE 'N' END AS textYn
		         ,CASE WHEN (SELECT COUNT(1) FROM GOD_GOD_EVL GE
		            WHERE ORD_NO = OG.ORD_NO
		            AND ORD_GOD_TURN = OG.ORD_GOD_TURN
		            AND MBR_NO = O.MBR_NO
		            AND GE.NTCE_YN != 'N'
		            AND EXISTS (SELECT 1 FROM  GOD_GOD_EVL_ATCH_FILE WHERE GE.GOD_NO = GOD_NO AND GE.GOD_EVL_TURN = GOD_EVL_TURN)

		         ) > 0 THEN 'Y'
		         ELSE 'N' END AS photoYn
			FROM ORD O
				INNER JOIN ORD_GOD OG
				ON O.ORD_NO = OG.ORD_NO AND O.MBR_NO = #{mbr.mbrNo,jdbcType=VARCHAR} AND OG.GOD_TP_CD != 'PCHS_GFT' AND OG.GOD_TP_CD != 'CNVRS_GFT'
				LEFT OUTER JOIN ORD_CPST_GOD_CNNC OCGC ON OG.ORD_NO = OCGC.ORD_NO AND OG.ORD_GOD_TURN = OCGC.ORD_CPST_GOD_TURN
				INNER JOIN GOD G ON OG.GOD_NO = G.GOD_NO AND G.GOD_TP_CD != 'GFCT'
				LEFT OUTER JOIN
				(
				SELECT
				  C.ORD_NO
				, CWG.ITM_NO
				, OCGC.ORD_GOD_TURN
				, SUM(NVL(CWG.CLM_QTY,0) - NVL(CWG.CLM_WTHDRAW_QTY,0)) AS CLM_QTY
				FROM CLM C
					JOIN CLM_WRHS_GOD CWG ON C.ORD_NO = CWG.ORD_NO AND C.CLM_NO = CWG.CLM_NO
					JOIN ORD_CLM_GOD_CNNC OCGC ON CWG.CLM_NO = OCGC.CLM_NO
					AND CWG.CLM_WRHS_GOD_TURN = OCGC.CLM_WRHS_GOD_TURN
					AND CWG.ORD_NO = OCGC.ORD_NO
					AND OCGC.GOD_CNNC_TP_CD = 'WRHS_GOD_CNNC'
				WHERE C.CLM_STAT_CD != 'WTHDRAW'
				GROUP BY CWG.ITM_NO, OCGC.ORD_GOD_TURN, C.ORD_NO
				) C ON OG.ITM_NO = C.ITM_NO AND OG.ORD_GOD_TURN = C.ORD_GOD_TURN AND OG.ORD_NO = C.ORD_NO
				LEFT OUTER JOIN LGS_DLIVY_DRCT_GOD LDDG ON OG.ORD_NO = LDDG.ORD_NO AND OG.ORD_GOD_TURN = LDDG.ORD_GOD_TURN AND OG.DLV_PCUPSP_TURN = LDDG.DLV_PCUPSP_TURN
			WHERE
				O.MBR_NO = #{mbr.mbrNo,jdbcType=VARCHAR}
		        AND O.MALL_ID IN ( SELECT CNTC_MALL_ID FROM SYS_MALL_CNTC WHERE MALL_ID = #{mallId, jdbcType=VARCHAR} )
	           	AND
	           	(
	                OG.CSTMR_PCH_DCSN_DT IS NULL OR
	                OG.CSTMR_PCH_DCSN_DT > SYSDATE - 90
	            )
	            <if test="mallId neq 'MBM' and mallId neq 'SAM'">
				AND NOT EXISTS
				(
					SELECT 1
					FROM GOD_GOD_EVL GG
					WHERE GG.MBR_NO = O.MBR_NO AND O.ORD_NO = GG.ORD_NO AND GG.ORD_GOD_TURN = OG.ORD_GOD_TURN AND NTCE_YN ='N'
				)
				</if>
				AND NOT EXISTS
				(
					SELECT 1
					FROM
						(
						SELECT C.ORD_NO, CWG.ITM_NO, OCGC.ORD_GOD_TURN, SUM(NVL(CWG.CLM_QTY,0)) AS CLM_QTY
						FROM CLM C
							JOIN CLM_WRHS_GOD CWG ON C.ORD_NO = CWG.ORD_NO AND C.CLM_NO = CWG.CLM_NO
							JOIN ORD_CLM_GOD_CNNC OCGC ON CWG.CLM_NO = OCGC.CLM_NO
								AND CWG.CLM_WRHS_GOD_TURN = OCGC.CLM_WRHS_GOD_TURN
								AND CWG.ORD_NO = OCGC.ORD_NO
								AND OCGC.GOD_CNNC_TP_CD = 'WRHS_GOD_CNNC'
						WHERE 1 = 1	AND CWG.CLM_WTHDRAW_SECT_CD != 'ALL_WTHDRAW'
						GROUP BY CWG.ITM_NO , OCGC.ORD_GOD_TURN , C.ORD_NO
						) C
					WHERE OG.ITM_NO = C.ITM_NO AND OG.ORD_GOD_TURN = C.ORD_GOD_TURN AND OG.ORD_NO = C.ORD_NO AND OG.ORD_QTY = C.CLM_QTY
				)
		) A
		WHERE (A.pckageGodTpCd IS NULL OR (A.pckageGodTpCd = 'ADIT_CPST_GOD' AND A.DSP_YN='Y')) AND A.dlvStatCd = 'DLV_COMPT' AND (textYn = 'N' OR photoYn = 'N')
    </select>

    <resultMap id="myAlrmResult" type="com.plgrim.ncp.biz.member.result.MypageAlrmFoResult">
        <result property="reWhsgNtcnSn"     column="RE_WHSG_NTCN_SN" />
        <result property="godNo"            column="GOD_NO" />
        <result property="setGodNo"         column="SET_GOD_NO" />
        <result property="godNm"            column="GOD_NM" />
        <result property="mobilAreaNo"      column="MOBIL_AREA_NO" />
        <result property="mobilTlofNo"      column="MOBIL_TLOF_NO" />
        <result property="mobilTlofWthnNo"  column="MOBIL_TLOF_WTHN_NO" />
        <result property="colorNm"          column="COLOR_NM" />
        <result property="brndId"           column="BRND_ID" />
        <result property="brndNm"           column="BRND_NM" />
        <result property="imgUrl"           column="IMG_URL" />
        <result property="itmNm"            column="ITM_NM" />
        <result property="regDt"            column="REG_DT" />
        <result property="godSaleSectCd"    column="GOD_SALE_SECT_CD" />
        <result property="ntcnComptYn"      column="NTCN_COMPT_YN" />
        <result property="clorChipImgUrl" column="CLOR_CHIP_IMG_URL" />
        <result property="stockStatus" column="STOCK_STATUS" />
        <result property="linkGodNo" column="LINK_GOD_NO" />
        <collection property="reord" column="{reWhsgNtcnSn=RE_WHSG_NTCN_SN,lang=lang}" ofType="com.plgrim.ncp.biz.member.result.MypageAlrmFoResult" select="selectMyAlarmsForReord"/>

    </resultMap>
    <resultMap id="myAlrmReordResult" type="com.plgrim.ncp.biz.member.result.MypageAlrmFoResult">
        <result property="stockStatus" column="STOCK_STATUS" />
        <result property="linkGodNo" column="LINK_GOD_NO" />
    </resultMap>
    <select id="selectMyAlarmsForStockList" parameterType="com.plgrim.ncp.biz.member.data.MypageFoDTO" resultMap="myAlrmResult">
        SELECT /* [biz.mbr.mypage.xml][selectMyAlarmsForStockList]MyPage Alarm 목록조회][csh] */
                    al.RE_WHSG_NTCN_SN
                  , al.GOD_NO
                  , al.SET_GOD_NO
                  , al.GOD_NM
                  , al.MOBIL_AREA_NO
                  , al.MOBIL_TLOF_NO
                  , al.MOBIL_TLOF_WTHN_NO
                  , al.COLOR_NM
                  , al.IMG_URL
                  , al.BRND_ID
                  , al.BRND_NM
                  , al.GOD_SALE_SECT_CD
                  , al.NTCN_COMPT_YN
                  , al.ITM_NM
                  , TO_CHAR(al.REG_DT, 'YYYY.MM.DD')    AS regDt
                  , al.CLOR_CHIP_IMG_URL
                  , case when al.god_aprv_sect_cd = 'APRV_COMPT' and al.god_sale_sect_cd in ('SALE_PROGRS','SALE_END') and al.itm_stat_cd = 'SALE_END' then 'SALE_END'
                         when al.god_aprv_sect_cd = 'APRV_COMPT' and al.god_sale_sect_cd = 'SALE_PROGRS' and al.itm_stat_cd = 'SALE_PROGRS' and al.INV_QTY <![CDATA[ >= ]]> 5 then 'STOCK_COMP'
                         else 'STOCK_WAIT'
                    end as STOCK_STATUS
                  , case when al.DSP_YN = 'Y' and al.ITM_STAT_CD in ('SALE_PROGRS','SLDOUT') then nvl(al.SET_GOD_NO,al.GOD_NO)
                         else ''
                    end as LINK_GOD_NO
                  , #{lang,jdbcType=VARCHAR} as lang
              FROM (
              <include refid="com.plgrim.ncp.base.beginPage"/>
                    SELECT lst.*
                    FROM (
                          SELECT   grw.RE_WHSG_NTCN_SN
                                   , grw.GOD_NO
                                   , grw.SET_GOD_NO
                                   , grw.MOBIL_AREA_NO
                                   , grw.MOBIL_TLOF_NO
                                   , grw.MOBIL_TLOF_WTHN_NO
                                   , NVL(gl.god_nm,gd.god_nm) as  god_nm
                                   , gd.COLOR_NM
                                   , gig.IMG_URL
                                   , gd.BRND_ID
                                   , sb.BRND_NM
                                   , gd.GOD_SALE_SECT_CD
                                   , grw.NTCN_COMPT_YN
                                   , grw.REG_DT
                                   , gi.ITM_NM
                                   , gd.CLOR_CHIP_IMG_URL
                                   , gd.DSP_YN
                                   , gd.GOD_APRV_SECT_CD
                                   , gi.ITM_STAT_CD
                                   , nvl(inv.lc2_inv_qty,0) - decode(inv.safe_inv_rt_use_yn,'Y', nvl(ssb.safe_inv_rt,0), nvl(inv.safe_inv_qty,0)) as inv_qty
                              FROM GOD_RE_WHSG_NTCN grw
                              INNER JOIN GOD gd ON grw.GOD_NO = gd.GOD_NO
                              INNER JOIN GOD_ITM gi ON  grw.GOD_NO = gi.GOD_NO AND GRW.ITM_NO = gi.ITM_NO
                              INNER JOIN SYS_BRND SB ON gd.BRND_GRP_ID = SB.BRND_ID
                              INNER JOIN SYS_BRND SB2 ON gd.BRND_ID = SB2.BRND_ID AND SB2.USE_YN ='Y'
                            <if test='lang!= null and lang != "" '>
                              <if test='lang != "KOR"'>
                              /* 브랜드명 다국어 변환 */
                              JOIN SYS_BRND_LANG SBL ON SB.BRND_ID = SBL.BRND_ID AND SBL.LANG_CD = #{lang,jdbcType=VARCHAR}
                              /* 해외판매여부 체크 */
                              JOIN GOD_LANGBY_GOD_NM GLGN ON gd.GOD_NO = GLGN.GOD_NO AND GLGN.OVSEA_DSP_STAT_CD = 'DSP_APRV' AND GLGN.LANG_CD = #{lang,jdbcType=VARCHAR}
                              </if>
                            </if>
                              LEFT OUTER JOIN GOD_IMG gig ON gd.GOD_NO = gig.GOD_NO
                                                          AND gig.IMG_TURN = 0 /* 대표 이미지 */
                                                          AND gig.IMG_TP_CD = 'THNAIL' /* 상품 이미지 */
                                                          AND gig.IMG_SIZE_CD = '164X216' /*가로X세로 */
                                                          AND gig.IMG_APRV_YN = 'Y'
                                                          AND gig.IMG_USE_YN = 'Y'
                              LEFT OUTER JOIN GOD_LANGBY_GOD_NM gl ON gd.GOD_NO = gl.GOD_NO
                                                                   AND gl.LANG_CD = #{lang,jdbcType=VARCHAR}
                              LEFT OUTER JOIN SYS_SHOP_BRND ssb on sb2.erp_brnd_id = ssb.erp_brnd_id and ssb.shop_id = 'X30004'
                              LEFT OUTER JOIN GOD_SHOP_ITM_INV inv on gi.god_no = inv.god_no and inv.shop_id = ssb.shop_id and gi.itm_no = inv.itm_no
                            WHERE grw.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                            <!-- 2017.06 재입고알림개선 : 모두노출시키고 상태값에 적용
                            AND gd.GOD_APRV_SECT_CD = 'APRV_COMPT'
                            AND gd.GOD_SALE_SECT_CD IN ('SLDOUT', 'SALE_PROGRS', 'TMPR_SLDOUT') -->
                            AND grw.REG_DT BETWEEN ADD_MONTHS(SYSDATE,-3) AND SYSDATE
                            AND gd.partmal_sect_cd = 'MCOM'
                          UNION ALL
                          SELECT   grw.RE_WHSG_NTCN_SN
                                   , grw.GOD_NO
                                   , grw.SET_GOD_NO
                                   , grw.MOBIL_AREA_NO
                                   , grw.MOBIL_TLOF_NO
                                   , grw.MOBIL_TLOF_WTHN_NO
                                   , NVL(gl.god_nm,gd.god_nm) as  god_nm
                                   , gd.COLOR_NM
                                   , gig.IMG_URL
                                   , gd.BRND_ID
                                   , sb.BRND_NM
                                   , gd.GOD_SALE_SECT_CD
                                   , grw.NTCN_COMPT_YN
                                   , grw.REG_DT
                                   , gi.ITM_NM
                                   , gd.CLOR_CHIP_IMG_URL
                                   , gd.DSP_YN
                                   , gd.GOD_APRV_SECT_CD
                                   , gi.ITM_STAT_CD
                                   , nvl(gi.TOT_USEFUL_INV_QTY,0) - ( decode(gi.SAFE_INV_USE_YN,'Y', nvl(gi.SAFE_INV_QTY,0), 0) + nvl(gi.SALE_PREARNGE_QTY, 0) ) AS inv_qty
                              FROM GOD_RE_WHSG_NTCN grw
                              INNER JOIN GOD gd ON grw.GOD_NO = gd.GOD_NO
                              INNER JOIN GOD_ITM gi ON  grw.GOD_NO = gi.GOD_NO AND GRW.ITM_NO = gi.ITM_NO
                              INNER JOIN SYS_BRND SB ON gd.BRND_GRP_ID = SB.BRND_ID
                            <if test='lang!= null and lang != "" '>
                              <if test='lang != "KOR"'>
                              /* 브랜드명 다국어 변환 */
                              JOIN SYS_BRND_LANG SBL ON SB.BRND_ID = SBL.BRND_ID AND SBL.LANG_CD = #{lang,jdbcType=VARCHAR}
                              /* 해외판매여부 체크 */
                              JOIN GOD_LANGBY_GOD_NM GLGN ON gd.GOD_NO = GLGN.GOD_NO AND GLGN.OVSEA_DSP_STAT_CD = 'DSP_APRV' AND GLGN.LANG_CD = #{lang,jdbcType=VARCHAR}
                              </if>
                            </if>
                              LEFT OUTER JOIN GOD_IMG gig ON gd.GOD_NO = gig.GOD_NO
                                                          AND gig.IMG_TURN = 0 /* 대표 이미지 */
                                                          AND gig.IMG_TP_CD = 'THNAIL' /* 상품 이미지 */
                                                          AND gig.IMG_SIZE_CD = '164X216' /*가로X세로 */
                                                          AND gig.IMG_APRV_YN = 'Y'
                                                          AND gig.IMG_USE_YN = 'Y'
                              LEFT OUTER JOIN GOD_LANGBY_GOD_NM gl ON gd.GOD_NO = gl.GOD_NO AND gl.LANG_CD = #{lang,jdbcType=VARCHAR}
                            WHERE grw.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                            AND grw.REG_DT BETWEEN ADD_MONTHS(SYSDATE,-3) AND SYSDATE
                            AND gd.partmal_sect_cd <![CDATA[ <> ]]> 'MCOM'
                    ) lst
                    ORDER BY lst.REG_DT DESC
             <include refid="com.plgrim.ncp.base.endPage"/>
                  )al
    </select>

    <select id="countMyAlarmsForStockList" parameterType="com.plgrim.ncp.biz.member.data.MypageFoDTO" resultType="Long">
        SELECT /* [biz.mbr.mypage.xml][countMyAlarmsForStockList]MyPage Alarm 목록조회][csh] */
               COUNT(*)
          FROM (
                    SELECT lst.*
                    FROM (
                          SELECT   grw.RE_WHSG_NTCN_SN
                                   , grw.GOD_NO
                                   , grw.SET_GOD_NO
                                   , grw.MOBIL_AREA_NO
                                   , grw.MOBIL_TLOF_NO
                                   , grw.MOBIL_TLOF_WTHN_NO
                                   , NVL(gl.god_nm,gd.god_nm) as  god_nm
                                   , gd.COLOR_NM
                                   , gig.IMG_URL
                                   , gd.BRND_ID
                                   , sb.BRND_NM
                                   , gd.GOD_SALE_SECT_CD
                                   , grw.NTCN_COMPT_YN
                                   , grw.REG_DT
                                   , gi.ITM_NM
                                   , gd.CLOR_CHIP_IMG_URL
                                   , gd.DSP_YN
                                   , gd.GOD_APRV_SECT_CD
                                   , gi.ITM_STAT_CD
                                   , nvl(inv.lc2_inv_qty,0) - decode(inv.safe_inv_rt_use_yn,'Y', nvl(ssb.safe_inv_rt,0), nvl(inv.safe_inv_qty,0)) as inv_qty
                              FROM GOD_RE_WHSG_NTCN grw
                              INNER JOIN GOD gd ON grw.GOD_NO = gd.GOD_NO
                              INNER JOIN GOD_ITM gi ON  grw.GOD_NO = gi.GOD_NO AND GRW.ITM_NO = gi.ITM_NO
                              INNER JOIN SYS_BRND SB ON gd.BRND_GRP_ID = SB.BRND_ID
                              INNER JOIN SYS_BRND SB2 ON gd.BRND_ID = SB2.BRND_ID AND SB2.USE_YN ='Y'
                            <if test='lang!= null and lang != "" '>
                              <if test='lang != "KOR"'>
                              /* 브랜드명 다국어 변환 */
                              JOIN SYS_BRND_LANG SBL ON SB.BRND_ID = SBL.BRND_ID AND SBL.LANG_CD = #{lang,jdbcType=VARCHAR}
                              /* 해외판매여부 체크 */
                              JOIN GOD_LANGBY_GOD_NM GLGN ON gd.GOD_NO = GLGN.GOD_NO AND GLGN.OVSEA_DSP_STAT_CD = 'DSP_APRV' AND GLGN.LANG_CD = #{lang,jdbcType=VARCHAR}
                              </if>
                            </if>
                              LEFT OUTER JOIN GOD_IMG gig ON gd.GOD_NO = gig.GOD_NO
                                                          AND gig.IMG_TURN = 0 /* 대표 이미지 */
                                                          AND gig.IMG_TP_CD = 'THNAIL' /* 상품 이미지 */
                                                          AND gig.IMG_SIZE_CD = '164X216' /*가로X세로 */
                                                          AND gig.IMG_APRV_YN = 'Y'
                                                          AND gig.IMG_USE_YN = 'Y'
                              LEFT OUTER JOIN GOD_LANGBY_GOD_NM gl ON gd.GOD_NO = gl.GOD_NO
                                                                   AND gl.LANG_CD = #{lang,jdbcType=VARCHAR}
                              LEFT OUTER JOIN SYS_SHOP_BRND ssb on sb2.erp_brnd_id = ssb.erp_brnd_id and ssb.shop_id = 'X30004'
                              LEFT OUTER JOIN GOD_SHOP_ITM_INV inv on gi.god_no = inv.god_no and inv.shop_id = ssb.shop_id and gi.itm_no = inv.itm_no
                            WHERE grw.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                            <!-- 2017.06 재입고알림개선 : 모두노출시키고 상태값에 적용
                            AND gd.GOD_APRV_SECT_CD = 'APRV_COMPT'
                            AND gd.GOD_SALE_SECT_CD IN ('SLDOUT', 'SALE_PROGRS', 'TMPR_SLDOUT') -->
                            AND grw.REG_DT BETWEEN ADD_MONTHS(SYSDATE,-3) AND SYSDATE
                            AND gd.partmal_sect_cd = 'MCOM'
                          UNION ALL
                          SELECT   grw.RE_WHSG_NTCN_SN
                                   , grw.GOD_NO
                                   , grw.SET_GOD_NO
                                   , grw.MOBIL_AREA_NO
                                   , grw.MOBIL_TLOF_NO
                                   , grw.MOBIL_TLOF_WTHN_NO
                                   , NVL(gl.god_nm,gd.god_nm) as  god_nm
                                   , gd.COLOR_NM
                                   , gig.IMG_URL
                                   , gd.BRND_ID
                                   , sb.BRND_NM
                                   , gd.GOD_SALE_SECT_CD
                                   , grw.NTCN_COMPT_YN
                                   , grw.REG_DT
                                   , gi.ITM_NM
                                   , gd.CLOR_CHIP_IMG_URL
                                   , gd.DSP_YN
                                   , gd.GOD_APRV_SECT_CD
                                   , gi.ITM_STAT_CD
                                   , nvl(gi.TOT_USEFUL_INV_QTY,0) - ( decode(gi.SAFE_INV_USE_YN,'Y', nvl(gi.SAFE_INV_QTY,0), 0) + nvl(gi.SALE_PREARNGE_QTY, 0) ) AS inv_qty
                              FROM GOD_RE_WHSG_NTCN grw
                              INNER JOIN GOD gd ON grw.GOD_NO = gd.GOD_NO
                              INNER JOIN GOD_ITM gi ON  grw.GOD_NO = gi.GOD_NO AND GRW.ITM_NO = gi.ITM_NO
                              INNER JOIN SYS_BRND SB ON gd.BRND_GRP_ID = SB.BRND_ID
                            <if test='lang!= null and lang != "" '>
                              <if test='lang != "KOR"'>
                              /* 브랜드명 다국어 변환 */
                              JOIN SYS_BRND_LANG SBL ON SB.BRND_ID = SBL.BRND_ID AND SBL.LANG_CD = #{lang,jdbcType=VARCHAR}
                              /* 해외판매여부 체크 */
                              JOIN GOD_LANGBY_GOD_NM GLGN ON gd.GOD_NO = GLGN.GOD_NO AND GLGN.OVSEA_DSP_STAT_CD = 'DSP_APRV' AND GLGN.LANG_CD = #{lang,jdbcType=VARCHAR}
                              </if>
                            </if>
                              LEFT OUTER JOIN GOD_IMG gig ON gd.GOD_NO = gig.GOD_NO
                                                          AND gig.IMG_TURN = 0 /* 대표 이미지 */
                                                          AND gig.IMG_TP_CD = 'THNAIL' /* 상품 이미지 */
                                                          AND gig.IMG_SIZE_CD = '164X216' /*가로X세로 */
                                                          AND gig.IMG_APRV_YN = 'Y'
                                                          AND gig.IMG_USE_YN = 'Y'
                              LEFT OUTER JOIN GOD_LANGBY_GOD_NM gl ON gd.GOD_NO = gl.GOD_NO AND gl.LANG_CD = #{lang,jdbcType=VARCHAR}
                            WHERE grw.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                            AND grw.REG_DT BETWEEN ADD_MONTHS(SYSDATE,-3) AND SYSDATE
                            AND gd.partmal_sect_cd <![CDATA[ <> ]]> 'MCOM'
                    ) lst
              )al
    </select>

    <select id="selectMyAlarmsForReord" resultMap="myAlrmReordResult">
        SELECT /* [biz.mbr.mypage.xml][selectMyAlarmsForReord][MyPage Alarm 목록조회 - 알림신청건별 리오더상품정보 조회] */
                 case when lst.god_aprv_sect_cd = 'APRV_COMPT' and lst.god_sale_sect_cd in ('SALE_PROGRS','SALE_END') and lst.itm_stat_cd = 'SALE_END' then 'SALE_END'
                      when lst.god_aprv_sect_cd = 'APRV_COMPT' and lst.god_sale_sect_cd = 'SALE_PROGRS' and lst.itm_stat_cd = 'SALE_PROGRS' and lst.INV_QTY <![CDATA[ >= ]]> 5 then 'STOCK_COMP'
                      else 'STOCK_WAIT'
                 end as STOCK_STATUS
                ,case when lst.DSP_YN = 'Y' and lst.ITM_STAT_CD in ('SALE_PROGRS','SLDOUT') then nvl(lst.SET_GOD_NO,lst.GOD_NO)
                      else ''
                 end as LINK_GOD_NO
        FROM (
                SELECT  grw.RE_WHSG_NTCN_SN
                        ,gd.god_no as GOD_NO
                        ,sgd.god_no as SET_GOD_NO
                        ,gd.GOD_SALE_SECT_CD
                        ,gd.DSP_YN
                        ,gd.GOD_APRV_SECT_CD
                        ,ngi.ITM_STAT_CD
                        ,nvl(inv.lc2_inv_qty,0) - decode(inv.safe_inv_rt_use_yn,'Y', nvl(ssb.safe_inv_rt,0), nvl(inv.safe_inv_qty,0)) as inv_qty
                FROM GOD_RE_WHSG_NTCN grw
                JOIN god gd on grw.god_no = gd.reord_bf_god_no
                JOIN god_itm gi on grw.god_no = gi.god_no and grw.itm_no = gi.itm_no
                JOIN god_itm ngi
                    on gd.god_no = ngi.god_no
                    and gi.opt_cd_1 = ngi.opt_cd_1
                    and gi.opt_val_cd_1 = ngi.opt_val_cd_1
                    and nvl(gi.opt_cd_2,'*') = nvl(ngi.opt_cd_2,'*')
                    and nvl(gi.opt_val_cd_2,'*') = nvl(ngi.opt_val_cd_2,'*')
                    and nvl(gi.opt_cd_3,'*') = nvl(ngi.opt_cd_3,'*')
                    and nvl(gi.opt_val_cd_3,'*') = nvl(ngi.opt_val_cd_3,'*')
                JOIN SYS_BRND SB ON gd.BRND_GRP_ID = SB.BRND_ID
                JOIN SYS_BRND SB2 ON gd.BRND_ID = SB2.BRND_ID AND SB2.USE_YN ='Y'
                JOIN SYS_SHOP_BRND ssb on sb2.erp_brnd_id = ssb.erp_brnd_id
                JOIN GOD_SHOP_ITM_INV inv on ngi.god_no = inv.god_no and inv.shop_id = ssb.shop_id and ngi.itm_no = inv.itm_no
                LEFT OUTER JOIN god sgd on grw.set_god_no = sgd.reord_bf_god_no /* 리오더 세트품번 조회 */
                LEFT OUTER JOIN god_cpst_god_cnnc cnnc on sgd.god_no = cnnc.god_no and gd.god_no = cnnc.cpst_god_no
                <if test='lang!= null and lang != "" '>
                  <if test='lang != "KOR"'>
                  /* 브랜드명 다국어 변환 */
                  JOIN SYS_BRND_LANG SBL ON SB.BRND_ID = SBL.BRND_ID AND SBL.LANG_CD = #{lang,jdbcType=VARCHAR}
                  /* 해외판매여부 체크 */
                  JOIN GOD_LANGBY_GOD_NM GLGN ON gd.GOD_NO = GLGN.GOD_NO AND GLGN.OVSEA_DSP_STAT_CD = 'DSP_APRV' AND GLGN.LANG_CD = #{lang,jdbcType=VARCHAR}
                  </if>
                </if>
                WHERE grw.RE_WHSG_NTCN_SN = #{reWhsgNtcnSn, jdbcType=VARCHAR}
                and ssb.shop_id = 'X30004'
                and gd.partmal_sect_cd = 'MCOM'
                and ROWNUM = 1
                UNION ALL
                SELECT  grw.RE_WHSG_NTCN_SN
                        ,gd.god_no as GOD_NO
                        ,sgd.god_no as SET_GOD_NO
                        ,gd.GOD_SALE_SECT_CD
                        ,gd.DSP_YN
                        ,gd.GOD_APRV_SECT_CD
                        ,ngi.ITM_STAT_CD
                        ,nvl(ngi.TOT_USEFUL_INV_QTY,0) - ( decode(ngi.SAFE_INV_USE_YN,'Y', nvl(ngi.SAFE_INV_QTY,0), 0) + nvl(ngi.SALE_PREARNGE_QTY, 0) )  AS inv_qty
                FROM GOD_RE_WHSG_NTCN grw
                JOIN god gd on grw.god_no = gd.reord_bf_god_no
                JOIN god_itm gi on grw.god_no = gi.god_no and grw.itm_no = gi.itm_no
                JOIN god_itm ngi
                    on gd.god_no = ngi.god_no
                    and gi.opt_cd_1 = ngi.opt_cd_1
                    and gi.opt_val_cd_1 = ngi.opt_val_cd_1
                    and nvl(gi.opt_cd_2,'*') = nvl(ngi.opt_cd_2,'*')
                    and nvl(gi.opt_val_cd_2,'*') = nvl(ngi.opt_val_cd_2,'*')
                    and nvl(gi.opt_cd_3,'*') = nvl(ngi.opt_cd_3,'*')
                    and nvl(gi.opt_val_cd_3,'*') = nvl(ngi.opt_val_cd_3,'*')
                JOIN SYS_BRND SB ON gd.BRND_GRP_ID = SB.BRND_ID
                LEFT OUTER JOIN god sgd on grw.set_god_no = sgd.reord_bf_god_no /* 리오더 세트품번 조회 */
                LEFT OUTER JOIN god_cpst_god_cnnc cnnc on sgd.god_no = cnnc.god_no and gd.god_no = cnnc.cpst_god_no
                <if test='lang!= null and lang != "" '>
                  <if test='lang != "KOR"'>
                  /* 브랜드명 다국어 변환 */
                  JOIN SYS_BRND_LANG SBL ON SB.BRND_ID = SBL.BRND_ID AND SBL.LANG_CD = #{lang,jdbcType=VARCHAR}
                  /* 해외판매여부 체크 */
                  JOIN GOD_LANGBY_GOD_NM GLGN ON gd.GOD_NO = GLGN.GOD_NO AND GLGN.OVSEA_DSP_STAT_CD = 'DSP_APRV' AND GLGN.LANG_CD = #{lang,jdbcType=VARCHAR}
                  </if>
                </if>
                WHERE grw.RE_WHSG_NTCN_SN = #{reWhsgNtcnSn, jdbcType=VARCHAR}
                and gd.partmal_sect_cd <![CDATA[ <> ]]> 'MCOM'
                and ROWNUM = 1

        ) lst
    </select>

    <select id = "selectMyGoodsReview" parameterType ="com.plgrim.ncp.biz.member.data.MemberOrdGodFoDTO" resultMap="reviewMap">
	 	SELECT  /* [biz.mbr.mypage.selectMyGoodsReview][상품평 작성 리스트][muba]*/
	 		 O.ORD_DT
			,OG.GOD_NM
			,OG.ORD_NO
			,OG.MOBILE_GOD_NM
			,OG.ITM_NM
			,OG.ITM_NO
			,OG.COLOR_NM
			,OG.COLOR_CD
			,OG.BRND_ID
			,OG.BRND_GRP_ID
			,OG.GOD_NO
			,OG.ORD_QTY
			,OG.ORD_GOD_TURN
			,GG.GOD_EVL_SJ
			,GG.GOD_EVL_CONT
			,GG.PKG_EVL_SCORE
			,GG.QLTY_EVL_SCORE
			,GG.DLV_EVL_SCORE
			,GG.SIZE_EVL_CD
			,GG.COLOR_EVL_CD
			,GG.BST_GOD_EVL_YN
			,GG.NTCE_YN
			,GG.INQIRE_NUM
			,GG.REG_DT
			,GG.GOD_EVL_TURN
			,GG.MALL_ID
			,GG.DVC_CD
			,GG.LANG_CD
			,GG.GOD_EVL_WRITNG_DT
			,FI.ATCH_FILE_TURN
			,FI.ATCH_FILE_URL
			,FI.ATCH_FILE_NM
			,CASE WHEN #{lang,jdbcType=VARCHAR} = 'KOR'
				THEN BRND.BRND_NM
				ELSE SBL.BRND_NM
				END AS brnd_nm
			,NVL(OG.ORD_QTY,0)-NVL(C.CLM_QTY,0) AS realOrdQty
			,OCGC.PCKAGE_GOD_TP_CD AS pckageGodTpCd
			,CASE
				WHEN LDDG.DLV_STAT_CD IS NULL
				THEN
				(
				SELECT MAX (DLV_STAT_CD)
				FROM LGS_DLIVY_DRCT_GOD
				WHERE PCKAGE_GOD_TURN = OG.ORD_GOD_TURN
				AND ORD_NO = O.ORD_NO
				)
				ELSE
				LDDG.DLV_STAT_CD
				END AS dlvStatCd
			,IMG.IMG_URL AS LST_IMG_URL
			,G.RECOMEND_SEX_CD
	        ,CASE WHEN (SELECT COUNT(1) FROM GOD_GOD_EVL GE
	            WHERE ORD_NO = OG.ORD_NO
	            AND ORD_GOD_TURN = OG.ORD_GOD_TURN
	            AND MBR_NO = O.MBR_NO
	            AND GE.NTCE_YN != 'N'
	            AND NOT EXISTS
	            (
	            SELECT 1
	            FROM GOD_GOD_EVL_ATCH_FILE
	            WHERE GE.GOD_NO = GOD_NO AND GE.GOD_EVL_TURN = GOD_EVL_TURN
				<if test="godGodEvl !=null and godGodEvl.godEvlTurn != null and godGodEvl.godEvlTurn != 0 ">
					AND GE.GOD_EVL_TURN = #{godGodEvl.godEvlTurn}
				</if>
	            )

	         ) > 0 THEN 'Y'
	         ELSE 'N' END AS textYn
	         ,CASE WHEN (SELECT COUNT(1) FROM GOD_GOD_EVL GE
	            WHERE ORD_NO = OG.ORD_NO
	            AND ORD_GOD_TURN = OG.ORD_GOD_TURN
	            AND MBR_NO = O.MBR_NO
	            AND GE.NTCE_YN != 'N'
	            AND EXISTS
	            (
	            SELECT 1
	            FROM GOD_GOD_EVL_ATCH_FILE
	            WHERE GE.GOD_NO = GOD_NO AND GE.GOD_EVL_TURN = GOD_EVL_TURN
				<if test="godGodEvl !=null and godGodEvl.godEvlTurn != null and godGodEvl.godEvlTurn != 0 ">
					AND GE.GOD_EVL_TURN = #{godGodEvl.godEvlTurn}
				</if>
	            )
	         ) > 0 THEN 'Y'
	         ELSE 'N' END AS photoYn
		FROM ORD O
			INNER JOIN ORD_GOD OG ON O.ORD_NO = OG.ORD_NO
			LEFT OUTER JOIN ORD_CPST_GOD_CNNC OCGC ON OG.ORD_NO = OCGC.ORD_NO
				AND OG.ORD_GOD_TURN = OCGC.ORD_CPST_GOD_TURN
			LEFT OUTER JOIN GOD_IMG IMG ON OG.GOD_NO = IMG.GOD_NO
				AND IMG.IMG_TP_CD ='THNAIL'
			LEFT OUTER JOIN GOD_GOD_EVL GG ON GG.MBR_NO = O.MBR_NO
				AND O.ORD_NO = GG.ORD_NO
				AND GG.GOD_NO = OG.GOD_NO
				AND GG.ORD_GOD_TURN = OG.ORD_GOD_TURN
			LEFT OUTER JOIN LGS_DLIVY_DRCT_GOD LDDG ON OG.ORD_NO = LDDG.ORD_NO
				AND OG.ORD_GOD_TURN = LDDG.ORD_GOD_TURN
				AND OG.DLV_PCUPSP_TURN = LDDG.DLV_PCUPSP_TURN
			INNER JOIN SYS_BRND BRND ON BRND.BRND_ID = OG.BRND_ID
			LEFT OUTER JOIN SYS_BRND_LANG SBL ON BRND.BRND_ID =  SBL.BRND_ID
				AND SBL.LANG_CD =#{lang,jdbcType=VARCHAR}
			LEFT OUTER JOIN	GOD_GOD_EVL_ATCH_FILE FI ON FI.GOD_NO = OG.GOD_NO
				AND FI.GOD_EVL_TURN = GG.GOD_EVL_TURN
			LEFT OUTER JOIN
				(
				SELECT C.ORD_NO
					, CWG.ITM_NO
					, OCGC.ORD_GOD_TURN
					, SUM(NVL(CWG.CLM_QTY,0) - NVL(CWG.CLM_WTHDRAW_QTY,0)) AS clm_qty
				FROM CLM C
				JOIN CLM_WRHS_GOD CWG ON C.ORD_NO = CWG.ORD_NO AND C.CLM_NO = CWG.CLM_NO
				JOIN ORD_CLM_GOD_CNNC OCGC ON CWG.CLM_NO = OCGC.CLM_NO
				AND CWG.CLM_WRHS_GOD_TURN = OCGC.CLM_WRHS_GOD_TURN
				AND CWG.ORD_NO = OCGC.ORD_NO
				AND OCGC.GOD_CNNC_TP_CD = 'WRHS_GOD_CNNC'
				WHERE C.CLM_STAT_CD != 'WTHDRAW' AND C.CLM_TP_CD !='REPAIR'
				GROUP BY CWG.ITM_NO , OCGC.ORD_GOD_TURN , C.ORD_NO
				)C ON OG.ITM_NO = C.ITM_NO  AND  OG.ORD_GOD_TURN = C.ORD_GOD_TURN AND OG.ORD_NO = C.ORD_NO
			INNER JOIN GOD G ON OG.GOD_NO = G.GOD_NO AND G.GOD_TP_CD != 'GFCT'
		WHERE O.MBR_NO = #{mbr.mbrNo,jdbcType=VARCHAR}
			AND	OG.GOD_NO = #{ordGod.godNo}
			AND	OG.ORD_NO = #{ordGod.ordNo}
			AND	OG.ORD_GOD_TURN = #{ordGod.ordGodTurn}
			<if test="godGodEvl !=null and godGodEvl.godEvlTurn != null and godGodEvl.godEvlTurn != 0 ">
				AND GG.GOD_EVL_TURN = #{godGodEvl.godEvlTurn}
			</if>
			AND EXISTS
			(
			SELECT 1
			FROM GOD_GOD_EVL GG
			WHERE GG.MBR_NO = O.MBR_NO AND O.ORD_NO = GG.ORD_NO AND GG.ORD_GOD_TURN = OG.ORD_GOD_TURN
			)
    </select>
    <select id = "selectMyGoodsNoReview" parameterType ="com.plgrim.ncp.biz.member.data.MemberOrdGodFoDTO" resultMap="reviewMap">
		SELECT  /* [biz.mbr.mypage.selectMyGoodsNoReview][상품평 작성 리스트][muba]*/
			 O.ORD_DT
			,OG.GOD_NM
			,OG.ORD_NO
			,OG.MOBILE_GOD_NM
			,OG.ITM_NM
			,OG.ITM_NO
			,OG.SKU_NO
			,OG.COLOR_NM
			,OG.COLOR_CD
			,OG.BRND_ID
			,OG.BRND_GRP_ID
			,OG.GOD_NO
			,OG.ORD_QTY
			,OG.ORD_GOD_TURN
			,GG.GOD_EVL_SJ
			,GG.GOD_EVL_CONT
			,GG.PKG_EVL_SCORE
			,GG.QLTY_EVL_SCORE
			,GG.DLV_EVL_SCORE
			,GG.SIZE_EVL_CD
			,GG.COLOR_EVL_CD
			,GG.BST_GOD_EVL_YN
			,GG.NTCE_YN
			,GG.INQIRE_NUM
			,GG.REG_DT
			,GG.GOD_EVL_TURN
			,GG.MALL_ID
			,GG.DVC_CD
			,GG.LANG_CD
			,GG.GOD_EVL_WRITNG_DT
			,FI.ATCH_FILE_TURN
			,FI.ATCH_FILE_URL
			,FI.ATCH_FILE_NM
			,CASE WHEN #{lang,jdbcType=VARCHAR} = 'KOR'
				  THEN BRND.BRND_NM
				  ELSE SBL.BRND_NM
				  END AS brnd_nm
			,NVL(OG.ORD_QTY,0)-NVL(C.CLM_QTY,0) AS realOrdQty
			,IMG.IMG_URL AS LST_IMG_URL
			,G.RECOMEND_SEX_CD
		FROM ORD O
		    INNER JOIN ORD_GOD OG ON O.ORD_NO = OG.ORD_NO
				AND O.MBR_NO = #{mbr.mbrNo,jdbcType=VARCHAR}
			LEFT OUTER JOIN GOD_IMG IMG ON OG.GOD_NO = IMG.GOD_NO
				AND IMG.IMG_TP_CD ='THNAIL'
			LEFT OUTER JOIN GOD_GOD_EVL GG ON GG.MBR_NO = O.MBR_NO
				AND O.ORD_NO = GG.ORD_NO
				AND GG.GOD_NO = OG.GOD_NO
				AND GG.ORD_GOD_TURN = OG.ORD_GOD_TURN
				<if test="mallId eq 'MBM' or mallId eq 'SAM'">
					AND GG.NTCE_YN = 'Y'
				</if>
			LEFT OUTER JOIN LGS_DLIVY_DRCT_GOD LDDG ON OG.ORD_NO = LDDG.ORD_NO
				AND OG.ORD_GOD_TURN = LDDG.ORD_GOD_TURN
				AND OG.DLV_PCUPSP_TURN = LDDG.DLV_PCUPSP_TURN
			INNER JOIN SYS_BRND BRND ON BRND.BRND_ID = OG.BRND_ID
			LEFT OUTER JOIN SYS_BRND_LANG SBL ON BRND.BRND_ID =  SBL.BRND_ID
				AND SBL.LANG_CD =#{lang,jdbcType=VARCHAR}
			LEFT OUTER JOIN GOD_GOD_EVL_ATCH_FILE FI ON FI.GOD_NO = OG.GOD_NO
				AND FI.GOD_EVL_TURN = GG.GOD_EVL_TURN
			LEFT OUTER JOIN(
				SELECT C.ORD_NO
					, CWG.ITM_NO
					, OCGC.ORD_GOD_TURN
					, SUM(NVL(CWG.CLM_QTY,0) - NVL(CWG.CLM_WTHDRAW_QTY,0)) AS clm_qty
				FROM CLM C
				JOIN CLM_WRHS_GOD CWG ON C.ORD_NO = CWG.ORD_NO AND C.CLM_NO = CWG.CLM_NO
				JOIN ORD_CLM_GOD_CNNC OCGC ON CWG.CLM_NO = OCGC.CLM_NO
					AND CWG.CLM_WRHS_GOD_TURN = OCGC.CLM_WRHS_GOD_TURN
					AND CWG.ORD_NO = OCGC.ORD_NO
					AND OCGC.GOD_CNNC_TP_CD = 'WRHS_GOD_CNNC'
				WHERE C.CLM_STAT_CD != 'WTHDRAW'
					GROUP BY CWG.ITM_NO , OCGC.ORD_GOD_TURN , C.ORD_NO
			  ) C ON OG.ITM_NO = C.ITM_NO  AND  OG.ORD_GOD_TURN = C.ORD_GOD_TURN AND OG.ORD_NO = C.ORD_NO
			INNER JOIN GOD G ON OG.GOD_NO = G.GOD_NO AND G.GOD_TP_CD != 'GFCT'
		WHERE O.MBR_NO = #{mbr.mbrNo,jdbcType=VARCHAR}
			AND OG.GOD_NO = #{ordGod.godNo}
			AND OG.ORD_NO = #{ordGod.ordNo}
			AND OG.ORD_GOD_TURN = #{ordGod.ordGodTurn}
			<if test="godGodEvl !=null and godGodEvl.godEvlTurn != null and godGodEvl.godEvlTurn != 0 ">
				AND GG.GOD_EVL_TURN = #{godGodEvl.godEvlTurn}
			</if>
    </select>
	<update id="deleteMyGoodsReviewNtceYn" parameterType="com.plgrim.ncp.biz.member.data.MemberOrdGodFoDTO">
	    UPDATE /* [biz.mbr.mypage.deleteMyGoodsReview][상품평 삭제][muba]*/
	    GOD_GOD_EVL SET
				 NTCE_YN = 'N'
	            ,UDTER_ID = #{mbr.mbrNo,jdbcType=VARCHAR}
	            ,UDT_DT = SYSDATE
	    WHERE   1 = 1
	    AND     ORD_NO = #{ordGod.ordNo,jdbcType=VARCHAR}
	    AND     GOD_NO = #{ordGod.godNo,jdbcType=VARCHAR}
	    AND     GOD_EVL_TURN = #{godGodEvl.godEvlTurn,jdbcType=NUMERIC}
	    AND     MBR_NO = #{mbr.mbrNo,jdbcType=VARCHAR}
	</update>
    <select id = "selectMyGoodsStoreNoReview" parameterType ="com.plgrim.ncp.biz.member.data.MemberOrdGodFoDTO" resultMap="reviewStoreMap">
            SELECT  /* [biz.mbr.mypage.selectMyGoodsStoreReview][상품평 작성 리스트-매장구매내역]*/
            		gd.god_no
            		,gd.god_nm
            		,gd.color_nm
            		,gd.mobile_god_nm
                    ,gg.god_evl_sj
                    ,gg.god_evl_cont
                    ,gg.pkg_evl_score
                    ,gg.qlty_evl_score
                    ,gg.dlv_evl_score
                    ,gg.size_evl_cd
                    ,gg.color_evl_cd
                    ,gg.bst_god_evl_yn
                    ,gg.ntce_yn
                    ,gg.inqire_num
                    ,gg.reg_dt
                    ,gg.god_evl_turn
                    ,gg.mall_id
                    ,gg.dvc_cd
                    ,gg.lang_cd
                    ,gg.god_evl_writng_dt
                    ,fi.atch_file_turn
                    ,fi.atch_file_url
                    ,fi.atch_file_nm
                    ,brnd.brnd_nm
                    ,img.img_url as lst_img_url
              FROM god gd
                   LEFT OUTER JOIN god_god_evl gg
                      ON     gg.mbr_no = #{mbr.mbrNo,jdbcType=VARCHAR}
                         AND gg.rcptfr_no = #{godGodEvl.rcptfrNo,jdbcType=VARCHAR}
                         AND gg.god_no = gd.god_no
                  INNER JOIN sys_brnd brnd
                        ON brnd.brnd_id = gd.brnd_id
                  LEFT OUTER JOIN
                      GOD_GOD_EVL_ATCH_FILE fi
                        ON fi.god_no = gd.god_no
                        AND fi.god_evl_turn = gg.god_evl_turn
                  LEFT OUTER JOIN
                  	  GOD_IMG img
		                ON gd.god_no = img.god_no
		                AND img.img_tp_cd ='THNAIL'
                  INNER JOIN god_itm gt
                  		ON gd.god_no = gt.god_no
                  		AND gt.sku_no = #{godGodEvl.skuNo,jdbcType=VARCHAR}
                  		AND ROWNUM = 1
             WHERE NOT EXISTS
                    (SELECT 1
                       FROM god_god_evl gg
                      WHERE     gg.mbr_no = #{mbr.mbrNo,jdbcType=VARCHAR}
                            AND gg.rcptfr_no = #{godGodEvl.rcptfrNo,jdbcType=VARCHAR}
                            AND gg.sku_no = #{godGodEvl.skuNo,jdbcType=VARCHAR})
             <if test="godGodEvl !=null and godGodEvl.godEvlTurn != null and godGodEvl.godEvlTurn != 0 ">
             AND    gg.god_evl_turn = #{godGodEvl.godEvlTurn}
             </if>
    </select>
    <select id = "selectMyGoodsStoreReview" parameterType ="godGodEvl" resultType="com.plgrim.ncp.base.entities.datasource1.god.GodGodEvl">
            SELECT  /* [biz.mbr.mypage.selectMyGoodsStoreReview][상품평 작성 리스트-매장구매내역]*/
            		gg.god_no
                    ,gg.god_evl_sj
                    ,gg.god_evl_cont
                    ,gg.pkg_evl_score
                    ,gg.qlty_evl_score
                    ,gg.dlv_evl_score
                    ,gg.size_evl_cd
                    ,gg.color_evl_cd
                    ,gg.bst_god_evl_yn
                    ,gg.ntce_yn
                    ,gg.inqire_num
                    ,gg.reg_dt
                    ,gg.god_evl_turn
                    ,gg.mall_id
                    ,gg.dvc_cd
                    ,gg.lang_cd
                    ,gg.god_evl_writng_dt
                    ,gg.rcptfr_no
              FROM god_god_evl gg
			WHERE gg.rcptfr_no = #{rcptfrNo,jdbcType=VARCHAR}
			AND gg.sku_no = #{skuNo,jdbcType=VARCHAR}
			AND rownum = 1
    </select>

    <delete id="deleteGodGodEvlAtchFile" parameterType="com.plgrim.ncp.biz.member.data.MemberOrdGodFoDTO">
        DELETE /* [biz.mbr.mypage][deleteGodGodEvlAtchFile]*/
        FROM GOD_GOD_EVL_ATCH_FILE
        WHERE   1 = 1
        AND     god_no = #{godGodEvlAtchFile.godNo,jdbcType=VARCHAR}
        AND     god_evl_turn = #{godGodEvlAtchFile.godEvlTurn,jdbcType=NUMERIC}
        <if test="deleteFileNm != null">
        AND     atch_file_nm IN
            <foreach collection="deleteFileNm" item="fileNm" index="index" separator="," open=" (" close=")">
                #{fileNm}
            </foreach>
        </if>
        <if test="atchFileTurn != null">
        AND     atch_file_turn  IN
            <foreach collection="atchFileTurn" item="fileTurn" index="index" separator="," open=" (" close=")">
                #{fileTurn}
            </foreach>
        </if>
        <if test="godGodEvlAtchFile.atchFileTurn != null">
        AND     atch_file_turn = #{godGodEvlAtchFile.atchFileTurn,jdbcType=NUMERIC}
        </if>
    </delete>

     <update id="updateGodGodEvl" parameterType="godGodEvl">
		UPDATE /*  [biz.mbr.mypage][updateGodGodEvl][muba]*/
		GOD_GOD_EVL SET
				 MBR_NO = #{mbrNo,jdbcType=VARCHAR}
				,CSTMR_NM = #{cstmrNm,jdbcType=VARCHAR}
				,ORD_NO = #{ordNo,jdbcType=VARCHAR}
				,ORD_GOD_TURN = #{ordGodTurn,jdbcType=NUMERIC}
				,GOD_EVL_SJ = #{godEvlSj,jdbcType=VARCHAR}
				,GOD_EVL_CONT = #{godEvlCont,jdbcType=VARCHAR}
				,QLTY_EVL_SCORE = #{qltyEvlScore,jdbcType=VARCHAR}
				,SIZE_EVL_CD = #{sizeEvlCd,jdbcType=VARCHAR}
				,COLOR_EVL_CD = #{colorEvlCd,jdbcType=VARCHAR}
				,UDTER_ID = #{mbrNo,jdbcType=VARCHAR}
				,UDT_DT = SYSDATE
		WHERE   1 = 1
			AND GOD_NO = #{godNo,jdbcType=VARCHAR}
			AND GOD_EVL_TURN = #{godEvlTurn,jdbcType=NUMERIC}
			AND MBR_NO = #{mbrNo,jdbcType=VARCHAR}
    </update>




    <resultMap id="myPageMainResult" type="com.plgrim.ncp.biz.member.result.MypageMainFoResult">
        <result property="alrmTitle" column="ALRM_TITLE" />
        <result property="alrmType" column="ALRM_TYPE" />
        <result property="alrmCnt" column="ALRM_CNT" />
        <result property="dateStart" column="DATE_START" />
        <result property="dateEnd" column="DATE_END" />
        <result property="pcUrl" column="PC_URL" />
        <result property="mobileUrl" column="MOBILE_URL" />
    </resultMap>
    <select id="selectMyPageAlramList" parameterType="com.plgrim.ncp.biz.member.data.MypageFoDTO" resultMap="myPageMainResult">
        SELECT /* [biz.mbr.mypage.xml][selectMyPageAlramList][MyPage Main Alarm 목록조회][csh] */
               al.ALRM_TITLE
              ,al.ALRM_TYPE
              ,al.ALRM_CNT
              ,al.DATE_START
              ,al.DATE_END
              ,al.ALRM_NO
              ,al.REG_DT
              ,al.PC_URL
              ,al.MOBILE_URL
          FROM
               (
                SELECT
                	<choose>
                	<when test="lang != null and lang != '' and lang != 'KOR'">
                	    (SELECT PL.PRM_NM
                	     FROM PRM_LANG PL
                	     WHERE PL.PRM_NO = PR.PRM_NO
                	     AND LANG_CD = #{lang, jdbcType=VARCHAR}
                	    )                                                                 AS ALRM_TITLE
                	</when>
                	<otherwise>
                        pr.PRM_NM                                                         AS ALRM_TITLE
                	</otherwise>
                	</choose>
                     ,  'CPN_ISSU'                                                        AS ALRM_TYPE
                     ,  ''                                                                AS ALRM_CNT
                     ,  TO_CHAR(TO_DATE(mic.VALID_BEG_DATE , 'YYYY.MM.DD'), 'YYYY.MM.DD') AS DATE_START
                     ,  TO_CHAR(TO_DATE(mic.VALID_END_DATE , 'YYYY.MM.DD'), 'YYYY.MM.DD') AS DATE_END
                     ,  mic.MBR_CPN_NO                                                    AS ALRM_NO
                     ,  mic.REG_DT                                                        AS REG_DT
                     ,  ''                                                                AS PC_URL
                     ,  ''                                                                AS MOBILE_URL
                  FROM MBR_ISSU_CPN mic INNER JOIN PRM pr ON mic.PRM_NO = pr.PRM_NO
                 WHERE mic.REG_DT BETWEEN SYSDATE-1 AND SYSDATE
                   AND mic.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                   AND pr.PRM_STAT_CD = 'APRV'
                   AND EXISTS (
                   	SELECT 1 FROM PRM_APL_TGT
                   		WHERE prm_no = mic.prm_no
                   			AND prm_tgt_tp_cd = 'MALL_ID'
                   			AND mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
				   )
                 UNION
                 SELECT
                    <choose>
                	<when test="lang != null and lang != '' and lang != 'KOR'">
                	    (SELECT PL.PRM_NM
                	     FROM PRM_LANG PL
                	     WHERE PL.PRM_NO = PR.PRM_NO
                	     AND LANG_CD = #{lang, jdbcType=VARCHAR}
                	    )                                                                 AS ALRM_TITLE
                	</when>
                	<otherwise>
                        pr.PRM_NM                                                         AS ALRM_TITLE
                	</otherwise>
                	</choose>
                     ,  'CPN_CLSE'                                                        AS ALRM_TYPE
                     ,  ''                                                                AS ALRM_CNT
                     ,  TO_CHAR(TO_DATE(mic.VALID_BEG_DATE , 'YYYY.MM.DD'), 'YYYY.MM.DD') AS DATE_START
                     ,  TO_CHAR(TO_DATE(mic.VALID_END_DATE , 'YYYY.MM.DD'), 'YYYY.MM.DD') AS DATE_END
                     ,  mic.MBR_CPN_NO                                                    AS ALRM_NO
                     ,  mic.REG_DT                                                        AS REG_DT
                     ,  ''                                                                AS PC_URL
                     ,  ''                                                                AS MOBILE_URL
                  FROM MBR_ISSU_CPN mic INNER JOIN PRM pr ON mic.PRM_NO = pr.PRM_NO
                  WHERE SYSDATE BETWEEN TO_DATE(mic.VALID_END_DATE||'23:59:59', 'YYYY-MM-DD HH24:MI:SS')-3 AND TO_DATE(mic.VALID_END_DATE||'23:59:59', 'YYYY-MM-DD HH24:MI:SS')
                   AND mic.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                   AND pr.PRM_STAT_CD = 'APRV'
                   AND EXISTS (
                   	SELECT 1 FROM PRM_APL_TGT
                   		WHERE prm_no = mic.prm_no
                   			AND prm_tgt_tp_cd = 'MALL_ID'
                   			AND mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
				   )
                 UNION
                 SELECT  gd.GOD_NM                                                        AS ALRM_TITLE
                     ,  'GOD_BEST'                                                        AS ALRM_TYPE
                     ,  ''                                                                AS ALRM_CNT
                     ,  ''                                                                AS DATE_START
                     ,  ''                                                                AS DATE_END
                     , gd.GOD_NO                                                          AS ALRM_NO
                     , gge.UDT_DT                                                         AS REG_DT
                     ,  ''                                                                AS PC_URL
                     ,  ''                                                                AS MOBILE_URL
                  FROM GOD_GOD_EVL gge INNER JOIN god gd ON gge.GOD_NO = gd.GOD_NO AND gge.BST_GOD_EVL_YN = 'Y'
                 WHERE gge.UDT_DT BETWEEN SYSDATE-7 AND SYSDATE
                   AND gge.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                   AND gge.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
                 UNION
                SELECT ''                                                                AS ALRM_TITLE
                     ,  'GOD_POINT'                                                      AS ALRM_TYPE
                     ,  TO_CHAR(odp.CNT)                                                 AS ALRM_CNT
                     ,  ''                                                               AS DATE_START
                     ,  ''                                                               AS DATE_END
                     ,  ''                                                               AS ALRM_NO
                     , odp.UDT_DT                                                        AS REG_DT
                     ,  ''                                                                AS PC_URL
                     ,  ''                                                                AS MOBILE_URL
                 FROM(
                         SELECT COUNT(DISTINCT od.ORD_NO)  AS CNT , od.UDT_DT
                           FROM ORD od INNER JOIN ORD_GOD og ON od.ORD_NO = og.ORD_NO
                                                            AND od.UDT_DT BETWEEN ADD_MONTHS(SYSDATE , -1) AND SYSDATE
                                                            AND od.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                                       INNER JOIN LGS_DLIVY_DRCT_GOD ld ON ld.ORD_NO =og.ORD_NO
                                                                       AND ld.ORD_GOD_TURN = og.ORD_GOD_TURN
                                                                       AND ld.DLV_PCUPSP_TURN = og.DLV_PCUPSP_TURN
                                                                       AND ld.DLV_STAT_CD = 'DLV_COMPT'
                            WHERE 1=1
                             AND NOT EXISTS ( SELECT 1 FROM GOD_GOD_EVL ggl WHERE ggl.ORD_NO = og.ORD_NO AND ggl.ORD_GOD_TURN= og.ORD_GOD_TURN)
                             AND od.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
                          GROUP BY  od.UDT_DT
                     )odp
                WHERE odp.CNT <![CDATA[  > ]]>   0
                UNION
                SELECT  ''                                                              AS ALRM_TITLE
                     ,  'MTM_INQ'                                                       AS ALRM_TYPE
                     ,  ''                                                              AS ALRM_CNT
                     ,  ''                                                              AS DATE_START
                     ,  ''                                                              AS DATE_END
                     ,  ''                                                              AS ALRM_NO
                     , cmi.UDT_DT                                                       AS REG_DT
                     ,  ''                                                                AS PC_URL
                     ,  ''                                                                AS MOBILE_URL
                 FROM CSO_MTM_INQ cmi
                WHERE cmi.ANS_STAT_CD = 'ANS_COMPT'
                  AND cmi.INQ_MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                  AND cmi.UDT_DT BETWEEN SYSDATE-7 AND SYSDATE
                  AND cmi.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
                UNION
                SELECT  ''                                                              AS ALRM_TITLE
                     ,  'GOD_INQ'                                                       AS ALRM_TYPE
                     ,  ''                                                              AS ALRM_CNT
                     ,  ''                                                              AS DATE_START
                     ,  ''                                                              AS DATE_END
                     ,  ''                                                              AS ALRM_NO
                     , cgi.UDT_DT                                                       AS REG_DT
                     ,  ''                                                                AS PC_URL
                     ,  ''                                                                AS MOBILE_URL
                 FROM CSO_GOD_INQ cgi
                WHERE cgi.ANS_STAT_CD = 'ANS_COMPT'
                  AND cgi.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                  AND cgi.UDT_DT BETWEEN SYSDATE-7 AND SYSDATE
                  AND cgi.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
                UNION
                SELECT  et.EVT_NM                                                       AS ALRM_TITLE
                     ,  (CASE WHEN  et.EVT_END_DT <![CDATA[ < ]]> SYSDATE+3 THEN 'EVT_CLSE' ELSE 'EVT_ISSU' END) AS ALRM_TYPE
                     ,  ''                                                              AS ALRM_CNT
                     ,  TO_CHAR(et.EVT_BEG_DT , 'YYYY.MM.DD')                           AS DATE_START
                     ,  TO_CHAR(et.EVT_END_DT , 'YYYY.MM.DD')                           AS DATE_END
                     ,  et.EVT_NO                                                       AS ALRM_NO
                     ,  et.UDT_DT                                                       AS REG_DT
                     ,  et.PC_URL                                                         AS PC_URL
                     ,  et.MOBILE_URL                                                     AS MOBILE_URL
                 FROM EVT et
                WHERE (SYSDATE BETWEEN et.EVT_BEG_DT AND et.EVT_END_DT OR SYSDATE BETWEEN et.APPLCN_BEG_DT AND et.APPLCN_END_DT )
                  AND et.EVT_STAT_CD = 'APRV'
                  AND et.DSP_YN = 'Y'
                  AND et.UPPER_EVT_NO IS NULL
                  AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = et.evt_no AND evt_dsp_tgt_tp_cd = 'MALL_ID' AND mall_id = #{mallId, jdbcType=VARCHAR})
<!-- 언어별 이벤트를 조회하도록 변경하였으나 정책으로는 언어별 구분없이 공통으로 나오는게 맞다 하여 일단 주석처리 -->
<!-- 		        <if test="lang != null and lang != ''"> -->
<!-- 			      AND EXISTS -->
<!-- 			          (SELECT 1 -->
<!-- 			             FROM EVT_PARTCPTN_TGT A -->
<!-- 			            WHERE A.PARTCPTN_TGT_TP_CD = 'LANG' AND A.EVT_NO = et.EVT_NO AND A.LANG_CD = #{lang, jdbcType=VARCHAR})		    -->
<!-- 				</if> -->
             ) al
           ORDER BY al.REG_DT DESC
   </select>

   <select id="selectMyPageAlramListMb" parameterType="com.plgrim.ncp.biz.member.data.MypageFoDTO" resultMap="myPageMainResult">

        SELECT *
        FROM (
        SELECT /* [biz.mbr.mypage.xml][selectMyPageAlramListMb][MyPage Main Alarm 목록조회][csh] */
               al.ALRM_TITLE
              ,al.ALRM_TYPE
              ,al.ALRM_CNT
              ,al.DATE_START
              ,al.DATE_END
              ,al.ALRM_NO
              ,al.REG_DT
              ,al.PC_URL
              ,al.MOBILE_URL
              ,row_number() over(order by al.REG_DT DESC) rnum
          FROM
               (
                SELECT
                    <choose>
                	<when test="lang != null and lang != '' and lang != 'KOR'">
                	    (SELECT PL.PRM_NM
                	     FROM PRM_LANG PL
                	     WHERE PL.PRM_NO = PR.PRM_NO
                	     AND LANG_CD = #{lang, jdbcType=VARCHAR}
                	    )                                                                 AS ALRM_TITLE
                	</when>
                	<otherwise>
                        pr.PRM_NM                                                         AS ALRM_TITLE
                	</otherwise>
                	</choose>
                     ,  'CPN_ISSU'                                                        AS ALRM_TYPE
                     ,  ''                                                                AS ALRM_CNT
                     ,  TO_CHAR(TO_DATE(mic.VALID_BEG_DATE , 'YYYY.MM.DD'), 'YYYY.MM.DD') AS DATE_START
                     ,  TO_CHAR(TO_DATE(mic.VALID_END_DATE , 'YYYY.MM.DD'), 'YYYY.MM.DD') AS DATE_END
                     ,  mic.MBR_CPN_NO                                                    AS ALRM_NO
                     ,  mic.REG_DT                                                        AS REG_DT
                     ,  ''                                                                AS PC_URL
                     ,  ''                                                                AS MOBILE_URL
                  FROM MBR_ISSU_CPN mic INNER JOIN PRM pr ON mic.PRM_NO = pr.PRM_NO
                 WHERE mic.REG_DT BETWEEN SYSDATE-1 AND SYSDATE
                   AND mic.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                   AND pr.PRM_STAT_CD = 'APRV'
                   AND EXISTS (
                   	SELECT 1 FROM PRM_APL_TGT
                   		WHERE prm_no = mic.prm_no
                   			AND prm_tgt_tp_cd = 'MALL_ID'
                   			AND mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
				   )
                 UNION ALL
                 SELECT
                    <choose>
                	<when test="lang != null and lang != '' and lang != 'KOR'">
                	    (SELECT PL.PRM_NM
                	     FROM PRM_LANG PL
                	     WHERE PL.PRM_NO = PR.PRM_NO
                	     AND LANG_CD = #{lang, jdbcType=VARCHAR}
                	    )                                                                 AS ALRM_TITLE
                	</when>
                	<otherwise>
                        pr.PRM_NM                                                         AS ALRM_TITLE
                	</otherwise>
                	</choose>
                     ,  'CPN_CLSE'                                                        AS ALRM_TYPE
                     ,  ''                                                                AS ALRM_CNT
                     ,  TO_CHAR(TO_DATE(mic.VALID_BEG_DATE , 'YYYY.MM.DD'), 'YYYY.MM.DD') AS DATE_START
                     ,  TO_CHAR(TO_DATE(mic.VALID_END_DATE , 'YYYY.MM.DD'), 'YYYY.MM.DD') AS DATE_END
                     ,  mic.MBR_CPN_NO                                                    AS ALRM_NO
                     ,  mic.REG_DT                                                        AS REG_DT
                     ,  ''                                                                AS PC_URL
                     ,  ''                                                                AS MOBILE_URL
                  FROM MBR_ISSU_CPN mic INNER JOIN PRM pr ON mic.PRM_NO = pr.PRM_NO
                  WHERE SYSDATE BETWEEN TO_DATE(mic.VALID_END_DATE||'23:59:59', 'YYYY-MM-DD HH24:MI:SS')-3 AND TO_DATE(mic.VALID_END_DATE||'23:59:59', 'YYYY-MM-DD HH24:MI:SS')
                   AND mic.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                   AND pr.PRM_STAT_CD = 'APRV'
                   AND EXISTS (
                   	SELECT 1 FROM PRM_APL_TGT
                   		WHERE prm_no = mic.prm_no
                   			AND prm_tgt_tp_cd = 'MALL_ID'
                   			AND mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
				   )
                 UNION ALL
                 SELECT  gd.GOD_NM                                                        AS ALRM_TITLE
                     ,  'GOD_BEST'                                                        AS ALRM_TYPE
                     ,  ''                                                                AS ALRM_CNT
                     ,  ''                                                                AS DATE_START
                     ,  ''                                                                AS DATE_END
                     , gd.GOD_NO                                                          AS ALRM_NO
                     , gge.UDT_DT                                                         AS REG_DT
                     ,  ''                                                                AS PC_URL
                     ,  ''                                                                AS MOBILE_URL
                  FROM GOD_GOD_EVL gge INNER JOIN god gd ON gge.GOD_NO = gd.GOD_NO AND gge.BST_GOD_EVL_YN = 'Y'
                 WHERE gge.UDT_DT BETWEEN SYSDATE-7 AND SYSDATE
                   AND gge.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                   AND gge.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
                 UNION ALL
                SELECT ''                                                                AS ALRM_TITLE
                     ,  'GOD_POINT'                                                      AS ALRM_TYPE
                     ,  TO_CHAR(odp.CNT)                                                 AS ALRM_CNT
                     ,  ''                                                               AS DATE_START
                     ,  ''                                                               AS DATE_END
                     ,  ''                                                               AS ALRM_NO
                     , odp.UDT_DT                                                        AS REG_DT
                     ,  ''                                                                AS PC_URL
                     ,  ''                                                                AS MOBILE_URL
                 FROM(
                         SELECT COUNT(DISTINCT od.ORD_NO)  AS CNT , od.UDT_DT
                           FROM ORD od INNER JOIN ORD_GOD og ON od.ORD_NO = og.ORD_NO
                                                            AND od.UDT_DT BETWEEN ADD_MONTHS(SYSDATE , -1) AND SYSDATE
                                                            AND od.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                                       INNER JOIN LGS_DLIVY_DRCT_GOD ld ON ld.ORD_NO =og.ORD_NO
                                                                       AND ld.ORD_GOD_TURN = og.ORD_GOD_TURN
                                                                       AND ld.DLV_PCUPSP_TURN = og.DLV_PCUPSP_TURN
                                                                       AND ld.DLV_STAT_CD = 'DLV_COMPT'
                            WHERE 1=1
                             AND NOT EXISTS ( SELECT 1 FROM GOD_GOD_EVL ggl WHERE ggl.ORD_NO = og.ORD_NO AND ggl.ORD_GOD_TURN= og.ORD_GOD_TURN)
                             AND od.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
                          GROUP BY  od.UDT_DT
                     )odp
                WHERE odp.CNT <![CDATA[  > ]]>   0
                UNION ALL
                SELECT  ''                                                              AS ALRM_TITLE
                     ,  'MTM_INQ'                                                       AS ALRM_TYPE
                     ,  ''                                                              AS ALRM_CNT
                     ,  ''                                                              AS DATE_START
                     ,  ''                                                              AS DATE_END
                     ,  ''                                                              AS ALRM_NO
                     , cmi.UDT_DT                                                       AS REG_DT
                     ,  ''                                                                AS PC_URL
                     ,  ''                                                                AS MOBILE_URL
                 FROM CSO_MTM_INQ cmi
                WHERE cmi.ANS_STAT_CD = 'ANS_COMPT'
                  AND cmi.INQ_MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                  AND cmi.UDT_DT BETWEEN SYSDATE-7 AND SYSDATE
                  AND cmi.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
                UNION ALL
                SELECT  ''                                                              AS ALRM_TITLE
                     ,  'GOD_INQ'                                                       AS ALRM_TYPE
                     ,  ''                                                              AS ALRM_CNT
                     ,  ''                                                              AS DATE_START
                     ,  ''                                                              AS DATE_END
                     ,  ''                                                              AS ALRM_NO
                     , cgi.UDT_DT                                                       AS REG_DT
                     ,  ''                                                                AS PC_URL
                     ,  ''                                                                AS MOBILE_URL
                 FROM CSO_GOD_INQ cgi
                WHERE cgi.ANS_STAT_CD = 'ANS_COMPT'
                  AND cgi.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                  AND cgi.UDT_DT BETWEEN SYSDATE-7 AND SYSDATE
                  AND cgi.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
                UNION ALL
                SELECT  et.EVT_NM                                                       AS ALRM_TITLE
                     ,  (CASE WHEN  et.EVT_END_DT <![CDATA[ < ]]> SYSDATE+3 THEN 'EVT_CLSE' ELSE 'EVT_ISSU' END) AS ALRM_TYPE
                     ,  ''                                                              AS ALRM_CNT
                     ,  TO_CHAR(et.EVT_BEG_DT , 'YYYY.MM.DD')                           AS DATE_START
                     ,  TO_CHAR(et.EVT_END_DT , 'YYYY.MM.DD')                           AS DATE_END
                     ,  et.EVT_NO                                                       AS ALRM_NO
                     ,  et.UDT_DT                                                       AS REG_DT
                     ,  et.PC_URL                                                         AS PC_URL
                     ,  et.MOBILE_URL                                                     AS MOBILE_URL
                 FROM EVT et
                WHERE (SYSDATE BETWEEN et.EVT_BEG_DT AND et.EVT_END_DT OR SYSDATE BETWEEN et.APPLCN_BEG_DT AND et.APPLCN_END_DT )
                  AND et.EVT_STAT_CD = 'APRV'
                  AND et.DSP_YN = 'Y'
                  AND et.UPPER_EVT_NO IS NULL
                  AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = et.evt_no AND evt_dsp_tgt_tp_cd = 'MALL_ID' AND mall_id = #{mallId, jdbcType=VARCHAR})
<!-- 언어별 이벤트를 조회하도록 변경하였으나 정책으로는 언어별 구분없이 공통으로 나오는게 맞다 하여 일단 주석처리 -->
<!-- 				<if test="lang != null and lang != ''"> -->
<!-- 			      AND EXISTS -->
<!-- 			          (SELECT 1 -->
<!-- 			             FROM EVT_PARTCPTN_TGT A -->
<!-- 			            WHERE A.PARTCPTN_TGT_TP_CD = 'LANG' AND A.EVT_NO = et.EVT_NO AND A.LANG_CD = #{lang, jdbcType=VARCHAR})		    -->
<!-- 				</if> -->
             ) al
          )
     where rnum <![CDATA[<]]> 4
   </select>

   <select id="selectMyPageAlramListCnt" parameterType="com.plgrim.ncp.biz.member.data.MypageFoDTO" resultType="Integer">


        SELECT /* [biz.mbr.mypage.xml][selectMyPageAlramList]MyPage Main Alarm 목록조회][csh] */
              sum(cnt) as cnt
          FROM
               (
                SELECT  count(1) as cnt
                  FROM MBR_ISSU_CPN mic INNER JOIN PRM pr ON mic.PRM_NO = pr.PRM_NO
                 WHERE mic.REG_DT BETWEEN SYSDATE-1 AND SYSDATE
                   AND mic.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                   AND EXISTS (
                   	SELECT 1 FROM PRM_APL_TGT
                   		WHERE prm_no = mic.prm_no
                   			AND prm_tgt_tp_cd = 'MALL_ID'
                   			AND mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
				   )
                 UNION ALL
                 SELECT count(1) as cnt
                  FROM MBR_ISSU_CPN mic INNER JOIN PRM pr ON mic.PRM_NO = pr.PRM_NO
                 WHERE TO_DATE(mic.VALID_END_DATE||'23:59:59', 'YYYY-MM-DD HH24:MI:SS') BETWEEN SYSDATE-3 AND SYSDATE
                   AND mic.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                   AND EXISTS (
                   	SELECT 1 FROM PRM_APL_TGT
                   		WHERE prm_no = mic.prm_no
                   			AND prm_tgt_tp_cd = 'MALL_ID'
                   			AND mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
				   )
                 UNION ALL
                 SELECT  count(1) as cnt
                  FROM GOD_GOD_EVL gge INNER JOIN god gd ON gge.GOD_NO = gd.GOD_NO AND gge.BST_GOD_EVL_YN = 'Y'
                 WHERE gge.UDT_DT BETWEEN SYSDATE-7 AND SYSDATE
                   AND gge.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                   AND gge.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
                 UNION ALL
                SELECT count(1) as cnt
                 FROM(
                         SELECT COUNT(DISTINCT od.ORD_NO)  AS CNT , od.UDT_DT
                           FROM ORD od INNER JOIN ORD_GOD og ON od.ORD_NO = og.ORD_NO
                                                            AND od.UDT_DT BETWEEN ADD_MONTHS(SYSDATE , -1) AND SYSDATE
                                                            AND od.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                                       INNER JOIN LGS_DLIVY_DRCT_GOD ld ON ld.ORD_NO =og.ORD_NO
                                                                       AND ld.ORD_GOD_TURN = og.ORD_GOD_TURN
                                                                       AND ld.DLV_PCUPSP_TURN = og.DLV_PCUPSP_TURN
                                                                       AND ld.DLV_STAT_CD = 'DLV_COMPT'
                            WHERE 1=1
                             AND NOT EXISTS ( SELECT 1 FROM GOD_GOD_EVL ggl WHERE ggl.ORD_NO = og.ORD_NO AND ggl.ORD_GOD_TURN= og.ORD_GOD_TURN)
                             AND od.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
                          GROUP BY  od.UDT_DT
                     )odp
                WHERE odp.CNT <![CDATA[  > ]]>   0
                UNION ALL
                SELECT count(1) as cnt
                 FROM CSO_MTM_INQ cmi
                WHERE cmi.ANS_STAT_CD = 'ANS_COMPT'
                  AND cmi.INQ_MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                  AND cmi.UDT_DT BETWEEN SYSDATE-7 AND SYSDATE
                  AND cmi.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
                UNION ALL
                SELECT  count(1) as cnt
                 FROM CSO_GOD_INQ cgi
                WHERE cgi.ANS_STAT_CD = 'ANS_COMPT'
                  AND cgi.MBR_NO = #{mbr.mbrNo, jdbcType=VARCHAR}
                  AND cgi.UDT_DT BETWEEN SYSDATE-7 AND SYSDATE
                  AND cgi.mall_id IN <foreach collection="plgrimshopMallIdList" item="plgrimshopMallId" index="index" separator="," open="(" close=")">#{plgrimshopMallId}</foreach>
                UNION ALL
                SELECT count(1) as cnt
                FROM EVT et
                WHERE (SYSDATE BETWEEN et.EVT_BEG_DT AND et.EVT_END_DT OR SYSDATE BETWEEN et.APPLCN_BEG_DT AND et.APPLCN_END_DT )
                  AND et.EVT_STAT_CD = 'APRV'
                  AND et.DSP_YN = 'Y'
                  AND et.UPPER_EVT_NO IS NULL
                  AND EXISTS (SELECT 1 FROM EVT_DSP_TGT WHERE evt_no = et.evt_no AND evt_dsp_tgt_tp_cd = 'MALL_ID' AND mall_id = #{mallId, jdbcType=VARCHAR})
<!-- 언어별 이벤트를 조회하도록 변경하였으나 정책으로는 언어별 구분없이 공통으로 나오는게 맞다 하여 일단 주석처리 -->
<!-- 				<if test="lang != null and lang != ''"> -->
<!-- 			      AND EXISTS -->
<!-- 			          (SELECT 1 -->
<!-- 			             FROM EVT_PARTCPTN_TGT A -->
<!-- 			            WHERE A.PARTCPTN_TGT_TP_CD = 'LANG' AND A.EVT_NO = et.EVT_NO AND A.LANG_CD = #{lang, jdbcType=VARCHAR})		    -->
<!-- 				</if> -->
                UNION ALL
                SELECT 0 as cnt FROM DUAL
             ) al

   </select>
    <resultMap id="myTdGodResult" type="com.plgrim.ncp.biz.member.result.MypageTdGodFoResult">
        <result property="todayGodSn" column="TODAY_GOD_SN" />
        <result property="godNo" column="GOD_NO" />
        <result property="godNm" column="GOD_NM" />
        <result property="colorNm" column="COLOR_NM" />
        <result property="imgUrl" column="IMG_URL" />
        <result property="godUrl" column="GOD_URL" />
        <result property="brndId" column="BRND_ID" />
        <result property="brndNm" column="BRND_NM" />
        <result property="godSaleSectCd" column="GOD_SALE_SECT_CD" />
        <result property="lastSalePrc" column="LAST_SALE_PRC" />
        <result property="rtlPrc" column="RTL_PRC" />
        <result property="csmrPrc" column="CSMR_PRC"/>
        <result property="godDcRt" column="GOD_DC_RT" />
        <result property="cpnDcRt" column="CPN_DC_RT" />

    </resultMap>
    <select id="selectMyTodayGodList" parameterType="com.plgrim.ncp.biz.member.data.MypageFoDTO" resultMap="myTdGodResult">
        SELECT /* [biz.mbr.mypage.xml][selectMyTodayGodList]MyPage Today Good 목록조회][csh] */
                td.TODAY_GOD_SN
              , td.GOD_NO
              , td.GOD_NM
              , td.COLOR_NM
              , td.IMG_URL
              , td.GOD_URL
              , td.GOD_SALE_SECT_CD
              , td.BRND_ID
              , td.BRND_NM
              , td.RTL_PRC
              , td.CSMR_PRC
              , td.LAST_SALE_PRC
              , td.GOD_DC_RT
              , td.CPN_DC_RT
          FROM (
          <include refid="com.plgrim.ncp.base.beginPage"/>

                SELECT   mtg.TODAY_GOD_SN
                       , gd.GOD_NO
                       , NVL(gl.god_nm,gd.god_nm) as  god_nm
                       , gd.COLOR_NM
                       , gig.IMG_URL
					<choose>
						<when test='mallId != null and (mallId.equalsIgnoreCase("MBM") or mallId.equalsIgnoreCase("SAM"))'>
					   , FN_SEO_URL(#{mallId, jdbcType=VARCHAR}, #{lang,jdbcType=VARCHAR}, gd.GOD_NO) AS GOD_URL
						</when>
						<otherwise>
                       , '/goods/'|| (SELECT CD_NM FROM MV_SYS_CD WHERE UPPER_CD = 'RECOMEND_SEX' AND CD= GD.RECOMEND_SEX_CD  AND LANG_CD ='KOR') || '/'
                                  || (SELECT SB.BRND_PRDLST_NM FROM SYS_BRND_PRDLST SB WHERE SB.BRND_ID = GD.BRND_ID AND SB.PRDLST_CD  = GD.PRDLST_CD) || '/'
                                  || GD.ERP_GOD_NO AS GOD_URL
                    	</otherwise>
                    </choose>
                       , gd.GOD_SALE_SECT_CD
                       , gd.BRND_ID
                       , NVL(sbl.BRND_NM,sb.BRND_NM) as brnd_nm
                       , dsp.RTL_PRC
                       , dsp.CSMR_PRC
                       , dsp.LAST_SALE_PRC
                       , CASE
                            WHEN dsp.GOD_DC_RT > 0 THEN
                                ROUND ( (dsp.RTL_PRC - dsp.DC_PRC) / dsp.RTL_PRC * 100)
                            ELSE
                            (CASE
                                WHEN dsp.RTL_PRC > dsp.CSMR_PRC THEN
                                    ROUND ((  dsp.RTL_PRC - dsp.CSMR_PRC) / dsp.RTL_PRC * 100)
                                ELSE
                                    0
                            END)
                        END AS GOD_DC_RT
                       , dsp.CPN_DC_RT
                  FROM MBR_TODAY_GOD mtg
                       INNER JOIN GOD gd ON gd.GOD_NO = mtg.GOD_NO
                                         AND mtg.MBR_NO =  #{mbr.mbrNo, jdbcType=VARCHAR}
                                         AND mtg.INQIRE_DT BETWEEN SYSDATE-7 AND SYSDATE
                  INNER JOIN SYS_BRND SB ON gd.BRND_GRP_ID = SB.BRND_ID AND SB.USE_YN ='Y'
                  LEFT OUTER JOIN GOD_IMG gig ON gd.GOD_NO = gig.GOD_NO
                                              AND gig.IMG_TURN = 1 /* 대표 이미지, 0 -> 1 변경(2018.06.14 ryan) */
                                              AND gig.IMG_TP_CD = 'THNAIL' /* 상품 이미지 */
                                              --AND gig.IMG_SIZE_CD = '228X301' /*가로X세로, 주석처리 변경(2018.06.14 ryan) */
                                              AND gig.IMG_APRV_YN = 'Y'
                                              AND gig.IMG_USE_YN = 'Y'
                  LEFT OUTER JOIN GOD_LANGBY_GOD_NM gl ON gd.GOD_NO = gl.GOD_NO
                                                       AND gl.LANG_CD = #{lang,jdbcType=VARCHAR}
                  LEFT OUTER JOIN SYS_BRND_LANG sbl
                        ON SB.BRND_ID =  sbl.BRND_ID
                        AND sbl.LANG_CD =#{lang,jdbcType=VARCHAR}
                  INNER JOIN DSP_GOD_PRC dsp ON dsp.GOD_NO = gd.GOD_NO
                                                  AND dsp.MALL_ID = #{mallId, jdbcType=VARCHAR}
                                                  AND dsp.LANG_CD = 'KOR' /* 2018.08.07 ryan) */
                                                  <!-- AND dsp.LANG_CD =#{lang, jdbcType=VARCHAR} 주석처리 2018.08.07 ryan-->
                                                  <!-- AND dsp.PRC_SECT_CD = #{prcSectCd, jdbcType=VARCHAR} -->
                                                  <if test='spcPrmTp != null and spcPrmTp != ""'>
                                                  AND dsp.PRC_SECT_CD = CASE
                                                                       WHEN (SELECT 1
                                                                               FROM DSP_GOD_PRC A
                                                                              WHERE A.PRC_SECT_CD = #{spcPrmTp, jdbcType=VARCHAR} AND A.GOD_NO = gd.GOD_NO AND ROWNUM = 1)
                                                                               IS NOT NULL
                                                                       THEN #{spcPrmTp, jdbcType=VARCHAR} ELSE #{prcSectCd, jdbcType=VARCHAR} END
                                                  </if>
                                                  <if test='spcPrmTp == null or spcPrmTp == ""'>
                                                  AND dsp.PRC_SECT_CD = #{prcSectCd, jdbcType=VARCHAR}
                                                  </if>
               WHERE 1=1
				 <!-- AND MTG.LANG_CD = #{lang,jdbcType=VARCHAR} /* 다국어 구분없이 전체조회 2018.08.07 ryan */ -->
				 AND MTG.MALL_ID = #{mallId,jdbcType=VARCHAR}
                 AND MTG.DELETE_YN = 'N'
                 AND gd.DSP_YN = 'Y'
                 AND gd.GOD_APRV_SECT_CD = 'APRV_COMPT'
                 -- AND gd.GOD_SALE_SECT_CD IN ('SLDOUT', 'SALE_PROGRS', 'TMPR_SLDOUT')  -- #47237 국문몰 픽업 Only 판매 상태 개발의 건
                 -- AND gd.GOD_SALE_SECT_CD IN ('SLDOUT', 'SALE_PROGRS', 'TMPR_SLDOUT', 'SALE_PROGRS_PKUP')
                 AND gd.GOD_SALE_SECT_CD IN ('SALE_PROGRS', 'SMTM_SLDOUT', 'SLDOUT')    -- 판매중, 일시품절, 품절
                 AND EXISTS
                          (SELECT 1
                             FROM DSP_CTGRY_CNNC_GOD A
                              INNER JOIN DSP_CTGRY B
                                     ON (A.DSP_CTGRY_NO = B.DSP_CTGRY_NO AND B.DSP_YN = 'Y' AND B.DELETE_YN = 'N')
                            WHERE A.GOD_NO = gd.GOD_NO AND A.DSP_YN = 'Y')
                AND  mtg.INQIRE_DT  <![CDATA[>]]> SYSDATE -7
                  ORDER BY mtg.INQIRE_DT DESC
          <include refid="com.plgrim.ncp.base.endPage"/>
              )td
    </select>


     <select id="countMyTodayGodList" parameterType="com.plgrim.ncp.biz.member.data.MypageFoDTO" resultType="long">
        SELECT /* [biz.mbr.mypage.xml][countMyTodayGodList][MyPage Today Good 목록Count조회][csh] */
                COUNT(*)
          FROM (

                SELECT   mtg.TODAY_GOD_SN
                       , gd.GOD_NO
                       , NVL(gl.god_nm,gd.god_nm) as  god_nm
                       , gd.CSMR_PRC
                       , gd.COLOR_NM
                       , gig.IMG_URL
                       , gd.GOD_SALE_SECT_CD
                       , gd.BRND_ID
                       , sb.BRND_NM
                       , dsp.LAST_SALE_PRC
                  FROM MBR_TODAY_GOD mtg
                       INNER JOIN GOD gd ON gd.GOD_NO = mtg.GOD_NO
                                         AND mtg.MBR_NO =  #{mbr.mbrNo, jdbcType=VARCHAR}
                                         AND mtg.INQIRE_DT BETWEEN SYSDATE-7 AND SYSDATE
                  INNER JOIN SYS_BRND SB ON gd.BRND_GRP_ID = SB.BRND_ID AND SB.USE_YN ='Y'
                  LEFT OUTER JOIN GOD_IMG gig ON gd.GOD_NO = gig.GOD_NO
                                              AND gig.IMG_TURN = 1 /* 대표 이미지, 0 -> 1 변경(2018.06.14 ryan) */
                                              AND gig.IMG_TP_CD = 'THNAIL' /* 상품 이미지 */
                                              --AND gig.IMG_SIZE_CD = '228X301' /*가로X세로, 주석처리 변경(2018.06.14 ryan) */
                                              AND gig.IMG_APRV_YN = 'Y'
                                              AND gig.IMG_USE_YN = 'Y'
                  LEFT OUTER JOIN GOD_LANGBY_GOD_NM gl ON gd.GOD_NO = gl.GOD_NO
                                                       AND gl.LANG_CD = #{lang,jdbcType=VARCHAR}
                  INNER JOIN DSP_GOD_PRC dsp ON dsp.GOD_NO = gd.GOD_NO
                                                  AND dsp.MALL_ID = #{mallId, jdbcType=VARCHAR}
                                                  AND dsp.LANG_CD = 'KOR' /* 2018.08.07 ryan) */
                                                  <!-- AND dsp.LANG_CD =#{lang, jdbcType=VARCHAR} 주석처리 2018.08.07 ryan-->
                                                  AND dsp.PRC_SECT_CD = #{prcSectCd, jdbcType=VARCHAR}
                WHERE 1=1
				 <!-- AND MTG.LANG_CD = #{lang,jdbcType=VARCHAR} /* 다국어 구분없이 전체조회 2018.08.07 ryan */ -->
				 AND MTG.MALL_ID = #{mallId, jdbcType=VARCHAR}
                 AND MTG.DELETE_YN = 'N'
                 AND gd.DSP_YN = 'Y'
                 AND gd.GOD_APRV_SECT_CD = 'APRV_COMPT'
                 -- AND gd.GOD_SALE_SECT_CD IN ('SLDOUT', 'SALE_PROGRS', 'TMPR_SLDOUT') -- #47237 국문몰 픽업 Only 판매 상태 개발의 건
                 -- AND gd.GOD_SALE_SECT_CD IN ('SLDOUT', 'SALE_PROGRS', 'TMPR_SLDOUT', 'SALE_PROGRS_PKUP')
                 AND gd.GOD_SALE_SECT_CD IN ('SALE_PROGRS', 'SMTM_SLDOUT', 'SLDOUT')    -- 판매중, 일시품절, 품절
                 AND EXISTS
                          (SELECT 1
                             FROM DSP_CTGRY_CNNC_GOD A
                              INNER JOIN DSP_CTGRY B
                                     ON (A.DSP_CTGRY_NO = B.DSP_CTGRY_NO AND B.DSP_YN = 'Y' AND B.DELETE_YN = 'N')
                            WHERE A.GOD_NO = gd.GOD_NO AND A.DSP_YN = 'Y')
                AND  mtg.INQIRE_DT <![CDATA[>]]> SYSDATE -7

				<!-- ncp 3차 언어구분 추가
                AND mtg.MALL_ID = #{mallId, jdbcType=VARCHAR}
				-->
                <!-- AND mtg.LANG_CD = #{lang, jdbcType=VARCHAR} /* 주석처리 2018.08.07 ryan */ -->
				<!-- ncp 3차 언어구분 추가 -->

                  ORDER BY mtg.INQIRE_DT DESC
              )td
    </select>

    <update id="deleteMyTodayGodList" parameterType="com.plgrim.ncp.biz.member.data.MypageFoDTO">
        UPDATE MBR_TODAY_GOD /* [biz.mbr.mypage.xml][deleteMyTodayGodList][최근본항품 List삭제 ][csh] */
        SET  delete_yn = 'Y'
        ,udt_dt = SYSDATE
        WHERE 1=1
            AND today_god_sn = #{todayGodSn,jdbcType=NUMERIC}
    </update>

    <update id="deleteAllTodayGoodList" parameterType="com.plgrim.ncp.biz.member.data.MypageFoDTO">
        UPDATE MBR_TODAY_GOD /* [biz.mbr.mypage.xml][deleteAllTodayGoodList][최근본항품 List전체삭제 ][csh] */
        SET  delete_yn = 'Y'
        ,udt_dt = SYSDATE
        WHERE 1=1
            AND MBR_NO  = #{mbr.mbrNo, jdbcType=VARCHAR}
            <!-- AND LANG_CD = #{lang,jdbcType=VARCHAR} /* 다국어 구분없이 전체삭제 2018.08.07 ryan */ -->
    </update>

    <resultMap id="historyInfo" type="com.plgrim.ncp.biz.helpdesk.result.HistoryInfoFoResult">
        <result property="mbrLoginLog.mbrLoginCd" column="MBR_LOGIN_CD" />
        <result property="loginDt" column="loginDt" />
        <result property="joinDt" column="joinDt" />
        <result property="mbrLoginLog.loginIp" column="LOGIN_IP" />
        <result property="mbrLoginLog.loginNationCd" column="LOGIN_NATION_CD" />
        <result property="mbrLoginLog.inflowUrl" column="INFLOW_URL" />
        <result property="mbrLoginLog.dvcCd" column="DVC_CD" />
        <result property="mbrLoginLog.inflowSn"   column="INFLOW_SN" />
        <result property="mbrPsnlInfoModHist.psnlInfoModHistSn" column="PSNL_INFO_MOD_HIST_SN" />
        <result property="mbrPsnlInfoModHist.psnlInfoModHistTurn" column="PSNL_INFO_MOD_HIST_TURN" />
        <result property="psnlInfoModDt" column="psnlInfoModDt" />
        <result property="mbrPsnlInfoModHist.psnlInfoUdtSectCd" column="PSNL_INFO_UDT_SECT_CD" />
        <result property="usefJobCd" column="USEF_JOB_CD" />
        <result property="mbrPsnlInfoModHist.modBfVal" column="MOD_BF_VAL" />
        <result property="mbrPsnlInfoModHist.modAfVal" column="MOD_AF_VAL" />
        <result property="mbrPsnlInfoModHist.modMbrNo" column="MOD_MBR_NO" />
        <result property="mbrPsnlInfoModHist.modAdminId" column="MOD_ADMIN_ID" />
        <result property="mbrPsnlInfoModHist.modResnDscr" column="MOD_RESN_DSCR" />
        <result property="mbrPsnlInfoModHist.erpTrnsmisYn" column="ERP_TRNSMIS_YN" />
        <result property="mbrPsnlInfoModHist.modLcSectCd" column="MOD_LC_SECT_CD" />
        <result property="erpTrnsmisDt" column="ERP_TRNSMIS_DT" />
        <result property="regtrId" column="REGTR_ID" />
        <result property="regDt" column="REG_DT" />
        <result property="udterId" column="UDTER_ID" />
        <result property="udtDt" column="UDT_DT" />
        <result property="mbr.joinDt" column="JOIN_DT" />


    </resultMap>
    <!-- 로그인 기록 -->
    <select id="selectMyLoginHistory" parameterType="com.plgrim.ncp.biz.helpdesk.data.HistoryInfoFoDTO" resultMap ="historyInfo">
        <include refid="com.plgrim.ncp.base.beginPage"/>
        SELECT /* [biz.mbr.mypage.xml][selectMyLoginHistory][로그인 기록 List ][김대영]*/
                TO_CHAR(LOG_OCCUR_DT, 'YYYY.MM.DD hh24:mi:ss')  AS loginDt
               ,LOGIN_IP
               ,(SELECT CD_NM FROM MV_SYS_CD WHERE UPPER_CD = 'NATION' AND CD = A.LOGIN_NATION_CD AND LANG_CD = #{lang, jdbcType=VARCHAR}) as LOGIN_NATION_CD
               ,DVC_CD
         FROM  MBR_LOGIN_LOG A
        WHERE  MBR_NO = #{mbrNo, jdbcType=VARCHAR}
        <if test="!@com.plgrim.ncp.framework.commons.StringService@isEmpty(dateStart)" >
          AND LOG_OCCUR_DT BETWEEN  TO_DATE(#{dateStart , jdbcType=VARCHAR}||' 00:00:00','YYYY-MM-DD HH24:MI:SS') AND TO_DATE(#{dateEnd}||' 23:59:59','YYYY-MM-DD HH24:MI:SS')
        </if>
        <if test="@com.plgrim.ncp.framework.commons.StringService@isEmpty(dateStart)">
          AND LOG_OCCUR_DT BETWEEN  ADD_MONTHS(SYSDATE , -3) AND SYSDATE
        </if>
        ORDER BY LOG_OCCUR_DT DESC
        <include refid="com.plgrim.ncp.base.endPage"/>
    </select>

    <!-- 로그인기록 카운트 -->
    <select id ="selectCountHistory" parameterType="com.plgrim.ncp.biz.helpdesk.data.HistoryInfoFoDTO" resultType="long">
        SELECT /* [biz.mbr.mypage.xml][selectCountHistory][페이징 카운터][김대영] */
               COUNT(*)
          FROM MBR_LOGIN_LOG
         WHERE MBR_NO = #{mbrNo, jdbcType=VARCHAR}
          <if test="dateStart != null ">
          AND LOG_OCCUR_DT BETWEEN  TO_DATE(#{dateStart , jdbcType=VARCHAR}||' 00:00:00','YYYY-MM-DD HH24:MI:SS') AND TO_DATE(#{dateEnd}||' 23:59:59','YYYY-MM-DD HH24:MI:SS')
          </if>
          <if test="dateStart == null ">
          AND LOG_OCCUR_DT BETWEEN  ADD_MONTHS(SYSDATE , -3) AND SYSDATE
          </if>
    </select>

    <insert id="insertGodGodEvl" parameterType="godGodEvl">
        INSERT /* [biz.mbr.mypage.xml][insertGodGodEvl] */
        INTO GOD_GOD_EVL
        (
            GOD_NO
           ,GOD_EVL_TURN
           ,GOD_EVL_WRITNG_DT
           ,DSGN_GRP_NO
           ,MBR_NO
           ,CSTMR_NM
           ,ORD_NO
           ,ORD_GOD_TURN
           ,RCPTFR_NO
           <if test='rcptfrNo != null and rcptfrNo != ""'>
           ,INFLOW_ORD_SECT_CD
           </if>
           ,SKU_NO
           ,GOD_EVL_SJ
           ,GOD_EVL_CONT
           ,PKG_EVL_SCORE
           ,QLTY_EVL_SCORE
           ,DLV_EVL_SCORE
           ,SIZE_EVL_CD
           ,COLOR_EVL_CD
           ,BST_GOD_EVL_YN
           ,NTCE_YN
           ,INQIRE_NUM
           ,CNRS_SNS_CD
           ,MALL_ID
           ,LANG_CD
           ,DVC_CD
           ,REGTR_ID
           ,UDTER_ID
           ,REG_DT
           ,UDT_DT
           ,UTID
        )
        VALUES
        (
            #{godNo,jdbcType=VARCHAR}
           ,#{godEvlTurn,jdbcType=NUMERIC}
           ,SYSDATE
           ,(SELECT dsgn_grp_no FROM god WHERE god_no = #{godNo,jdbcType=VARCHAR})
           ,#{mbrNo,jdbcType=VARCHAR}
           ,#{cstmrNm,jdbcType=VARCHAR}
           ,#{ordNo,jdbcType=VARCHAR}
           ,#{ordGodTurn,jdbcType=NUMERIC}
           ,#{rcptfrNo,jdbcType=VARCHAR}
           <if test='rcptfrNo != null and rcptfrNo != ""'>
           ,'OFLNE_ORD'
           </if>
           ,#{skuNo,jdbcType=VARCHAR}
           ,#{godEvlSj,jdbcType=VARCHAR}
           ,#{godEvlCont,jdbcType=VARCHAR}
           ,#{pkgEvlScore,jdbcType=NUMERIC}
           ,#{qltyEvlScore,jdbcType=NUMERIC}
           ,#{dlvEvlScore,jdbcType=NUMERIC}
           ,#{sizeEvlCd,jdbcType=VARCHAR}
           ,#{colorEvlCd,jdbcType=VARCHAR}
           ,#{bstGodEvlYn,jdbcType=VARCHAR}
           ,'Y'
           ,0
           ,#{cnrsSnsCd,jdbcType=VARCHAR}
           ,#{mallId,jdbcType=VARCHAR}
           ,#{langCd,jdbcType=VARCHAR}
           ,#{dvcCd,jdbcType=VARCHAR}
           ,#{mbrNo,jdbcType=VARCHAR}
           ,#{mbrNo,jdbcType=VARCHAR}
           ,SYSDATE
           ,SYSDATE
           ,#{userTrackingId,jdbcType=VARCHAR}
        )
    </insert>



   <!--  <update id="updateGodGodEvl" parameterType="godGodEvl">
        UPDATE /* [biz.mbr.mypage.xml][updateGodGodEvl] */
        GOD_GOD_EVL SET
                DSGN_GRP_NO = #{dsgnGrpNo,jdbcType=VARCHAR}
                <if test="mbrNo != null">
                ,MBR_NO = #{mbrNo,jdbcType=VARCHAR}
                </if>
                <if test="cstmrNm != null">
                ,CSTMR_NM = #{cstmrNm,jdbcType=VARCHAR}
                </if>
                ,ORD_NO = #{ordNo,jdbcType=VARCHAR}
                ,ORD_GOD_TURN = #{ordGodTurn,jdbcType=NUMERIC}
                ,GOD_EVL_SJ = #{godEvlSj,jdbcType=VARCHAR}
                ,GOD_EVL_CONT = #{godEvlCont,jdbcType=VARCHAR}
                ,PKG_EVL_SCORE = #{pkgEvlScore,jdbcType=NUMERIC}
                ,QLTY_EVL_SCORE = #{qltyEvlScore,jdbcType=NUMERIC}
                ,DLV_EVL_SCORE = #{dlvEvlScore,jdbcType=NUMERIC}
                ,SIZE_EVL_CD = #{sizeEvlCd,jdbcType=VARCHAR}
                ,COLOR_EVL_CD = #{colorEvlCd,jdbcType=VARCHAR}
                <if test="bstGodEvlYn != null">
                ,BST_GOD_EVL_YN = #{bstGodEvlYn,jdbcType=VARCHAR}
                </if>
                <if test="ntceYn != null">
                ,NTCE_YN = #{ntceYn,jdbcType=VARCHAR}
                </if>
                <if test="inqireNum != null">
                ,INQIRE_NUM = #{inqireNum,jdbcType=NUMERIC}
                </if>
                <if test="mallId != null">
                ,MALL_ID = #{mallId,jdbcType=VARCHAR}
                </if>
                <if test="langCd != null">
                ,LANG_CD = #{langCd,jdbcType=VARCHAR}
                </if>
                <if test="dvcCd != null">
                ,DVC_CD = #{dvcCd,jdbcType=VARCHAR}
                </if>
                ,UDT_DT = SYSDATE
        WHERE   1 = 1
        AND     GOD_NO = #{godNo,jdbcType=VARCHAR}
        AND     GOD_EVL_TURN = #{godEvlTurn,jdbcType=NUMERIC}
    </update> -->

    <select id ="selectEscPrmCpnGftExchg" parameterType="com.plgrim.ncp.base.entities.datasource1.prm.PrmCpnGftExchg" resultType="prmCpnGftExchg">
        SELECT /* [biz.mbr.mypage.xml][selectEscPrmCpnGftExchg][8s사은품쿠폰조회][ken] */
               exchgbil_no
             , stdr_amt
             , mbr_no
             , beg_dt
             , end_dt
             , issu_dt
          FROM PRM_CPN_GFT_EXCHG
         WHERE mbr_no = #{mbrNo, jdbcType=VARCHAR}
           AND TRUNC(SYSDATE) <![CDATA[  <= ]]>  TRUNC(END_DT)
           AND USE_YN = 'Y'
           AND ROWNUM = 1
    </select>


    <resultMap id="myBrndResult" type="com.plgrim.ncp.biz.member.result.MyBrndFoResult">
        <result property="dspCtgryNo" column="DSP_CTGRY_NO"/>
        <result property="ctgryOutptTpCd" column="CTGRY_OUTPT_TP_CD"/>
        <result property="outptSectCd" column="OUTPT_SECT_CD"/>
        <result property="outptLinkUrl" column="OUTPT_LINK_URL"/>
		<result property="brndId" column="BRND_ID"/>
		<result property="brndNm" column="BRND_NM"/>
		<result property="pcBrndImgFileNm" column="PC_BRND_IMG_FILE_NM"/>
        <result property="pcBrndImgFileUrl" column="PC_BRND_IMG_FILE_URL"/>
        <result property="pcBrndImgAltrtvCont" column="PC_BRND_IMG_ALTRTV_CONT"/>
        <result property="mobileBrndImgFileNm" column="MOBILE_BRND_IMG_FILE_NM"/>
        <result property="mobileBrndImgFileUrl" column="MOBILE_BRND_IMG_FILE_URL"/>
        <result property="mobileBrndImgAltrtvCont" column="MOBILE_BRND_IMG_ALTRTV_CONT"/>
        <result property="pcixeBrndImgFileNm" column="PCIXE_BRND_IMG_FILE_NM"/>
        <result property="pcixeBrndImgFileUrl" column="PCIXE_BRND_IMG_FILE_URL"/>
        <result property="pcixeBrndImgAltrtvCont" column="PCIXE_BRND_IMG_ALTRTV_CONT"/>
        <result property="mbixeBrndImgFileNm" column="MBIXE_BRND_IMG_FILE_NM"/>
        <result property="mbixeBrndImgFileUrl" column="MBIXE_BRND_IMG_FILE_URL"/>
        <result property="mbixeBrndImgAltrtvCont" column="MBIXE_BRND_IMG_ALTRTV_CONT"/>
    </resultMap>

    <select id="selectMyBrndList" parameterType="com.plgrim.ncp.biz.member.data.MyBrndFoDTO" resultMap="myBrndResult">
		<include refid="com.plgrim.ncp.base.beginPage"/>
	        SELECT    /* [biz.mbr.mypage.xml][selectMyBrndList][나의브랜드조회][DIAN] */
			     CTG.DSP_CTGRY_NO
                ,CTG.CTGRY_OUTPT_TP_CD
                ,CTG.OUTPT_SECT_CD
                ,CTG.OUTPT_LINK_URL
			    ,BRND.BRND_ID
				<choose>
				<when test="lang != 'KOR' ">
				/* 전시카테고리명 다국어변환 */
			    ,ctgLang.dsp_ctgry_nm as brnd_nm
				</when>
				<otherwise>
			    ,ctg.dsp_ctgry_nm as brnd_nm
				</otherwise>
				</choose>
				,SBI1.BRND_IMG_FILE_NM          AS PC_BRND_IMG_FILE_NM
	            ,SBI1.BRND_IMG_FILE_URL         AS PC_BRND_IMG_FILE_URL
	            ,SBI1.BRND_IMG_ALTRTV_CONT      AS PC_BRND_IMG_ALTRTV_CONT
	            ,SBI2.BRND_IMG_FILE_NM          AS MOBILE_BRND_IMG_FILE_NM
	            ,SBI2.BRND_IMG_FILE_URL         AS MOBILE_BRND_IMG_FILE_URL
	            ,SBI2.BRND_IMG_ALTRTV_CONT      AS MOBILE_BRND_IMG_ALTRTV_CONT
			FROM MBR_BUKMK_BRND MB
			JOIN SYS_BRND BRND ON (MB.BRND_ID = BRND.BRND_ID )
			JOIN DSP_CTGRY CTG ON (CTG.DSP_BRND_ID = BRND.BRND_ID AND MB.MALL_ID = CTG.APL_MALL_ID)
			<if test="lang != 'KOR' ">
			/* 전시카테고리명 다국어변환 */
			left outer join dsp_ctgry_lang ctgLang ON ctg.dsp_ctgry_no = ctgLang.dsp_ctgry_no AND ctgLang.lang_cd = #{lang, jdbcType=VARCHAR}
			</if>
			LEFT OUTER JOIN (
			    SELECT
			         BRND_ID
			        ,BRND_IMG_FILE_NM
			        ,BRND_IMG_FILE_URL
			        ,BRND_IMG_ALTRTV_CONT
			    FROM SYS_BRND_IMG
			    WHERE 1=1
			    AND BRND_IMG_SECT_CD = 'PC_RPRST_IMG'
			    AND LANG_CD = #{lang, jdbcType=VARCHAR}
			) SBI1
			ON (MB.BRND_ID = SBI1.BRND_ID)
			LEFT OUTER JOIN (
			    SELECT
			         BRND_ID
			        ,BRND_IMG_FILE_NM
			        ,BRND_IMG_FILE_URL
			        ,BRND_IMG_ALTRTV_CONT
			    FROM SYS_BRND_IMG
			    WHERE 1=1
			    AND BRND_IMG_SECT_CD = 'MOBILE_RPRST_IMG'
			    AND LANG_CD = #{lang, jdbcType=VARCHAR}
			) SBI2
			ON (MB.BRND_ID = SBI2.BRND_ID)
			WHERE CTG.APL_MALL_ID = #{mallId, jdbcType=VARCHAR}
			AND CTG.DELETE_YN = 'N'
			AND CTG.SPCIFY_URL_DSP_YN = 'N'
			AND CTG.DSP_YN = 'Y'
			AND CTG.DSP_BRND_ID IN (
			    SELECT T4.BRND_ID
			    FROM DSP_CTGRY_CNNC_GOD T2
			    JOIN GOD T3 ON T3.GOD_NO = T2.GOD_NO
			    JOIN SYS_BRND T4 ON T3.BRND_GRP_ID = T4.BRND_ID
			    JOIN DSP_CTGRY_DSP_APL T1 ON (T1.DSP_CTGRY_NO = T2.DSP_CTGRY_NO AND T1.DSP_YN = 'Y' AND T1.LANG_CD = #{lang, jdbcType=VARCHAR}
				<if test='spcPrmTp != null and spcPrmTp != ""'>
		        AND t1.DSP_MBR_SECT_CD = CASE
		                                 WHEN (SELECT 1
		                                       FROM dsp_ctgry_dsp_apl A
		                                      WHERE A.DSP_MBR_SECT_CD = #{spcPrmTp, jdbcType=VARCHAR} AND t1.dsp_ctgry_no = A.dsp_ctgry_no AND ROWNUM = 1)
		                                       IS NOT NULL
		                                 THEN #{spcPrmTp, jdbcType=VARCHAR} ELSE #{prcSectCd, jdbcType=VARCHAR} END
		        </if>
		        <if test='spcPrmTp == null or spcPrmTp == ""'>
				  AND t1.DSP_MBR_SECT_CD = #{prcSectCd, jdbcType=VARCHAR}
		        </if>
			    )
			    WHERE 1 = 1
			    AND T3.GOD_APRV_SECT_CD = 'APRV_COMPT'
			    -- AND T3.GOD_SALE_SECT_CD IN ('SALE_PROGRS', 'SLDOUT') -- #47237 국문몰 픽업 Only 판매 상태 개발의 건
			    AND T3.GOD_SALE_SECT_CD IN ('SALE_PROGRS', 'SLDOUT', 'SALE_PROGRS_PKUP')
			    AND T3.DSP_YN = 'Y'
			    AND T3.SPCIFY_URL_DSP_YN = 'N'
			    AND T4.USE_YN = 'Y'
				<if test='empYn == "N"'>
				AND t3.EMP_ONLY_YN = 'N'
			 	</if>
			    AND T2.DSP_YN = 'Y'
			    AND T4.USE_YN = 'Y'
			    AND T3.BRND_GRP_ID = MB.BRND_ID
			)
			AND MB.MBR_NO = #{mbrNo, jdbcType=VARCHAR}
			AND MB.MALL_ID = #{mallId, jdbcType=VARCHAR}
			ORDER BY BRND_NM
		<include refid="com.plgrim.ncp.base.endPage"/>
    </select>

    <select id="selectMyBrndListCount" parameterType="com.plgrim.ncp.biz.member.data.MyBrndFoDTO" resultType="Integer">
	    SELECT    /* [biz.mbr.mypage.xml][selectMyBrndListCount][나의브랜드총Count][DIAN] */
		     count(*)
		FROM MBR_BUKMK_BRND MB
		JOIN SYS_BRND BRND ON (MB.BRND_ID = BRND.BRND_ID )
		JOIN DSP_CTGRY CTG ON (CTG.DSP_BRND_ID = BRND.BRND_ID AND MB.MALL_ID = CTG.APL_MALL_ID)
		WHERE CTG.APL_MALL_ID = #{mallId, jdbcType=VARCHAR}
		AND CTG.DELETE_YN = 'N'
		AND CTG.SPCIFY_URL_DSP_YN = 'N'
		AND CTG.DSP_YN = 'Y'
		AND CTG.DSP_BRND_ID IN (
		    SELECT T4.BRND_ID
		    FROM DSP_CTGRY_CNNC_GOD T2
		    JOIN GOD T3 ON T3.GOD_NO = T2.GOD_NO
		    JOIN SYS_BRND T4 ON T3.BRND_GRP_ID = T4.BRND_ID
		    JOIN DSP_CTGRY_DSP_APL T1 ON (T1.DSP_CTGRY_NO = T2.DSP_CTGRY_NO AND T1.DSP_YN = 'Y' AND T1.LANG_CD = #{lang, jdbcType=VARCHAR}
			<if test='spcPrmTp != null and spcPrmTp != ""'>
	        AND t1.DSP_MBR_SECT_CD = CASE
	                                 WHEN (SELECT 1
	                                       FROM dsp_ctgry_dsp_apl A
	                                      WHERE A.DSP_MBR_SECT_CD = #{spcPrmTp, jdbcType=VARCHAR} AND t1.dsp_ctgry_no = A.dsp_ctgry_no AND ROWNUM = 1)
	                                       IS NOT NULL
	                                 THEN #{spcPrmTp, jdbcType=VARCHAR} ELSE #{prcSectCd, jdbcType=VARCHAR} END
	        </if>
	        <if test='spcPrmTp == null or spcPrmTp == ""'>
			  AND t1.DSP_MBR_SECT_CD = #{prcSectCd, jdbcType=VARCHAR}
	        </if>
		    )
		    WHERE 1 = 1
		    AND T3.GOD_APRV_SECT_CD = 'APRV_COMPT'
		    -- AND T3.GOD_SALE_SECT_CD IN ('SALE_PROGRS', 'SLDOUT') -- #47237 국문몰 픽업 Only 판매 상태 개발의 건
		    AND T3.GOD_SALE_SECT_CD IN ('SALE_PROGRS', 'SLDOUT', 'SALE_PROGRS_PKUP')
		    AND T3.DSP_YN = 'Y'
		    AND T3.SPCIFY_URL_DSP_YN = 'N'
		    AND T4.USE_YN = 'Y'
			<if test='empYn == "N"'>
			AND t3.EMP_ONLY_YN = 'N'
		 	</if>
		    AND T2.DSP_YN = 'Y'
		    AND T4.USE_YN = 'Y'
		    AND T3.BRND_GRP_ID = MB.BRND_ID
		)
		AND MB.MBR_NO = #{mbrNo, jdbcType=VARCHAR}
		AND MB.MALL_ID = #{mallId, jdbcType=VARCHAR}
    </select>

    <!-- ERP 상품상태에 따른 상품번호 조회 -->
    <select id="selectErpGodNoByStatus" parameterType="String" resultType="String">
		SELECT /* [biz.mbr.reserve.xml][selectErpGodNoByStatus][ ERP 상품상태에 따른 상품번호 조회] */
		       gd.god_no
		FROM god gd , god_itm gt
		WHERE gd.god_no = gt.god_no
		  AND gt.sku_no = #{matNo, jdbcType=VARCHAR}
		  AND gd.GOD_APRV_SECT_CD = 'APRV_COMPT'
		  AND gd.DSP_YN = 'Y'
		  -- AND gd.GOD_SALE_SECT_CD in ('SALE_PROGRS', 'SLDOUT') -- #47237 국문몰 픽업 Only 판매 상태 개발의 건
		  AND gd.GOD_SALE_SECT_CD in ('SALE_PROGRS', 'SLDOUT', 'SALE_PROGRS_PKUP')
		  AND ROWNUM =1
    </select>

	<!-- 픽업주문 -> 일반배송 전환 가능여부 확인 -->
	<select id="getPickupDeliveryChangeYn" parameterType="com.plgrim.ncp.biz.order.data.MypageOrderInfoDTO" resultType="com.plgrim.ncp.biz.order.data.MypageOrderInfoDTO">
		SELECT	/* [biz.mbr.mypage.xml][getPickupDeliveryChangeYn][일반배송 전환 여부 (주문별)] */
			CASE
				WHEN (SELECT count(1)
						FROM LGS_DLIVY_DRCT_GOD
						WHERE dlv_stat_cd NOT IN ('DLIVY_DRCT_CNCL', 'DLV_WAIT','DLIVY_DRCT','SHOP_PRPARE_COMPT')
							AND ord_no = #{ordNo,jdbcType=VARCHAR}
						) = 0
				THEN
					CASE
						WHEN (SELECT count(1)
								FROM LGS_DLIVY_DRCT_GOD
								WHERE dlv_stat_cd IN ('DLV_WAIT','DLIVY_DRCT','SHOP_PRPARE_COMPT')
									AND ord_no = #{ordNo,jdbcType=VARCHAR}
								) > 0
						THEN 'Y'
						ELSE 'N'
						END
				ELSE 'N'
			END AS dlvYn
		FROM DUAL
    </select>

    <!-- 픽업주문 -> 일반배송 전환 가능여부 확인 ( #47710 옵션 판매상태 기준으로 조회 ) -->
    <select id="getPickupDeliveryChangeYnByItmStat" parameterType="String" resultType="String">
        SELECT /* [biz.mbr.mypage.xml][getPickupDeliveryChangeYnByItmStat][옵션 판매상태에 따른 일반배송 전환가능 여부 조회] */
               CASE WHEN count(gi.itm_stat_cd) > 0 THEN 'N'
                    ELSE 'Y'
               END as pickupDlvChangeYn
          FROM ORD_GOD og
          JOIN LGS_DLVSP ld
            ON og.ord_no = ld.ord_no
           AND og.dlv_pcupsp_turn = ld.dlv_pcupsp_turn
          JOIN GOD_ITM gi
            ON og.itm_no = gi.itm_no
         WHERE og.ord_no = #{ordNo}
           AND og.god_tp_cd = 'GNRL_GOD'
           AND gi.itm_stat_cd = 'SALE_PROGRS_PKUP' /* 픽업판매중 상품이 있으면 일반배송으로 전환 불가 */
           AND ld.dlv_pcupsp_sect_cd = 'ORD_DLVSP'
    </select>

    <!-- 수신동의 유도 캠페인쿠폰 카운트 -->
    <select id = "selectMyCampaginCouponCount" parameterType ="com.plgrim.ncp.base.entities.datasource1.mbr.MbrIssuCpn" resultType="Integer">
		SELECT  /* [biz.mbr.mypage.xml][selectMyCampaginCouponCount][조회 : 수신동의 유도 캠페인쿠폰 카운트 ] */
		COUNT(*)
		  FROM MBR_ISSU_CPN MIC JOIN MBR MBR ON MIC.MBR_NO = MBR.MBR_NO JOIN PRM_CPN PC ON MIC.PRM_NO = PC.PRM_NO
		 WHERE 1=1
		   AND MIC.MBR_NO = #{mbrNo,jdbcType=VARCHAR}
		   AND MIC.PRM_NO = #{prmNo,jdbcType=VARCHAR}
    </select>

    <select id="selectGodWishList" parameterType="com.plgrim.ncp.biz.member.data.MypageFoDTO" resultType="com.plgrim.ncp.biz.member.result.MypageWishFoResult">
        SELECT bwg.WISHLST_SN
              ,bwg.GOD_TURN
          FROM BSK_WISHLST bw
    INNER JOIN BSK_WISHLST_GOD bwg ON bw.WISHLST_SN = bwg.WISHLST_SN
         WHERE bwg.GOD_NO = #{godNo ,jdbcType=VARCHAR}
           AND bw.MBR_NO =  #{mbrNo, jdbcType=VARCHAR}
    </select>
    <select id="selectGodWishListCount" parameterType="com.plgrim.ncp.biz.member.data.MypageFoDTO" resultType="com.plgrim.ncp.biz.member.result.MypageWishFoResult">
        SELECT COUNT(bwg.GOD_TURN) AS wishListCount
              ,CASE WHEN MAX(mb.MBR_NO) IS NULL THEN '' ELSE 'active' END AS wishListYn
          FROM BSK_WISHLST bw
    INNER JOIN BSK_WISHLST_GOD bwg ON bw.WISHLST_SN = bwg.WISHLST_SN
    LEFT OUTER JOIN MBR mb ON bw.MBR_NO = mb.MBR_NO AND mb.MBR_NO = #{mbrNo, jdbcType=VARCHAR}
         WHERE GOD_NO = #{godNo ,jdbcType=VARCHAR}
    </select>
</mapper>